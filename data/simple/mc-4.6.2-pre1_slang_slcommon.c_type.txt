int	O
SLang_Version	int
=	O
SLANG_VERSION	int
;	O
char	O
*	O
SLang_Version_String	pointer
=	O
SLANG_VERSION_STRING	pointer
;	O
int	O
_pSLinterp_UTF8_Mode	int
=	O
0	int
;	O
int	O
_pSLtt_UTF8_Mode	int
=	O
0	int
;	O
int	O
_pSLutf8_mode	int
=	O
0	int
;	O
int	O
SLutf8_is_utf8_mode	function
(	O
void	O
)	O
{	O
return	O
_pSLutf8_mode	int
;	O
}	O
int	O
SLinterp_utf8_enable	function
(	O
int	O
mode	int
)	O
{	O
if	O
(	O
mode	int
==	O
-	O
1	int
)	O
mode	int
=	O
_pSLutf8_mode	int
;	O
return	O
_pSLinterp_UTF8_Mode	int
=	O
mode	int
;	O
}	O
int	O
SLinterp_is_utf8_mode	function
(	O
void	O
)	O
{	O
return	O
_pSLinterp_UTF8_Mode	int
;	O
}	O
static	O
int	O
utf8_enable	function
(	O
int	O
mode	int
)	O
{	O
char	O
*	O
locale	pointer
;	O
if	O
(	O
mode	int
!=	O
-	O
1	int
)	O
return	O
(	O
mode	int
!=	O
0	int
)	O
;	O
(	O
void	O
)	O
setlocale	function
(	O
LC_ALL	O
,	O
""	pointer
)	O
;	O
locale	pointer
=	O
setlocale	function
(	O
LC_ALL	O
,	O
""	pointer
)	O
;	O
if	O
(	O
(	O
(	O
locale	pointer
==	O
NULL	O
)	O
||	O
(	O
*	O
locale	pointer
==	O
0	int
)	O
)	O
&&	O
(	O
(	O
NULL	O
==	O
(	O
locale	pointer
=	O
getenv	function
(	O
"LC_ALL"	pointer
)	O
)	O
)	O
||	O
(	O
*	O
locale	pointer
==	O
0	int
)	O
)	O
&&	O
(	O
(	O
NULL	O
==	O
(	O
locale	pointer
=	O
getenv	function
(	O
"LC_CTYPE"	pointer
)	O
)	O
)	O
||	O
(	O
*	O
locale	pointer
==	O
0	int
)	O
)	O
&&	O
(	O
(	O
NULL	O
==	O
(	O
locale	pointer
=	O
getenv	function
(	O
"LANG"	pointer
)	O
)	O
)	O
||	O
(	O
*	O
locale	pointer
==	O
0	int
)	O
)	O
)	O
return	O
0	int
;	O
while	O
(	O
*	O
locale	pointer
&&	O
(	O
*	O
locale	pointer
!=	O
'.'	O
)	O
&&	O
(	O
*	O
locale	pointer
!=	O
'@'	O
)	O
&&	O
(	O
*	O
locale	pointer
!=	O
'+'	O
)	O
&&	O
(	O
*	O
locale	pointer
!=	O
','	O
)	O
)	O
locale	pointer
++	O
;	O
if	O
(	O
*	O
locale	pointer
==	O
'.'	O
)	O
{	O
locale	pointer
++	O
;	O
if	O
(	O
0	int
==	O
strncmp	function
(	O
locale	pointer
,	O
"UTF-8"	pointer
,	O
5	int
)	O
)	O
locale	pointer
+=	O
5	int
;	O
else	O
if	O
(	O
0	int
==	O
strncmp	function
(	O
locale	pointer
,	O
"utf8"	pointer
,	O
4	int
)	O
)	O
locale	pointer
+=	O
4	int
;	O
else	O
return	O
0	int
;	O
if	O
(	O
(	O
*	O
locale	pointer
==	O
0	int
)	O
||	O
(	O
*	O
locale	pointer
==	O
'@'	O
)	O
||	O
(	O
*	O
locale	pointer
==	O
'+'	O
)	O
||	O
(	O
*	O
locale	pointer
==	O
','	O
)	O
)	O
return	O
1	int
;	O
}	O
return	O
0	int
;	O
}	O
int	O
SLutf8_enable	function
(	O
int	O
mode	int
)	O
{	O
mode	int
=	O
utf8_enable	function
(	O
mode	int
)	O
;	O
_pSLutf8_mode	int
=	O
mode	int
;	O
_pSLtt_UTF8_Mode	int
=	O
mode	int
;	O
_pSLinterp_UTF8_Mode	int
=	O
mode	int
;	O
return	O
mode	int
;	O
}	O
char	O
*	O
SLcalloc	function
(	O
unsigned	O
int	O
nelems	int
,	O
unsigned	O
int	O
len	int
)	O
{	O
char	O
*	O
p	pointer
;	O
len	int
=	O
nelems	int
*	O
len	int
;	O
p	pointer
=	O
SLmalloc	O
(	O
len	int
)	O
;	O
if	O
(	O
p	pointer
!=	O
NULL	O
)	O
memset	function
(	O
p	pointer
,	O
0	int
,	O
len	int
)	O
;	O
return	O
p	pointer
;	O
}	O
int	O
_pSLsecure_issetugid	function
(	O
void	O
)	O
{	O
static	O
int	O
enable_secure	int
;	O
if	O
(	O
enable_secure	int
==	O
0	int
)	O
{	O
if	O
(	O
(	O
getuid	function
(	O
)	O
!=	O
geteuid	function
(	O
)	O
)	O
||	O
(	O
getgid	function
(	O
)	O
!=	O
getegid	function
(	O
)	O
)	O
)	O
enable_secure	int
=	O
1	int
;	O
else	O
enable_secure	int
=	O
-	O
1	int
;	O
}	O
return	O
(	O
enable_secure	int
==	O
1	int
)	O
;	O
}	O
char	O
*	O
_pSLsecure_getenv	function
(	O
char	O
*	O
s	pointer
)	O
{	O
if	O
(	O
_pSLsecure_issetugid	function
(	O
)	O
)	O
return	O
NULL	O
;	O
return	O
getenv	function
(	O
s	pointer
)	O
;	O
}	O
typedef	O
struct	O
Interrupt_Hook_Type	struct
{	O
int	O
(	O
*	O
func	pointer
)	O
(	O
VOID_STAR	pointer
)	O
;	O
VOID_STAR	pointer
client_data	pointer
;	O
struct	O
Interrupt_Hook_Type	struct
*	O
next	pointer
;	O
}	O
Interrupt_Hook_Type	struct
;	O
static	O
Interrupt_Hook_Type	struct
*	O
Interrupt_Hooks	pointer
=	O
NULL	O
;	O
static	O
Interrupt_Hook_Type	struct
*	O
find_interrupt_hook	function
(	O
int	O
(	O
*	O
func	pointer
)	O
(	O
VOID_STAR	pointer
)	O
,	O
VOID_STAR	pointer
cd	pointer
,	O
Interrupt_Hook_Type	struct
*	O
*	O
prevp	pointer
)	O
{	O
Interrupt_Hook_Type	struct
*	O
h	pointer
=	O
Interrupt_Hooks	pointer
;	O
Interrupt_Hook_Type	struct
*	O
prev	pointer
=	O
NULL	O
;	O
while	O
(	O
h	pointer
!=	O
NULL	O
)	O
{	O
if	O
(	O
(	O
h	pointer
->	O
func	pointer
==	O
func	pointer
)	O
&&	O
(	O
h	pointer
->	O
client_data	pointer
==	O
cd	pointer
)	O
)	O
{	O
if	O
(	O
prevp	pointer
!=	O
NULL	O
)	O
*	O
prevp	pointer
=	O
prev	pointer
;	O
return	O
h	pointer
;	O
}	O
h	pointer
=	O
h	pointer
->	O
next	pointer
;	O
}	O
return	O
NULL	O
;	O
}	O
int	O
SLang_add_interrupt_hook	function
(	O
int	O
(	O
*	O
func	pointer
)	O
(	O
VOID_STAR	pointer
)	O
,	O
VOID_STAR	pointer
cd	pointer
)	O
{	O
Interrupt_Hook_Type	struct
*	O
h	pointer
;	O
if	O
(	O
NULL	O
!=	O
find_interrupt_hook	function
(	O
func	pointer
,	O
cd	pointer
,	O
NULL	O
)	O
)	O
return	O
0	int
;	O
if	O
(	O
NULL	O
==	O
(	O
h	pointer
=	O
(	O
Interrupt_Hook_Type	struct
*	O
)	O
SLmalloc	O
(	O
sizeof	O
(	O
Interrupt_Hook_Type	struct
)	O
)	O
)	O
)	O
return	O
-	O
1	int
;	O
h	pointer
->	O
func	pointer
=	O
func	pointer
;	O
h	pointer
->	O
client_data	pointer
=	O
cd	pointer
;	O
h	pointer
->	O
next	pointer
=	O
Interrupt_Hooks	pointer
;	O
Interrupt_Hooks	pointer
=	O
h	pointer
;	O
return	O
0	int
;	O
}	O
void	O
SLang_remove_interrupt_hook	function
(	O
int	O
(	O
*	O
func	pointer
)	O
(	O
VOID_STAR	pointer
)	O
,	O
VOID_STAR	pointer
cd	pointer
)	O
{	O
Interrupt_Hook_Type	struct
*	O
h	pointer
,	O
*	O
hprev	pointer
;	O
if	O
(	O
NULL	O
==	O
(	O
h	pointer
=	O
find_interrupt_hook	function
(	O
func	pointer
,	O
cd	pointer
,	O
&	O
hprev	pointer
)	O
)	O
)	O
return	O
;	O
if	O
(	O
hprev	pointer
==	O
NULL	O
)	O
Interrupt_Hooks	pointer
=	O
h	pointer
->	O
next	pointer
;	O
else	O
hprev	pointer
->	O
next	pointer
=	O
h	pointer
->	O
next	pointer
;	O
SLfree	O
(	O
(	O
char	O
*	O
)	O
h	pointer
)	O
;	O
}	O
int	O
SLang_handle_interrupt	function
(	O
void	O
)	O
{	O
Interrupt_Hook_Type	struct
*	O
h	pointer
;	O
int	O
status	int
=	O
0	int
;	O
h	pointer
=	O
Interrupt_Hooks	pointer
;	O
while	O
(	O
h	pointer
!=	O
NULL	O
)	O
{	O
if	O
(	O
-	O
1	int
==	O
(	O
*	O
h	pointer
->	O
func	pointer
)	O
(	O
h	pointer
->	O
client_data	pointer
)	O
)	O
status	int
=	O
-	O
1	int
;	O
h	pointer
=	O
h	pointer
->	O
next	pointer
;	O
}	O
return	O
status	int
;	O
}	O
