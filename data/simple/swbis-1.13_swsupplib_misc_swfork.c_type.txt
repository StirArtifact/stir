static	O
int	O
my_openpty	function
(	O
int	O
*	O
p_fdm	pointer
,	O
int	O
*	O
p_fds	pointer
)	O
{	O
return	O
-	O
1	int
;	O
}	O
static	O
void	O
release_tty_name	function
(	O
char	O
*	O
slave_pty_name	pointer
,	O
int	O
be_verbose	int
)	O
{	O
if	O
(	O
chown	function
(	O
slave_pty_name	pointer
,	O
(	O
uid_t	int
)	O
(	O
0	int
)	O
,	O
(	O
gid_t	int
)	O
(	O
0	int
)	O
)	O
<	O
0	int
)	O
if	O
(	O
be_verbose	int
)	O
fprintf	function
(	O
stderr	pointer
,	O
"%s: chown %.100s 0 0 failed: %.100s"	pointer
,	O
swlib_utilname_get	function
(	O
)	O
,	O
slave_pty_name	pointer
,	O
strerror	function
(	O
errno	O
)	O
)	O
;	O
if	O
(	O
chmod	function
(	O
slave_pty_name	pointer
,	O
(	O
mode_t	int
)	O
0666	int
)	O
<	O
0	int
)	O
if	O
(	O
be_verbose	int
)	O
fprintf	function
(	O
stderr	pointer
,	O
"%s: chmod %.100s 0666 failed: %.100s"	pointer
,	O
swlib_utilname_get	function
(	O
)	O
,	O
slave_pty_name	pointer
,	O
strerror	function
(	O
errno	O
)	O
)	O
;	O
}	O
static	O
int	O
swlib_ptym_open	function
(	O
char	O
*	O
pts_name	pointer
,	O
int	O
*	O
start	int
)	O
{	O
int	O
fdm	int
;	O
char	O
*	O
ptr1	pointer
,	O
*	O
ptr2	pointer
;	O
char	O
ptr2char	array
[	O
]	O
=	O
"0123456789abcdef"	pointer
;	O
char	O
*	O
ptr2start	pointer
;	O
if	O
(	O
*	O
start	int
<	O
0	int
||	O
(	O
unsigned	O
int	O
)	O
(	O
*	O
start	int
)	O
>=	O
strlen	function
(	O
ptr2char	array
)	O
)	O
return	O
-	O
1	int
;	O
ptr2start	pointer
=	O
ptr2char	array
+	O
(	O
*	O
start	int
)	O
;	O
strcpy	function
(	O
pts_name	pointer
,	O
"/dev/ptyXY"	pointer
)	O
;	O
for	O
(	O
ptr1	pointer
=	O
"pqrstuvwxyzPQRST"	pointer
;	O
*	O
ptr1	pointer
!=	O
0	int
;	O
ptr1	pointer
++	O
)	O
{	O
pts_name	pointer
[	O
8	int
]	O
=	O
*	O
ptr1	pointer
;	O
for	O
(	O
ptr2	pointer
=	O
ptr2start	pointer
;	O
*	O
ptr2	pointer
!=	O
0	int
;	O
ptr2	pointer
++	O
)	O
{	O
if	O
(	O
swlib_get_verbose_level	function
(	O
)	O
>=	O
SWC_VERBOSE_7	int
)	O
{	O
fprintf	function
(	O
stderr	pointer
,	O
"%s: ptr2start is [%s]\n"	pointer
,	O
swlib_utilname_get	function
(	O
)	O
,	O
ptr2start	pointer
)	O
;	O
}	O
pts_name	pointer
[	O
9	int
]	O
=	O
*	O
ptr2	pointer
;	O
if	O
(	O
(	O
fdm	int
=	O
open	function
(	O
pts_name	pointer
,	O
O_RDWR	int
)	O
)	O
<	O
0	int
)	O
{	O
if	O
(	O
errno	O
==	O
ENOENT	int
)	O
{	O
return	O
(	O
-	O
1	int
)	O
;	O
}	O
else	O
{	O
(	O
*	O
start	int
)	O
++	O
;	O
if	O
(	O
swlib_get_verbose_level	function
(	O
)	O
>=	O
SWC_VERBOSE_7	int
)	O
fprintf	function
(	O
stderr	pointer
,	O
"%s: open attempt failed on pty (master) : %s\n"	pointer
,	O
swlib_utilname_get	function
(	O
)	O
,	O
pts_name	pointer
)	O
;	O
continue	O
;	O
}	O
}	O
if	O
(	O
swlib_get_verbose_level	function
(	O
)	O
>=	O
SWC_VERBOSE_7	int
)	O
{	O
fprintf	function
(	O
stderr	pointer
,	O
"%s: Using pty (master) : %s\n"	pointer
,	O
swlib_utilname_get	function
(	O
)	O
,	O
pts_name	pointer
)	O
;	O
}	O
pts_name	pointer
[	O
5	int
]	O
=	O
't'	O
;	O
return	O
(	O
fdm	int
)	O
;	O
}	O
}	O
return	O
(	O
-	O
1	int
)	O
;	O
}	O
static	O
int	O
swlib_ptys_open	function
(	O
char	O
*	O
pts_name	pointer
)	O
{	O
struct	O
passwd	struct
*	O
pw	pointer
;	O
struct	O
group	struct
*	O
grp	pointer
;	O
mode_t	int
mode	int
;	O
uid_t	int
uid	int
;	O
gid_t	int
gid	int
;	O
int	O
fds	int
;	O
if	O
(	O
(	O
fds	int
=	O
open	function
(	O
pts_name	pointer
,	O
O_RDWR	int
)	O
)	O
<	O
0	int
)	O
{	O
fprintf	function
(	O
stderr	pointer
,	O
"%s: swlib_ptys_open: open failed on %s : %s\n"	pointer
,	O
swlib_utilname_get	function
(	O
)	O
,	O
pts_name	pointer
,	O
strerror	function
(	O
errno	O
)	O
)	O
;	O
return	O
(	O
-	O
1	int
)	O
;	O
}	O
if	O
(	O
(	O
pw	pointer
=	O
getpwuid	function
(	O
getuid	function
(	O
)	O
)	O
)	O
==	O
NULL	O
)	O
{	O
SWLIB_FATAL	O
(	O
"passwd entry lookup failed for a uid"	pointer
)	O
;	O
return	O
-	O
1	int
;	O
}	O
if	O
(	O
(	O
grp	pointer
=	O
getgrnam	function
(	O
"tty"	pointer
)	O
)	O
!=	O
NULL	O
)	O
{	O
gid	int
=	O
grp	pointer
->	O
gr_gid	int
;	O
mode	int
=	O
S_IRUSR	O
|	O
S_IWUSR	O
|	O
S_IWGRP	O
;	O
}	O
else	O
{	O
gid	int
=	O
pw	pointer
->	O
pw_gid	int
;	O
mode	int
=	O
S_IRUSR	O
|	O
S_IWUSR	O
|	O
S_IWGRP	O
|	O
S_IWOTH	O
;	O
}	O
uid	int
=	O
pw	pointer
->	O
pw_uid	int
;	O
if	O
(	O
chown	function
(	O
pts_name	pointer
,	O
uid	int
,	O
gid	int
)	O
<	O
0	int
)	O
{	O
if	O
(	O
uid	int
==	O
0	int
)	O
{	O
SWLIB_FATAL	O
(	O
"chown failed for slave pty"	pointer
)	O
;	O
return	O
-	O
1	int
;	O
}	O
else	O
{	O
fprintf	function
(	O
stderr	pointer
,	O
"%s: warning: using pty %s with insecure ownership\n"	pointer
,	O
swlib_utilname_get	function
(	O
)	O
,	O
pts_name	pointer
)	O
;	O
}	O
}	O
if	O
(	O
chmod	function
(	O
pts_name	pointer
,	O
mode	int
)	O
<	O
0	int
)	O
{	O
if	O
(	O
uid	int
==	O
0	int
)	O
{	O
SWLIB_FATAL	O
(	O
"chmod failed for slave pty"	pointer
)	O
;	O
return	O
-	O
1	int
;	O
}	O
else	O
{	O
fprintf	function
(	O
stderr	pointer
,	O
"%s: warning: using pty %s with insecure permissions\n"	pointer
,	O
swlib_utilname_get	function
(	O
)	O
,	O
pts_name	pointer
)	O
;	O
}	O
}	O
return	O
(	O
fds	int
)	O
;	O
}	O
pid_t	int
swlib_pty_fork2	function
(	O
int	O
*	O
ptrfdm	pointer
,	O
int	O
ofd	int
,	O
int	O
ifd	int
,	O
int	O
efd	int
,	O
const	O
struct	O
termios	struct
*	O
slave_termios	pointer
,	O
const	O
struct	O
winsize	struct
*	O
slave_winsize	pointer
,	O
int	O
*	O
pc_pid	pointer
,	O
int	O
make_raw	int
,	O
sigset_t	struct
*	O
sigmask	pointer
)	O
{	O
int	O
fdm	int
,	O
fds	int
;	O
pid_t	int
pid	int
;	O
pid_t	int
c_pid	int
;	O
char	O
pts_name	pointer
[	O
20	int
]	O
;	O
char	O
*	O
tmpc	pointer
;	O
char	O
*	O
pts_type	pointer
;	O
char	O
slave_pty_name	pointer
[	O
50	int
]	O
;	O
int	O
op	array
[	O
2	int
]	O
;	O
int	O
ip	array
[	O
2	int
]	O
;	O
int	O
pcpipe	array
[	O
2	int
]	O
;	O
int	O
testfds	int
=	O
-	O
1	int
;	O
int	O
start	int
=	O
0	int
;	O
int	O
have_openpty	int
=	O
0	int
;	O
int	O
have_posix_openpt	int
=	O
0	int
;	O
int	O
ret	int
;	O
have_posix_openpt	int
=	O
1	int
;	O
have_openpty	int
=	O
0	int
;	O
slave_pty_name	pointer
[	O
0	int
]	O
=	O
'\0'	O
;	O
if	O
(	O
have_posix_openpt	int
)	O
{	O
E_DEBUG	O
(	O
""	pointer
)	O
;	O
pts_type	pointer
=	O
"posix_openpt"	pointer
;	O
ret	int
=	O
posix_openpt	function
(	O
O_RDWR	int
|	O
O_NOCTTY	int
)	O
;	O
if	O
(	O
ret	int
<	O
0	int
)	O
{	O
fprintf	function
(	O
stderr	pointer
,	O
"%s: posix_openpt failed: %s\n"	pointer
,	O
swlib_utilname_get	function
(	O
)	O
,	O
strerror	function
(	O
errno	O
)	O
)	O
;	O
return	O
-	O
1	int
;	O
}	O
fdm	int
=	O
ret	int
;	O
E_DEBUG2	O
(	O
"fdm=%d"	pointer
,	O
fdm	int
)	O
;	O
tmpc	pointer
=	O
ptsname	function
(	O
fdm	int
)	O
;	O
if	O
(	O
tmpc	pointer
==	O
NULL	O
)	O
{	O
fprintf	function
(	O
stderr	pointer
,	O
"%s: ptsname failed\n"	pointer
,	O
swlib_utilname_get	function
(	O
)	O
)	O
;	O
return	O
-	O
1	int
;	O
}	O
E_DEBUG2	O
(	O
"ptsname=%s"	pointer
,	O
tmpc	pointer
)	O
;	O
strncpy	function
(	O
slave_pty_name	pointer
,	O
tmpc	pointer
,	O
sizeof	O
(	O
slave_pty_name	pointer
)	O
-	O
1	int
)	O
;	O
slave_pty_name	pointer
[	O
sizeof	O
(	O
slave_pty_name	pointer
)	O
-	O
1	int
]	O
=	O
'\0'	O
;	O
}	O
else	O
if	O
(	O
have_openpty	int
)	O
{	O
pts_type	pointer
=	O
"openpty"	pointer
;	O
swlib_doif_writef	O
(	O
swlib_get_verbose_level	function
(	O
)	O
,	O
SWC_VERBOSE_7	int
,	O
(	O
struct	O
sw_logspec	struct
*	O
)	O
(	O
NULL	O
)	O
,	O
STDERR_FILENO	int
,	O
"using system openpty()\n"	pointer
)	O
;	O
ret	int
=	O
my_openpty	function
(	O
&	O
fdm	int
,	O
&	O
fds	int
)	O
;	O
if	O
(	O
ret	int
<	O
0	int
)	O
{	O
fprintf	function
(	O
stderr	pointer
,	O
"%s: openpty failed\n"	pointer
,	O
swlib_utilname_get	function
(	O
)	O
)	O
;	O
return	O
-	O
1	int
;	O
}	O
tmpc	pointer
=	O
ttyname	function
(	O
fds	int
)	O
;	O
if	O
(	O
tmpc	pointer
==	O
NULL	O
)	O
{	O
fprintf	function
(	O
stderr	pointer
,	O
"%s: ttyname failed\n"	pointer
,	O
swlib_utilname_get	function
(	O
)	O
)	O
;	O
return	O
-	O
1	int
;	O
}	O
strncpy	function
(	O
slave_pty_name	pointer
,	O
tmpc	pointer
,	O
sizeof	O
(	O
slave_pty_name	pointer
)	O
-	O
1	int
)	O
;	O
slave_pty_name	pointer
[	O
sizeof	O
(	O
slave_pty_name	pointer
)	O
-	O
1	int
]	O
=	O
'\0'	O
;	O
swlib_doif_writef	O
(	O
swlib_get_verbose_level	function
(	O
)	O
,	O
SWC_VERBOSE_7	int
,	O
(	O
struct	O
sw_logspec	struct
*	O
)	O
(	O
NULL	O
)	O
,	O
STDERR_FILENO	int
,	O
"opened master pty [%s] using openpty\n"	pointer
,	O
ttyname	function
(	O
fdm	int
)	O
)	O
;	O
swlib_doif_writef	O
(	O
swlib_get_verbose_level	function
(	O
)	O
,	O
SWC_VERBOSE_7	int
,	O
(	O
struct	O
sw_logspec	struct
*	O
)	O
(	O
NULL	O
)	O
,	O
STDERR_FILENO	int
,	O
"opened slave pty [%s] using openpty\n"	pointer
,	O
slave_pty_name	pointer
)	O
;	O
}	O
else	O
{	O
pts_type	pointer
=	O
"SVR4"	pointer
;	O
while	O
(	O
testfds	int
<	O
0	int
)	O
{	O
if	O
(	O
swlib_get_verbose_level	function
(	O
)	O
>=	O
SWC_VERBOSE_7	int
)	O
{	O
fprintf	function
(	O
stderr	pointer
,	O
"%s: pty name search index: %d\n"	pointer
,	O
swlib_utilname_get	function
(	O
)	O
,	O
start	int
)	O
;	O
}	O
if	O
(	O
(	O
fdm	int
=	O
swlib_ptym_open	function
(	O
pts_name	pointer
,	O
&	O
start	int
)	O
)	O
<	O
0	int
)	O
{	O
fprintf	function
(	O
stderr	pointer
,	O
"can't open master pty: %s\n"	pointer
,	O
pts_name	pointer
)	O
;	O
fprintf	function
(	O
stderr	pointer
,	O
"fatal: out of ptys\n"	pointer
)	O
;	O
return	O
-	O
1	int
;	O
}	O
if	O
(	O
(	O
testfds	int
=	O
swlib_ptys_open	function
(	O
pts_name	pointer
)	O
)	O
<	O
0	int
)	O
{	O
close	pointer
(	O
fdm	int
)	O
;	O
if	O
(	O
swlib_get_verbose_level	function
(	O
)	O
>=	O
SWC_VERBOSE_7	int
)	O
{	O
fprintf	function
(	O
stderr	pointer
,	O
"%s: can't open slave pty %s\n"	pointer
,	O
swlib_utilname_get	function
(	O
)	O
,	O
pts_name	pointer
)	O
;	O
}	O
}	O
if	O
(	O
testfds	int
>=	O
0	int
)	O
close	pointer
(	O
testfds	int
)	O
;	O
start	int
++	O
;	O
}	O
}	O
fprintf	function
(	O
stderr	pointer
,	O
"%s: @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\n"	pointer
"%s: Warning: this program's usage of pty's (%s) may be insecure.\n"	pointer
"%s: This feature of swcopy is meant for testing only.\n"	pointer
"%s: @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\n"	pointer
,	O
swlib_utilname_get	function
(	O
)	O
,	O
swlib_utilname_get	function
(	O
)	O
,	O
pts_type	pointer
,	O
swlib_utilname_get	function
(	O
)	O
,	O
swlib_utilname_get	function
(	O
)	O
)	O
;	O
if	O
(	O
ifd	int
<	O
0	int
)	O
ifd	int
=	O
STDIN_FILENO	int
;	O
if	O
(	O
ofd	int
<	O
0	int
)	O
ofd	int
=	O
STDOUT_FILENO	int
;	O
if	O
(	O
efd	int
<	O
0	int
)	O
efd	int
=	O
STDERR_FILENO	int
;	O
pipe	function
(	O
op	array
)	O
;	O
pipe	function
(	O
ip	array
)	O
;	O
pipe	function
(	O
pcpipe	array
)	O
;	O
if	O
(	O
(	O
pid	int
=	O
swndfork	function
(	O
sigmask	pointer
,	O
NULL	O
)	O
)	O
<	O
0	int
)	O
{	O
return	O
(	O
-	O
1	int
)	O
;	O
}	O
else	O
if	O
(	O
pid	int
==	O
0	int
)	O
{	O
if	O
(	O
setsid	function
(	O
)	O
<	O
0	int
)	O
{	O
fprintf	function
(	O
stderr	pointer
,	O
"setsid error"	pointer
)	O
;	O
}	O
if	O
(	O
have_posix_openpt	int
)	O
{	O
if	O
(	O
grantpt	function
(	O
fdm	int
)	O
<	O
0	int
||	O
unlockpt	function
(	O
fdm	int
)	O
<	O
0	int
)	O
{	O
fprintf	function
(	O
stderr	pointer
,	O
"%s: pts gramtpt or unlockpt failed\n"	pointer
,	O
swlib_utilname_get	function
(	O
)	O
)	O
;	O
return	O
-	O
1	int
;	O
}	O
fds	int
=	O
open	function
(	O
slave_pty_name	pointer
,	O
O_RDWR	int
)	O
;	O
if	O
(	O
fds	int
<	O
0	int
)	O
{	O
fprintf	function
(	O
stderr	pointer
,	O
"%s: open failed on %s, reason: %s\n"	pointer
,	O
swlib_utilname_get	function
(	O
)	O
,	O
slave_pty_name	pointer
,	O
strerror	function
(	O
errno	O
)	O
)	O
;	O
close	pointer
(	O
fdm	int
)	O
;	O
return	O
-	O
1	int
;	O
}	O
E_DEBUG2	O
(	O
"fds=%d"	pointer
,	O
fds	int
)	O
;	O
}	O
else	O
if	O
(	O
have_openpty	int
)	O
{	O
}	O
else	O
{	O
if	O
(	O
(	O
fds	int
=	O
swlib_ptys_open	function
(	O
pts_name	pointer
)	O
)	O
<	O
0	int
)	O
{	O
close	pointer
(	O
fdm	int
)	O
;	O
fprintf	function
(	O
stderr	pointer
,	O
"can't open slave pty %s : %s\n"	pointer
,	O
pts_name	pointer
,	O
strerror	function
(	O
errno	O
)	O
)	O
;	O
}	O
if	O
(	O
fds	int
>=	O
0	int
)	O
{	O
swlib_doif_writef	O
(	O
swlib_get_verbose_level	function
(	O
)	O
,	O
SWC_VERBOSE_7	int
,	O
(	O
struct	O
sw_logspec	struct
*	O
)	O
(	O
NULL	O
)	O
,	O
STDERR_FILENO	int
,	O
"Using pty (slave) : %s\n"	pointer
,	O
pts_name	pointer
)	O
;	O
}	O
}	O
E_DEBUG	O
(	O
"HERE 4"	pointer
)	O
;	O
if	O
(	O
slave_termios	pointer
!=	O
NULL	O
)	O
{	O
if	O
(	O
tcsetattr	function
(	O
fds	int
,	O
TCSANOW	int
,	O
slave_termios	pointer
)	O
<	O
0	int
)	O
fprintf	function
(	O
stderr	pointer
,	O
"tcsetattr error on slave pty : %s: %s\n"	pointer
,	O
pts_name	pointer
,	O
strerror	function
(	O
errno	O
)	O
)	O
;	O
}	O
E_DEBUG	O
(	O
"HERE 5"	pointer
)	O
;	O
if	O
(	O
slave_winsize	pointer
!=	O
NULL	O
)	O
{	O
if	O
(	O
ioctl	function
(	O
fds	int
,	O
TIOCSWINSZ	int
,	O
slave_winsize	pointer
)	O
<	O
0	int
)	O
fprintf	function
(	O
stderr	pointer
,	O
"TIOCSWINSZ error on slave pty %s: %s\n"	pointer
,	O
pts_name	pointer
,	O
strerror	function
(	O
errno	O
)	O
)	O
;	O
}	O
E_DEBUG	O
(	O
"HERE 6"	pointer
)	O
;	O
c_pid	int
=	O
swndfork	function
(	O
sigmask	pointer
,	O
NULL	O
)	O
;	O
if	O
(	O
c_pid	int
<	O
0	int
)	O
{	O
fprintf	function
(	O
stderr	pointer
,	O
"fork error\n"	pointer
)	O
;	O
exit	function
(	O
1	int
)	O
;	O
}	O
else	O
if	O
(	O
c_pid	int
>	O
0	int
)	O
{	O
close	pointer
(	O
fdm	int
)	O
;	O
close	pointer
(	O
op	array
[	O
0	int
]	O
)	O
;	O
close	pointer
(	O
op	array
[	O
1	int
]	O
)	O
;	O
close	pointer
(	O
ip	array
[	O
0	int
]	O
)	O
;	O
close	pointer
(	O
ip	array
[	O
1	int
]	O
)	O
;	O
close	pointer
(	O
pcpipe	array
[	O
0	int
]	O
)	O
;	O
if	O
(	O
uxfio_unix_safe_write	function
(	O
pcpipe	array
[	O
1	int
]	O
,	O
(	O
void	O
*	O
)	O
(	O
&	O
c_pid	int
)	O
,	O
sizeof	O
(	O
c_pid	int
)	O
)	O
!=	O
sizeof	O
(	O
c_pid	int
)	O
)	O
{	O
fprintf	function
(	O
stderr	pointer
,	O
"write error : %s \n"	pointer
,	O
strerror	function
(	O
errno	O
)	O
)	O
;	O
}	O
close	pointer
(	O
pcpipe	array
[	O
1	int
]	O
)	O
;	O
E_DEBUG	O
(	O
"at parent"	pointer
)	O
;	O
if	O
(	O
dup2	function
(	O
fds	int
,	O
0	int
)	O
!=	O
0	int
)	O
fprintf	function
(	O
stderr	pointer
,	O
"dup2 error to ifd = %d"	pointer
,	O
ifd	int
)	O
;	O
if	O
(	O
dup2	function
(	O
fds	int
,	O
1	int
)	O
!=	O
1	int
)	O
fprintf	function
(	O
stderr	pointer
,	O
"dup2 error to ofd = %d"	pointer
,	O
ofd	int
)	O
;	O
if	O
(	O
dup2	function
(	O
efd	int
,	O
2	int
)	O
!=	O
2	int
)	O
fprintf	function
(	O
stderr	pointer
,	O
"dup2 error to efd = %d"	pointer
,	O
efd	int
)	O
;	O
swgp_close_all_fd	function
(	O
3	int
)	O
;	O
return	O
(	O
0	int
)	O
;	O
}	O
else	O
if	O
(	O
c_pid	int
==	O
0	int
)	O
{	O
int	O
ret	int
;	O
uintmax_t	long
sb	pointer
;	O
close	pointer
(	O
pcpipe	array
[	O
0	int
]	O
)	O
;	O
close	pointer
(	O
pcpipe	array
[	O
1	int
]	O
)	O
;	O
close	pointer
(	O
fds	int
)	O
;	O
close	pointer
(	O
op	array
[	O
0	int
]	O
)	O
;	O
close	pointer
(	O
ip	array
[	O
1	int
]	O
)	O
;	O
if	O
(	O
make_raw	int
)	O
if	O
(	O
swlib_tty_raw	function
(	O
fdm	int
)	O
<	O
0	int
)	O
{	O
fprintf	function
(	O
stderr	pointer
,	O
"tty_raw error : source_fdar[0]\n"	pointer
)	O
;	O
exit	function
(	O
2	int
)	O
;	O
}	O
E_DEBUG	O
(	O
"at swgp_stdioPump"	pointer
)	O
;	O
ret	int
=	O
swgp_stdioPump	function
(	O
op	array
[	O
1	int
]	O
,	O
fdm	int
,	O
fdm	int
,	O
ip	array
[	O
0	int
]	O
,	O
0	int
,	O
1	int
,	O
0	int
,	O
NULL	O
,	O
NULL	O
,	O
NULL	O
,	O
&	O
sb	pointer
)	O
;	O
close	pointer
(	O
fdm	int
)	O
;	O
close	pointer
(	O
op	array
[	O
1	int
]	O
)	O
;	O
close	pointer
(	O
ip	array
[	O
0	int
]	O
)	O
;	O
if	O
(	O
have_openpty	int
)	O
{	O
}	O
_exit	function
(	O
ret	int
)	O
;	O
}	O
}	O
else	O
{	O
close	pointer
(	O
pcpipe	array
[	O
1	int
]	O
)	O
;	O
if	O
(	O
read	pointer
(	O
pcpipe	array
[	O
0	int
]	O
,	O
(	O
void	O
*	O
)	O
(	O
pc_pid	pointer
)	O
,	O
sizeof	O
(	O
c_pid	int
)	O
)	O
!=	O
sizeof	O
(	O
c_pid	int
)	O
)	O
{	O
fprintf	function
(	O
stderr	pointer
,	O
"read error : %s \n"	pointer
,	O
strerror	function
(	O
errno	O
)	O
)	O
;	O
}	O
close	pointer
(	O
pcpipe	array
[	O
0	int
]	O
)	O
;	O
close	pointer
(	O
fdm	int
)	O
;	O
close	pointer
(	O
op	array
[	O
1	int
]	O
)	O
;	O
close	pointer
(	O
ip	array
[	O
0	int
]	O
)	O
;	O
ptrfdm	pointer
[	O
0	int
]	O
=	O
op	array
[	O
0	int
]	O
;	O
ptrfdm	pointer
[	O
1	int
]	O
=	O
ip	array
[	O
1	int
]	O
;	O
ptrfdm	pointer
[	O
2	int
]	O
=	O
efd	int
;	O
return	O
(	O
pid	int
)	O
;	O
}	O
return	O
-	O
1	int
;	O
}	O
pid_t	int
swlib_no_pty_fork	function
(	O
int	O
*	O
ptrfdm	pointer
,	O
int	O
ofd	int
,	O
int	O
ifd	int
,	O
int	O
efd	int
,	O
sigset_t	struct
*	O
sigmask	pointer
)	O
{	O
int	O
opipe	array
[	O
2	int
]	O
;	O
int	O
ipipe	array
[	O
2	int
]	O
;	O
pid_t	int
pid	int
;	O
pipe	function
(	O
opipe	array
)	O
;	O
pipe	function
(	O
ipipe	array
)	O
;	O
if	O
(	O
(	O
pid	int
=	O
swndfork	function
(	O
sigmask	pointer
,	O
NULL	O
)	O
)	O
<	O
0	int
)	O
{	O
return	O
(	O
-	O
1	int
)	O
;	O
}	O
else	O
if	O
(	O
pid	int
==	O
0	int
)	O
{	O
close	pointer
(	O
opipe	array
[	O
0	int
]	O
)	O
;	O
close	pointer
(	O
ipipe	array
[	O
1	int
]	O
)	O
;	O
if	O
(	O
dup2	function
(	O
ipipe	array
[	O
0	int
]	O
,	O
0	int
)	O
!=	O
0	int
)	O
fprintf	function
(	O
stderr	pointer
,	O
"dup2 error to ifd = %d"	pointer
,	O
ifd	int
)	O
;	O
if	O
(	O
dup2	function
(	O
opipe	array
[	O
1	int
]	O
,	O
1	int
)	O
!=	O
1	int
)	O
fprintf	function
(	O
stderr	pointer
,	O
"dup2 error to ofd = %d"	pointer
,	O
ofd	int
)	O
;	O
if	O
(	O
dup2	function
(	O
efd	int
,	O
2	int
)	O
!=	O
2	int
)	O
fprintf	function
(	O
stderr	pointer
,	O
"dup2 error to efd = %d"	pointer
,	O
efd	int
)	O
;	O
close	pointer
(	O
efd	int
)	O
;	O
close	pointer
(	O
opipe	array
[	O
1	int
]	O
)	O
;	O
close	pointer
(	O
ipipe	array
[	O
0	int
]	O
)	O
;	O
swgp_close_all_fd	function
(	O
3	int
)	O
;	O
return	O
(	O
0	int
)	O
;	O
}	O
else	O
{	O
close	pointer
(	O
opipe	array
[	O
1	int
]	O
)	O
;	O
close	pointer
(	O
ipipe	array
[	O
0	int
]	O
)	O
;	O
ptrfdm	pointer
[	O
0	int
]	O
=	O
opipe	array
[	O
0	int
]	O
;	O
ptrfdm	pointer
[	O
1	int
]	O
=	O
ipipe	array
[	O
1	int
]	O
;	O
ptrfdm	pointer
[	O
2	int
]	O
=	O
efd	int
;	O
return	O
(	O
pid	int
)	O
;	O
}	O
}	O
pid_t	int
swlib_fork	function
(	O
char	O
*	O
type	enum
,	O
int	O
*	O
ptrfdm	pointer
,	O
int	O
ofd	int
,	O
int	O
ifd	int
,	O
int	O
efd	int
,	O
const	O
struct	O
termios	struct
*	O
slave_termios	pointer
,	O
const	O
struct	O
winsize	struct
*	O
slave_winsize	pointer
,	O
pid_t	int
*	O
pcpid	pointer
,	O
int	O
make_raw	int
,	O
sigset_t	struct
*	O
sigmask	pointer
)	O
{	O
if	O
(	O
strcmp	function
(	O
type	enum
,	O
SWFORK_PTY	pointer
)	O
==	O
0	int
)	O
{	O
*	O
pcpid	pointer
=	O
0	int
;	O
return	O
-	O
1	int
;	O
}	O
else	O
if	O
(	O
strcmp	function
(	O
type	enum
,	O
SWFORK_PTY2	pointer
)	O
==	O
0	int
)	O
{	O
return	O
swlib_pty_fork2	function
(	O
ptrfdm	pointer
,	O
ofd	int
,	O
ifd	int
,	O
efd	int
,	O
slave_termios	pointer
,	O
slave_winsize	pointer
,	O
pcpid	pointer
,	O
make_raw	int
,	O
sigmask	pointer
)	O
;	O
}	O
else	O
if	O
(	O
strcmp	function
(	O
type	enum
,	O
SWFORK_NO_PTY	pointer
)	O
==	O
0	int
)	O
{	O
*	O
pcpid	pointer
=	O
0	int
;	O
return	O
swlib_no_pty_fork	function
(	O
ptrfdm	pointer
,	O
ofd	int
,	O
ifd	int
,	O
efd	int
,	O
sigmask	pointer
)	O
;	O
}	O
else	O
if	O
(	O
strcmp	function
(	O
type	enum
,	O
SWFORK_FORK	pointer
)	O
==	O
0	int
)	O
{	O
pid_t	int
pid	int
;	O
*	O
pcpid	pointer
=	O
0	int
;	O
if	O
(	O
(	O
pid	int
=	O
swndfork	function
(	O
sigmask	pointer
,	O
NULL	O
)	O
)	O
<	O
0	int
)	O
{	O
return	O
(	O
-	O
1	int
)	O
;	O
}	O
else	O
if	O
(	O
pid	int
==	O
0	int
)	O
{	O
return	O
(	O
0	int
)	O
;	O
}	O
else	O
{	O
ptrfdm	pointer
[	O
0	int
]	O
=	O
ifd	int
;	O
ptrfdm	pointer
[	O
1	int
]	O
=	O
ofd	int
;	O
ptrfdm	pointer
[	O
2	int
]	O
=	O
efd	int
;	O
return	O
(	O
pid	int
)	O
;	O
}	O
}	O
else	O
if	O
(	O
strcmp	function
(	O
type	enum
,	O
SWFORK_NO_FORK	pointer
)	O
==	O
0	int
)	O
{	O
ptrfdm	pointer
[	O
0	int
]	O
=	O
ifd	int
;	O
ptrfdm	pointer
[	O
1	int
]	O
=	O
ofd	int
;	O
ptrfdm	pointer
[	O
2	int
]	O
=	O
efd	int
;	O
return	O
(	O
0	int
)	O
;	O
}	O
return	O
-	O
1	int
;	O
}	O
pid_t	int
swndfork	function
(	O
sigset_t	struct
*	O
sigmask	pointer
,	O
sigset_t	struct
*	O
sigdfl	pointer
)	O
{	O
int	O
ret	int
;	O
ret	int
=	O
fork	function
(	O
)	O
;	O
if	O
(	O
ret	int
==	O
0	int
)	O
{	O
if	O
(	O
sigdfl	pointer
)	O
{	O
struct	O
sigaction	struct
act	struct
;	O
sigemptyset	function
(	O
&	O
act	struct
.	O
sa_mask	struct
)	O
;	O
act	struct
.	O
sa_handler	pointer
=	O
SIG_DFL	O
;	O
act	struct
.	O
sa_flags	int
=	O
0	int
;	O
if	O
(	O
sigismember	function
(	O
sigdfl	pointer
,	O
SIGTERM	int
)	O
)	O
sigaction	struct
(	O
SIGTERM	int
,	O
&	O
act	struct
,	O
NULL	O
)	O
;	O
if	O
(	O
sigismember	function
(	O
sigdfl	pointer
,	O
SIGINT	int
)	O
)	O
sigaction	struct
(	O
SIGINT	int
,	O
&	O
act	struct
,	O
NULL	O
)	O
;	O
if	O
(	O
sigismember	function
(	O
sigdfl	pointer
,	O
SIGPIPE	int
)	O
)	O
sigaction	struct
(	O
SIGPIPE	int
,	O
&	O
act	struct
,	O
NULL	O
)	O
;	O
if	O
(	O
sigismember	function
(	O
sigdfl	pointer
,	O
SIGALRM	int
)	O
)	O
sigaction	struct
(	O
SIGALRM	int
,	O
&	O
act	struct
,	O
NULL	O
)	O
;	O
}	O
if	O
(	O
sigmask	pointer
)	O
{	O
sigprocmask	function
(	O
SIG_BLOCK	int
,	O
sigmask	pointer
,	O
NULL	O
)	O
;	O
}	O
}	O
return	O
ret	int
;	O
}	O
