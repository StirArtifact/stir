int	O
noPrivileges	int
=	O
0	int
;	O
static	O
__inline__	O
void	O
print_privs	function
(	O
const	O
char	O
*	O
message	pointer
UNUSEDP	O
)	O
{	O
}	O
static	O
gid_t	int
rgid	int
,	O
egid	int
;	O
static	O
uid_t	int
ruid	int
,	O
euid	int
;	O
static	O
__inline__	O
void	O
Setuid	function
(	O
uid_t	int
uid	int
)	O
{	O
if	O
(	O
euid	int
==	O
0	int
)	O
{	O
seteuid	function
(	O
uid	int
)	O
;	O
}	O
else	O
setuid	function
(	O
uid	int
)	O
;	O
}	O
void	O
reclaim_privs	function
(	O
void	O
)	O
{	O
if	O
(	O
noPrivileges	int
)	O
return	O
;	O
setgid	function
(	O
egid	int
)	O
;	O
Setuid	function
(	O
euid	int
)	O
;	O
print_privs	function
(	O
"after reclaim privs, both uids should be 0 "	pointer
)	O
;	O
}	O
void	O
drop_privs	function
(	O
void	O
)	O
{	O
Setuid	function
(	O
ruid	int
)	O
;	O
setgid	function
(	O
rgid	int
)	O
;	O
print_privs	function
(	O
"after drop_privs, real should be 0, effective should not "	pointer
)	O
;	O
}	O
void	O
destroy_privs	function
(	O
void	O
)	O
{	O
if	O
(	O
euid	int
==	O
0	int
)	O
{	O
setuid	function
(	O
0	int
)	O
;	O
setuid	function
(	O
ruid	int
)	O
;	O
seteuid	function
(	O
ruid	int
)	O
;	O
}	O
drop_privs	function
(	O
)	O
;	O
print_privs	function
(	O
"destroy_privs, no uid should be zero  "	pointer
)	O
;	O
}	O
uid_t	int
get_real_uid	function
(	O
void	O
)	O
{	O
return	O
ruid	int
;	O
}	O
void	O
init_privs	function
(	O
void	O
)	O
{	O
euid	int
=	O
geteuid	function
(	O
)	O
;	O
ruid	int
=	O
getuid	function
(	O
)	O
;	O
egid	int
=	O
getegid	function
(	O
)	O
;	O
rgid	int
=	O
getgid	function
(	O
)	O
;	O
if	O
(	O
euid	int
!=	O
ruid	int
)	O
{	O
unsetenv	function
(	O
"SOURCE_DATE_EPOCH"	pointer
)	O
;	O
}	O
if	O
(	O
euid	int
==	O
0	int
&&	O
ruid	int
!=	O
0	int
)	O
{	O
setuid	function
(	O
0	int
)	O
;	O
}	O
drop_privs	function
(	O
)	O
;	O
print_privs	function
(	O
"after init, real should be 0, effective should not "	pointer
)	O
;	O
}	O
void	O
closeExec	function
(	O
int	O
fd	int
)	O
{	O
fcntl	function
(	O
fd	int
,	O
F_SETFD	int
,	O
1	int
)	O
;	O
}	O
