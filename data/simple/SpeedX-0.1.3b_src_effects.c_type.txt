extern	O
char	O
*	O
screen_buffer	pointer
;	O
extern	O
int	O
factor	int
;	O
extern	O
int	O
color	int
;	O
extern	O
int	O
bitmap_bit_order	int
;	O
void	O
fog	function
(	O
unsigned	O
int	O
r	int
,	O
unsigned	O
int	O
g	int
,	O
unsigned	O
int	O
b	int
)	O
{	O
unsigned	O
int	O
i	int
,	O
j	int
;	O
unsigned	O
int	O
Color	int
=	O
0	int
;	O
unsigned	O
int	O
background	int
=	O
0	int
;	O
unsigned	O
int	O
rc	int
,	O
gc	int
,	O
bc	int
,	O
alpha	int
;	O
unsigned	O
int	O
ofs1	int
,	O
ofs2	int
;	O
ofs1	int
=	O
factor	int
*	O
(	O
HEIGHT	int
/	O
2	int
)	O
*	O
WIDTH	int
;	O
ofs2	int
=	O
ofs1	int
-	O
factor	int
;	O
for	O
(	O
j	int
=	O
0	int
;	O
j	int
<	O
HEIGHT	int
/	O
4	int
;	O
j	int
++	O
)	O
{	O
alpha	int
=	O
(	O
(	O
(	O
HEIGHT	int
/	O
4	int
)	O
-	O
j	int
)	O
*	O
255	int
)	O
/	O
(	O
HEIGHT	int
/	O
4	int
)	O
;	O
for	O
(	O
i	int
=	O
0	int
;	O
i	int
<	O
WIDTH	int
;	O
i	int
++	O
)	O
{	O
memcpy	O
(	O
&	O
background	int
,	O
&	O
screen_buffer	pointer
[	O
ofs1	int
]	O
,	O
factor	int
)	O
;	O
if	O
(	O
bitmap_bit_order	int
)	O
background	int
>>=	O
(	O
8	int
*	O
(	O
4	int
-	O
factor	int
)	O
)	O
;	O
rc	int
=	O
(	O
alpha	int
*	O
r	int
+	O
(	O
255	int
-	O
alpha	int
)	O
*	O
red	O
(	O
background	int
)	O
)	O
>>	O
8	int
;	O
gc	int
=	O
(	O
alpha	int
*	O
g	int
+	O
(	O
255	int
-	O
alpha	int
)	O
*	O
green	O
(	O
background	int
)	O
)	O
>>	O
8	int
;	O
bc	int
=	O
(	O
alpha	int
*	O
b	int
+	O
(	O
255	int
-	O
alpha	int
)	O
*	O
blue	O
(	O
background	int
)	O
)	O
>>	O
8	int
;	O
Color	int
=	O
rgb	O
(	O
rc	int
,	O
gc	int
,	O
bc	int
)	O
;	O
memcpy	O
(	O
&	O
screen_buffer	pointer
[	O
ofs1	int
]	O
,	O
&	O
Color	int
,	O
factor	int
)	O
;	O
ofs1	int
+=	O
factor	int
;	O
memcpy	O
(	O
&	O
background	int
,	O
&	O
screen_buffer	pointer
[	O
ofs2	int
]	O
,	O
factor	int
)	O
;	O
if	O
(	O
bitmap_bit_order	int
)	O
background	int
>>=	O
(	O
8	int
*	O
(	O
4	int
-	O
factor	int
)	O
)	O
;	O
rc	int
=	O
(	O
alpha	int
*	O
r	int
+	O
(	O
255	int
-	O
alpha	int
)	O
*	O
red	O
(	O
background	int
)	O
)	O
>>	O
8	int
;	O
gc	int
=	O
(	O
alpha	int
*	O
g	int
+	O
(	O
255	int
-	O
alpha	int
)	O
*	O
green	O
(	O
background	int
)	O
)	O
>>	O
8	int
;	O
bc	int
=	O
(	O
alpha	int
*	O
b	int
+	O
(	O
255	int
-	O
alpha	int
)	O
*	O
blue	O
(	O
background	int
)	O
)	O
>>	O
8	int
;	O
Color	int
=	O
rgb	O
(	O
rc	int
,	O
gc	int
,	O
bc	int
)	O
;	O
memcpy	O
(	O
&	O
screen_buffer	pointer
[	O
ofs2	int
]	O
,	O
&	O
Color	int
,	O
factor	int
)	O
;	O
ofs2	int
-=	O
factor	int
;	O
}	O
}	O
}	O
