static	O
struct	O
termios	struct
save_termios	struct
;	O
static	O
int	O
ttysavefd	int
=	O
-	O
1	int
;	O
static	O
enum	O
{	O
RESET	int
,	O
RAW	int
,	O
CBREAK	int
}	O
ttystate	enum
=	O
RESET	int
;	O
int	O
tty_cbreak	function
(	O
int	O
fd	int
)	O
{	O
struct	O
termios	struct
buf	struct
;	O
if	O
(	O
tcgetattr	function
(	O
fd	int
,	O
&	O
save_termios	struct
)	O
<	O
0	int
)	O
return	O
(	O
-	O
1	int
)	O
;	O
buf	struct
=	O
save_termios	struct
;	O
buf	struct
.	O
c_lflag	int
&=	O
~	O
(	O
ECHO	int
|	O
ICANON	int
)	O
;	O
buf	struct
.	O
c_cc	array
[	O
VMIN	int
]	O
=	O
1	int
;	O
buf	struct
.	O
c_cc	array
[	O
VTIME	int
]	O
=	O
0	int
;	O
if	O
(	O
tcsetattr	function
(	O
fd	int
,	O
TCSAFLUSH	int
,	O
&	O
buf	struct
)	O
<	O
0	int
)	O
return	O
(	O
-	O
1	int
)	O
;	O
ttystate	enum
=	O
CBREAK	int
;	O
ttysavefd	int
=	O
fd	int
;	O
return	O
(	O
0	int
)	O
;	O
}	O
int	O
tty_raw	function
(	O
int	O
fd	int
)	O
{	O
struct	O
termios	struct
buf	struct
;	O
if	O
(	O
tcgetattr	function
(	O
fd	int
,	O
&	O
save_termios	struct
)	O
<	O
0	int
)	O
return	O
(	O
-	O
1	int
)	O
;	O
buf	struct
=	O
save_termios	struct
;	O
buf	struct
.	O
c_lflag	int
&=	O
~	O
(	O
ECHO	int
|	O
ICANON	int
|	O
IEXTEN	int
|	O
ISIG	int
)	O
;	O
buf	struct
.	O
c_iflag	int
&=	O
~	O
(	O
BRKINT	int
|	O
ICRNL	int
|	O
INPCK	int
|	O
ISTRIP	int
|	O
IXON	int
)	O
;	O
buf	struct
.	O
c_cflag	int
&=	O
~	O
(	O
CSIZE	int
|	O
PARENB	int
)	O
;	O
buf	struct
.	O
c_cflag	int
|=	O
CS8	int
;	O
buf	struct
.	O
c_oflag	int
&=	O
~	O
(	O
OPOST	int
)	O
;	O
buf	struct
.	O
c_cc	array
[	O
VMIN	int
]	O
=	O
1	int
;	O
buf	struct
.	O
c_cc	array
[	O
VTIME	int
]	O
=	O
0	int
;	O
if	O
(	O
tcsetattr	function
(	O
fd	int
,	O
TCSAFLUSH	int
,	O
&	O
buf	struct
)	O
<	O
0	int
)	O
return	O
(	O
-	O
1	int
)	O
;	O
ttystate	enum
=	O
RAW	int
;	O
ttysavefd	int
=	O
fd	int
;	O
return	O
(	O
0	int
)	O
;	O
}	O
int	O
tty_reset	function
(	O
int	O
fd	int
)	O
{	O
if	O
(	O
ttystate	enum
!=	O
CBREAK	int
&&	O
ttystate	enum
!=	O
RAW	int
)	O
return	O
(	O
0	int
)	O
;	O
if	O
(	O
tcsetattr	function
(	O
fd	int
,	O
TCSAFLUSH	int
,	O
&	O
save_termios	struct
)	O
<	O
0	int
)	O
return	O
(	O
-	O
1	int
)	O
;	O
ttystate	enum
=	O
RESET	int
;	O
return	O
(	O
0	int
)	O
;	O
}	O
void	O
tty_atexit	function
(	O
void	O
)	O
{	O
if	O
(	O
ttysavefd	int
>=	O
0	int
)	O
tty_reset	function
(	O
ttysavefd	int
)	O
;	O
}	O
struct	O
termios	struct
*	O
tty_termios	function
(	O
void	O
)	O
{	O
return	O
(	O
&	O
save_termios	struct
)	O
;	O
}	O
