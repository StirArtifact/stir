const	O
typeinfo_t	O
iconv_ostream_typeinfo	O
=	O
{	O
"iconv_ostream"	pointer
}	O
;	O
static	O
const	O
typeinfo_t	O
*	O
const	O
iconv_ostream_superclasses	array
[	O
]	O
=	O
{	O
iconv_ostream_SUPERCLASSES	O
}	O
;	O
static	O
void	O
iconv_ostream__write_mem	function
(	O
iconv_ostream_t	O
stream	int
,	O
const	O
void	O
*	O
data	pointer
,	O
size_t	O
len	int
)	O
{	O
if	O
(	O
len	int
>	O
0	int
)	O
{	O
char	O
inbuffer	array
[	O
BUFFERSIZE	int
]	O
;	O
size_t	O
inbufcount	O
;	O
inbufcount	O
=	O
stream	int
->	O
buflen	O
;	O
if	O
(	O
inbufcount	O
>	O
0	int
)	O
memcpy	O
(	O
inbuffer	array
,	O
stream	int
->	O
buf	O
,	O
inbufcount	O
)	O
;	O
for	O
(	O
;	O
;	O
)	O
{	O
{	O
size_t	O
n	O
=	O
(	O
len	int
<=	O
BUFFERSIZE	int
-	O
inbufcount	O
?	O
len	int
:	O
BUFFERSIZE	int
-	O
inbufcount	O
)	O
;	O
if	O
(	O
n	O
>	O
0	int
)	O
{	O
memcpy	O
(	O
inbuffer	array
+	O
inbufcount	O
,	O
data	pointer
,	O
n	O
)	O
;	O
data	pointer
=	O
(	O
char	O
*	O
)	O
data	pointer
+	O
n	O
;	O
inbufcount	O
+=	O
n	O
;	O
len	int
-=	O
n	O
;	O
}	O
}	O
{	O
char	O
outbuffer	array
[	O
8	int
*	O
BUFFERSIZE	int
]	O
;	O
const	O
char	O
*	O
inptr	pointer
=	O
inbuffer	array
;	O
size_t	O
insize	O
=	O
inbufcount	O
;	O
char	O
*	O
outptr	pointer
=	O
outbuffer	array
;	O
size_t	O
outsize	O
=	O
sizeof	O
(	O
outbuffer	array
)	O
;	O
size_t	O
res	O
=	O
iconv	O
(	O
stream	int
->	O
cd	O
,	O
(	O
ICONV_CONST	O
char	O
*	O
*	O
)	O
&	O
inptr	pointer
,	O
&	O
insize	O
,	O
&	O
outptr	pointer
,	O
&	O
outsize	O
)	O
;	O
if	O
(	O
res	O
>	O
0	int
)	O
{	O
errno	O
=	O
EILSEQ	O
;	O
res	O
=	O
-	O
1	int
;	O
}	O
if	O
(	O
res	O
==	O
(	O
size_t	O
)	O
(	O
-	O
1	int
)	O
&&	O
errno	O
!=	O
EINVAL	O
)	O
error	function
(	O
EXIT_FAILURE	O
,	O
0	int
,	O
_	O
(	O
"%s: cannot convert from %s to %s"	pointer
)	O
,	O
"iconv_ostream"	pointer
,	O
stream	int
->	O
from_encoding	pointer
,	O
stream	int
->	O
to_encoding	pointer
)	O
;	O
if	O
(	O
sizeof	O
(	O
outbuffer	array
)	O
-	O
outsize	O
>	O
0	int
)	O
ostream_write_mem	function
(	O
stream	int
->	O
destination	int
,	O
outbuffer	array
,	O
sizeof	O
(	O
outbuffer	array
)	O
-	O
outsize	O
)	O
;	O
if	O
(	O
insize	O
>	O
BUFSIZE	O
)	O
error	function
(	O
EXIT_FAILURE	O
,	O
0	int
,	O
_	O
(	O
"%s: shift sequence too long"	pointer
)	O
,	O
"iconv_ostream"	pointer
)	O
;	O
if	O
(	O
len	int
==	O
0	int
)	O
{	O
if	O
(	O
insize	O
>	O
0	int
)	O
memcpy	O
(	O
stream	int
->	O
buf	O
,	O
inptr	pointer
,	O
insize	O
)	O
;	O
stream	int
->	O
buflen	O
=	O
insize	O
;	O
break	O
;	O
}	O
if	O
(	O
insize	O
>	O
0	int
)	O
memmove	O
(	O
inbuffer	array
,	O
inptr	pointer
,	O
insize	O
)	O
;	O
inbufcount	O
=	O
insize	O
;	O
}	O
}	O
}	O
}	O
static	O
void	O
iconv_ostream__flush	function
(	O
iconv_ostream_t	O
stream	int
,	O
ostream_flush_scope_t	O
scope	int
)	O
{	O
if	O
(	O
scope	int
!=	O
FLUSH_THIS_STREAM	O
)	O
ostream_flush	function
(	O
stream	int
->	O
destination	int
,	O
scope	int
)	O
;	O
}	O
static	O
void	O
iconv_ostream__free	function
(	O
iconv_ostream_t	O
stream	int
)	O
{	O
{	O
char	O
outbuffer	array
[	O
2048	int
]	O
;	O
char	O
*	O
outptr	pointer
=	O
outbuffer	array
;	O
size_t	O
outsize	O
=	O
sizeof	O
(	O
outbuffer	array
)	O
;	O
size_t	O
res	O
=	O
iconv	O
(	O
stream	int
->	O
cd	O
,	O
NULL	O
,	O
NULL	O
,	O
&	O
outptr	pointer
,	O
&	O
outsize	O
)	O
;	O
if	O
(	O
res	O
==	O
(	O
size_t	O
)	O
(	O
-	O
1	int
)	O
)	O
error	function
(	O
EXIT_FAILURE	O
,	O
0	int
,	O
_	O
(	O
"%s: cannot convert from %s to %s"	pointer
)	O
,	O
"iconv_ostream"	pointer
,	O
stream	int
->	O
from_encoding	pointer
,	O
stream	int
->	O
to_encoding	pointer
)	O
;	O
if	O
(	O
sizeof	O
(	O
outbuffer	array
)	O
-	O
outsize	O
>	O
0	int
)	O
ostream_write_mem	function
(	O
stream	int
->	O
destination	int
,	O
outbuffer	array
,	O
sizeof	O
(	O
outbuffer	array
)	O
-	O
outsize	O
)	O
;	O
}	O
iconv_close	function
(	O
stream	int
->	O
cd	O
)	O
;	O
free	function
(	O
stream	int
->	O
from_encoding	pointer
)	O
;	O
free	function
(	O
stream	int
->	O
to_encoding	pointer
)	O
;	O
free	function
(	O
stream	int
)	O
;	O
}	O
iconv_ostream_t	O
iconv_ostream_create	function
(	O
const	O
char	O
*	O
from_encoding	pointer
,	O
const	O
char	O
*	O
to_encoding	pointer
,	O
ostream_t	O
destination	int
)	O
{	O
iconv_ostream_t	O
stream	int
=	O
XMALLOC	O
(	O
struct	O
iconv_ostream_representation	O
)	O
;	O
stream	int
->	O
base	O
.	O
vtable	pointer
=	O
&	O
iconv_ostream_vtable	O
;	O
stream	int
->	O
destination	int
=	O
destination	int
;	O
stream	int
->	O
from_encoding	pointer
=	O
xstrdup	O
(	O
from_encoding	pointer
)	O
;	O
stream	int
->	O
to_encoding	pointer
=	O
xstrdup	O
(	O
to_encoding	pointer
)	O
;	O
stream	int
->	O
cd	O
=	O
iconv_open	function
(	O
to_encoding	pointer
,	O
from_encoding	pointer
)	O
;	O
if	O
(	O
stream	int
->	O
cd	O
==	O
(	O
iconv_t	O
)	O
(	O
-	O
1	int
)	O
)	O
{	O
if	O
(	O
iconv_open	function
(	O
"UTF-8"	pointer
,	O
from_encoding	pointer
)	O
==	O
(	O
iconv_t	O
)	O
(	O
-	O
1	int
)	O
)	O
error	function
(	O
EXIT_FAILURE	O
,	O
0	int
,	O
_	O
(	O
"%s does not support conversion from %s"	pointer
)	O
,	O
"iconv"	pointer
,	O
from_encoding	pointer
)	O
;	O
else	O
if	O
(	O
iconv_open	function
(	O
to_encoding	pointer
,	O
"UTF-8"	pointer
)	O
==	O
(	O
iconv_t	O
)	O
(	O
-	O
1	int
)	O
)	O
error	function
(	O
EXIT_FAILURE	O
,	O
0	int
,	O
_	O
(	O
"%s does not support conversion to %s"	pointer
)	O
,	O
"iconv"	pointer
,	O
to_encoding	pointer
)	O
;	O
else	O
error	function
(	O
EXIT_FAILURE	O
,	O
0	int
,	O
_	O
(	O
"%s does not support conversion from %s to %s"	pointer
)	O
,	O
"iconv"	pointer
,	O
from_encoding	pointer
,	O
to_encoding	pointer
)	O
;	O
}	O
stream	int
->	O
buflen	O
=	O
0	int
;	O
return	O
stream	int
;	O
}	O
const	O
struct	O
iconv_ostream_implementation	O
iconv_ostream_vtable	O
=	O
{	O
iconv_ostream_superclasses	array
,	O
sizeof	O
(	O
iconv_ostream_superclasses	array
)	O
/	O
sizeof	O
(	O
iconv_ostream_superclasses	array
[	O
0	int
]	O
)	O
,	O
sizeof	O
(	O
struct	O
iconv_ostream_representation	O
)	O
,	O
iconv_ostream__write_mem	function
,	O
iconv_ostream__flush	function
,	O
iconv_ostream__free	function
,	O
}	O
;	O
void	O
iconv_ostream_write_mem	function
(	O
iconv_ostream_t	O
first_arg	int
,	O
const	O
void	O
*	O
data	pointer
,	O
size_t	O
len	int
)	O
{	O
const	O
struct	O
iconv_ostream_implementation	O
*	O
vtable	pointer
=	O
(	O
(	O
struct	O
iconv_ostream_representation_header	O
*	O
)	O
(	O
struct	O
iconv_ostream_representation	O
*	O
)	O
first_arg	int
)	O
->	O
vtable	pointer
;	O
vtable	pointer
->	O
write_mem	O
(	O
first_arg	int
,	O
data	pointer
,	O
len	int
)	O
;	O
}	O
void	O
iconv_ostream_flush	function
(	O
iconv_ostream_t	O
first_arg	int
,	O
ostream_flush_scope_t	O
scope	int
)	O
{	O
const	O
struct	O
iconv_ostream_implementation	O
*	O
vtable	pointer
=	O
(	O
(	O
struct	O
iconv_ostream_representation_header	O
*	O
)	O
(	O
struct	O
iconv_ostream_representation	O
*	O
)	O
first_arg	int
)	O
->	O
vtable	pointer
;	O
vtable	pointer
->	O
flush	O
(	O
first_arg	int
,	O
scope	int
)	O
;	O
}	O
void	O
iconv_ostream_free	function
(	O
iconv_ostream_t	O
first_arg	int
)	O
{	O
const	O
struct	O
iconv_ostream_implementation	O
*	O
vtable	pointer
=	O
(	O
(	O
struct	O
iconv_ostream_representation_header	O
*	O
)	O
(	O
struct	O
iconv_ostream_representation	O
*	O
)	O
first_arg	int
)	O
->	O
vtable	pointer
;	O
vtable	pointer
->	O
free	function
(	O
first_arg	int
)	O
;	O
}	O
