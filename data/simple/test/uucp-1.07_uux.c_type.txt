const	O
char	O
uux_rcsid	array
[	O
]	O
=	O
"$Id: uux.c,v 1.89 2002/03/05 19:10:42 ian Rel $"	pointer
;	O
static	O
boolean	int
fXquote	int
;	O
static	O
boolean	int
fXquote_output	int
;	O
static	O
boolean	int
fXxqtlocal	int
;	O
static	O
struct	O
uuconf_system	struct
sXxqtsys	struct
;	O
static	O
const	O
char	O
*	O
zXxqtloc	pointer
;	O
static	O
char	O
bXgrade	char
=	O
BDEFAULT_UUX_GRADE	O
;	O
static	O
char	O
abXxqt_tname	array
[	O
CFILE_NAME_LEN	O
]	O
;	O
static	O
char	O
abXxqt_xname	array
[	O
CFILE_NAME_LEN	O
]	O
;	O
static	O
FILE	struct
*	O
eXxqt_file	pointer
;	O
static	O
struct	O
scmd	struct
*	O
pasXcmds	pointer
;	O
static	O
int	O
cXcmds	int
;	O
static	O
FILE	struct
*	O
eXclose	pointer
;	O
static	O
char	O
*	O
zXnames	pointer
;	O
static	O
void	O
uxusage	function
P	O
(	O
(	O
void	O
)	O
)	O
;	O
static	O
void	O
uxhelp	function
P	O
(	O
(	O
void	O
)	O
)	O
;	O
static	O
void	O
uxadd_xqt_line	function
P	O
(	O
(	O
int	O
bchar	int
,	O
const	O
char	O
*	O
z1	pointer
,	O
const	O
char	O
*	O
z2	pointer
)	O
)	O
;	O
static	O
void	O
uxadd_send_file	function
P	O
(	O
(	O
const	O
char	O
*	O
zfrom	pointer
,	O
const	O
char	O
*	O
zto	pointer
,	O
const	O
char	O
*	O
zoptions	pointer
,	O
const	O
char	O
*	O
ztemp	pointer
,	O
const	O
char	O
*	O
zforward	pointer
)	O
)	O
;	O
static	O
void	O
uxcopy_stdin	function
P	O
(	O
(	O
FILE	struct
*	O
e	pointer
)	O
)	O
;	O
static	O
void	O
uxrecord_file	function
P	O
(	O
(	O
const	O
char	O
*	O
zfile	pointer
)	O
)	O
;	O
static	O
void	O
uxfatal	function
P	O
(	O
(	O
void	O
)	O
)	O
;	O
static	O
void	O
uxabort	function
P	O
(	O
(	O
int	O
istat	int
)	O
)	O
;	O
static	O
void	O
uxadd_name	function
P	O
(	O
(	O
const	O
char	O
*	O
)	O
)	O
;	O
static	O
const	O
struct	O
option	struct
asXlongopts	array
[	O
]	O
=	O
{	O
{	O
"requestor"	pointer
,	O
required_argument	int
,	O
NULL	O
,	O
'a'	O
}	O
,	O
{	O
"return-stdin"	pointer
,	O
no_argument	int
,	O
NULL	O
,	O
'b'	O
}	O
,	O
{	O
"nocopy"	pointer
,	O
no_argument	int
,	O
NULL	O
,	O
'c'	O
}	O
,	O
{	O
"copy"	pointer
,	O
no_argument	int
,	O
NULL	O
,	O
'C'	O
}	O
,	O
{	O
"grade"	pointer
,	O
required_argument	int
,	O
NULL	O
,	O
'g'	O
}	O
,	O
{	O
"jobid"	pointer
,	O
no_argument	int
,	O
NULL	O
,	O
'j'	O
}	O
,	O
{	O
"link"	pointer
,	O
no_argument	int
,	O
NULL	O
,	O
'l'	O
}	O
,	O
{	O
"notification"	pointer
,	O
required_argument	int
,	O
NULL	O
,	O
2	int
}	O
,	O
{	O
"stdin"	pointer
,	O
no_argument	int
,	O
NULL	O
,	O
'p'	O
}	O
,	O
{	O
"nouucico"	pointer
,	O
no_argument	int
,	O
NULL	O
,	O
'r'	O
}	O
,	O
{	O
"status"	pointer
,	O
required_argument	int
,	O
NULL	O
,	O
's'	O
}	O
,	O
{	O
"noexpand"	pointer
,	O
no_argument	int
,	O
NULL	O
,	O
'W'	O
}	O
,	O
{	O
"config"	pointer
,	O
required_argument	int
,	O
NULL	O
,	O
'I'	O
}	O
,	O
{	O
"debug"	pointer
,	O
required_argument	int
,	O
NULL	O
,	O
'x'	O
}	O
,	O
{	O
"version"	pointer
,	O
no_argument	int
,	O
NULL	O
,	O
'v'	O
}	O
,	O
{	O
"help"	pointer
,	O
no_argument	int
,	O
NULL	O
,	O
1	int
}	O
,	O
{	O
NULL	O
,	O
0	int
,	O
NULL	O
,	O
0	int
}	O
}	O
;	O
int	O
main	function
(	O
argc	int
,	O
argv	pointer
)	O
int	O
argc	int
;	O
char	O
*	O
*	O
argv	pointer
;	O
{	O
const	O
char	O
*	O
zrequestor	pointer
=	O
NULL	O
;	O
boolean	int
fretstdin	int
=	O
FALSE	O
;	O
boolean	int
fcopy	int
=	O
FALSE	O
;	O
boolean	int
fdontcopy	int
=	O
FALSE	O
;	O
const	O
char	O
*	O
zconfig	pointer
=	O
NULL	O
;	O
boolean	int
fjobid	int
=	O
FALSE	O
;	O
boolean	int
flink	int
=	O
FALSE	O
;	O
boolean	int
fno_ack	int
=	O
FALSE	O
;	O
boolean	int
fread_stdin	int
=	O
FALSE	O
;	O
boolean	int
fuucico	int
=	O
TRUE	O
;	O
const	O
char	O
*	O
zstatus_file	pointer
=	O
NULL	O
;	O
boolean	int
fexpand	int
=	O
TRUE	O
;	O
boolean	int
ferror_ack	int
=	O
FALSE	O
;	O
int	O
iopt	int
;	O
pointer	pointer
puuconf	pointer
;	O
int	O
iuuconf	int
;	O
const	O
char	O
*	O
zlocalname	pointer
;	O
int	O
i	int
;	O
size_t	long
clen	long
;	O
char	O
*	O
zargs	pointer
;	O
char	O
*	O
zarg	pointer
;	O
char	O
*	O
zcmd	pointer
;	O
const	O
char	O
*	O
zsys	pointer
;	O
char	O
*	O
zexclam	pointer
;	O
boolean	int
fgetcwd	int
;	O
const	O
char	O
*	O
zuser	pointer
;	O
char	O
*	O
zforward	pointer
;	O
char	O
*	O
*	O
pzargs	pointer
;	O
int	O
calloc_args	int
;	O
int	O
cargs	int
;	O
const	O
char	O
*	O
zinput_from	pointer
;	O
const	O
char	O
*	O
zinput_to	pointer
;	O
const	O
char	O
*	O
zinput_temp	pointer
;	O
boolean	int
finputcopied	int
;	O
char	O
*	O
zcall_system	pointer
;	O
boolean	int
fcall_any	int
;	O
struct	O
uuconf_system	struct
slocalsys	struct
;	O
boolean	int
fneedshell	int
;	O
char	O
*	O
zfullcmd	pointer
;	O
boolean	int
fpoll	int
;	O
char	O
aboptions	array
[	O
10	int
]	O
;	O
zProgram	pointer
=	O
argv	pointer
[	O
0	int
]	O
;	O
ulog_fatal_fn	function
(	O
uxfatal	function
)	O
;	O
opterr	int
=	O
0	int
;	O
while	O
(	O
1	int
)	O
{	O
while	O
(	O
getopt_long	function
(	O
argc	int
,	O
argv	pointer
,	O
"+a:bcCg:I:jlnprs:Wvx:z"	pointer
,	O
asXlongopts	array
,	O
(	O
int	O
*	O
)	O
NULL	O
)	O
!=	O
EOF	O
)	O
;	O
if	O
(	O
optind	int
>=	O
argc	int
||	O
strcmp	function
(	O
argv	pointer
[	O
optind	int
]	O
,	O
"-"	pointer
)	O
!=	O
0	int
)	O
break	O
;	O
argv	pointer
[	O
optind	int
]	O
=	O
zbufcpy	function
(	O
"-p"	pointer
)	O
;	O
optind	int
=	O
0	int
;	O
}	O
opterr	int
=	O
1	int
;	O
optind	int
=	O
0	int
;	O
while	O
(	O
(	O
iopt	int
=	O
getopt_long	function
(	O
argc	int
,	O
argv	pointer
,	O
"+a:bcCg:I:jlnprs:Wvx:z"	pointer
,	O
asXlongopts	array
,	O
(	O
int	O
*	O
)	O
NULL	O
)	O
)	O
!=	O
EOF	O
)	O
{	O
switch	O
(	O
iopt	int
)	O
{	O
case	O
'a'	O
:	O
zrequestor	pointer
=	O
optarg	pointer
;	O
break	O
;	O
case	O
'b'	O
:	O
fretstdin	int
=	O
TRUE	O
;	O
break	O
;	O
case	O
'c'	O
:	O
fcopy	int
=	O
FALSE	O
;	O
fdontcopy	int
=	O
TRUE	O
;	O
break	O
;	O
case	O
'C'	O
:	O
fcopy	int
=	O
TRUE	O
;	O
break	O
;	O
case	O
'I'	O
:	O
if	O
(	O
fsysdep_other_config	function
(	O
optarg	pointer
)	O
)	O
zconfig	pointer
=	O
optarg	pointer
;	O
break	O
;	O
case	O
'j'	O
:	O
fjobid	int
=	O
TRUE	O
;	O
break	O
;	O
case	O
'g'	O
:	O
bXgrade	char
=	O
optarg	pointer
[	O
0	int
]	O
;	O
break	O
;	O
case	O
'l'	O
:	O
flink	int
=	O
TRUE	O
;	O
break	O
;	O
case	O
'n'	O
:	O
fno_ack	int
=	O
TRUE	O
;	O
break	O
;	O
case	O
'p'	O
:	O
fread_stdin	int
=	O
TRUE	O
;	O
break	O
;	O
case	O
'r'	O
:	O
fuucico	int
=	O
FALSE	O
;	O
break	O
;	O
case	O
's'	O
:	O
zstatus_file	pointer
=	O
optarg	pointer
;	O
break	O
;	O
case	O
'W'	O
:	O
fexpand	int
=	O
FALSE	O
;	O
break	O
;	O
case	O
'x'	O
:	O
iDebug	int
|=	O
idebug_parse	function
(	O
optarg	pointer
)	O
;	O
break	O
;	O
case	O
'z'	O
:	O
ferror_ack	int
=	O
TRUE	O
;	O
break	O
;	O
case	O
2	int
:	O
if	O
(	O
*	O
optarg	pointer
==	O
't'	O
||	O
*	O
optarg	pointer
==	O
'T'	O
||	O
*	O
optarg	pointer
==	O
'y'	O
||	O
*	O
optarg	pointer
==	O
'Y'	O
||	O
*	O
optarg	pointer
==	O
'e'	O
||	O
*	O
optarg	pointer
==	O
'E'	O
)	O
{	O
ferror_ack	int
=	O
TRUE	O
;	O
fno_ack	int
=	O
FALSE	O
;	O
}	O
else	O
if	O
(	O
*	O
optarg	pointer
==	O
'f'	O
||	O
*	O
optarg	pointer
==	O
'F'	O
||	O
*	O
optarg	pointer
==	O
'n'	O
||	O
*	O
optarg	pointer
==	O
'N'	O
)	O
{	O
ferror_ack	int
=	O
FALSE	O
;	O
fno_ack	int
=	O
TRUE	O
;	O
}	O
break	O
;	O
case	O
'v'	O
:	O
printf	function
(	O
"uux (Taylor UUCP) %s\n"	pointer
,	O
VERSION	pointer
)	O
;	O
printf	function
(	O
"Copyright (C) 1991, 92, 93, 94, 1995, 2002 Ian Lance Taylor\n"	pointer
)	O
;	O
printf	function
(	O
"This program is free software; you may redistribute it under the terms of\n"	pointer
)	O
;	O
printf	function
(	O
"the GNU General Public LIcense.  This program has ABSOLUTELY NO WARRANTY.\n"	pointer
)	O
;	O
exit	function
(	O
EX_OK	int
)	O
;	O
case	O
1	int
:	O
uxhelp	function
(	O
)	O
;	O
exit	function
(	O
EX_OK	int
)	O
;	O
case	O
0	int
:	O
break	O
;	O
default	O
:	O
uxusage	function
(	O
)	O
;	O
break	O
;	O
}	O
}	O
if	O
(	O
!	O
UUCONF_GRADE_LEGAL	O
(	O
bXgrade	char
)	O
||	O
(	O
(	O
bXgrade	char
<	O
'0'	O
||	O
bXgrade	char
>	O
'9'	O
)	O
&&	O
(	O
bXgrade	char
<	O
'a'	O
||	O
bXgrade	char
>	O
'z'	O
)	O
&&	O
(	O
bXgrade	char
<	O
'A'	O
||	O
bXgrade	char
>	O
'Z'	O
)	O
)	O
)	O
{	O
ulog	function
(	O
LOG_ERROR	int
,	O
"Ignoring illegal grade"	pointer
)	O
;	O
bXgrade	char
=	O
BDEFAULT_UUX_GRADE	O
;	O
}	O
if	O
(	O
(	O
zrequestor	pointer
!=	O
NULL	O
&&	O
zrequestor	pointer
[	O
strcspn	function
(	O
zrequestor	pointer
,	O
" \t\n"	pointer
)	O
]	O
!=	O
'\0'	O
)	O
||	O
(	O
zstatus_file	pointer
!=	O
NULL	O
&&	O
zstatus_file	pointer
[	O
strcspn	function
(	O
zstatus_file	pointer
,	O
" \t\n"	pointer
)	O
]	O
!=	O
'\0'	O
)	O
)	O
fXquote	int
=	O
TRUE	O
;	O
if	O
(	O
optind	int
==	O
argc	int
)	O
uxusage	function
(	O
)	O
;	O
iuuconf	int
=	O
uuconf_init	function
(	O
&	O
puuconf	pointer
,	O
(	O
const	O
char	O
*	O
)	O
NULL	O
,	O
zconfig	pointer
)	O
;	O
if	O
(	O
iuuconf	int
!=	O
UUCONF_SUCCESS	O
)	O
ulog_uuconf	function
(	O
LOG_FATAL	int
,	O
puuconf	pointer
,	O
iuuconf	int
)	O
;	O
{	O
const	O
char	O
*	O
zdebug	pointer
;	O
iuuconf	int
=	O
uuconf_debuglevel	function
(	O
puuconf	pointer
,	O
&	O
zdebug	pointer
)	O
;	O
if	O
(	O
iuuconf	int
!=	O
UUCONF_SUCCESS	O
)	O
ulog_uuconf	function
(	O
LOG_FATAL	int
,	O
puuconf	pointer
,	O
iuuconf	int
)	O
;	O
if	O
(	O
zdebug	pointer
!=	O
NULL	O
)	O
iDebug	int
|=	O
idebug_parse	function
(	O
zdebug	pointer
)	O
;	O
}	O
clen	long
=	O
1	int
;	O
for	O
(	O
i	int
=	O
optind	int
;	O
i	int
<	O
argc	int
;	O
i	int
++	O
)	O
clen	long
+=	O
strlen	function
(	O
argv	pointer
[	O
i	int
]	O
)	O
+	O
1	int
;	O
zargs	pointer
=	O
zbufalc	function
(	O
clen	long
)	O
;	O
*	O
zargs	pointer
=	O
'\0'	O
;	O
for	O
(	O
i	int
=	O
optind	int
;	O
i	int
<	O
argc	int
;	O
i	int
++	O
)	O
{	O
strcat	function
(	O
zargs	pointer
,	O
argv	pointer
[	O
i	int
]	O
)	O
;	O
strcat	function
(	O
zargs	pointer
,	O
" "	pointer
)	O
;	O
}	O
clen	long
=	O
strcspn	function
(	O
zargs	pointer
,	O
ZSHELLSEPS	pointer
)	O
;	O
zcmd	pointer
=	O
zbufalc	function
(	O
clen	long
+	O
1	int
)	O
;	O
strncpy	function
(	O
zcmd	pointer
,	O
zargs	pointer
,	O
clen	long
)	O
;	O
zcmd	pointer
[	O
clen	long
]	O
=	O
'\0'	O
;	O
zargs	pointer
+=	O
clen	long
;	O
calloc_args	int
=	O
10	int
;	O
pzargs	pointer
=	O
(	O
char	O
*	O
*	O
)	O
xmalloc	function
(	O
calloc_args	int
*	O
sizeof	O
(	O
char	O
*	O
)	O
)	O
;	O
cargs	int
=	O
0	int
;	O
for	O
(	O
zarg	pointer
=	O
strtok	function
(	O
zargs	pointer
,	O
" \t"	pointer
)	O
;	O
zarg	pointer
!=	O
NULL	O
;	O
zarg	pointer
=	O
strtok	function
(	O
(	O
char	O
*	O
)	O
NULL	O
,	O
" \t"	pointer
)	O
)	O
{	O
while	O
(	O
*	O
zarg	pointer
!=	O
'\0'	O
)	O
{	O
if	O
(	O
cargs	int
+	O
1	int
>=	O
calloc_args	int
)	O
{	O
calloc_args	int
+=	O
10	int
;	O
pzargs	pointer
=	O
(	O
char	O
*	O
*	O
)	O
xrealloc	function
(	O
(	O
pointer	pointer
)	O
pzargs	pointer
,	O
calloc_args	int
*	O
sizeof	O
(	O
char	O
*	O
)	O
)	O
;	O
}	O
if	O
(	O
*	O
zarg	pointer
==	O
'('	O
)	O
clen	long
=	O
strlen	function
(	O
zarg	pointer
)	O
;	O
else	O
clen	long
=	O
strcspn	function
(	O
zarg	pointer
,	O
ZSHELLSEPS	pointer
)	O
;	O
if	O
(	O
clen	long
>	O
0	int
)	O
{	O
pzargs	pointer
[	O
cargs	int
]	O
=	O
zbufalc	function
(	O
clen	long
+	O
1	int
)	O
;	O
memcpy	function
(	O
pzargs	pointer
[	O
cargs	int
]	O
,	O
zarg	pointer
,	O
clen	long
)	O
;	O
pzargs	pointer
[	O
cargs	int
]	O
[	O
clen	long
]	O
=	O
'\0'	O
;	O
++	O
cargs	int
;	O
zarg	pointer
+=	O
clen	long
;	O
}	O
if	O
(	O
*	O
zarg	pointer
!=	O
'\0'	O
)	O
{	O
clen	long
=	O
strspn	function
(	O
zarg	pointer
,	O
ZSHELLNONREDIRSEPS	pointer
)	O
;	O
if	O
(	O
clen	long
==	O
0	int
)	O
clen	long
=	O
1	int
;	O
pzargs	pointer
[	O
cargs	int
]	O
=	O
zbufalc	function
(	O
clen	long
+	O
1	int
)	O
;	O
memcpy	function
(	O
pzargs	pointer
[	O
cargs	int
]	O
,	O
zarg	pointer
,	O
clen	long
)	O
;	O
pzargs	pointer
[	O
cargs	int
]	O
[	O
clen	long
]	O
=	O
'\0'	O
;	O
++	O
cargs	int
;	O
zarg	pointer
+=	O
clen	long
;	O
}	O
}	O
}	O
fgetcwd	int
=	O
FALSE	O
;	O
for	O
(	O
i	int
=	O
0	int
;	O
i	int
<	O
cargs	int
;	O
i	int
++	O
)	O
{	O
if	O
(	O
pzargs	pointer
[	O
i	int
]	O
[	O
0	int
]	O
==	O
'('	O
)	O
continue	O
;	O
zexclam	pointer
=	O
strrchr	function
(	O
pzargs	pointer
[	O
i	int
]	O
,	O
'!'	O
)	O
;	O
if	O
(	O
zexclam	pointer
!=	O
NULL	O
&&	O
fsysdep_needs_cwd	function
(	O
zexclam	pointer
+	O
1	int
)	O
)	O
{	O
fgetcwd	int
=	O
TRUE	O
;	O
break	O
;	O
}	O
if	O
(	O
(	O
pzargs	pointer
[	O
i	int
]	O
[	O
0	int
]	O
==	O
'<'	O
||	O
pzargs	pointer
[	O
i	int
]	O
[	O
0	int
]	O
==	O
'>'	O
)	O
&&	O
i	int
+	O
1	int
<	O
cargs	int
&&	O
strchr	function
(	O
pzargs	pointer
[	O
i	int
+	O
1	int
]	O
,	O
'!'	O
)	O
==	O
NULL	O
&&	O
fsysdep_needs_cwd	function
(	O
pzargs	pointer
[	O
i	int
+	O
1	int
]	O
)	O
)	O
{	O
fgetcwd	int
=	O
TRUE	O
;	O
break	O
;	O
}	O
}	O
usysdep_signal	function
(	O
SIGINT	int
)	O
;	O
usysdep_signal	function
(	O
SIGHUP	int
)	O
;	O
usysdep_signal	function
(	O
SIGQUIT	int
)	O
;	O
usysdep_signal	function
(	O
SIGTERM	int
)	O
;	O
usysdep_signal	function
(	O
SIGPIPE	int
)	O
;	O
usysdep_initialize	function
(	O
puuconf	pointer
,	O
INIT_SUID	O
|	O
(	O
fgetcwd	int
?	O
INIT_GETCWD	O
:	O
0	int
)	O
)	O
;	O
zuser	pointer
=	O
zsysdep_login_name	function
(	O
)	O
;	O
iuuconf	int
=	O
uuconf_localname	function
(	O
puuconf	pointer
,	O
&	O
zlocalname	pointer
)	O
;	O
if	O
(	O
iuuconf	int
==	O
UUCONF_NOT_FOUND	O
)	O
{	O
zlocalname	pointer
=	O
zsysdep_localname	function
(	O
)	O
;	O
if	O
(	O
zlocalname	pointer
==	O
NULL	O
)	O
exit	function
(	O
EX_CONFIG	int
)	O
;	O
}	O
else	O
if	O
(	O
iuuconf	int
!=	O
UUCONF_SUCCESS	O
)	O
ulog_uuconf	function
(	O
LOG_FATAL	int
,	O
puuconf	pointer
,	O
iuuconf	int
)	O
;	O
iuuconf	int
=	O
uuconf_system_info	function
(	O
puuconf	pointer
,	O
zlocalname	pointer
,	O
&	O
slocalsys	struct
)	O
;	O
if	O
(	O
iuuconf	int
!=	O
UUCONF_SUCCESS	O
)	O
{	O
if	O
(	O
iuuconf	int
!=	O
UUCONF_NOT_FOUND	O
)	O
ulog_uuconf	function
(	O
LOG_FATAL	int
,	O
puuconf	pointer
,	O
iuuconf	int
)	O
;	O
iuuconf	int
=	O
uuconf_system_local	function
(	O
puuconf	pointer
,	O
&	O
slocalsys	struct
)	O
;	O
if	O
(	O
iuuconf	int
!=	O
UUCONF_SUCCESS	O
)	O
ulog_uuconf	function
(	O
LOG_FATAL	int
,	O
puuconf	pointer
,	O
iuuconf	int
)	O
;	O
slocalsys	struct
.	O
uuconf_zname	pointer
=	O
(	O
char	O
*	O
)	O
zlocalname	pointer
;	O
}	O
zcmd	pointer
=	O
zremove_local_sys	function
(	O
&	O
slocalsys	struct
,	O
zcmd	pointer
)	O
;	O
zexclam	pointer
=	O
strchr	function
(	O
zcmd	pointer
,	O
'!'	O
)	O
;	O
if	O
(	O
zexclam	pointer
==	O
NULL	O
)	O
{	O
zsys	pointer
=	O
zlocalname	pointer
;	O
fXxqtlocal	int
=	O
TRUE	O
;	O
zforward	pointer
=	O
NULL	O
;	O
}	O
else	O
{	O
*	O
zexclam	pointer
=	O
'\0'	O
;	O
zsys	pointer
=	O
zcmd	pointer
;	O
zcmd	pointer
=	O
zexclam	pointer
+	O
1	int
;	O
fXxqtlocal	int
=	O
FALSE	O
;	O
zexclam	pointer
=	O
strrchr	function
(	O
zcmd	pointer
,	O
'!'	O
)	O
;	O
if	O
(	O
zexclam	pointer
==	O
NULL	O
)	O
zforward	pointer
=	O
NULL	O
;	O
else	O
{	O
clen	long
=	O
zexclam	pointer
-	O
zcmd	pointer
;	O
zforward	pointer
=	O
zbufalc	function
(	O
clen	long
+	O
1	int
)	O
;	O
memcpy	function
(	O
zforward	pointer
,	O
zcmd	pointer
,	O
clen	long
)	O
;	O
zforward	pointer
[	O
clen	long
]	O
=	O
'\0'	O
;	O
zcmd	pointer
=	O
zexclam	pointer
+	O
1	int
;	O
}	O
}	O
if	O
(	O
fXxqtlocal	int
)	O
sXxqtsys	struct
=	O
slocalsys	struct
;	O
else	O
{	O
iuuconf	int
=	O
uuconf_system_info	function
(	O
puuconf	pointer
,	O
zsys	pointer
,	O
&	O
sXxqtsys	struct
)	O
;	O
if	O
(	O
iuuconf	int
!=	O
UUCONF_SUCCESS	O
)	O
{	O
if	O
(	O
iuuconf	int
!=	O
UUCONF_NOT_FOUND	O
)	O
ulog_uuconf	function
(	O
LOG_FATAL	int
,	O
puuconf	pointer
,	O
iuuconf	int
)	O
;	O
if	O
(	O
!	O
funknown_system	function
(	O
puuconf	pointer
,	O
zsys	pointer
,	O
&	O
sXxqtsys	struct
)	O
)	O
ulog	function
(	O
LOG_FATAL	int
,	O
"%s: System not found"	pointer
,	O
zsys	pointer
)	O
;	O
}	O
}	O
zXxqtloc	pointer
=	O
sXxqtsys	struct
.	O
uuconf_zlocalname	pointer
;	O
if	O
(	O
zXxqtloc	pointer
==	O
NULL	O
)	O
zXxqtloc	pointer
=	O
zlocalname	pointer
;	O
zinput_from	pointer
=	O
NULL	O
;	O
zinput_to	pointer
=	O
NULL	O
;	O
zinput_temp	pointer
=	O
NULL	O
;	O
finputcopied	int
=	O
FALSE	O
;	O
zcall_system	pointer
=	O
NULL	O
;	O
fcall_any	int
=	O
FALSE	O
;	O
for	O
(	O
i	int
=	O
0	int
;	O
i	int
<	O
cargs	int
;	O
i	int
++	O
)	O
{	O
const	O
char	O
*	O
zsystem	pointer
;	O
char	O
*	O
zfile	pointer
;	O
char	O
*	O
zforw	pointer
;	O
boolean	int
finput	int
,	O
foutput	int
;	O
boolean	int
flocal	int
,	O
fonxqt	int
;	O
if	O
(	O
pzargs	pointer
[	O
i	int
]	O
[	O
0	int
]	O
==	O
'('	O
)	O
{	O
clen	long
=	O
strlen	function
(	O
pzargs	pointer
[	O
i	int
]	O
)	O
;	O
if	O
(	O
pzargs	pointer
[	O
i	int
]	O
[	O
clen	long
-	O
1	int
]	O
!=	O
')'	O
)	O
ulog	function
(	O
LOG_ERROR	int
,	O
"Mismatched parentheses"	pointer
)	O
;	O
else	O
pzargs	pointer
[	O
i	int
]	O
[	O
clen	long
-	O
1	int
]	O
=	O
'\0'	O
;	O
++	O
pzargs	pointer
[	O
i	int
]	O
;	O
continue	O
;	O
}	O
finput	int
=	O
FALSE	O
;	O
foutput	int
=	O
FALSE	O
;	O
if	O
(	O
i	int
+	O
1	int
<	O
cargs	int
)	O
{	O
if	O
(	O
pzargs	pointer
[	O
i	int
]	O
[	O
0	int
]	O
==	O
'<'	O
)	O
finput	int
=	O
TRUE	O
;	O
else	O
if	O
(	O
pzargs	pointer
[	O
i	int
]	O
[	O
0	int
]	O
==	O
'>'	O
)	O
foutput	int
=	O
TRUE	O
;	O
if	O
(	O
finput	int
||	O
foutput	int
)	O
{	O
pzargs	pointer
[	O
i	int
]	O
=	O
NULL	O
;	O
i	int
++	O
;	O
}	O
}	O
zexclam	pointer
=	O
strchr	function
(	O
pzargs	pointer
[	O
i	int
]	O
,	O
'!'	O
)	O
;	O
if	O
(	O
zexclam	pointer
==	O
NULL	O
&&	O
!	O
finput	int
&&	O
!	O
foutput	int
)	O
continue	O
;	O
if	O
(	O
zexclam	pointer
!=	O
NULL	O
)	O
{	O
pzargs	pointer
[	O
i	int
]	O
=	O
zremove_local_sys	function
(	O
&	O
slocalsys	struct
,	O
pzargs	pointer
[	O
i	int
]	O
)	O
;	O
zexclam	pointer
=	O
strchr	function
(	O
pzargs	pointer
[	O
i	int
]	O
,	O
'!'	O
)	O
;	O
}	O
if	O
(	O
zexclam	pointer
==	O
NULL	O
)	O
{	O
zsystem	pointer
=	O
zlocalname	pointer
;	O
zfile	pointer
=	O
pzargs	pointer
[	O
i	int
]	O
;	O
flocal	int
=	O
TRUE	O
;	O
zforw	pointer
=	O
NULL	O
;	O
}	O
else	O
{	O
*	O
zexclam	pointer
=	O
'\0'	O
;	O
zsystem	pointer
=	O
pzargs	pointer
[	O
i	int
]	O
;	O
zfile	pointer
=	O
zexclam	pointer
+	O
1	int
;	O
flocal	int
=	O
FALSE	O
;	O
zexclam	pointer
=	O
strrchr	function
(	O
zfile	pointer
,	O
'!'	O
)	O
;	O
if	O
(	O
zexclam	pointer
==	O
NULL	O
)	O
zforw	pointer
=	O
NULL	O
;	O
else	O
{	O
*	O
zexclam	pointer
=	O
'\0'	O
;	O
zforw	pointer
=	O
zfile	pointer
;	O
zfile	pointer
=	O
zexclam	pointer
+	O
1	int
;	O
}	O
}	O
if	O
(	O
flocal	int
)	O
fonxqt	int
=	O
fXxqtlocal	int
;	O
else	O
if	O
(	O
fXxqtlocal	int
)	O
fonxqt	int
=	O
FALSE	O
;	O
else	O
if	O
(	O
zforward	pointer
==	O
NULL	O
?	O
zforw	pointer
!=	O
NULL	O
:	O
zforw	pointer
==	O
NULL	O
)	O
fonxqt	int
=	O
FALSE	O
;	O
else	O
if	O
(	O
zforward	pointer
!=	O
NULL	O
&&	O
zforw	pointer
!=	O
NULL	O
&&	O
strcmp	function
(	O
zforward	pointer
,	O
zforw	pointer
)	O
!=	O
0	int
)	O
fonxqt	int
=	O
FALSE	O
;	O
else	O
if	O
(	O
strcmp	function
(	O
zsystem	pointer
,	O
sXxqtsys	struct
.	O
uuconf_zname	pointer
)	O
==	O
0	int
)	O
fonxqt	int
=	O
TRUE	O
;	O
else	O
if	O
(	O
sXxqtsys	struct
.	O
uuconf_pzalias	pointer
==	O
NULL	O
)	O
fonxqt	int
=	O
FALSE	O
;	O
else	O
{	O
char	O
*	O
*	O
pzal	pointer
;	O
fonxqt	int
=	O
FALSE	O
;	O
for	O
(	O
pzal	pointer
=	O
sXxqtsys	struct
.	O
uuconf_pzalias	pointer
;	O
*	O
pzal	pointer
!=	O
NULL	O
;	O
pzal	pointer
++	O
)	O
{	O
if	O
(	O
strcmp	function
(	O
zsystem	pointer
,	O
*	O
pzal	pointer
)	O
==	O
0	int
)	O
{	O
fonxqt	int
=	O
TRUE	O
;	O
break	O
;	O
}	O
}	O
}	O
if	O
(	O
flocal	int
)	O
zfile	pointer
=	O
zsysdep_local_file_cwd	function
(	O
zfile	pointer
,	O
sXxqtsys	struct
.	O
uuconf_zpubdir	pointer
,	O
(	O
boolean	int
*	O
)	O
NULL	O
)	O
;	O
else	O
if	O
(	O
fexpand	int
)	O
zfile	pointer
=	O
zsysdep_add_cwd	function
(	O
zfile	pointer
)	O
;	O
if	O
(	O
zfile	pointer
==	O
NULL	O
)	O
uxabort	function
(	O
EX_OSERR	int
)	O
;	O
if	O
(	O
foutput	int
)	O
{	O
if	O
(	O
flocal	int
)	O
{	O
if	O
(	O
!	O
fin_directory_list	function
(	O
zfile	pointer
,	O
sXxqtsys	struct
.	O
uuconf_pzremote_receive	pointer
,	O
sXxqtsys	struct
.	O
uuconf_zpubdir	pointer
,	O
TRUE	O
,	O
FALSE	O
,	O
(	O
const	O
char	O
*	O
)	O
NULL	O
)	O
)	O
ulog	function
(	O
LOG_FATAL	int
,	O
"Not permitted to create %s"	pointer
,	O
zfile	pointer
)	O
;	O
}	O
if	O
(	O
zforward	pointer
!=	O
NULL	O
||	O
zforw	pointer
!=	O
NULL	O
)	O
ulog	function
(	O
LOG_FATAL	int
,	O
"May not forward standard output"	pointer
)	O
;	O
if	O
(	O
fonxqt	int
)	O
uxadd_xqt_line	function
(	O
'O'	O
,	O
zfile	pointer
,	O
(	O
const	O
char	O
*	O
)	O
NULL	O
)	O
;	O
else	O
if	O
(	O
flocal	int
)	O
uxadd_xqt_line	function
(	O
'O'	O
,	O
zfile	pointer
,	O
zXxqtloc	pointer
)	O
;	O
else	O
uxadd_xqt_line	function
(	O
'O'	O
,	O
zfile	pointer
,	O
zsystem	pointer
)	O
;	O
pzargs	pointer
[	O
i	int
]	O
=	O
NULL	O
;	O
continue	O
;	O
}	O
if	O
(	O
finput	int
)	O
{	O
if	O
(	O
fread_stdin	int
)	O
ulog	function
(	O
LOG_FATAL	int
,	O
"Standard input specified twice"	pointer
)	O
;	O
pzargs	pointer
[	O
i	int
]	O
=	O
NULL	O
;	O
}	O
if	O
(	O
flocal	int
)	O
{	O
char	O
*	O
zuse	pointer
;	O
char	O
*	O
zdata	pointer
;	O
char	O
abtname	array
[	O
CFILE_NAME_LEN	O
]	O
;	O
char	O
abdname	array
[	O
CFILE_NAME_LEN	O
]	O
;	O
if	O
(	O
!	O
fsysdep_access	function
(	O
zfile	pointer
)	O
)	O
uxabort	function
(	O
EX_NOINPUT	int
)	O
;	O
zdata	pointer
=	O
zsysdep_data_file_name	function
(	O
&	O
sXxqtsys	struct
,	O
zXxqtloc	pointer
,	O
bXgrade	char
,	O
FALSE	O
,	O
abtname	array
,	O
abdname	array
,	O
(	O
char	O
*	O
)	O
NULL	O
)	O
;	O
if	O
(	O
zdata	pointer
==	O
NULL	O
)	O
uxabort	function
(	O
EX_OSERR	int
)	O
;	O
if	O
(	O
fcopy	int
||	O
flink	int
||	O
fXxqtlocal	int
)	O
{	O
boolean	int
fdid	int
;	O
uxrecord_file	function
(	O
zdata	pointer
)	O
;	O
fdid	int
=	O
FALSE	O
;	O
if	O
(	O
flink	int
)	O
{	O
boolean	int
fworked	int
;	O
if	O
(	O
!	O
fsysdep_link	function
(	O
zfile	pointer
,	O
zdata	pointer
,	O
&	O
fworked	int
)	O
)	O
uxabort	function
(	O
EX_OSERR	int
)	O
;	O
if	O
(	O
fworked	int
)	O
fdid	int
=	O
TRUE	O
;	O
else	O
if	O
(	O
fdontcopy	int
)	O
ulog	function
(	O
LOG_FATAL	int
,	O
"%s: Can't link to spool directory"	pointer
,	O
zfile	pointer
)	O
;	O
}	O
if	O
(	O
!	O
fdid	int
)	O
{	O
openfile_t	pointer
efile	pointer
;	O
efile	pointer
=	O
esysdep_user_fopen	function
(	O
zfile	pointer
,	O
TRUE	O
,	O
TRUE	O
)	O
;	O
if	O
(	O
!	O
ffileisopen	O
(	O
efile	pointer
)	O
)	O
uxabort	function
(	O
EX_NOINPUT	int
)	O
;	O
if	O
(	O
!	O
fcopy_open_file	function
(	O
efile	pointer
,	O
zdata	pointer
,	O
FALSE	O
,	O
TRUE	O
,	O
TRUE	O
)	O
)	O
uxabort	function
(	O
EX_CANTCREAT	int
)	O
;	O
(	O
void	O
)	O
ffileclose	O
(	O
efile	pointer
)	O
;	O
}	O
zuse	pointer
=	O
abtname	array
;	O
}	O
else	O
{	O
ubuffree	function
(	O
zdata	pointer
)	O
;	O
if	O
(	O
!	O
fsysdep_daemon_access	function
(	O
zfile	pointer
)	O
)	O
uxabort	function
(	O
EX_NOINPUT	int
)	O
;	O
if	O
(	O
!	O
fin_directory_list	function
(	O
zfile	pointer
,	O
sXxqtsys	struct
.	O
uuconf_pzlocal_send	pointer
,	O
sXxqtsys	struct
.	O
uuconf_zpubdir	pointer
,	O
TRUE	O
,	O
TRUE	O
,	O
zuser	pointer
)	O
)	O
ulog	function
(	O
LOG_FATAL	int
,	O
"Not permitted to send from %s"	pointer
,	O
zfile	pointer
)	O
;	O
zuse	pointer
=	O
zfile	pointer
;	O
}	O
if	O
(	O
fXxqtlocal	int
)	O
{	O
if	O
(	O
finput	int
)	O
uxadd_xqt_line	function
(	O
'I'	O
,	O
zuse	pointer
,	O
(	O
char	O
*	O
)	O
NULL	O
)	O
;	O
else	O
pzargs	pointer
[	O
i	int
]	O
=	O
zuse	pointer
;	O
}	O
else	O
{	O
finputcopied	int
=	O
fcopy	int
||	O
flink	int
;	O
if	O
(	O
finput	int
)	O
{	O
zinput_from	pointer
=	O
zuse	pointer
;	O
zinput_to	pointer
=	O
zbufcpy	function
(	O
abdname	array
)	O
;	O
zinput_temp	pointer
=	O
zbufcpy	function
(	O
abtname	array
)	O
;	O
}	O
else	O
{	O
char	O
*	O
zbase	pointer
;	O
uxadd_send_file	function
(	O
zuse	pointer
,	O
abdname	array
,	O
finputcopied	int
?	O
"C"	pointer
:	O
"c"	pointer
,	O
abtname	array
,	O
zforward	pointer
)	O
;	O
zbase	pointer
=	O
zsysdep_base_name	function
(	O
zfile	pointer
)	O
;	O
if	O
(	O
zbase	pointer
==	O
NULL	O
)	O
uxabort	function
(	O
EX_OSERR	int
)	O
;	O
uxadd_xqt_line	function
(	O
'F'	O
,	O
abdname	array
,	O
zbase	pointer
)	O
;	O
pzargs	pointer
[	O
i	int
]	O
=	O
zbase	pointer
;	O
}	O
}	O
}	O
else	O
if	O
(	O
fonxqt	int
)	O
{	O
if	O
(	O
finput	int
)	O
uxadd_xqt_line	function
(	O
'I'	O
,	O
zfile	pointer
,	O
(	O
const	O
char	O
*	O
)	O
NULL	O
)	O
;	O
else	O
pzargs	pointer
[	O
i	int
]	O
=	O
zfile	pointer
;	O
}	O
else	O
{	O
struct	O
uuconf_system	struct
sfromsys	struct
;	O
char	O
abtname	array
[	O
CFILE_NAME_LEN	O
]	O
;	O
struct	O
scmd	struct
s	struct
;	O
char	O
*	O
zjobid	pointer
;	O
iuuconf	int
=	O
uuconf_system_info	function
(	O
puuconf	pointer
,	O
zsystem	pointer
,	O
&	O
sfromsys	struct
)	O
;	O
if	O
(	O
iuuconf	int
!=	O
UUCONF_SUCCESS	O
)	O
{	O
if	O
(	O
iuuconf	int
!=	O
UUCONF_NOT_FOUND	O
)	O
ulog_uuconf	function
(	O
LOG_FATAL	int
,	O
puuconf	pointer
,	O
iuuconf	int
)	O
;	O
if	O
(	O
!	O
funknown_system	function
(	O
puuconf	pointer
,	O
zsystem	pointer
,	O
&	O
sfromsys	struct
)	O
)	O
ulog	function
(	O
LOG_FATAL	int
,	O
"%s: System not found"	pointer
,	O
zsystem	pointer
)	O
;	O
}	O
if	O
(	O
fonxqt	int
)	O
{	O
if	O
(	O
finput	int
)	O
uxadd_xqt_line	function
(	O
'I'	O
,	O
zfile	pointer
,	O
(	O
const	O
char	O
*	O
)	O
NULL	O
)	O
;	O
else	O
pzargs	pointer
[	O
i	int
]	O
=	O
zfile	pointer
;	O
}	O
else	O
{	O
char	O
*	O
zdata	pointer
;	O
boolean	int
ftemp	int
;	O
if	O
(	O
!	O
sfromsys	struct
.	O
uuconf_fcall_transfer	int
&&	O
!	O
sfromsys	struct
.	O
uuconf_fcalled_transfer	int
)	O
ulog	function
(	O
LOG_FATAL	int
,	O
"Not permitted to transfer files to or from %s"	pointer
,	O
sfromsys	struct
.	O
uuconf_zname	pointer
)	O
;	O
if	O
(	O
zforw	pointer
!=	O
NULL	O
)	O
{	O
ulog	function
(	O
LOG_FATAL	int
,	O
"File forwarding not supported"	pointer
)	O
;	O
}	O
zdata	pointer
=	O
zsysdep_data_file_name	function
(	O
&	O
slocalsys	struct
,	O
zXxqtloc	pointer
,	O
bXgrade	char
,	O
FALSE	O
,	O
abtname	array
,	O
(	O
char	O
*	O
)	O
NULL	O
,	O
(	O
char	O
*	O
)	O
NULL	O
)	O
;	O
if	O
(	O
zdata	pointer
==	O
NULL	O
)	O
uxabort	function
(	O
EX_OSERR	int
)	O
;	O
ubuffree	function
(	O
zdata	pointer
)	O
;	O
s	struct
.	O
bcmd	char
=	O
'R'	O
;	O
s	struct
.	O
bgrade	char
=	O
bXgrade	char
;	O
s	struct
.	O
pseq	pointer
=	O
NULL	O
;	O
s	struct
.	O
zfrom	pointer
=	O
zfile	pointer
;	O
s	struct
.	O
zto	pointer
=	O
zbufcpy	function
(	O
abtname	array
)	O
;	O
s	struct
.	O
zuser	pointer
=	O
zuser	pointer
;	O
s	struct
.	O
zoptions	pointer
=	O
"9"	pointer
;	O
s	struct
.	O
ztemp	pointer
=	O
""	pointer
;	O
s	struct
.	O
imode	int
=	O
0600	int
;	O
s	struct
.	O
znotify	pointer
=	O
""	pointer
;	O
s	struct
.	O
cbytes	long
=	O
-	O
1	int
;	O
s	struct
.	O
zcmd	pointer
=	O
NULL	O
;	O
s	struct
.	O
ipos	long
=	O
0	int
;	O
zjobid	pointer
=	O
zsysdep_spool_commands	function
(	O
&	O
sfromsys	struct
,	O
bXgrade	char
,	O
1	int
,	O
&	O
s	struct
,	O
&	O
ftemp	int
)	O
;	O
if	O
(	O
zjobid	pointer
==	O
NULL	O
)	O
uxabort	function
(	O
ftemp	int
?	O
EX_TEMPFAIL	int
:	O
EX_DATAERR	int
)	O
;	O
if	O
(	O
fjobid	int
)	O
printf	function
(	O
"%s\n"	pointer
,	O
zjobid	pointer
)	O
;	O
ubuffree	function
(	O
zjobid	pointer
)	O
;	O
if	O
(	O
fcall_any	int
)	O
{	O
ubuffree	function
(	O
zcall_system	pointer
)	O
;	O
zcall_system	pointer
=	O
NULL	O
;	O
}	O
else	O
{	O
fcall_any	int
=	O
TRUE	O
;	O
zcall_system	pointer
=	O
zbufcpy	function
(	O
sfromsys	struct
.	O
uuconf_zname	pointer
)	O
;	O
}	O
if	O
(	O
fXxqtlocal	int
)	O
{	O
if	O
(	O
finput	int
)	O
{	O
uxadd_xqt_line	function
(	O
'F'	O
,	O
abtname	array
,	O
(	O
char	O
*	O
)	O
NULL	O
)	O
;	O
uxadd_xqt_line	function
(	O
'I'	O
,	O
abtname	array
,	O
(	O
char	O
*	O
)	O
NULL	O
)	O
;	O
}	O
else	O
{	O
char	O
*	O
zbase	pointer
;	O
zbase	pointer
=	O
zsysdep_base_name	function
(	O
zfile	pointer
)	O
;	O
if	O
(	O
zbase	pointer
==	O
NULL	O
)	O
uxabort	function
(	O
EX_OSERR	int
)	O
;	O
uxadd_xqt_line	function
(	O
'F'	O
,	O
abtname	array
,	O
zbase	pointer
)	O
;	O
pzargs	pointer
[	O
i	int
]	O
=	O
zbase	pointer
;	O
}	O
}	O
else	O
{	O
char	O
abxtname	array
[	O
CFILE_NAME_LEN	O
]	O
;	O
char	O
*	O
zbase	pointer
;	O
char	O
*	O
zxqt	pointer
;	O
FILE	struct
*	O
e	pointer
;	O
zdata	pointer
=	O
zsysdep_data_file_name	function
(	O
&	O
sXxqtsys	struct
,	O
zXxqtloc	pointer
,	O
bXgrade	char
,	O
TRUE	O
,	O
abxtname	array
,	O
(	O
char	O
*	O
)	O
NULL	O
,	O
(	O
char	O
*	O
)	O
NULL	O
)	O
;	O
if	O
(	O
zdata	pointer
==	O
NULL	O
)	O
uxabort	function
(	O
EX_OSERR	int
)	O
;	O
ubuffree	function
(	O
zdata	pointer
)	O
;	O
zbase	pointer
=	O
zsysdep_base_name	function
(	O
zfile	pointer
)	O
;	O
if	O
(	O
zbase	pointer
==	O
NULL	O
)	O
uxabort	function
(	O
EX_OSERR	int
)	O
;	O
zxqt	pointer
=	O
zsysdep_xqt_file_name	function
(	O
)	O
;	O
if	O
(	O
zxqt	pointer
==	O
NULL	O
)	O
uxabort	function
(	O
EX_OSERR	int
)	O
;	O
e	pointer
=	O
esysdep_fopen	function
(	O
zxqt	pointer
,	O
FALSE	O
,	O
FALSE	O
,	O
TRUE	O
)	O
;	O
if	O
(	O
e	pointer
==	O
NULL	O
)	O
uxabort	function
(	O
EX_OSERR	int
)	O
;	O
uxrecord_file	function
(	O
zxqt	pointer
)	O
;	O
fprintf	function
(	O
e	pointer
,	O
"U %s %s\n"	pointer
,	O
zsysdep_login_name	function
(	O
)	O
,	O
zlocalname	pointer
)	O
;	O
fprintf	function
(	O
e	pointer
,	O
"F %s %s\n"	pointer
,	O
abtname	array
,	O
zbase	pointer
)	O
;	O
fprintf	function
(	O
e	pointer
,	O
"C uucp -C -W -d -g %c %s %s!"	pointer
,	O
bXgrade	char
,	O
zbase	pointer
,	O
sXxqtsys	struct
.	O
uuconf_zname	pointer
)	O
;	O
if	O
(	O
zforward	pointer
!=	O
NULL	O
)	O
fprintf	function
(	O
e	pointer
,	O
"%s!"	pointer
,	O
zforward	pointer
)	O
;	O
fprintf	function
(	O
e	pointer
,	O
"%s\n"	pointer
,	O
abxtname	array
)	O
;	O
if	O
(	O
!	O
fstdiosync	O
(	O
e	pointer
,	O
zxqt	pointer
)	O
)	O
ulog	function
(	O
LOG_FATAL	int
,	O
"fsync failed"	pointer
)	O
;	O
if	O
(	O
fclose	function
(	O
e	pointer
)	O
!=	O
0	int
)	O
ulog	function
(	O
LOG_FATAL	int
,	O
"fclose: %s"	pointer
,	O
strerror	function
(	O
errno	O
)	O
)	O
;	O
if	O
(	O
finput	int
)	O
{	O
uxadd_xqt_line	function
(	O
'F'	O
,	O
abxtname	array
,	O
(	O
char	O
*	O
)	O
NULL	O
)	O
;	O
uxadd_xqt_line	function
(	O
'I'	O
,	O
abxtname	array
,	O
(	O
char	O
*	O
)	O
NULL	O
)	O
;	O
ubuffree	function
(	O
zbase	pointer
)	O
;	O
}	O
else	O
{	O
uxadd_xqt_line	function
(	O
'F'	O
,	O
abxtname	array
,	O
zbase	pointer
)	O
;	O
pzargs	pointer
[	O
i	int
]	O
=	O
zbase	pointer
;	O
}	O
}	O
}	O
(	O
void	O
)	O
uuconf_system_free	function
(	O
puuconf	pointer
,	O
&	O
sfromsys	struct
)	O
;	O
}	O
}	O
if	O
(	O
fread_stdin	int
)	O
{	O
char	O
*	O
zdata	pointer
;	O
char	O
abtname	array
[	O
CFILE_NAME_LEN	O
]	O
;	O
char	O
abdname	array
[	O
CFILE_NAME_LEN	O
]	O
;	O
FILE	struct
*	O
e	pointer
;	O
zdata	pointer
=	O
zsysdep_data_file_name	function
(	O
&	O
sXxqtsys	struct
,	O
zXxqtloc	pointer
,	O
bXgrade	char
,	O
FALSE	O
,	O
abtname	array
,	O
abdname	array
,	O
(	O
char	O
*	O
)	O
NULL	O
)	O
;	O
if	O
(	O
zdata	pointer
==	O
NULL	O
)	O
uxabort	function
(	O
EX_OSERR	int
)	O
;	O
e	pointer
=	O
esysdep_fopen	function
(	O
zdata	pointer
,	O
FALSE	O
,	O
FALSE	O
,	O
TRUE	O
)	O
;	O
if	O
(	O
e	pointer
==	O
NULL	O
)	O
uxabort	function
(	O
EX_OSERR	int
)	O
;	O
eXclose	pointer
=	O
e	pointer
;	O
uxrecord_file	function
(	O
zdata	pointer
)	O
;	O
uxcopy_stdin	function
(	O
e	pointer
)	O
;	O
if	O
(	O
!	O
fstdiosync	O
(	O
e	pointer
,	O
zdata	pointer
)	O
)	O
ulog	function
(	O
LOG_FATAL	int
,	O
"fsync failed"	pointer
)	O
;	O
eXclose	pointer
=	O
NULL	O
;	O
if	O
(	O
fclose	function
(	O
e	pointer
)	O
!=	O
0	int
)	O
ulog	function
(	O
LOG_FATAL	int
,	O
"fclose: %s"	pointer
,	O
strerror	function
(	O
errno	O
)	O
)	O
;	O
if	O
(	O
fXxqtlocal	int
)	O
uxadd_xqt_line	function
(	O
'I'	O
,	O
abtname	array
,	O
(	O
const	O
char	O
*	O
)	O
NULL	O
)	O
;	O
else	O
{	O
zinput_from	pointer
=	O
zbufcpy	function
(	O
abtname	array
)	O
;	O
zinput_to	pointer
=	O
zbufcpy	function
(	O
abdname	array
)	O
;	O
zinput_temp	pointer
=	O
zinput_from	pointer
;	O
finputcopied	int
=	O
TRUE	O
;	O
}	O
}	O
if	O
(	O
fretstdin	int
)	O
uxadd_xqt_line	function
(	O
'B'	O
,	O
(	O
const	O
char	O
*	O
)	O
NULL	O
,	O
(	O
const	O
char	O
*	O
)	O
NULL	O
)	O
;	O
if	O
(	O
zstatus_file	pointer
!=	O
NULL	O
)	O
uxadd_xqt_line	function
(	O
'M'	O
,	O
zstatus_file	pointer
,	O
(	O
const	O
char	O
*	O
)	O
NULL	O
)	O
;	O
fneedshell	int
=	O
FALSE	O
;	O
if	O
(	O
zcmd	pointer
[	O
strcspn	function
(	O
zcmd	pointer
,	O
ZSHELLCHARS	pointer
)	O
]	O
!=	O
'\0'	O
)	O
fneedshell	int
=	O
TRUE	O
;	O
clen	long
=	O
strlen	function
(	O
zcmd	pointer
)	O
+	O
1	int
;	O
for	O
(	O
i	int
=	O
0	int
;	O
i	int
<	O
cargs	int
;	O
i	int
++	O
)	O
{	O
if	O
(	O
pzargs	pointer
[	O
i	int
]	O
!=	O
NULL	O
)	O
{	O
clen	long
+=	O
strlen	function
(	O
pzargs	pointer
[	O
i	int
]	O
)	O
+	O
1	int
;	O
if	O
(	O
pzargs	pointer
[	O
i	int
]	O
[	O
strcspn	function
(	O
pzargs	pointer
[	O
i	int
]	O
,	O
ZSHELLCHARS	pointer
)	O
]	O
!=	O
'\0'	O
)	O
fneedshell	int
=	O
TRUE	O
;	O
}	O
}	O
zfullcmd	pointer
=	O
zbufalc	function
(	O
clen	long
)	O
;	O
strcpy	function
(	O
zfullcmd	pointer
,	O
zcmd	pointer
)	O
;	O
for	O
(	O
i	int
=	O
0	int
;	O
i	int
<	O
cargs	int
;	O
i	int
++	O
)	O
{	O
if	O
(	O
pzargs	pointer
[	O
i	int
]	O
!=	O
NULL	O
)	O
{	O
strcat	function
(	O
zfullcmd	pointer
,	O
" "	pointer
)	O
;	O
strcat	function
(	O
zfullcmd	pointer
,	O
pzargs	pointer
[	O
i	int
]	O
)	O
;	O
}	O
}	O
fpoll	int
=	O
FALSE	O
;	O
if	O
(	O
eXxqt_file	pointer
==	O
NULL	O
&&	O
zinput_from	pointer
!=	O
NULL	O
&&	O
zforward	pointer
==	O
NULL	O
)	O
{	O
struct	O
scmd	struct
s	struct
;	O
char	O
*	O
zoptions	pointer
;	O
s	struct
.	O
bcmd	char
=	O
'E'	O
;	O
s	struct
.	O
bgrade	char
=	O
bXgrade	char
;	O
s	struct
.	O
pseq	pointer
=	O
NULL	O
;	O
s	struct
.	O
zuser	pointer
=	O
zuser	pointer
;	O
s	struct
.	O
zfrom	pointer
=	O
zinput_from	pointer
;	O
s	struct
.	O
zto	pointer
=	O
zinput_to	pointer
;	O
s	struct
.	O
zoptions	pointer
=	O
aboptions	array
;	O
zoptions	pointer
=	O
aboptions	array
;	O
*	O
zoptions	pointer
++	O
=	O
finputcopied	int
?	O
'C'	O
:	O
'c'	O
;	O
if	O
(	O
fno_ack	int
)	O
*	O
zoptions	pointer
++	O
=	O
'N'	O
;	O
if	O
(	O
ferror_ack	int
)	O
*	O
zoptions	pointer
++	O
=	O
'Z'	O
;	O
if	O
(	O
zrequestor	pointer
!=	O
NULL	O
)	O
*	O
zoptions	pointer
++	O
=	O
'R'	O
;	O
if	O
(	O
fneedshell	int
)	O
*	O
zoptions	pointer
++	O
=	O
'e'	O
;	O
*	O
zoptions	pointer
=	O
'\0'	O
;	O
s	struct
.	O
ztemp	pointer
=	O
zinput_temp	pointer
;	O
s	struct
.	O
imode	int
=	O
0666	int
;	O
if	O
(	O
zrequestor	pointer
==	O
NULL	O
)	O
zrequestor	pointer
=	O
"\"\""	pointer
;	O
s	struct
.	O
znotify	pointer
=	O
zrequestor	pointer
;	O
s	struct
.	O
cbytes	long
=	O
-	O
1	int
;	O
s	struct
.	O
zcmd	pointer
=	O
zfullcmd	pointer
;	O
s	struct
.	O
ipos	long
=	O
0	int
;	O
++	O
cXcmds	int
;	O
pasXcmds	pointer
=	O
(	O
struct	O
scmd	struct
*	O
)	O
xrealloc	function
(	O
(	O
pointer	pointer
)	O
pasXcmds	pointer
,	O
cXcmds	int
*	O
sizeof	O
(	O
struct	O
scmd	struct
)	O
)	O
;	O
pasXcmds	pointer
[	O
cXcmds	int
-	O
1	int
]	O
=	O
s	struct
;	O
uxadd_name	function
(	O
zinput_from	pointer
)	O
;	O
}	O
else	O
if	O
(	O
*	O
zfullcmd	pointer
==	O
'\0'	O
&&	O
eXxqt_file	pointer
==	O
NULL	O
&&	O
zinput_from	pointer
==	O
NULL	O
&&	O
cXcmds	int
==	O
0	int
)	O
{	O
fpoll	int
=	O
TRUE	O
;	O
}	O
else	O
{	O
uxadd_xqt_line	function
(	O
'U'	O
,	O
zuser	pointer
,	O
zXxqtloc	pointer
)	O
;	O
if	O
(	O
zinput_from	pointer
!=	O
NULL	O
)	O
{	O
uxadd_xqt_line	function
(	O
'F'	O
,	O
zinput_to	pointer
,	O
(	O
char	O
*	O
)	O
NULL	O
)	O
;	O
uxadd_xqt_line	function
(	O
'I'	O
,	O
zinput_to	pointer
,	O
(	O
char	O
*	O
)	O
NULL	O
)	O
;	O
uxadd_send_file	function
(	O
zinput_from	pointer
,	O
zinput_to	pointer
,	O
finputcopied	int
?	O
"C"	pointer
:	O
"c"	pointer
,	O
zinput_temp	pointer
,	O
zforward	pointer
)	O
;	O
}	O
if	O
(	O
fno_ack	int
)	O
uxadd_xqt_line	function
(	O
'N'	O
,	O
(	O
const	O
char	O
*	O
)	O
NULL	O
,	O
(	O
const	O
char	O
*	O
)	O
NULL	O
)	O
;	O
if	O
(	O
ferror_ack	int
)	O
uxadd_xqt_line	function
(	O
'Z'	O
,	O
(	O
const	O
char	O
*	O
)	O
NULL	O
,	O
(	O
const	O
char	O
*	O
)	O
NULL	O
)	O
;	O
if	O
(	O
zrequestor	pointer
!=	O
NULL	O
)	O
uxadd_xqt_line	function
(	O
'R'	O
,	O
zrequestor	pointer
,	O
(	O
const	O
char	O
*	O
)	O
NULL	O
)	O
;	O
if	O
(	O
fneedshell	int
)	O
uxadd_xqt_line	function
(	O
'e'	O
,	O
(	O
const	O
char	O
*	O
)	O
NULL	O
,	O
(	O
const	O
char	O
*	O
)	O
NULL	O
)	O
;	O
uxadd_xqt_line	function
(	O
'C'	O
,	O
zfullcmd	pointer
,	O
(	O
const	O
char	O
*	O
)	O
NULL	O
)	O
;	O
if	O
(	O
!	O
fstdiosync	O
(	O
eXxqt_file	pointer
,	O
"execution file"	pointer
)	O
)	O
ulog	function
(	O
LOG_FATAL	int
,	O
"fsync failed"	pointer
)	O
;	O
if	O
(	O
fclose	function
(	O
eXxqt_file	pointer
)	O
!=	O
0	int
)	O
ulog	function
(	O
LOG_FATAL	int
,	O
"fclose: %s"	pointer
,	O
strerror	function
(	O
errno	O
)	O
)	O
;	O
eXxqt_file	pointer
=	O
NULL	O
;	O
if	O
(	O
!	O
fXxqtlocal	int
)	O
uxadd_send_file	function
(	O
abXxqt_tname	array
,	O
abXxqt_xname	array
,	O
"C"	pointer
,	O
abXxqt_tname	array
,	O
zforward	pointer
)	O
;	O
}	O
if	O
(	O
FGOT_SIGNAL	O
(	O
)	O
)	O
uxabort	function
(	O
EX_OSERR	int
)	O
;	O
if	O
(	O
cXcmds	int
>	O
0	int
||	O
fpoll	int
)	O
{	O
char	O
*	O
zjobid	pointer
;	O
boolean	int
ftemp	int
;	O
if	O
(	O
!	O
fpoll	int
&&	O
!	O
sXxqtsys	struct
.	O
uuconf_fcall_transfer	int
&&	O
!	O
sXxqtsys	struct
.	O
uuconf_fcalled_transfer	int
)	O
ulog	function
(	O
LOG_FATAL	int
,	O
"Not permitted to transfer files to or from %s"	pointer
,	O
sXxqtsys	struct
.	O
uuconf_zname	pointer
)	O
;	O
zjobid	pointer
=	O
zsysdep_spool_commands	function
(	O
&	O
sXxqtsys	struct
,	O
bXgrade	char
,	O
cXcmds	int
,	O
pasXcmds	pointer
,	O
&	O
ftemp	int
)	O
;	O
if	O
(	O
zjobid	pointer
==	O
NULL	O
)	O
{	O
ulog_close	function
(	O
)	O
;	O
exit	function
(	O
ftemp	int
?	O
EX_TEMPFAIL	int
:	O
EX_DATAERR	int
)	O
;	O
}	O
if	O
(	O
fjobid	int
)	O
printf	function
(	O
"%s\n"	pointer
,	O
zjobid	pointer
)	O
;	O
ubuffree	function
(	O
zjobid	pointer
)	O
;	O
if	O
(	O
fcall_any	int
)	O
{	O
ubuffree	function
(	O
zcall_system	pointer
)	O
;	O
zcall_system	pointer
=	O
NULL	O
;	O
}	O
else	O
{	O
fcall_any	int
=	O
TRUE	O
;	O
zcall_system	pointer
=	O
zbufcpy	function
(	O
sXxqtsys	struct
.	O
uuconf_zname	pointer
)	O
;	O
}	O
}	O
if	O
(	O
!	O
fpoll	int
)	O
{	O
ulog_to_file	function
(	O
puuconf	pointer
,	O
TRUE	O
)	O
;	O
ulog_system	function
(	O
sXxqtsys	struct
.	O
uuconf_zname	pointer
)	O
;	O
ulog_user	function
(	O
zuser	pointer
)	O
;	O
if	O
(	O
zXnames	pointer
==	O
NULL	O
)	O
ulog	function
(	O
LOG_NORMAL	int
,	O
"Queuing %s"	pointer
,	O
zfullcmd	pointer
)	O
;	O
else	O
ulog	function
(	O
LOG_NORMAL	int
,	O
"Queuing %s (%s)"	pointer
,	O
zfullcmd	pointer
,	O
zXnames	pointer
)	O
;	O
ulog_close	function
(	O
)	O
;	O
}	O
if	O
(	O
!	O
fuucico	int
||	O
(	O
zcall_system	pointer
==	O
NULL	O
&&	O
!	O
fcall_any	int
)	O
)	O
{	O
if	O
(	O
fXxqtlocal	int
&&	O
fuucico	int
)	O
{	O
char	O
*	O
zconfigarg	pointer
;	O
if	O
(	O
zconfig	pointer
==	O
NULL	O
)	O
zconfigarg	pointer
=	O
NULL	O
;	O
else	O
{	O
zconfigarg	pointer
=	O
zbufalc	function
(	O
sizeof	O
"-I"	pointer
+	O
strlen	function
(	O
zconfig	pointer
)	O
)	O
;	O
sprintf	function
(	O
zconfigarg	pointer
,	O
"-I%s"	pointer
,	O
zconfig	pointer
)	O
;	O
}	O
(	O
void	O
)	O
fsysdep_run	function
(	O
FALSE	O
,	O
"uuxqt"	pointer
,	O
zconfigarg	pointer
,	O
(	O
const	O
char	O
*	O
)	O
NULL	O
)	O
;	O
}	O
}	O
else	O
{	O
const	O
char	O
*	O
zcicoarg	pointer
;	O
char	O
*	O
zconfigarg	pointer
;	O
if	O
(	O
zcall_system	pointer
==	O
NULL	O
)	O
zcicoarg	pointer
=	O
"-r1"	pointer
;	O
else	O
{	O
char	O
*	O
z	pointer
;	O
z	pointer
=	O
zbufalc	function
(	O
sizeof	O
"-Cs"	pointer
+	O
strlen	function
(	O
zcall_system	pointer
)	O
)	O
;	O
sprintf	function
(	O
z	pointer
,	O
"-Cs%s"	pointer
,	O
zcall_system	pointer
)	O
;	O
zcicoarg	pointer
=	O
z	pointer
;	O
}	O
if	O
(	O
zconfig	pointer
==	O
NULL	O
)	O
zconfigarg	pointer
=	O
NULL	O
;	O
else	O
{	O
zconfigarg	pointer
=	O
zbufalc	function
(	O
sizeof	O
"-I"	pointer
+	O
strlen	function
(	O
zconfig	pointer
)	O
)	O
;	O
sprintf	function
(	O
zconfigarg	pointer
,	O
"-I%s"	pointer
,	O
zconfig	pointer
)	O
;	O
}	O
(	O
void	O
)	O
fsysdep_run	function
(	O
FALSE	O
,	O
"uucico"	pointer
,	O
zcicoarg	pointer
,	O
zconfigarg	pointer
)	O
;	O
}	O
exit	function
(	O
EX_OK	int
)	O
;	O
return	O
0	int
;	O
}	O
static	O
void	O
uxhelp	function
(	O
)	O
{	O
printf	function
(	O
"Taylor UUCP %s, copyright (C) 1991, 92, 93, 94, 1995, 2002 Ian Lance Taylor\n"	pointer
,	O
VERSION	pointer
)	O
;	O
printf	function
(	O
"Usage: %s [options] [-] command\n"	pointer
,	O
zProgram	pointer
)	O
;	O
printf	function
(	O
" -,-p,--stdin: Read standard input for standard input of command\n"	pointer
)	O
;	O
printf	function
(	O
" -c,--nocopy: Do not copy local files to spool directory (default)\n"	pointer
)	O
;	O
printf	function
(	O
" -C,--copy: Copy local files to spool directory\n"	pointer
)	O
;	O
printf	function
(	O
" -l,--link: link local files to spool directory\n"	pointer
)	O
;	O
printf	function
(	O
" -g,--grade grade: Set job grade (must be alphabetic)\n"	pointer
)	O
;	O
printf	function
(	O
" -n,--notification=no: Do not report completion status\n"	pointer
)	O
;	O
printf	function
(	O
" -z,--notification=error: Report completion status only on error\n"	pointer
)	O
;	O
printf	function
(	O
" -r,--nouucico: Do not start uucico daemon\n"	pointer
)	O
;	O
printf	function
(	O
" -a,--requestor address: Address to mail status report to\n"	pointer
)	O
;	O
printf	function
(	O
" -b,--return-stdin: Return standard input with status report\n"	pointer
)	O
;	O
printf	function
(	O
" -s,--status file: Report completion status to file\n"	pointer
)	O
;	O
printf	function
(	O
" -j,--jobid: Report job id\n"	pointer
)	O
;	O
printf	function
(	O
" -x,--debug debug: Set debugging level\n"	pointer
)	O
;	O
printf	function
(	O
" -I,--config file: Set configuration file to use\n"	pointer
)	O
;	O
printf	function
(	O
" -v,--version: Print version and exit\n"	pointer
)	O
;	O
printf	function
(	O
" --help: Print help and exit\n"	pointer
)	O
;	O
printf	function
(	O
"Report bugs to taylor-uucp@gnu.org\n"	pointer
)	O
;	O
}	O
static	O
void	O
uxusage	function
(	O
)	O
{	O
fprintf	function
(	O
stderr	pointer
,	O
"Usage: %s [options] [-] command\n"	pointer
,	O
zProgram	pointer
)	O
;	O
fprintf	function
(	O
stderr	pointer
,	O
"Use %s --help for help\n"	pointer
,	O
zProgram	pointer
)	O
;	O
exit	function
(	O
EX_USAGE	int
)	O
;	O
}	O
static	O
void	O
uxadd_xqt_line	function
(	O
bchar	int
,	O
z1	pointer
,	O
z2	pointer
)	O
int	O
bchar	int
;	O
const	O
char	O
*	O
z1	pointer
;	O
const	O
char	O
*	O
z2	pointer
;	O
{	O
char	O
*	O
z1q	pointer
;	O
char	O
*	O
z2q	pointer
;	O
if	O
(	O
eXxqt_file	pointer
==	O
NULL	O
)	O
{	O
const	O
char	O
*	O
zxqt_name	pointer
;	O
if	O
(	O
fXxqtlocal	int
)	O
zxqt_name	pointer
=	O
zsysdep_xqt_file_name	function
(	O
)	O
;	O
else	O
zxqt_name	pointer
=	O
zsysdep_data_file_name	function
(	O
&	O
sXxqtsys	struct
,	O
zXxqtloc	pointer
,	O
bXgrade	char
,	O
TRUE	O
,	O
abXxqt_tname	array
,	O
(	O
char	O
*	O
)	O
NULL	O
,	O
abXxqt_xname	array
)	O
;	O
if	O
(	O
zxqt_name	pointer
==	O
NULL	O
)	O
uxabort	function
(	O
EX_OSERR	int
)	O
;	O
uxrecord_file	function
(	O
zxqt_name	pointer
)	O
;	O
eXxqt_file	pointer
=	O
esysdep_fopen	function
(	O
zxqt_name	pointer
,	O
FALSE	O
,	O
FALSE	O
,	O
TRUE	O
)	O
;	O
if	O
(	O
eXxqt_file	pointer
==	O
NULL	O
)	O
uxabort	function
(	O
EX_OSERR	int
)	O
;	O
}	O
z1q	pointer
=	O
NULL	O
;	O
z2q	pointer
=	O
NULL	O
;	O
if	O
(	O
fXquote	int
)	O
{	O
if	O
(	O
!	O
fXquote_output	int
)	O
{	O
fprintf	function
(	O
eXxqt_file	pointer
,	O
"Q\n"	pointer
)	O
;	O
fXquote_output	int
=	O
TRUE	O
;	O
}	O
if	O
(	O
z1	pointer
!=	O
NULL	O
)	O
{	O
z1q	pointer
=	O
zquote_cmd_string	function
(	O
z1	pointer
,	O
FALSE	O
)	O
;	O
z1	pointer
=	O
z1q	pointer
;	O
}	O
if	O
(	O
z2	pointer
!=	O
NULL	O
)	O
{	O
z2q	pointer
=	O
zquote_cmd_string	function
(	O
z2	pointer
,	O
FALSE	O
)	O
;	O
z2	pointer
=	O
z2q	pointer
;	O
}	O
}	O
if	O
(	O
z1	pointer
==	O
NULL	O
)	O
fprintf	function
(	O
eXxqt_file	pointer
,	O
"%c\n"	pointer
,	O
bchar	int
)	O
;	O
else	O
if	O
(	O
z2	pointer
==	O
NULL	O
)	O
fprintf	function
(	O
eXxqt_file	pointer
,	O
"%c %s\n"	pointer
,	O
bchar	int
,	O
z1	pointer
)	O
;	O
else	O
fprintf	function
(	O
eXxqt_file	pointer
,	O
"%c %s %s\n"	pointer
,	O
bchar	int
,	O
z1	pointer
,	O
z2	pointer
)	O
;	O
if	O
(	O
z1q	pointer
!=	O
NULL	O
)	O
ubuffree	function
(	O
z1q	pointer
)	O
;	O
if	O
(	O
z2q	pointer
!=	O
NULL	O
)	O
ubuffree	function
(	O
z2q	pointer
)	O
;	O
}	O
static	O
void	O
uxadd_send_file	function
(	O
zfrom	pointer
,	O
zto	pointer
,	O
zoptions	pointer
,	O
ztemp	pointer
,	O
zforward	pointer
)	O
const	O
char	O
*	O
zfrom	pointer
;	O
const	O
char	O
*	O
zto	pointer
;	O
const	O
char	O
*	O
zoptions	pointer
;	O
const	O
char	O
*	O
ztemp	pointer
;	O
const	O
char	O
*	O
zforward	pointer
;	O
{	O
struct	O
scmd	struct
s	struct
;	O
if	O
(	O
zforward	pointer
!=	O
NULL	O
)	O
{	O
char	O
*	O
zbase	pointer
;	O
char	O
*	O
zxqt	pointer
;	O
char	O
abtname	array
[	O
CFILE_NAME_LEN	O
]	O
;	O
char	O
abdname	array
[	O
CFILE_NAME_LEN	O
]	O
;	O
char	O
abxname	array
[	O
CFILE_NAME_LEN	O
]	O
;	O
FILE	struct
*	O
e	pointer
;	O
zbase	pointer
=	O
zsysdep_base_name	function
(	O
zfrom	pointer
)	O
;	O
if	O
(	O
zbase	pointer
==	O
NULL	O
)	O
uxabort	function
(	O
EX_OSERR	int
)	O
;	O
zxqt	pointer
=	O
zsysdep_data_file_name	function
(	O
&	O
sXxqtsys	struct
,	O
zXxqtloc	pointer
,	O
bXgrade	char
,	O
TRUE	O
,	O
abtname	array
,	O
abdname	array
,	O
abxname	array
)	O
;	O
if	O
(	O
zxqt	pointer
==	O
NULL	O
)	O
uxabort	function
(	O
EX_OSERR	int
)	O
;	O
e	pointer
=	O
esysdep_fopen	function
(	O
zxqt	pointer
,	O
FALSE	O
,	O
FALSE	O
,	O
TRUE	O
)	O
;	O
if	O
(	O
e	pointer
==	O
NULL	O
)	O
uxabort	function
(	O
EX_OSERR	int
)	O
;	O
uxrecord_file	function
(	O
zxqt	pointer
)	O
;	O
fprintf	function
(	O
e	pointer
,	O
"U %s %s\n"	pointer
,	O
zsysdep_login_name	function
(	O
)	O
,	O
zXxqtloc	pointer
)	O
;	O
fprintf	function
(	O
e	pointer
,	O
"F %s %s\n"	pointer
,	O
abdname	array
,	O
zbase	pointer
)	O
;	O
fprintf	function
(	O
e	pointer
,	O
"C uucp -C -W -d -g %c %s %s!%s\n"	pointer
,	O
bXgrade	char
,	O
zbase	pointer
,	O
zforward	pointer
,	O
zto	pointer
)	O
;	O
ubuffree	function
(	O
zbase	pointer
)	O
;	O
if	O
(	O
!	O
fstdiosync	O
(	O
e	pointer
,	O
zxqt	pointer
)	O
)	O
ulog	function
(	O
LOG_FATAL	int
,	O
"fsync failed"	pointer
)	O
;	O
if	O
(	O
fclose	function
(	O
e	pointer
)	O
!=	O
0	int
)	O
ulog	function
(	O
LOG_FATAL	int
,	O
"fclose: %s"	pointer
,	O
strerror	function
(	O
errno	O
)	O
)	O
;	O
s	struct
.	O
bcmd	char
=	O
'S'	O
;	O
s	struct
.	O
bgrade	char
=	O
bXgrade	char
;	O
s	struct
.	O
pseq	pointer
=	O
NULL	O
;	O
s	struct
.	O
zfrom	pointer
=	O
zbufcpy	function
(	O
abtname	array
)	O
;	O
s	struct
.	O
zto	pointer
=	O
zbufcpy	function
(	O
abxname	array
)	O
;	O
s	struct
.	O
zuser	pointer
=	O
zsysdep_login_name	function
(	O
)	O
;	O
s	struct
.	O
zoptions	pointer
=	O
"C"	pointer
;	O
s	struct
.	O
ztemp	pointer
=	O
s	struct
.	O
zfrom	pointer
;	O
s	struct
.	O
imode	int
=	O
0666	int
;	O
s	struct
.	O
znotify	pointer
=	O
NULL	O
;	O
s	struct
.	O
cbytes	long
=	O
-	O
1	int
;	O
s	struct
.	O
zcmd	pointer
=	O
NULL	O
;	O
s	struct
.	O
ipos	long
=	O
0	int
;	O
++	O
cXcmds	int
;	O
pasXcmds	pointer
=	O
(	O
struct	O
scmd	struct
*	O
)	O
xrealloc	function
(	O
(	O
pointer	pointer
)	O
pasXcmds	pointer
,	O
cXcmds	int
*	O
sizeof	O
(	O
struct	O
scmd	struct
)	O
)	O
;	O
pasXcmds	pointer
[	O
cXcmds	int
-	O
1	int
]	O
=	O
s	struct
;	O
uxadd_name	function
(	O
abtname	array
)	O
;	O
zto	pointer
=	O
abdname	array
;	O
}	O
s	struct
.	O
bcmd	char
=	O
'S'	O
;	O
s	struct
.	O
bgrade	char
=	O
bXgrade	char
;	O
s	struct
.	O
pseq	pointer
=	O
NULL	O
;	O
s	struct
.	O
zfrom	pointer
=	O
zbufcpy	function
(	O
zfrom	pointer
)	O
;	O
s	struct
.	O
zto	pointer
=	O
zbufcpy	function
(	O
zto	pointer
)	O
;	O
s	struct
.	O
zuser	pointer
=	O
zsysdep_login_name	function
(	O
)	O
;	O
s	struct
.	O
zoptions	pointer
=	O
zbufcpy	function
(	O
zoptions	pointer
)	O
;	O
s	struct
.	O
ztemp	pointer
=	O
zbufcpy	function
(	O
ztemp	pointer
)	O
;	O
s	struct
.	O
imode	int
=	O
0666	int
;	O
s	struct
.	O
znotify	pointer
=	O
""	pointer
;	O
s	struct
.	O
cbytes	long
=	O
-	O
1	int
;	O
s	struct
.	O
zcmd	pointer
=	O
NULL	O
;	O
s	struct
.	O
ipos	long
=	O
0	int
;	O
++	O
cXcmds	int
;	O
pasXcmds	pointer
=	O
(	O
struct	O
scmd	struct
*	O
)	O
xrealloc	function
(	O
(	O
pointer	pointer
)	O
pasXcmds	pointer
,	O
cXcmds	int
*	O
sizeof	O
(	O
struct	O
scmd	struct
)	O
)	O
;	O
pasXcmds	pointer
[	O
cXcmds	int
-	O
1	int
]	O
=	O
s	struct
;	O
uxadd_name	function
(	O
zfrom	pointer
)	O
;	O
}	O
static	O
void	O
uxcopy_stdin	function
(	O
e	pointer
)	O
FILE	struct
*	O
e	pointer
;	O
{	O
CATCH_PROTECT	O
size_t	long
cread	long
;	O
char	O
ab	array
[	O
1024	int
]	O
;	O
do	O
{	O
size_t	long
cwrite	long
;	O
cread	long
=	O
0	int
;	O
if	O
(	O
fsysdep_catch	function
(	O
)	O
)	O
{	O
usysdep_start_catch	function
(	O
)	O
;	O
while	O
(	O
cread	long
<	O
sizeof	O
(	O
ab	array
)	O
)	O
{	O
int	O
b	int
;	O
if	O
(	O
FGOT_SIGNAL	O
(	O
)	O
)	O
uxabort	function
(	O
EX_OSERR	int
)	O
;	O
b	int
=	O
getchar	function
(	O
)	O
;	O
if	O
(	O
b	int
==	O
EOF	O
)	O
break	O
;	O
ab	array
[	O
cread	long
]	O
=	O
b	int
;	O
++	O
cread	long
;	O
}	O
}	O
usysdep_end_catch	function
(	O
)	O
;	O
if	O
(	O
FGOT_SIGNAL	O
(	O
)	O
)	O
uxabort	function
(	O
EX_OSERR	int
)	O
;	O
if	O
(	O
cread	long
>	O
0	int
)	O
{	O
cwrite	long
=	O
fwrite	function
(	O
ab	array
,	O
sizeof	O
(	O
char	O
)	O
,	O
cread	long
,	O
e	pointer
)	O
;	O
if	O
(	O
cwrite	long
!=	O
cread	long
)	O
ulog	function
(	O
LOG_FATAL	int
,	O
"fwrite: Wrote %d when attempted %d"	pointer
,	O
(	O
int	O
)	O
cwrite	long
,	O
(	O
int	O
)	O
cread	long
)	O
;	O
}	O
}	O
while	O
(	O
cread	long
==	O
sizeof	O
ab	array
)	O
;	O
}	O
static	O
int	O
cXfiles	int
;	O
static	O
const	O
char	O
*	O
*	O
pXaz	pointer
;	O
static	O
void	O
uxrecord_file	function
(	O
zfile	pointer
)	O
const	O
char	O
*	O
zfile	pointer
;	O
{	O
pXaz	pointer
=	O
(	O
const	O
char	O
*	O
*	O
)	O
xrealloc	function
(	O
(	O
pointer	pointer
)	O
pXaz	pointer
,	O
(	O
cXfiles	int
+	O
1	int
)	O
*	O
sizeof	O
(	O
const	O
char	O
*	O
)	O
)	O
;	O
pXaz	pointer
[	O
cXfiles	int
]	O
=	O
zfile	pointer
;	O
++	O
cXfiles	int
;	O
}	O
static	O
void	O
uxfatal	function
(	O
)	O
{	O
uxabort	function
(	O
EX_UNAVAILABLE	int
)	O
;	O
}	O
static	O
void	O
uxabort	function
(	O
istat	int
)	O
int	O
istat	int
;	O
{	O
int	O
i	int
;	O
if	O
(	O
eXxqt_file	pointer
!=	O
NULL	O
)	O
(	O
void	O
)	O
fclose	function
(	O
eXxqt_file	pointer
)	O
;	O
if	O
(	O
eXclose	pointer
!=	O
NULL	O
)	O
(	O
void	O
)	O
fclose	function
(	O
eXclose	pointer
)	O
;	O
for	O
(	O
i	int
=	O
0	int
;	O
i	int
<	O
cXfiles	int
;	O
i	int
++	O
)	O
(	O
void	O
)	O
remove	function
(	O
pXaz	pointer
[	O
i	int
]	O
)	O
;	O
ulog_close	function
(	O
)	O
;	O
exit	function
(	O
istat	int
)	O
;	O
}	O
static	O
void	O
uxadd_name	function
(	O
z	pointer
)	O
const	O
char	O
*	O
z	pointer
;	O
{	O
if	O
(	O
zXnames	pointer
==	O
NULL	O
)	O
zXnames	pointer
=	O
zbufcpy	function
(	O
z	pointer
)	O
;	O
else	O
{	O
size_t	long
cold	long
,	O
cadd	long
;	O
char	O
*	O
znew	pointer
;	O
cold	long
=	O
strlen	function
(	O
zXnames	pointer
)	O
;	O
cadd	long
=	O
strlen	function
(	O
z	pointer
)	O
;	O
znew	pointer
=	O
zbufalc	function
(	O
cold	long
+	O
2	int
+	O
cadd	long
)	O
;	O
memcpy	function
(	O
znew	pointer
,	O
zXnames	pointer
,	O
cold	long
)	O
;	O
znew	pointer
[	O
cold	long
]	O
=	O
' '	O
;	O
memcpy	function
(	O
znew	pointer
+	O
cold	long
+	O
1	int
,	O
z	pointer
,	O
cadd	long
+	O
1	int
)	O
;	O
ubuffree	function
(	O
zXnames	pointer
)	O
;	O
zXnames	pointer
=	O
znew	pointer
;	O
}	O
}	O
