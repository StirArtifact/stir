const	O
char	O
cu_rcsid	array
[	O
]	O
=	O
"$Id: cu.c,v 1.47 2002/03/05 19:10:41 ian Rel $"	pointer
;	O
const	O
char	O
*	O
zCuvar_escape	pointer
=	O
"~"	pointer
;	O
boolean	int
fCuvar_delay	int
=	O
TRUE	O
;	O
const	O
char	O
*	O
zCuvar_eol	pointer
=	O
"\r\025\003\017\004\023\021\022"	pointer
;	O
boolean	int
fCuvar_binary	int
=	O
FALSE	O
;	O
const	O
char	O
*	O
zCuvar_binary_prefix	pointer
=	O
"\026"	pointer
;	O
boolean	int
fCuvar_echocheck	int
=	O
FALSE	O
;	O
const	O
char	O
*	O
zCuvar_echonl	pointer
=	O
"\r"	pointer
;	O
int	O
cCuvar_timeout	int
=	O
30	int
;	O
const	O
char	O
*	O
zCuvar_kill	pointer
=	O
"\025"	pointer
;	O
int	O
cCuvar_resend	int
=	O
10	int
;	O
const	O
char	O
*	O
zCuvar_eofwrite	pointer
=	O
"\004"	pointer
;	O
const	O
char	O
*	O
zCuvar_eofread	pointer
=	O
"$"	pointer
;	O
boolean	int
fCuvar_verbose	int
=	O
TRUE	O
;	O
static	O
const	O
struct	O
uuconf_cmdtab	struct
asCuvars	array
[	O
]	O
=	O
{	O
{	O
"escape"	pointer
,	O
UUCONF_CMDTABTYPE_STRING	O
,	O
(	O
pointer	pointer
)	O
&	O
zCuvar_escape	pointer
,	O
NULL	O
}	O
,	O
{	O
"delay"	pointer
,	O
UUCONF_CMDTABTYPE_BOOLEAN	O
,	O
(	O
pointer	pointer
)	O
&	O
fCuvar_delay	int
,	O
NULL	O
}	O
,	O
{	O
"eol"	pointer
,	O
UUCONF_CMDTABTYPE_STRING	O
,	O
(	O
pointer	pointer
)	O
&	O
zCuvar_eol	pointer
,	O
NULL	O
}	O
,	O
{	O
"binary"	pointer
,	O
UUCONF_CMDTABTYPE_BOOLEAN	O
,	O
(	O
pointer	pointer
)	O
&	O
fCuvar_binary	int
,	O
NULL	O
}	O
,	O
{	O
"binary-prefix"	pointer
,	O
UUCONF_CMDTABTYPE_STRING	O
,	O
(	O
pointer	pointer
)	O
&	O
zCuvar_binary_prefix	pointer
,	O
NULL	O
}	O
,	O
{	O
"echocheck"	pointer
,	O
UUCONF_CMDTABTYPE_BOOLEAN	O
,	O
(	O
pointer	pointer
)	O
&	O
fCuvar_echocheck	int
,	O
NULL	O
}	O
,	O
{	O
"echonl"	pointer
,	O
UUCONF_CMDTABTYPE_STRING	O
,	O
(	O
pointer	pointer
)	O
&	O
zCuvar_echonl	pointer
,	O
NULL	O
}	O
,	O
{	O
"timeout"	pointer
,	O
UUCONF_CMDTABTYPE_INT	O
,	O
(	O
pointer	pointer
)	O
&	O
cCuvar_timeout	int
,	O
NULL	O
}	O
,	O
{	O
"kill"	pointer
,	O
UUCONF_CMDTABTYPE_STRING	O
,	O
(	O
pointer	pointer
)	O
&	O
zCuvar_kill	pointer
,	O
NULL	O
}	O
,	O
{	O
"resend"	pointer
,	O
UUCONF_CMDTABTYPE_INT	O
,	O
(	O
pointer	pointer
)	O
&	O
cCuvar_resend	int
,	O
NULL	O
}	O
,	O
{	O
"eofwrite"	pointer
,	O
UUCONF_CMDTABTYPE_STRING	O
,	O
(	O
pointer	pointer
)	O
&	O
zCuvar_eofwrite	pointer
,	O
NULL	O
}	O
,	O
{	O
"eofread"	pointer
,	O
UUCONF_CMDTABTYPE_STRING	O
,	O
(	O
pointer	pointer
)	O
&	O
zCuvar_eofread	pointer
,	O
NULL	O
}	O
,	O
{	O
"verbose"	pointer
,	O
UUCONF_CMDTABTYPE_BOOLEAN	O
,	O
(	O
pointer	pointer
)	O
&	O
fCuvar_verbose	int
,	O
NULL	O
}	O
,	O
{	O
NULL	O
,	O
0	int
,	O
NULL	O
,	O
NULL	O
}	O
}	O
;	O
static	O
const	O
char	O
abCuconnected	array
[	O
]	O
=	O
"\a[connected]"	pointer
;	O
static	O
pointer	pointer
pCuuuconf	pointer
;	O
static	O
struct	O
sconnection	struct
*	O
qCuconn	pointer
;	O
static	O
boolean	int
fCuclose_conn	int
;	O
static	O
struct	O
uuconf_dialer	struct
*	O
qCudialer	pointer
;	O
static	O
boolean	int
fCurestore_terminal	int
;	O
static	O
boolean	int
fCulocalecho	int
;	O
static	O
boolean	int
fCustarted	int
;	O
static	O
boolean	int
fCuconnprinted	int
=	O
FALSE	O
;	O
struct	O
sconninfo	struct
{	O
boolean	int
fmatched	int
;	O
boolean	int
flocked	int
;	O
boolean	int
fdirect	int
;	O
struct	O
sconnection	struct
*	O
qconn	pointer
;	O
const	O
char	O
*	O
zline	pointer
;	O
}	O
;	O
static	O
void	O
ucuusage	function
P	O
(	O
(	O
void	O
)	O
)	O
;	O
static	O
void	O
ucuhelp	function
P	O
(	O
(	O
void	O
)	O
)	O
;	O
static	O
void	O
ucuabort	function
P	O
(	O
(	O
void	O
)	O
)	O
;	O
static	O
void	O
uculog_start	function
P	O
(	O
(	O
void	O
)	O
)	O
;	O
static	O
void	O
uculog_end	function
P	O
(	O
(	O
void	O
)	O
)	O
;	O
static	O
int	O
icuport_lock	function
P	O
(	O
(	O
struct	O
uuconf_port	struct
*	O
qport	pointer
,	O
pointer	pointer
pinfo	pointer
)	O
)	O
;	O
static	O
boolean	int
fcudo_cmd	function
P	O
(	O
(	O
pointer	pointer
puuconf	pointer
,	O
struct	O
sconnection	struct
*	O
qconn	pointer
,	O
int	O
bcmd	char
)	O
)	O
;	O
static	O
boolean	int
fcuset_var	function
P	O
(	O
(	O
pointer	pointer
puuconf	pointer
,	O
char	O
*	O
zline	pointer
)	O
)	O
;	O
static	O
int	O
icuunrecogvar	function
P	O
(	O
(	O
pointer	pointer
puuconf	pointer
,	O
int	O
argc	int
,	O
char	O
*	O
*	O
argv	pointer
,	O
pointer	pointer
pvar	pointer
,	O
pointer	pointer
pinfo	pointer
)	O
)	O
;	O
static	O
int	O
icuunrecogfn	function
P	O
(	O
(	O
pointer	pointer
puuconf	pointer
,	O
int	O
argc	int
,	O
char	O
*	O
*	O
argv	pointer
,	O
pointer	pointer
pvar	pointer
,	O
pointer	pointer
pinfo	pointer
)	O
)	O
;	O
static	O
void	O
uculist_vars	function
P	O
(	O
(	O
void	O
)	O
)	O
;	O
static	O
void	O
uculist_fns	function
P	O
(	O
(	O
const	O
char	O
*	O
zescape	pointer
)	O
)	O
;	O
static	O
boolean	int
fcudo_subcmd	function
P	O
(	O
(	O
pointer	pointer
puuconf	pointer
,	O
struct	O
sconnection	struct
*	O
qconn	pointer
,	O
char	O
*	O
zline	pointer
)	O
)	O
;	O
static	O
boolean	int
fcusend_buf	function
P	O
(	O
(	O
struct	O
sconnection	struct
*	O
qconn	pointer
,	O
const	O
char	O
*	O
zbuf	pointer
,	O
size_t	long
cbuf	long
)	O
)	O
;	O
static	O
const	O
struct	O
option	struct
asCulongopts	array
[	O
]	O
=	O
{	O
{	O
"phone"	pointer
,	O
required_argument	int
,	O
NULL	O
,	O
'c'	O
}	O
,	O
{	O
"escape"	pointer
,	O
required_argument	int
,	O
NULL	O
,	O
'E'	O
}	O
,	O
{	O
"parity"	pointer
,	O
required_argument	int
,	O
NULL	O
,	O
2	int
}	O
,	O
{	O
"halfduplex"	pointer
,	O
no_argument	int
,	O
NULL	O
,	O
'h'	O
}	O
,	O
{	O
"prompt"	pointer
,	O
no_argument	int
,	O
NULL	O
,	O
'n'	O
}	O
,	O
{	O
"line"	pointer
,	O
required_argument	int
,	O
NULL	O
,	O
'l'	O
}	O
,	O
{	O
"port"	pointer
,	O
required_argument	int
,	O
NULL	O
,	O
'p'	O
}	O
,	O
{	O
"speed"	pointer
,	O
required_argument	int
,	O
NULL	O
,	O
's'	O
}	O
,	O
{	O
"baud"	pointer
,	O
required_argument	int
,	O
NULL	O
,	O
's'	O
}	O
,	O
{	O
"mapcr"	pointer
,	O
no_argument	int
,	O
NULL	O
,	O
't'	O
}	O
,	O
{	O
"nostop"	pointer
,	O
no_argument	int
,	O
NULL	O
,	O
3	int
}	O
,	O
{	O
"system"	pointer
,	O
required_argument	int
,	O
NULL	O
,	O
'z'	O
}	O
,	O
{	O
"config"	pointer
,	O
required_argument	int
,	O
NULL	O
,	O
'I'	O
}	O
,	O
{	O
"debug"	pointer
,	O
required_argument	int
,	O
NULL	O
,	O
'x'	O
}	O
,	O
{	O
"version"	pointer
,	O
no_argument	int
,	O
NULL	O
,	O
'v'	O
}	O
,	O
{	O
"help"	pointer
,	O
no_argument	int
,	O
NULL	O
,	O
1	int
}	O
,	O
{	O
NULL	O
,	O
0	int
,	O
NULL	O
,	O
0	int
}	O
}	O
;	O
int	O
main	function
(	O
argc	int
,	O
argv	pointer
)	O
int	O
argc	int
;	O
char	O
*	O
*	O
argv	pointer
;	O
{	O
char	O
*	O
zphone	pointer
=	O
NULL	O
;	O
boolean	int
feven	int
=	O
FALSE	O
;	O
char	O
*	O
zline	pointer
=	O
NULL	O
;	O
boolean	int
fprompt	int
=	O
FALSE	O
;	O
boolean	int
fodd	int
=	O
FALSE	O
;	O
const	O
char	O
*	O
zport	pointer
=	O
NULL	O
;	O
long	O
ibaud	long
=	O
0L	int
;	O
boolean	int
fmapcr	int
=	O
FALSE	O
;	O
const	O
char	O
*	O
zsystem	pointer
=	O
NULL	O
;	O
enum	O
txonxoffsetting	enum
txonxoff	enum
=	O
XONXOFF_ON	int
;	O
const	O
char	O
*	O
zconfig	pointer
=	O
NULL	O
;	O
int	O
iopt	int
;	O
pointer	pointer
puuconf	pointer
;	O
int	O
iuuconf	int
;	O
const	O
char	O
*	O
zlocalname	pointer
;	O
int	O
i	int
;	O
struct	O
uuconf_system	struct
ssys	struct
;	O
const	O
struct	O
uuconf_system	struct
*	O
qsys	pointer
=	O
NULL	O
;	O
boolean	int
flooped	int
;	O
struct	O
uuconf_port	struct
sport	struct
;	O
struct	O
sconnection	struct
sconn	struct
;	O
struct	O
sconninfo	struct
sinfo	struct
;	O
long	O
ihighbaud	long
;	O
struct	O
uuconf_dialer	struct
sdialer	struct
;	O
struct	O
uuconf_dialer	struct
*	O
qdialer	pointer
;	O
char	O
bcmd	char
;	O
zProgram	pointer
=	O
argv	pointer
[	O
0	int
]	O
;	O
for	O
(	O
i	int
=	O
1	int
;	O
i	int
<	O
argc	int
;	O
i	int
++	O
)	O
{	O
if	O
(	O
argv	pointer
[	O
i	int
]	O
[	O
0	int
]	O
==	O
'-'	O
&&	O
isdigit	function
(	O
BUCHAR	O
(	O
argv	pointer
[	O
i	int
]	O
[	O
1	int
]	O
)	O
)	O
)	O
{	O
size_t	long
clen	long
;	O
char	O
*	O
z	pointer
;	O
clen	long
=	O
strlen	function
(	O
argv	pointer
[	O
i	int
]	O
)	O
;	O
z	pointer
=	O
zbufalc	function
(	O
clen	long
+	O
2	int
)	O
;	O
z	pointer
[	O
0	int
]	O
=	O
'-'	O
;	O
z	pointer
[	O
1	int
]	O
=	O
's'	O
;	O
memcpy	function
(	O
z	pointer
+	O
2	int
,	O
argv	pointer
[	O
i	int
]	O
+	O
1	int
,	O
clen	long
)	O
;	O
argv	pointer
[	O
i	int
]	O
=	O
z	pointer
;	O
}	O
}	O
while	O
(	O
(	O
iopt	int
=	O
getopt_long	function
(	O
argc	int
,	O
argv	pointer
,	O
"a:c:deE:hnI:l:op:s:tvx:z:"	pointer
,	O
asCulongopts	array
,	O
(	O
int	O
*	O
)	O
NULL	O
)	O
)	O
!=	O
EOF	O
)	O
{	O
switch	O
(	O
iopt	int
)	O
{	O
case	O
'c'	O
:	O
zphone	pointer
=	O
optarg	pointer
;	O
break	O
;	O
case	O
'd'	O
:	O
iDebug	int
=	O
DEBUG_MAX	O
;	O
break	O
;	O
case	O
'e'	O
:	O
feven	int
=	O
TRUE	O
;	O
break	O
;	O
case	O
'E'	O
:	O
zCuvar_escape	pointer
=	O
optarg	pointer
;	O
break	O
;	O
case	O
'h'	O
:	O
fCulocalecho	int
=	O
TRUE	O
;	O
break	O
;	O
case	O
'n'	O
:	O
fprompt	int
=	O
TRUE	O
;	O
break	O
;	O
case	O
'l'	O
:	O
zline	pointer
=	O
optarg	pointer
;	O
break	O
;	O
case	O
'o'	O
:	O
fodd	int
=	O
TRUE	O
;	O
break	O
;	O
case	O
'p'	O
:	O
case	O
'a'	O
:	O
zport	pointer
=	O
optarg	pointer
;	O
break	O
;	O
case	O
's'	O
:	O
ibaud	long
=	O
strtol	function
(	O
optarg	pointer
,	O
(	O
char	O
*	O
*	O
)	O
NULL	O
,	O
10	int
)	O
;	O
break	O
;	O
case	O
't'	O
:	O
fmapcr	int
=	O
TRUE	O
;	O
break	O
;	O
case	O
'z'	O
:	O
zsystem	pointer
=	O
optarg	pointer
;	O
break	O
;	O
case	O
'I'	O
:	O
if	O
(	O
fsysdep_other_config	function
(	O
optarg	pointer
)	O
)	O
zconfig	pointer
=	O
optarg	pointer
;	O
break	O
;	O
case	O
'x'	O
:	O
iDebug	int
|=	O
idebug_parse	function
(	O
optarg	pointer
)	O
;	O
break	O
;	O
case	O
'v'	O
:	O
printf	function
(	O
"cu (Taylor UUCP) %s\n"	pointer
,	O
VERSION	pointer
)	O
;	O
printf	function
(	O
"Copyright (C) 1991, 92, 93, 94, 1995, 2002 Ian Lance Taylor\n"	pointer
)	O
;	O
printf	function
(	O
"This program is free software; you may redistribute it under the terms of\n"	pointer
)	O
;	O
printf	function
(	O
"the GNU General Public LIcense.  This program has ABSOLUTELY NO WARRANTY.\n"	pointer
)	O
;	O
exit	function
(	O
EXIT_SUCCESS	int
)	O
;	O
case	O
2	int
:	O
if	O
(	O
strncmp	function
(	O
optarg	pointer
,	O
"even"	pointer
,	O
strlen	function
(	O
optarg	pointer
)	O
)	O
==	O
0	int
)	O
feven	int
=	O
TRUE	O
;	O
else	O
if	O
(	O
strncmp	function
(	O
optarg	pointer
,	O
"odd"	pointer
,	O
strlen	function
(	O
optarg	pointer
)	O
)	O
==	O
0	int
)	O
fodd	int
=	O
TRUE	O
;	O
else	O
if	O
(	O
strncmp	function
(	O
optarg	pointer
,	O
"none"	pointer
,	O
strlen	function
(	O
optarg	pointer
)	O
)	O
==	O
0	int
)	O
{	O
feven	int
=	O
TRUE	O
;	O
fodd	int
=	O
TRUE	O
;	O
}	O
else	O
{	O
fprintf	function
(	O
stderr	pointer
,	O
"%s: --parity requires even, odd or none\n"	pointer
,	O
zProgram	pointer
)	O
;	O
ucuusage	function
(	O
)	O
;	O
}	O
break	O
;	O
case	O
3	int
:	O
txonxoff	enum
=	O
XONXOFF_OFF	int
;	O
break	O
;	O
case	O
1	int
:	O
ucuhelp	function
(	O
)	O
;	O
exit	function
(	O
EXIT_SUCCESS	int
)	O
;	O
case	O
0	int
:	O
break	O
;	O
default	O
:	O
ucuusage	function
(	O
)	O
;	O
}	O
}	O
if	O
(	O
optind	int
!=	O
argc	int
)	O
{	O
if	O
(	O
optind	int
!=	O
argc	int
-	O
1	int
||	O
zsystem	pointer
!=	O
NULL	O
||	O
zphone	pointer
!=	O
NULL	O
)	O
{	O
fprintf	function
(	O
stderr	pointer
,	O
"%s: too many arguments\n"	pointer
,	O
zProgram	pointer
)	O
;	O
ucuusage	function
(	O
)	O
;	O
}	O
if	O
(	O
strcmp	function
(	O
argv	pointer
[	O
optind	int
]	O
,	O
"dir"	pointer
)	O
!=	O
0	int
)	O
{	O
if	O
(	O
isdigit	function
(	O
BUCHAR	O
(	O
argv	pointer
[	O
optind	int
]	O
[	O
0	int
]	O
)	O
)	O
)	O
zphone	pointer
=	O
argv	pointer
[	O
optind	int
]	O
;	O
else	O
zsystem	pointer
=	O
argv	pointer
[	O
optind	int
]	O
;	O
}	O
}	O
if	O
(	O
zsystem	pointer
==	O
NULL	O
&&	O
zport	pointer
==	O
NULL	O
&&	O
zline	pointer
==	O
NULL	O
&&	O
ibaud	long
==	O
0L	int
)	O
{	O
fprintf	function
(	O
stderr	pointer
,	O
"%s: must specify system, line, port or speed\n"	pointer
,	O
zProgram	pointer
)	O
;	O
ucuusage	function
(	O
)	O
;	O
}	O
if	O
(	O
fprompt	int
)	O
{	O
size_t	long
cphone	long
;	O
printf	function
(	O
"Phone number: "	pointer
)	O
;	O
(	O
void	O
)	O
fflush	function
(	O
stdout	pointer
)	O
;	O
zphone	pointer
=	O
NULL	O
;	O
cphone	long
=	O
0	int
;	O
if	O
(	O
getline	function
(	O
&	O
zphone	pointer
,	O
&	O
cphone	long
,	O
stdin	pointer
)	O
<=	O
0	int
||	O
*	O
zphone	pointer
==	O
'\0'	O
)	O
{	O
fprintf	function
(	O
stderr	pointer
,	O
"%s: no phone number entered\n"	pointer
,	O
zProgram	pointer
)	O
;	O
exit	function
(	O
EXIT_FAILURE	int
)	O
;	O
}	O
}	O
iuuconf	int
=	O
uuconf_init	function
(	O
&	O
puuconf	pointer
,	O
"cu"	pointer
,	O
zconfig	pointer
)	O
;	O
if	O
(	O
iuuconf	int
!=	O
UUCONF_SUCCESS	O
)	O
ulog_uuconf	function
(	O
LOG_FATAL	int
,	O
puuconf	pointer
,	O
iuuconf	int
)	O
;	O
pCuuuconf	pointer
=	O
puuconf	pointer
;	O
{	O
const	O
char	O
*	O
zdebug	pointer
;	O
iuuconf	int
=	O
uuconf_debuglevel	function
(	O
puuconf	pointer
,	O
&	O
zdebug	pointer
)	O
;	O
if	O
(	O
iuuconf	int
!=	O
UUCONF_SUCCESS	O
)	O
ulog_uuconf	function
(	O
LOG_FATAL	int
,	O
puuconf	pointer
,	O
iuuconf	int
)	O
;	O
if	O
(	O
zdebug	pointer
!=	O
NULL	O
)	O
iDebug	int
|=	O
idebug_parse	function
(	O
zdebug	pointer
)	O
;	O
}	O
usysdep_initialize	function
(	O
puuconf	pointer
,	O
INIT_NOCHDIR	O
|	O
INIT_SUID	O
)	O
;	O
iuuconf	int
=	O
uuconf_localname	function
(	O
puuconf	pointer
,	O
&	O
zlocalname	pointer
)	O
;	O
if	O
(	O
iuuconf	int
==	O
UUCONF_NOT_FOUND	O
)	O
{	O
zlocalname	pointer
=	O
zsysdep_localname	function
(	O
)	O
;	O
if	O
(	O
zlocalname	pointer
==	O
NULL	O
)	O
exit	function
(	O
EXIT_FAILURE	int
)	O
;	O
}	O
else	O
if	O
(	O
iuuconf	int
!=	O
UUCONF_SUCCESS	O
)	O
ulog_uuconf	function
(	O
LOG_FATAL	int
,	O
puuconf	pointer
,	O
iuuconf	int
)	O
;	O
ulog_fatal_fn	function
(	O
ucuabort	function
)	O
;	O
pfLstart	pointer
=	O
uculog_start	function
;	O
pfLend	pointer
=	O
uculog_end	function
;	O
usysdep_signal	function
(	O
SIGINT	int
)	O
;	O
usysdep_signal	function
(	O
SIGHUP	int
)	O
;	O
usysdep_signal	function
(	O
SIGQUIT	int
)	O
;	O
usysdep_signal	function
(	O
SIGTERM	int
)	O
;	O
usysdep_signal	function
(	O
SIGPIPE	int
)	O
;	O
if	O
(	O
zsystem	pointer
!=	O
NULL	O
)	O
{	O
iuuconf	int
=	O
uuconf_system_info	function
(	O
puuconf	pointer
,	O
zsystem	pointer
,	O
&	O
ssys	struct
)	O
;	O
if	O
(	O
iuuconf	int
!=	O
UUCONF_SUCCESS	O
)	O
{	O
if	O
(	O
iuuconf	int
!=	O
UUCONF_NOT_FOUND	O
)	O
ulog_uuconf	function
(	O
LOG_FATAL	int
,	O
puuconf	pointer
,	O
iuuconf	int
)	O
;	O
ulog	function
(	O
LOG_FATAL	int
,	O
"%s: System not found"	pointer
,	O
zsystem	pointer
)	O
;	O
}	O
qsys	pointer
=	O
&	O
ssys	struct
;	O
}	O
flooped	int
=	O
FALSE	O
;	O
while	O
(	O
TRUE	O
)	O
{	O
enum	O
tparitysetting	enum
tparity	enum
;	O
enum	O
tstripsetting	enum
tstrip	enum
;	O
long	O
iusebaud	long
;	O
sinfo	struct
.	O
fmatched	int
=	O
FALSE	O
;	O
sinfo	struct
.	O
flocked	int
=	O
FALSE	O
;	O
sinfo	struct
.	O
fdirect	int
=	O
qsys	pointer
==	O
NULL	O
&&	O
zphone	pointer
==	O
NULL	O
;	O
sinfo	struct
.	O
qconn	pointer
=	O
&	O
sconn	struct
;	O
sinfo	struct
.	O
zline	pointer
=	O
zline	pointer
;	O
if	O
(	O
zport	pointer
!=	O
NULL	O
||	O
zline	pointer
!=	O
NULL	O
||	O
ibaud	long
!=	O
0L	int
)	O
{	O
iuuconf	int
=	O
uuconf_find_port	function
(	O
puuconf	pointer
,	O
zport	pointer
,	O
ibaud	long
,	O
0L	int
,	O
icuport_lock	function
,	O
(	O
pointer	pointer
)	O
&	O
sinfo	struct
,	O
&	O
sport	struct
)	O
;	O
if	O
(	O
iuuconf	int
!=	O
UUCONF_SUCCESS	O
)	O
{	O
if	O
(	O
iuuconf	int
!=	O
UUCONF_NOT_FOUND	O
)	O
{	O
if	O
(	O
sinfo	struct
.	O
flocked	int
)	O
{	O
(	O
void	O
)	O
fconn_unlock	function
(	O
&	O
sconn	struct
)	O
;	O
uconn_free	function
(	O
&	O
sconn	struct
)	O
;	O
}	O
ulog_uuconf	function
(	O
LOG_FATAL	int
,	O
puuconf	pointer
,	O
iuuconf	int
)	O
;	O
}	O
if	O
(	O
zline	pointer
==	O
NULL	O
||	O
zport	pointer
!=	O
NULL	O
||	O
zphone	pointer
!=	O
NULL	O
||	O
qsys	pointer
!=	O
NULL	O
)	O
{	O
if	O
(	O
sinfo	struct
.	O
fmatched	int
)	O
ulog	function
(	O
LOG_FATAL	int
,	O
"All matching ports in use"	pointer
)	O
;	O
else	O
ulog	function
(	O
LOG_FATAL	int
,	O
"No matching ports"	pointer
)	O
;	O
}	O
sport	struct
.	O
uuconf_zname	pointer
=	O
zline	pointer
;	O
sport	struct
.	O
uuconf_ttype	enum
=	O
UUCONF_PORTTYPE_DIRECT	int
;	O
sport	struct
.	O
uuconf_zprotocols	pointer
=	O
NULL	O
;	O
sport	struct
.	O
uuconf_qproto_params	pointer
=	O
NULL	O
;	O
sport	struct
.	O
uuconf_ireliable	int
=	O
0	int
;	O
sport	struct
.	O
uuconf_zlockname	pointer
=	O
NULL	O
;	O
sport	struct
.	O
uuconf_palloc	pointer
=	O
NULL	O
;	O
sport	struct
.	O
uuconf_u	union
.	O
uuconf_sdirect	struct
.	O
uuconf_zdevice	pointer
=	O
NULL	O
;	O
sport	struct
.	O
uuconf_u	union
.	O
uuconf_sdirect	struct
.	O
uuconf_ibaud	long
=	O
ibaud	long
;	O
if	O
(	O
!	O
fconn_init	function
(	O
&	O
sport	struct
,	O
&	O
sconn	struct
,	O
UUCONF_PORTTYPE_UNKNOWN	int
)	O
)	O
ucuabort	function
(	O
)	O
;	O
if	O
(	O
!	O
fconn_lock	function
(	O
&	O
sconn	struct
,	O
FALSE	O
,	O
TRUE	O
)	O
)	O
ulog	function
(	O
LOG_FATAL	int
,	O
"%s: Line in use"	pointer
,	O
zline	pointer
)	O
;	O
qCuconn	pointer
=	O
&	O
sconn	struct
;	O
if	O
(	O
!	O
fsysdep_port_access	function
(	O
&	O
sport	struct
)	O
)	O
ulog	function
(	O
LOG_FATAL	int
,	O
"%s: Permission denied"	pointer
,	O
zline	pointer
)	O
;	O
}	O
iusebaud	long
=	O
ibaud	long
;	O
ihighbaud	long
=	O
0L	int
;	O
}	O
else	O
{	O
for	O
(	O
;	O
qsys	pointer
!=	O
NULL	O
;	O
qsys	pointer
=	O
qsys	pointer
->	O
uuconf_qalternate	pointer
)	O
{	O
if	O
(	O
!	O
qsys	pointer
->	O
uuconf_fcall	int
)	O
continue	O
;	O
if	O
(	O
qsys	pointer
->	O
uuconf_qport	pointer
!=	O
NULL	O
)	O
{	O
if	O
(	O
fconn_init	function
(	O
qsys	pointer
->	O
uuconf_qport	pointer
,	O
&	O
sconn	struct
,	O
UUCONF_PORTTYPE_UNKNOWN	int
)	O
)	O
{	O
if	O
(	O
fconn_lock	function
(	O
&	O
sconn	struct
,	O
FALSE	O
,	O
FALSE	O
)	O
)	O
{	O
qCuconn	pointer
=	O
&	O
sconn	struct
;	O
break	O
;	O
}	O
uconn_free	function
(	O
&	O
sconn	struct
)	O
;	O
}	O
}	O
else	O
{	O
sinfo	struct
.	O
fmatched	int
=	O
FALSE	O
;	O
sinfo	struct
.	O
flocked	int
=	O
FALSE	O
;	O
sinfo	struct
.	O
qconn	pointer
=	O
&	O
sconn	struct
;	O
iuuconf	int
=	O
uuconf_find_port	function
(	O
puuconf	pointer
,	O
qsys	pointer
->	O
uuconf_zport	pointer
,	O
qsys	pointer
->	O
uuconf_ibaud	long
,	O
qsys	pointer
->	O
uuconf_ihighbaud	long
,	O
icuport_lock	function
,	O
(	O
pointer	pointer
)	O
&	O
sinfo	struct
,	O
&	O
sport	struct
)	O
;	O
if	O
(	O
iuuconf	int
==	O
UUCONF_SUCCESS	O
)	O
break	O
;	O
if	O
(	O
iuuconf	int
!=	O
UUCONF_NOT_FOUND	O
)	O
{	O
if	O
(	O
sinfo	struct
.	O
flocked	int
)	O
{	O
(	O
void	O
)	O
fconn_unlock	function
(	O
&	O
sconn	struct
)	O
;	O
uconn_free	function
(	O
&	O
sconn	struct
)	O
;	O
}	O
ulog_uuconf	function
(	O
LOG_FATAL	int
,	O
puuconf	pointer
,	O
iuuconf	int
)	O
;	O
}	O
}	O
}	O
if	O
(	O
qsys	pointer
==	O
NULL	O
)	O
{	O
const	O
char	O
*	O
zrem	pointer
;	O
if	O
(	O
flooped	int
)	O
zrem	pointer
=	O
"remaining "	pointer
;	O
else	O
zrem	pointer
=	O
""	pointer
;	O
if	O
(	O
sinfo	struct
.	O
fmatched	int
)	O
ulog	function
(	O
LOG_FATAL	int
,	O
"%s: All %smatching ports in use"	pointer
,	O
zsystem	pointer
,	O
zrem	pointer
)	O
;	O
else	O
ulog	function
(	O
LOG_FATAL	int
,	O
"%s: No %smatching ports"	pointer
,	O
zsystem	pointer
,	O
zrem	pointer
)	O
;	O
}	O
iusebaud	long
=	O
qsys	pointer
->	O
uuconf_ibaud	long
;	O
ihighbaud	long
=	O
qsys	pointer
->	O
uuconf_ihighbaud	long
;	O
}	O
if	O
(	O
!	O
fconn_open	function
(	O
&	O
sconn	struct
,	O
iusebaud	long
,	O
ihighbaud	long
,	O
FALSE	O
,	O
sinfo	struct
.	O
fdirect	int
)	O
)	O
ucuabort	function
(	O
)	O
;	O
fCuclose_conn	int
=	O
TRUE	O
;	O
if	O
(	O
FGOT_SIGNAL	O
(	O
)	O
)	O
ucuabort	function
(	O
)	O
;	O
if	O
(	O
fodd	int
&&	O
feven	int
)	O
{	O
tparity	enum
=	O
PARITYSETTING_NONE	int
;	O
tstrip	enum
=	O
STRIPSETTING_SEVENBITS	int
;	O
}	O
else	O
if	O
(	O
fodd	int
)	O
{	O
tparity	enum
=	O
PARITYSETTING_ODD	int
;	O
tstrip	enum
=	O
STRIPSETTING_SEVENBITS	int
;	O
}	O
else	O
if	O
(	O
feven	int
)	O
{	O
tparity	enum
=	O
PARITYSETTING_EVEN	int
;	O
tstrip	enum
=	O
STRIPSETTING_SEVENBITS	int
;	O
}	O
else	O
{	O
tparity	enum
=	O
PARITYSETTING_DEFAULT	int
;	O
tstrip	enum
=	O
STRIPSETTING_DEFAULT	int
;	O
}	O
if	O
(	O
!	O
fconn_set	function
(	O
&	O
sconn	struct
,	O
tparity	enum
,	O
tstrip	enum
,	O
txonxoff	enum
)	O
)	O
ucuabort	function
(	O
)	O
;	O
if	O
(	O
qsys	pointer
!=	O
NULL	O
)	O
zphone	pointer
=	O
qsys	pointer
->	O
uuconf_zphone	pointer
;	O
if	O
(	O
qsys	pointer
!=	O
NULL	O
||	O
zphone	pointer
!=	O
NULL	O
)	O
{	O
enum	O
tdialerfound	enum
tdialer	enum
;	O
if	O
(	O
!	O
fconn_dial	function
(	O
&	O
sconn	struct
,	O
puuconf	pointer
,	O
qsys	pointer
,	O
zphone	pointer
,	O
&	O
sdialer	struct
,	O
&	O
tdialer	enum
)	O
)	O
{	O
if	O
(	O
zport	pointer
!=	O
NULL	O
||	O
zline	pointer
!=	O
NULL	O
||	O
ibaud	long
!=	O
0L	int
||	O
qsys	pointer
==	O
NULL	O
)	O
ucuabort	function
(	O
)	O
;	O
qsys	pointer
=	O
qsys	pointer
->	O
uuconf_qalternate	pointer
;	O
if	O
(	O
qsys	pointer
==	O
NULL	O
)	O
ulog	function
(	O
LOG_FATAL	int
,	O
"%s: No remaining alternates"	pointer
,	O
zsystem	pointer
)	O
;	O
fCuclose_conn	int
=	O
FALSE	O
;	O
(	O
void	O
)	O
fconn_close	function
(	O
&	O
sconn	struct
,	O
pCuuuconf	pointer
,	O
qCudialer	pointer
,	O
FALSE	O
)	O
;	O
qCuconn	pointer
=	O
NULL	O
;	O
(	O
void	O
)	O
fconn_unlock	function
(	O
&	O
sconn	struct
)	O
;	O
uconn_free	function
(	O
&	O
sconn	struct
)	O
;	O
flooped	int
=	O
TRUE	O
;	O
continue	O
;	O
}	O
if	O
(	O
tdialer	enum
==	O
DIALERFOUND_FALSE	int
)	O
qdialer	pointer
=	O
NULL	O
;	O
else	O
qdialer	pointer
=	O
&	O
sdialer	struct
;	O
}	O
else	O
{	O
if	O
(	O
!	O
fsysdep_port_access	function
(	O
sconn	struct
.	O
qport	pointer
)	O
)	O
ulog	function
(	O
LOG_FATAL	int
,	O
"Access to port denied"	pointer
)	O
;	O
qdialer	pointer
=	O
NULL	O
;	O
if	O
(	O
!	O
fconn_carrier	function
(	O
&	O
sconn	struct
,	O
FALSE	O
)	O
)	O
ulog	function
(	O
LOG_FATAL	int
,	O
"Can't turn off carrier"	pointer
)	O
;	O
}	O
break	O
;	O
}	O
qCudialer	pointer
=	O
qdialer	pointer
;	O
if	O
(	O
FGOT_SIGNAL	O
(	O
)	O
)	O
ucuabort	function
(	O
)	O
;	O
printf	function
(	O
"%s\n"	pointer
,	O
ZCONNMSG	pointer
)	O
;	O
fCuconnprinted	int
=	O
TRUE	O
;	O
if	O
(	O
!	O
fsysdep_terminal_raw	function
(	O
fCulocalecho	int
)	O
)	O
ucuabort	function
(	O
)	O
;	O
fCurestore_terminal	int
=	O
TRUE	O
;	O
if	O
(	O
!	O
fsysdep_cu_init	function
(	O
&	O
sconn	struct
)	O
)	O
ucuabort	function
(	O
)	O
;	O
fCustarted	int
=	O
TRUE	O
;	O
while	O
(	O
fsysdep_cu	function
(	O
&	O
sconn	struct
,	O
&	O
bcmd	char
,	O
zlocalname	pointer
)	O
)	O
if	O
(	O
!	O
fcudo_cmd	function
(	O
puuconf	pointer
,	O
&	O
sconn	struct
,	O
bcmd	char
)	O
)	O
break	O
;	O
fCustarted	int
=	O
FALSE	O
;	O
if	O
(	O
!	O
fsysdep_cu_finish	function
(	O
)	O
)	O
ucuabort	function
(	O
)	O
;	O
fCurestore_terminal	int
=	O
FALSE	O
;	O
(	O
void	O
)	O
fsysdep_terminal_restore	function
(	O
)	O
;	O
(	O
void	O
)	O
fconn_close	function
(	O
&	O
sconn	struct
,	O
puuconf	pointer
,	O
qdialer	pointer
,	O
TRUE	O
)	O
;	O
(	O
void	O
)	O
fconn_unlock	function
(	O
&	O
sconn	struct
)	O
;	O
uconn_free	function
(	O
&	O
sconn	struct
)	O
;	O
if	O
(	O
fCuconnprinted	int
)	O
printf	function
(	O
"\n%s\n"	pointer
,	O
ZDISMSG	pointer
)	O
;	O
ulog_close	function
(	O
)	O
;	O
usysdep_exit	function
(	O
TRUE	O
)	O
;	O
return	O
0	int
;	O
}	O
static	O
void	O
ucuusage	function
(	O
)	O
{	O
fprintf	function
(	O
stderr	pointer
,	O
"Usage: %s [options] [system or phone-number]\n"	pointer
,	O
zProgram	pointer
)	O
;	O
fprintf	function
(	O
stderr	pointer
,	O
"Use %s --help for help\n"	pointer
,	O
zProgram	pointer
)	O
;	O
exit	function
(	O
EXIT_FAILURE	int
)	O
;	O
}	O
static	O
void	O
ucuhelp	function
(	O
)	O
{	O
printf	function
(	O
"Taylor UUCP %s, copyright (C) 1991, 92, 93, 94, 1995, 2002 Ian Lance Taylor\n"	pointer
,	O
VERSION	pointer
)	O
;	O
printf	function
(	O
"Usage: %s [options] [system or phone-number]\n"	pointer
,	O
zProgram	pointer
)	O
;	O
printf	function
(	O
" -a,-p,--port port: Use named port\n"	pointer
)	O
;	O
printf	function
(	O
" -l,--line line: Use named device (e.g. tty0)\n"	pointer
)	O
;	O
printf	function
(	O
" -s,--speed,--baud speed, -#: Use given speed\n"	pointer
)	O
;	O
printf	function
(	O
" -c,--phone phone: Phone number to call\n"	pointer
)	O
;	O
printf	function
(	O
" -z,--system system: System to call\n"	pointer
)	O
;	O
printf	function
(	O
" -e: Set even parity\n"	pointer
)	O
;	O
printf	function
(	O
" -o: Set odd parity\n"	pointer
)	O
;	O
printf	function
(	O
" --parity={odd,even}: Set parity\n"	pointer
)	O
;	O
printf	function
(	O
" -E,--escape char: Set escape character\n"	pointer
)	O
;	O
printf	function
(	O
" -h,--halfduplex: Echo locally\n"	pointer
)	O
;	O
printf	function
(	O
" --nostop: Turn off XON/XOFF handling\n"	pointer
)	O
;	O
printf	function
(	O
" -t,--mapcr: Map carriage return to carriage return/linefeed\n"	pointer
)	O
;	O
printf	function
(	O
" -n,--prompt: Prompt for phone number\n"	pointer
)	O
;	O
printf	function
(	O
" -d: Set maximum debugging level\n"	pointer
)	O
;	O
printf	function
(	O
" -x,--debug debug: Set debugging type\n"	pointer
)	O
;	O
printf	function
(	O
" -I,--config file: Set configuration file to use\n"	pointer
)	O
;	O
printf	function
(	O
" -v,--version: Print version and exit\n"	pointer
)	O
;	O
printf	function
(	O
" --help: Print help and exit\n"	pointer
)	O
;	O
printf	function
(	O
"Report bugs to taylor-uucp@gnu.org\n"	pointer
)	O
;	O
}	O
static	O
void	O
ucuabort	function
(	O
)	O
{	O
if	O
(	O
fCustarted	int
)	O
{	O
fCustarted	int
=	O
FALSE	O
;	O
(	O
void	O
)	O
fsysdep_cu_finish	function
(	O
)	O
;	O
}	O
if	O
(	O
fCurestore_terminal	int
)	O
{	O
fCurestore_terminal	int
=	O
FALSE	O
;	O
(	O
void	O
)	O
fsysdep_terminal_restore	function
(	O
)	O
;	O
}	O
if	O
(	O
qCuconn	pointer
!=	O
NULL	O
)	O
{	O
struct	O
sconnection	struct
*	O
qconn	pointer
;	O
if	O
(	O
fCuclose_conn	int
)	O
{	O
fCuclose_conn	int
=	O
FALSE	O
;	O
(	O
void	O
)	O
fconn_close	function
(	O
qCuconn	pointer
,	O
pCuuuconf	pointer
,	O
qCudialer	pointer
,	O
FALSE	O
)	O
;	O
}	O
qconn	pointer
=	O
qCuconn	pointer
;	O
qCuconn	pointer
=	O
NULL	O
;	O
(	O
void	O
)	O
fconn_unlock	function
(	O
qconn	pointer
)	O
;	O
uconn_free	function
(	O
qconn	pointer
)	O
;	O
}	O
ulog_close	function
(	O
)	O
;	O
if	O
(	O
fCuconnprinted	int
)	O
printf	function
(	O
"\n%s\n"	pointer
,	O
ZDISMSG	pointer
)	O
;	O
usysdep_exit	function
(	O
FALSE	O
)	O
;	O
}	O
static	O
boolean	int
fCulog_restore	int
;	O
static	O
void	O
uculog_start	function
(	O
)	O
{	O
if	O
(	O
!	O
fCurestore_terminal	int
)	O
fCulog_restore	int
=	O
FALSE	O
;	O
else	O
{	O
fCulog_restore	int
=	O
TRUE	O
;	O
fCurestore_terminal	int
=	O
FALSE	O
;	O
if	O
(	O
!	O
fsysdep_terminal_restore	function
(	O
)	O
)	O
ucuabort	function
(	O
)	O
;	O
}	O
}	O
static	O
void	O
uculog_end	function
(	O
)	O
{	O
if	O
(	O
fCulog_restore	int
)	O
{	O
if	O
(	O
!	O
fsysdep_terminal_raw	function
(	O
fCulocalecho	int
)	O
)	O
ucuabort	function
(	O
)	O
;	O
fCurestore_terminal	int
=	O
TRUE	O
;	O
}	O
}	O
static	O
int	O
icuport_lock	function
(	O
qport	pointer
,	O
pinfo	pointer
)	O
struct	O
uuconf_port	struct
*	O
qport	pointer
;	O
pointer	pointer
pinfo	pointer
;	O
{	O
struct	O
sconninfo	struct
*	O
q	pointer
=	O
(	O
struct	O
sconninfo	struct
*	O
)	O
pinfo	pointer
;	O
if	O
(	O
q	pointer
->	O
zline	pointer
!=	O
NULL	O
&&	O
!	O
fsysdep_port_is_line	function
(	O
qport	pointer
,	O
q	pointer
->	O
zline	pointer
)	O
)	O
return	O
UUCONF_NOT_FOUND	O
;	O
q	pointer
->	O
fmatched	int
=	O
TRUE	O
;	O
if	O
(	O
!	O
fconn_init	function
(	O
qport	pointer
,	O
q	pointer
->	O
qconn	pointer
,	O
UUCONF_PORTTYPE_UNKNOWN	int
)	O
)	O
return	O
UUCONF_NOT_FOUND	O
;	O
else	O
if	O
(	O
!	O
fconn_lock	function
(	O
q	pointer
->	O
qconn	pointer
,	O
FALSE	O
,	O
q	pointer
->	O
fdirect	int
)	O
)	O
{	O
uconn_free	function
(	O
q	pointer
->	O
qconn	pointer
)	O
;	O
return	O
UUCONF_NOT_FOUND	O
;	O
}	O
else	O
{	O
qCuconn	pointer
=	O
q	pointer
->	O
qconn	pointer
;	O
q	pointer
->	O
flocked	int
=	O
TRUE	O
;	O
return	O
UUCONF_SUCCESS	O
;	O
}	O
}	O
static	O
boolean	int
fcudo_cmd	function
(	O
puuconf	pointer
,	O
qconn	pointer
,	O
bcmd	char
)	O
pointer	pointer
puuconf	pointer
;	O
struct	O
sconnection	struct
*	O
qconn	pointer
;	O
int	O
bcmd	char
;	O
{	O
char	O
*	O
zline	pointer
;	O
char	O
*	O
z	pointer
;	O
char	O
abescape	array
[	O
5	int
]	O
;	O
boolean	int
fret	int
;	O
size_t	long
clen	long
;	O
char	O
abbuf	array
[	O
100	int
]	O
;	O
switch	O
(	O
bcmd	char
)	O
{	O
default	O
:	O
zline	pointer
=	O
NULL	O
;	O
break	O
;	O
case	O
'!'	O
:	O
case	O
'$'	O
:	O
case	O
'|'	O
:	O
case	O
'+'	O
:	O
case	O
'%'	O
:	O
case	O
'c'	O
:	O
case	O
'>'	O
:	O
case	O
'<'	O
:	O
case	O
'p'	O
:	O
case	O
't'	O
:	O
case	O
's'	O
:	O
{	O
zline	pointer
=	O
zsysdep_terminal_line	function
(	O
(	O
const	O
char	O
*	O
)	O
NULL	O
)	O
;	O
if	O
(	O
zline	pointer
==	O
NULL	O
)	O
ucuabort	function
(	O
)	O
;	O
zline	pointer
[	O
strcspn	function
(	O
zline	pointer
,	O
"\n"	pointer
)	O
]	O
=	O
'\0'	O
;	O
}	O
break	O
;	O
}	O
switch	O
(	O
bcmd	char
)	O
{	O
default	O
:	O
if	O
(	O
!	O
isprint	function
(	O
*	O
zCuvar_escape	pointer
)	O
)	O
sprintf	function
(	O
abescape	array
,	O
"\\%03o"	pointer
,	O
BUCHAR	O
(	O
*	O
zCuvar_escape	pointer
)	O
)	O
;	O
else	O
{	O
abescape	array
[	O
0	int
]	O
=	O
*	O
zCuvar_escape	pointer
;	O
abescape	array
[	O
1	int
]	O
=	O
'\0'	O
;	O
}	O
sprintf	function
(	O
abbuf	array
,	O
"[Unrecognized.  Use %s%s to send %s]"	pointer
,	O
abescape	array
,	O
abescape	array
,	O
abescape	array
)	O
;	O
ucuputs	O
(	O
abbuf	array
)	O
;	O
return	O
TRUE	O
;	O
case	O
'.'	O
:	O
return	O
FALSE	O
;	O
case	O
'!'	O
:	O
case	O
'$'	O
:	O
case	O
'|'	O
:	O
case	O
'+'	O
:	O
if	O
(	O
!	O
fsysdep_cu_copy	function
(	O
FALSE	O
)	O
||	O
!	O
fsysdep_terminal_restore	function
(	O
)	O
)	O
ucuabort	function
(	O
)	O
;	O
fCurestore_terminal	int
=	O
FALSE	O
;	O
{	O
enum	O
tshell_cmd	enum
t	enum
;	O
switch	O
(	O
bcmd	char
)	O
{	O
default	O
:	O
case	O
'!'	O
:	O
t	enum
=	O
SHELL_NORMAL	int
;	O
break	O
;	O
case	O
'$'	O
:	O
t	enum
=	O
SHELL_STDOUT_TO_PORT	int
;	O
break	O
;	O
case	O
'|'	O
:	O
t	enum
=	O
SHELL_STDIN_FROM_PORT	int
;	O
break	O
;	O
case	O
'+'	O
:	O
t	enum
=	O
SHELL_STDIO_ON_PORT	int
;	O
break	O
;	O
}	O
(	O
void	O
)	O
fsysdep_shell	function
(	O
qconn	pointer
,	O
zline	pointer
,	O
t	enum
)	O
;	O
}	O
if	O
(	O
!	O
fsysdep_cu_copy	function
(	O
TRUE	O
)	O
||	O
!	O
fsysdep_terminal_raw	function
(	O
fCulocalecho	int
)	O
)	O
ucuabort	function
(	O
)	O
;	O
fCurestore_terminal	int
=	O
TRUE	O
;	O
ubuffree	function
(	O
zline	pointer
)	O
;	O
return	O
TRUE	O
;	O
case	O
'%'	O
:	O
fret	int
=	O
fcudo_subcmd	function
(	O
puuconf	pointer
,	O
qconn	pointer
,	O
zline	pointer
)	O
;	O
ubuffree	function
(	O
zline	pointer
)	O
;	O
return	O
fret	int
;	O
case	O
'#'	O
:	O
if	O
(	O
!	O
fconn_break	function
(	O
qconn	pointer
)	O
)	O
ucuabort	function
(	O
)	O
;	O
return	O
TRUE	O
;	O
case	O
'c'	O
:	O
(	O
void	O
)	O
fsysdep_chdir	function
(	O
zline	pointer
)	O
;	O
ubuffree	function
(	O
zline	pointer
)	O
;	O
return	O
TRUE	O
;	O
case	O
'>'	O
:	O
case	O
'<'	O
:	O
case	O
'p'	O
:	O
case	O
't'	O
:	O
clen	long
=	O
strlen	function
(	O
zline	pointer
)	O
;	O
z	pointer
=	O
zbufalc	function
(	O
clen	long
+	O
3	int
)	O
;	O
z	pointer
[	O
0	int
]	O
=	O
bcmd	char
;	O
z	pointer
[	O
1	int
]	O
=	O
' '	O
;	O
memcpy	function
(	O
z	pointer
+	O
2	int
,	O
zline	pointer
,	O
clen	long
+	O
1	int
)	O
;	O
ubuffree	function
(	O
zline	pointer
)	O
;	O
fret	int
=	O
fcudo_subcmd	function
(	O
puuconf	pointer
,	O
qconn	pointer
,	O
z	pointer
)	O
;	O
ubuffree	function
(	O
z	pointer
)	O
;	O
return	O
fret	int
;	O
case	O
'z'	O
:	O
if	O
(	O
!	O
fsysdep_cu_copy	function
(	O
FALSE	O
)	O
||	O
!	O
fsysdep_terminal_restore	function
(	O
)	O
)	O
ucuabort	function
(	O
)	O
;	O
fCurestore_terminal	int
=	O
FALSE	O
;	O
if	O
(	O
!	O
fsysdep_suspend	function
(	O
)	O
)	O
ucuabort	function
(	O
)	O
;	O
if	O
(	O
!	O
fsysdep_cu_copy	function
(	O
TRUE	O
)	O
||	O
!	O
fsysdep_terminal_raw	function
(	O
fCulocalecho	int
)	O
)	O
ucuabort	function
(	O
)	O
;	O
fCurestore_terminal	int
=	O
TRUE	O
;	O
return	O
TRUE	O
;	O
case	O
's'	O
:	O
fret	int
=	O
fcuset_var	function
(	O
puuconf	pointer
,	O
zline	pointer
)	O
;	O
ubuffree	function
(	O
zline	pointer
)	O
;	O
return	O
fret	int
;	O
case	O
'v'	O
:	O
uculist_vars	function
(	O
)	O
;	O
return	O
TRUE	O
;	O
case	O
'?'	O
:	O
if	O
(	O
!	O
isprint	function
(	O
*	O
zCuvar_escape	pointer
)	O
)	O
sprintf	function
(	O
abescape	array
,	O
"\\%03o"	pointer
,	O
BUCHAR	O
(	O
*	O
zCuvar_escape	pointer
)	O
)	O
;	O
else	O
{	O
abescape	array
[	O
0	int
]	O
=	O
*	O
zCuvar_escape	pointer
;	O
abescape	array
[	O
1	int
]	O
=	O
'\0'	O
;	O
}	O
ucuputs	O
(	O
""	pointer
)	O
;	O
ucuputs	O
(	O
"[Escape sequences]"	pointer
)	O
;	O
sprintf	function
(	O
abbuf	array
,	O
"[%s. hangup]                   [%s!CMD run shell]"	pointer
,	O
abescape	array
,	O
abescape	array
)	O
;	O
ucuputs	O
(	O
abbuf	array
)	O
;	O
sprintf	function
(	O
abbuf	array
,	O
"[%s$CMD stdout to remote]      [%s|CMD stdin from remote]"	pointer
,	O
abescape	array
,	O
abescape	array
)	O
;	O
ucuputs	O
(	O
abbuf	array
)	O
;	O
sprintf	function
(	O
abbuf	array
,	O
"[%s+CMD stdin and stdout to remote]"	pointer
,	O
abescape	array
)	O
;	O
ucuputs	O
(	O
abbuf	array
)	O
;	O
sprintf	function
(	O
abbuf	array
,	O
"[%s# send break]               [%scDIR change directory]"	pointer
,	O
abescape	array
,	O
abescape	array
)	O
;	O
ucuputs	O
(	O
abbuf	array
)	O
;	O
sprintf	function
(	O
abbuf	array
,	O
"[%s> send file]                [%s< receive file]"	pointer
,	O
abescape	array
,	O
abescape	array
)	O
;	O
ucuputs	O
(	O
abbuf	array
)	O
;	O
sprintf	function
(	O
abbuf	array
,	O
"[%spFROM TO send to Unix]      [%stFROM TO receive from Unix]"	pointer
,	O
abescape	array
,	O
abescape	array
)	O
;	O
ucuputs	O
(	O
abbuf	array
)	O
;	O
sprintf	function
(	O
abbuf	array
,	O
"[%ssVAR VAL set variable]      [%ssVAR set boolean]"	pointer
,	O
abescape	array
,	O
abescape	array
)	O
;	O
ucuputs	O
(	O
abbuf	array
)	O
;	O
sprintf	function
(	O
abbuf	array
,	O
"[%ss!VAR unset boolean]        [%sv list variables]"	pointer
,	O
abescape	array
,	O
abescape	array
)	O
;	O
ucuputs	O
(	O
abbuf	array
)	O
;	O
sprintf	function
(	O
abbuf	array
,	O
"[%sz suspend]"	pointer
,	O
abescape	array
)	O
;	O
ucuputs	O
(	O
abbuf	array
)	O
;	O
uculist_fns	function
(	O
abescape	array
)	O
;	O
return	O
TRUE	O
;	O
}	O
}	O
static	O
void	O
uculist_fns	function
(	O
zescape	pointer
)	O
const	O
char	O
*	O
zescape	pointer
;	O
{	O
char	O
abbuf	array
[	O
100	int
]	O
;	O
sprintf	function
(	O
abbuf	array
,	O
"[%s%%break send break]         [%s%%cd DIR change directory]"	pointer
,	O
zescape	pointer
,	O
zescape	pointer
)	O
;	O
ucuputs	O
(	O
abbuf	array
)	O
;	O
sprintf	function
(	O
abbuf	array
,	O
"[%s%%put FROM TO send file]    [%s%%take FROM TO receive file]"	pointer
,	O
zescape	pointer
,	O
zescape	pointer
)	O
;	O
ucuputs	O
(	O
abbuf	array
)	O
;	O
sprintf	function
(	O
abbuf	array
,	O
"[%s%%nostop no XON/XOFF]       [%s%%stop use XON/XOFF]"	pointer
,	O
zescape	pointer
,	O
zescape	pointer
)	O
;	O
ucuputs	O
(	O
abbuf	array
)	O
;	O
}	O
static	O
boolean	int
fcuset_var	function
(	O
puuconf	pointer
,	O
zline	pointer
)	O
pointer	pointer
puuconf	pointer
;	O
char	O
*	O
zline	pointer
;	O
{	O
char	O
*	O
zvar	pointer
,	O
*	O
zval	pointer
;	O
char	O
*	O
azargs	array
[	O
2	int
]	O
;	O
int	O
iuuconf	int
;	O
zvar	pointer
=	O
strtok	function
(	O
zline	pointer
,	O
"= \t"	pointer
)	O
;	O
if	O
(	O
zvar	pointer
==	O
NULL	O
)	O
{	O
ucuputs	O
(	O
abCuconnected	array
)	O
;	O
return	O
TRUE	O
;	O
}	O
zval	pointer
=	O
strtok	function
(	O
(	O
char	O
*	O
)	O
NULL	O
,	O
" \t"	pointer
)	O
;	O
if	O
(	O
zval	pointer
==	O
NULL	O
)	O
{	O
azargs	array
[	O
0	int
]	O
=	O
zvar	pointer
;	O
if	O
(	O
azargs	array
[	O
0	int
]	O
[	O
0	int
]	O
!=	O
'!'	O
)	O
azargs	array
[	O
1	int
]	O
=	O
zbufcpy	function
(	O
"t"	pointer
)	O
;	O
else	O
{	O
++	O
azargs	array
[	O
0	int
]	O
;	O
azargs	array
[	O
1	int
]	O
=	O
zbufcpy	function
(	O
"f"	pointer
)	O
;	O
}	O
}	O
else	O
{	O
azargs	array
[	O
0	int
]	O
=	O
zvar	pointer
;	O
azargs	array
[	O
1	int
]	O
=	O
zbufcpy	function
(	O
zval	pointer
)	O
;	O
}	O
iuuconf	int
=	O
uuconf_cmd_args	function
(	O
puuconf	pointer
,	O
2	int
,	O
azargs	array
,	O
asCuvars	array
,	O
(	O
pointer	pointer
)	O
NULL	O
,	O
icuunrecogvar	function
,	O
0	int
,	O
(	O
pointer	pointer
)	O
NULL	O
)	O
;	O
if	O
(	O
(	O
iuuconf	int
&	O
UUCONF_CMDTABRET_KEEP	O
)	O
==	O
0	int
)	O
ubuffree	function
(	O
azargs	array
[	O
1	int
]	O
)	O
;	O
if	O
(	O
(	O
iuuconf	int
&	O
~	O
UUCONF_CMDTABRET_KEEP	O
)	O
!=	O
UUCONF_SUCCESS	O
)	O
ulog_uuconf	function
(	O
LOG_ERROR	int
,	O
puuconf	pointer
,	O
iuuconf	int
)	O
;	O
return	O
TRUE	O
;	O
}	O
static	O
int	O
icuunrecogvar	function
(	O
puuconf	pointer
,	O
argc	int
,	O
argv	pointer
,	O
pvar	pointer
,	O
pinfo	pointer
)	O
pointer	pointer
puuconf	pointer
ATTRIBUTE_UNUSED	O
;	O
int	O
argc	int
ATTRIBUTE_UNUSED	O
;	O
char	O
*	O
*	O
argv	pointer
;	O
pointer	pointer
pvar	pointer
ATTRIBUTE_UNUSED	O
;	O
pointer	pointer
pinfo	pointer
ATTRIBUTE_UNUSED	O
;	O
{	O
char	O
abescape	array
[	O
5	int
]	O
;	O
if	O
(	O
!	O
isprint	function
(	O
*	O
zCuvar_escape	pointer
)	O
)	O
sprintf	function
(	O
abescape	array
,	O
"\\%03o"	pointer
,	O
BUCHAR	O
(	O
*	O
zCuvar_escape	pointer
)	O
)	O
;	O
else	O
{	O
abescape	array
[	O
0	int
]	O
=	O
*	O
zCuvar_escape	pointer
;	O
abescape	array
[	O
1	int
]	O
=	O
'\0'	O
;	O
}	O
ulog	function
(	O
LOG_ERROR	int
,	O
"%s: unknown variable (%sv lists variables)"	pointer
,	O
argv	pointer
[	O
0	int
]	O
,	O
abescape	array
)	O
;	O
return	O
UUCONF_CMDTABRET_CONTINUE	O
;	O
}	O
static	O
void	O
uculist_vars	function
(	O
)	O
{	O
const	O
struct	O
uuconf_cmdtab	struct
*	O
q	pointer
;	O
char	O
abbuf	array
[	O
100	int
]	O
;	O
ucuputs	O
(	O
""	pointer
)	O
;	O
for	O
(	O
q	pointer
=	O
asCuvars	array
;	O
q	pointer
->	O
uuconf_zcmd	pointer
!=	O
NULL	O
;	O
q	pointer
++	O
)	O
{	O
switch	O
(	O
UUCONF_TTYPE_CMDTABTYPE	O
(	O
q	pointer
->	O
uuconf_itype	int
)	O
)	O
{	O
case	O
UUCONF_TTYPE_CMDTABTYPE	O
(	O
UUCONF_CMDTABTYPE_BOOLEAN	O
)	O
:	O
if	O
(	O
*	O
(	O
boolean	int
*	O
)	O
q	pointer
->	O
uuconf_pvar	pointer
)	O
sprintf	function
(	O
abbuf	array
,	O
"%s true"	pointer
,	O
q	pointer
->	O
uuconf_zcmd	pointer
)	O
;	O
else	O
sprintf	function
(	O
abbuf	array
,	O
"%s false"	pointer
,	O
q	pointer
->	O
uuconf_zcmd	pointer
)	O
;	O
break	O
;	O
case	O
UUCONF_TTYPE_CMDTABTYPE	O
(	O
UUCONF_CMDTABTYPE_INT	O
)	O
:	O
sprintf	function
(	O
abbuf	array
,	O
"%s %d"	pointer
,	O
q	pointer
->	O
uuconf_zcmd	pointer
,	O
*	O
(	O
int	O
*	O
)	O
q	pointer
->	O
uuconf_pvar	pointer
)	O
;	O
break	O
;	O
case	O
UUCONF_TTYPE_CMDTABTYPE	O
(	O
UUCONF_CMDTABTYPE_LONG	O
)	O
:	O
sprintf	function
(	O
abbuf	array
,	O
"%s %ld"	pointer
,	O
q	pointer
->	O
uuconf_zcmd	pointer
,	O
*	O
(	O
long	O
*	O
)	O
q	pointer
->	O
uuconf_pvar	pointer
)	O
;	O
break	O
;	O
case	O
UUCONF_TTYPE_CMDTABTYPE	O
(	O
UUCONF_CMDTABTYPE_STRING	O
)	O
:	O
case	O
UUCONF_TTYPE_CMDTABTYPE	O
(	O
UUCONF_CMDTABTYPE_FULLSTRING	O
)	O
:	O
{	O
const	O
char	O
*	O
z	pointer
;	O
char	O
abchar	array
[	O
5	int
]	O
;	O
size_t	long
clen	long
;	O
sprintf	function
(	O
abbuf	array
,	O
"%s "	pointer
,	O
q	pointer
->	O
uuconf_zcmd	pointer
)	O
;	O
clen	long
=	O
strlen	function
(	O
abbuf	array
)	O
;	O
for	O
(	O
z	pointer
=	O
*	O
(	O
const	O
char	O
*	O
*	O
)	O
q	pointer
->	O
uuconf_pvar	pointer
;	O
*	O
z	pointer
!=	O
'\0'	O
;	O
z	pointer
++	O
)	O
{	O
int	O
cchar	int
;	O
if	O
(	O
!	O
isprint	function
(	O
*	O
z	pointer
)	O
)	O
{	O
sprintf	function
(	O
abchar	array
,	O
"\\%03o"	pointer
,	O
BUCHAR	O
(	O
*	O
z	pointer
)	O
)	O
;	O
cchar	int
=	O
4	int
;	O
}	O
else	O
{	O
abchar	array
[	O
0	int
]	O
=	O
*	O
z	pointer
;	O
abchar	array
[	O
1	int
]	O
=	O
'\0'	O
;	O
cchar	int
=	O
1	int
;	O
}	O
if	O
(	O
clen	long
+	O
cchar	int
<	O
sizeof	O
(	O
abbuf	array
)	O
)	O
strcat	function
(	O
abbuf	array
,	O
abchar	array
)	O
;	O
clen	long
+=	O
cchar	int
;	O
}	O
}	O
break	O
;	O
default	O
:	O
sprintf	function
(	O
abbuf	array
,	O
"%s [unprintable type]"	pointer
,	O
q	pointer
->	O
uuconf_zcmd	pointer
)	O
;	O
break	O
;	O
}	O
ucuputs	O
(	O
abbuf	array
)	O
;	O
}	O
}	O
static	O
char	O
bCutype	char
;	O
static	O
int	O
icubreak	function
P	O
(	O
(	O
pointer	pointer
puuconf	pointer
,	O
int	O
argc	int
,	O
char	O
*	O
*	O
argv	pointer
,	O
pointer	pointer
pvar	pointer
,	O
pointer	pointer
pinfo	pointer
)	O
)	O
;	O
static	O
int	O
icudebug	function
P	O
(	O
(	O
pointer	pointer
puuconf	pointer
,	O
int	O
argc	int
,	O
char	O
*	O
*	O
argv	pointer
,	O
pointer	pointer
pvar	pointer
,	O
pointer	pointer
pinfo	pointer
)	O
)	O
;	O
static	O
int	O
icuchdir	function
P	O
(	O
(	O
pointer	pointer
puuconf	pointer
,	O
int	O
argc	int
,	O
char	O
*	O
*	O
argv	pointer
,	O
pointer	pointer
pvar	pointer
,	O
pointer	pointer
pinfo	pointer
)	O
)	O
;	O
static	O
int	O
icuput	function
P	O
(	O
(	O
pointer	pointer
puuconf	pointer
,	O
int	O
argc	int
,	O
char	O
*	O
*	O
argv	pointer
,	O
pointer	pointer
pvar	pointer
,	O
pointer	pointer
pinfo	pointer
)	O
)	O
;	O
static	O
int	O
icutake	function
P	O
(	O
(	O
pointer	pointer
puuconf	pointer
,	O
int	O
argc	int
,	O
char	O
*	O
*	O
argv	pointer
,	O
pointer	pointer
pvar	pointer
,	O
pointer	pointer
pinfo	pointer
)	O
)	O
;	O
static	O
int	O
icunostop	function
P	O
(	O
(	O
pointer	pointer
puuconf	pointer
,	O
int	O
argc	int
,	O
char	O
*	O
*	O
argv	pointer
,	O
pointer	pointer
pvar	pointer
,	O
pointer	pointer
pinfo	pointer
)	O
)	O
;	O
static	O
const	O
struct	O
uuconf_cmdtab	struct
asCucmds	array
[	O
]	O
=	O
{	O
{	O
"break"	pointer
,	O
UUCONF_CMDTABTYPE_FN	O
|	O
1	int
,	O
NULL	O
,	O
icubreak	function
}	O
,	O
{	O
"b"	pointer
,	O
UUCONF_CMDTABTYPE_FN	O
|	O
1	int
,	O
NULL	O
,	O
icubreak	function
}	O
,	O
{	O
"cd"	pointer
,	O
UUCONF_CMDTABTYPE_FN	O
|	O
0	int
,	O
NULL	O
,	O
icuchdir	function
}	O
,	O
{	O
"d"	pointer
,	O
UUCONF_CMDTABTYPE_FN	O
|	O
1	int
,	O
NULL	O
,	O
icudebug	function
}	O
,	O
{	O
"put"	pointer
,	O
UUCONF_CMDTABTYPE_FN	O
|	O
0	int
,	O
NULL	O
,	O
icuput	function
}	O
,	O
{	O
"take"	pointer
,	O
UUCONF_CMDTABTYPE_FN	O
|	O
0	int
,	O
NULL	O
,	O
icutake	function
}	O
,	O
{	O
"nostop"	pointer
,	O
UUCONF_CMDTABTYPE_FN	O
|	O
1	int
,	O
NULL	O
,	O
icunostop	function
}	O
,	O
{	O
"stop"	pointer
,	O
UUCONF_CMDTABTYPE_FN	O
|	O
1	int
,	O
&	O
bCutype	char
,	O
icunostop	function
}	O
,	O
{	O
">"	pointer
,	O
UUCONF_CMDTABTYPE_FN	O
|	O
0	int
,	O
&	O
bCutype	char
,	O
icuput	function
}	O
,	O
{	O
"<"	pointer
,	O
UUCONF_CMDTABTYPE_FN	O
|	O
0	int
,	O
&	O
bCutype	char
,	O
icutake	function
}	O
,	O
{	O
"p"	pointer
,	O
UUCONF_CMDTABTYPE_FN	O
|	O
0	int
,	O
NULL	O
,	O
icuput	function
}	O
,	O
{	O
"t"	pointer
,	O
UUCONF_CMDTABTYPE_FN	O
|	O
0	int
,	O
NULL	O
,	O
icutake	function
}	O
,	O
{	O
NULL	O
,	O
0	int
,	O
NULL	O
,	O
NULL	O
}	O
}	O
;	O
static	O
boolean	int
fcudo_subcmd	function
(	O
puuconf	pointer
,	O
qconn	pointer
,	O
zline	pointer
)	O
pointer	pointer
puuconf	pointer
;	O
struct	O
sconnection	struct
*	O
qconn	pointer
;	O
char	O
*	O
zline	pointer
;	O
{	O
char	O
*	O
azargs	array
[	O
3	int
]	O
;	O
int	O
iarg	int
;	O
int	O
iuuconf	int
;	O
for	O
(	O
iarg	int
=	O
0	int
;	O
iarg	int
<	O
3	int
;	O
iarg	int
++	O
)	O
{	O
azargs	array
[	O
iarg	int
]	O
=	O
strtok	function
(	O
iarg	int
==	O
0	int
?	O
zline	pointer
:	O
(	O
char	O
*	O
)	O
NULL	O
,	O
" \t\n"	pointer
)	O
;	O
if	O
(	O
azargs	array
[	O
iarg	int
]	O
==	O
NULL	O
)	O
break	O
;	O
}	O
if	O
(	O
iarg	int
==	O
0	int
)	O
{	O
ucuputs	O
(	O
abCuconnected	array
)	O
;	O
return	O
TRUE	O
;	O
}	O
iuuconf	int
=	O
uuconf_cmd_args	function
(	O
puuconf	pointer
,	O
iarg	int
,	O
azargs	array
,	O
asCucmds	array
,	O
(	O
pointer	pointer
)	O
qconn	pointer
,	O
icuunrecogfn	function
,	O
0	int
,	O
(	O
pointer	pointer
)	O
NULL	O
)	O
;	O
if	O
(	O
iuuconf	int
!=	O
UUCONF_SUCCESS	O
)	O
ulog_uuconf	function
(	O
LOG_ERROR	int
,	O
puuconf	pointer
,	O
iuuconf	int
)	O
;	O
return	O
TRUE	O
;	O
}	O
static	O
int	O
icuunrecogfn	function
(	O
puuconf	pointer
,	O
argc	int
,	O
argv	pointer
,	O
pvar	pointer
,	O
pinfo	pointer
)	O
pointer	pointer
puuconf	pointer
ATTRIBUTE_UNUSED	O
;	O
int	O
argc	int
ATTRIBUTE_UNUSED	O
;	O
char	O
*	O
*	O
argv	pointer
;	O
pointer	pointer
pvar	pointer
ATTRIBUTE_UNUSED	O
;	O
pointer	pointer
pinfo	pointer
ATTRIBUTE_UNUSED	O
;	O
{	O
char	O
abescape	array
[	O
5	int
]	O
;	O
if	O
(	O
!	O
isprint	function
(	O
*	O
zCuvar_escape	pointer
)	O
)	O
sprintf	function
(	O
abescape	array
,	O
"\\%03o"	pointer
,	O
BUCHAR	O
(	O
*	O
zCuvar_escape	pointer
)	O
)	O
;	O
else	O
{	O
abescape	array
[	O
0	int
]	O
=	O
*	O
zCuvar_escape	pointer
;	O
abescape	array
[	O
1	int
]	O
=	O
'\0'	O
;	O
}	O
if	O
(	O
argv	pointer
[	O
0	int
]	O
[	O
0	int
]	O
==	O
'?'	O
)	O
uculist_fns	function
(	O
abescape	array
)	O
;	O
else	O
ulog	function
(	O
LOG_ERROR	int
,	O
"%s: unknown (%s%%? lists choices)"	pointer
,	O
argv	pointer
[	O
0	int
]	O
,	O
abescape	array
)	O
;	O
return	O
UUCONF_CMDTABRET_CONTINUE	O
;	O
}	O
static	O
int	O
icubreak	function
(	O
puuconf	pointer
,	O
argc	int
,	O
argv	pointer
,	O
pvar	pointer
,	O
pinfo	pointer
)	O
pointer	pointer
puuconf	pointer
ATTRIBUTE_UNUSED	O
;	O
int	O
argc	int
ATTRIBUTE_UNUSED	O
;	O
char	O
*	O
*	O
argv	pointer
ATTRIBUTE_UNUSED	O
;	O
pointer	pointer
pvar	pointer
ATTRIBUTE_UNUSED	O
;	O
pointer	pointer
pinfo	pointer
;	O
{	O
struct	O
sconnection	struct
*	O
qconn	pointer
=	O
(	O
struct	O
sconnection	struct
*	O
)	O
pinfo	pointer
;	O
if	O
(	O
!	O
fconn_break	function
(	O
qconn	pointer
)	O
)	O
ucuabort	function
(	O
)	O
;	O
return	O
UUCONF_CMDTABRET_CONTINUE	O
;	O
}	O
static	O
int	O
icuchdir	function
(	O
puuconf	pointer
,	O
argc	int
,	O
argv	pointer
,	O
pvar	pointer
,	O
pinfo	pointer
)	O
pointer	pointer
puuconf	pointer
ATTRIBUTE_UNUSED	O
;	O
int	O
argc	int
;	O
char	O
*	O
*	O
argv	pointer
;	O
pointer	pointer
pvar	pointer
ATTRIBUTE_UNUSED	O
;	O
pointer	pointer
pinfo	pointer
ATTRIBUTE_UNUSED	O
;	O
{	O
const	O
char	O
*	O
zarg	pointer
;	O
if	O
(	O
argc	int
<=	O
1	int
)	O
zarg	pointer
=	O
NULL	O
;	O
else	O
zarg	pointer
=	O
argv	pointer
[	O
1	int
]	O
;	O
(	O
void	O
)	O
fsysdep_chdir	function
(	O
zarg	pointer
)	O
;	O
return	O
UUCONF_CMDTABRET_CONTINUE	O
;	O
}	O
static	O
int	O
icudebug	function
(	O
puuconf	pointer
,	O
argc	int
,	O
argv	pointer
,	O
pvar	pointer
,	O
pinfo	pointer
)	O
pointer	pointer
puuconf	pointer
ATTRIBUTE_UNUSED	O
;	O
int	O
argc	int
ATTRIBUTE_UNUSED	O
;	O
char	O
*	O
*	O
argv	pointer
ATTRIBUTE_UNUSED	O
;	O
pointer	pointer
pvar	pointer
ATTRIBUTE_UNUSED	O
;	O
pointer	pointer
pinfo	pointer
ATTRIBUTE_UNUSED	O
;	O
{	O
if	O
(	O
iDebug	int
!=	O
0	int
)	O
iDebug	int
=	O
0	int
;	O
else	O
iDebug	int
=	O
DEBUG_MAX	O
;	O
return	O
UUCONF_CMDTABRET_CONTINUE	O
;	O
}	O
static	O
int	O
icunostop	function
(	O
puuconf	pointer
,	O
argc	int
,	O
argv	pointer
,	O
pvar	pointer
,	O
pinfo	pointer
)	O
pointer	pointer
puuconf	pointer
ATTRIBUTE_UNUSED	O
;	O
int	O
argc	int
ATTRIBUTE_UNUSED	O
;	O
char	O
*	O
*	O
argv	pointer
ATTRIBUTE_UNUSED	O
;	O
pointer	pointer
pvar	pointer
;	O
pointer	pointer
pinfo	pointer
;	O
{	O
struct	O
sconnection	struct
*	O
qconn	pointer
=	O
(	O
struct	O
sconnection	struct
*	O
)	O
pinfo	pointer
;	O
if	O
(	O
!	O
fconn_set	function
(	O
qconn	pointer
,	O
PARITYSETTING_DEFAULT	int
,	O
STRIPSETTING_DEFAULT	int
,	O
pvar	pointer
==	O
NULL	O
?	O
XONXOFF_OFF	int
:	O
XONXOFF_ON	int
)	O
)	O
ucuabort	function
(	O
)	O
;	O
return	O
UUCONF_CMDTABRET_CONTINUE	O
;	O
}	O
static	O
int	O
icuput	function
(	O
puuconf	pointer
,	O
argc	int
,	O
argv	pointer
,	O
pvar	pointer
,	O
pinfo	pointer
)	O
pointer	pointer
puuconf	pointer
ATTRIBUTE_UNUSED	O
;	O
int	O
argc	int
;	O
char	O
*	O
*	O
argv	pointer
;	O
pointer	pointer
pvar	pointer
;	O
pointer	pointer
pinfo	pointer
;	O
{	O
struct	O
sconnection	struct
*	O
qconn	pointer
=	O
(	O
struct	O
sconnection	struct
*	O
)	O
pinfo	pointer
;	O
char	O
*	O
zfrom	pointer
;	O
char	O
*	O
zto	pointer
=	O
NULL	O
;	O
char	O
*	O
zalc	pointer
;	O
openfile_t	pointer
e	pointer
;	O
int	O
cline	int
;	O
char	O
*	O
zbuf	pointer
;	O
size_t	long
cbuf	long
;	O
if	O
(	O
argc	int
>	O
1	int
)	O
zfrom	pointer
=	O
zbufcpy	function
(	O
argv	pointer
[	O
1	int
]	O
)	O
;	O
else	O
{	O
zfrom	pointer
=	O
zsysdep_terminal_line	function
(	O
"File to send: "	pointer
)	O
;	O
if	O
(	O
zfrom	pointer
==	O
NULL	O
)	O
ucuabort	function
(	O
)	O
;	O
zfrom	pointer
[	O
strcspn	function
(	O
zfrom	pointer
,	O
" \t\n"	pointer
)	O
]	O
=	O
'\0'	O
;	O
if	O
(	O
*	O
zfrom	pointer
==	O
'\0'	O
)	O
{	O
ubuffree	function
(	O
zfrom	pointer
)	O
;	O
ucuputs	O
(	O
abCuconnected	array
)	O
;	O
return	O
UUCONF_CMDTABRET_CONTINUE	O
;	O
}	O
}	O
if	O
(	O
pvar	pointer
==	O
NULL	O
)	O
{	O
if	O
(	O
argc	int
>	O
2	int
)	O
zto	pointer
=	O
zbufcpy	function
(	O
argv	pointer
[	O
2	int
]	O
)	O
;	O
else	O
{	O
char	O
*	O
zbase	pointer
;	O
char	O
*	O
zprompt	pointer
;	O
zbase	pointer
=	O
zsysdep_base_name	function
(	O
zfrom	pointer
)	O
;	O
if	O
(	O
zbase	pointer
==	O
NULL	O
)	O
ucuabort	function
(	O
)	O
;	O
zprompt	pointer
=	O
zbufalc	function
(	O
sizeof	O
"Remote file name []: "	pointer
+	O
strlen	function
(	O
zbase	pointer
)	O
)	O
;	O
sprintf	function
(	O
zprompt	pointer
,	O
"Remote file name [%s]: "	pointer
,	O
zbase	pointer
)	O
;	O
zto	pointer
=	O
zsysdep_terminal_line	function
(	O
zprompt	pointer
)	O
;	O
ubuffree	function
(	O
zprompt	pointer
)	O
;	O
if	O
(	O
zto	pointer
==	O
NULL	O
)	O
ucuabort	function
(	O
)	O
;	O
zto	pointer
[	O
strcspn	function
(	O
zto	pointer
,	O
" \t\n"	pointer
)	O
]	O
=	O
'\0'	O
;	O
if	O
(	O
*	O
zto	pointer
!=	O
'\0'	O
)	O
ubuffree	function
(	O
zbase	pointer
)	O
;	O
else	O
{	O
ubuffree	function
(	O
zto	pointer
)	O
;	O
zto	pointer
=	O
zbase	pointer
;	O
}	O
}	O
}	O
e	pointer
=	O
esysdep_user_fopen	function
(	O
zfrom	pointer
,	O
TRUE	O
,	O
fCuvar_binary	int
)	O
;	O
if	O
(	O
!	O
ffileisopen	O
(	O
e	pointer
)	O
)	O
{	O
const	O
char	O
*	O
zerrstr	pointer
;	O
if	O
(	O
pvar	pointer
==	O
NULL	O
)	O
ubuffree	function
(	O
zto	pointer
)	O
;	O
zerrstr	pointer
=	O
strerror	function
(	O
errno	O
)	O
;	O
zalc	pointer
=	O
zbufalc	function
(	O
strlen	function
(	O
zfrom	pointer
)	O
+	O
sizeof	O
": "	pointer
+	O
strlen	function
(	O
zerrstr	pointer
)	O
)	O
;	O
sprintf	function
(	O
zalc	pointer
,	O
"%s: %s"	pointer
,	O
zfrom	pointer
,	O
zerrstr	pointer
)	O
;	O
ubuffree	function
(	O
zfrom	pointer
)	O
;	O
ucuputs	O
(	O
zalc	pointer
)	O
;	O
ubuffree	function
(	O
zalc	pointer
)	O
;	O
ucuputs	O
(	O
abCuconnected	array
)	O
;	O
return	O
UUCONF_CMDTABRET_CONTINUE	O
;	O
}	O
ubuffree	function
(	O
zfrom	pointer
)	O
;	O
if	O
(	O
!	O
fsysdep_cu_copy	function
(	O
FALSE	O
)	O
||	O
!	O
fsysdep_terminal_signals	function
(	O
TRUE	O
)	O
)	O
ucuabort	function
(	O
)	O
;	O
if	O
(	O
pvar	pointer
==	O
NULL	O
)	O
{	O
boolean	int
fret	int
;	O
zalc	pointer
=	O
zbufalc	function
(	O
sizeof	O
"cat > \n"	pointer
+	O
strlen	function
(	O
zto	pointer
)	O
)	O
;	O
sprintf	function
(	O
zalc	pointer
,	O
"cat > %s\n"	pointer
,	O
zto	pointer
)	O
;	O
ubuffree	function
(	O
zto	pointer
)	O
;	O
fret	int
=	O
fcusend_buf	function
(	O
qconn	pointer
,	O
zalc	pointer
,	O
strlen	function
(	O
zalc	pointer
)	O
)	O
;	O
ubuffree	function
(	O
zalc	pointer
)	O
;	O
if	O
(	O
!	O
fret	int
)	O
{	O
(	O
void	O
)	O
ffileclose	O
(	O
e	pointer
)	O
;	O
if	O
(	O
!	O
fsysdep_cu_copy	function
(	O
TRUE	O
)	O
||	O
!	O
fsysdep_terminal_signals	function
(	O
FALSE	O
)	O
)	O
ucuabort	function
(	O
)	O
;	O
ucuputs	O
(	O
abCuconnected	array
)	O
;	O
return	O
UUCONF_CMDTABRET_CONTINUE	O
;	O
}	O
}	O
cline	int
=	O
0	int
;	O
zbuf	pointer
=	O
NULL	O
;	O
cbuf	long
=	O
0	int
;	O
while	O
(	O
TRUE	O
)	O
{	O
char	O
abbuf	array
[	O
512	int
]	O
;	O
size_t	long
c	long
;	O
if	O
(	O
fCuvar_binary	int
)	O
{	O
if	O
(	O
ffileeof	O
(	O
e	pointer
)	O
)	O
break	O
;	O
c	long
=	O
cfileread	O
(	O
e	pointer
,	O
abbuf	array
,	O
sizeof	O
abbuf	array
)	O
;	O
if	O
(	O
ffileioerror	O
(	O
e	pointer
,	O
c	long
)	O
)	O
{	O
ucuputs	O
(	O
"[file read error]"	pointer
)	O
;	O
break	O
;	O
}	O
if	O
(	O
c	long
==	O
0	int
)	O
break	O
;	O
zbuf	pointer
=	O
abbuf	array
;	O
}	O
else	O
{	O
if	O
(	O
getline	function
(	O
&	O
zbuf	pointer
,	O
&	O
cbuf	long
,	O
e	pointer
)	O
<=	O
0	int
)	O
{	O
xfree	function
(	O
(	O
pointer	pointer
)	O
zbuf	pointer
)	O
;	O
break	O
;	O
}	O
c	long
=	O
strlen	function
(	O
zbuf	pointer
)	O
;	O
}	O
if	O
(	O
fCuvar_verbose	int
)	O
{	O
++	O
cline	int
;	O
printf	function
(	O
"%d "	pointer
,	O
cline	int
)	O
;	O
(	O
void	O
)	O
fflush	function
(	O
stdout	pointer
)	O
;	O
}	O
if	O
(	O
!	O
fcusend_buf	function
(	O
qconn	pointer
,	O
zbuf	pointer
,	O
c	long
)	O
)	O
{	O
if	O
(	O
!	O
fCuvar_binary	int
)	O
xfree	function
(	O
(	O
pointer	pointer
)	O
zbuf	pointer
)	O
;	O
(	O
void	O
)	O
fclose	function
(	O
e	pointer
)	O
;	O
if	O
(	O
!	O
fsysdep_cu_copy	function
(	O
TRUE	O
)	O
||	O
!	O
fsysdep_terminal_signals	function
(	O
FALSE	O
)	O
)	O
ucuabort	function
(	O
)	O
;	O
ucuputs	O
(	O
abCuconnected	array
)	O
;	O
return	O
UUCONF_CMDTABRET_CONTINUE	O
;	O
}	O
}	O
(	O
void	O
)	O
ffileclose	O
(	O
e	pointer
)	O
;	O
if	O
(	O
pvar	pointer
==	O
NULL	O
)	O
{	O
char	O
beof	char
;	O
beof	char
=	O
'\004'	O
;	O
if	O
(	O
!	O
fconn_write	function
(	O
qconn	pointer
,	O
&	O
beof	char
,	O
1	int
)	O
)	O
ucuabort	function
(	O
)	O
;	O
}	O
else	O
{	O
if	O
(	O
*	O
zCuvar_eofwrite	pointer
!=	O
'\0'	O
)	O
{	O
if	O
(	O
!	O
fconn_write	function
(	O
qconn	pointer
,	O
zCuvar_eofwrite	pointer
,	O
strlen	function
(	O
zCuvar_eofwrite	pointer
)	O
)	O
)	O
ucuabort	function
(	O
)	O
;	O
}	O
}	O
if	O
(	O
fCuvar_verbose	int
)	O
ucuputs	O
(	O
""	pointer
)	O
;	O
ucuputs	O
(	O
"[file transfer complete]"	pointer
)	O
;	O
if	O
(	O
!	O
fsysdep_cu_copy	function
(	O
TRUE	O
)	O
||	O
!	O
fsysdep_terminal_signals	function
(	O
FALSE	O
)	O
)	O
ucuabort	function
(	O
)	O
;	O
ucuputs	O
(	O
abCuconnected	array
)	O
;	O
return	O
UUCONF_CMDTABRET_CONTINUE	O
;	O
}	O
static	O
int	O
icutake	function
(	O
puuconf	pointer
,	O
argc	int
,	O
argv	pointer
,	O
pvar	pointer
,	O
pinfo	pointer
)	O
pointer	pointer
puuconf	pointer
ATTRIBUTE_UNUSED	O
;	O
int	O
argc	int
;	O
char	O
*	O
*	O
argv	pointer
;	O
pointer	pointer
pvar	pointer
;	O
pointer	pointer
pinfo	pointer
;	O
{	O
struct	O
sconnection	struct
*	O
qconn	pointer
=	O
(	O
struct	O
sconnection	struct
*	O
)	O
pinfo	pointer
;	O
const	O
char	O
*	O
zeof	pointer
;	O
char	O
*	O
zfrom	pointer
,	O
*	O
zto	pointer
,	O
*	O
zcmd	pointer
;	O
char	O
*	O
zalc	pointer
;	O
openfile_t	pointer
e	pointer
;	O
char	O
bcr	char
;	O
size_t	long
ceoflen	long
;	O
char	O
*	O
zlook	pointer
=	O
NULL	O
;	O
size_t	long
ceofhave	long
;	O
boolean	int
ferr	int
;	O
if	O
(	O
argc	int
>	O
1	int
)	O
zfrom	pointer
=	O
zbufcpy	function
(	O
argv	pointer
[	O
1	int
]	O
)	O
;	O
else	O
{	O
zfrom	pointer
=	O
zsysdep_terminal_line	function
(	O
"Remote file to retreive: "	pointer
)	O
;	O
if	O
(	O
zfrom	pointer
==	O
NULL	O
)	O
ucuabort	function
(	O
)	O
;	O
zfrom	pointer
[	O
strcspn	function
(	O
zfrom	pointer
,	O
" \t\n"	pointer
)	O
]	O
=	O
'\0'	O
;	O
if	O
(	O
*	O
zfrom	pointer
==	O
'\0'	O
)	O
{	O
ubuffree	function
(	O
zfrom	pointer
)	O
;	O
ucuputs	O
(	O
abCuconnected	array
)	O
;	O
return	O
UUCONF_CMDTABRET_CONTINUE	O
;	O
}	O
}	O
if	O
(	O
argc	int
>	O
2	int
)	O
zto	pointer
=	O
zbufcpy	function
(	O
argv	pointer
[	O
2	int
]	O
)	O
;	O
else	O
{	O
char	O
*	O
zbase	pointer
;	O
char	O
*	O
zprompt	pointer
;	O
zbase	pointer
=	O
zsysdep_base_name	function
(	O
zfrom	pointer
)	O
;	O
if	O
(	O
zbase	pointer
==	O
NULL	O
)	O
ucuabort	function
(	O
)	O
;	O
zprompt	pointer
=	O
zbufalc	function
(	O
sizeof	O
"Local file name []: "	pointer
+	O
strlen	function
(	O
zbase	pointer
)	O
)	O
;	O
sprintf	function
(	O
zprompt	pointer
,	O
"Local file name [%s]: "	pointer
,	O
zbase	pointer
)	O
;	O
zto	pointer
=	O
zsysdep_terminal_line	function
(	O
zprompt	pointer
)	O
;	O
ubuffree	function
(	O
zprompt	pointer
)	O
;	O
if	O
(	O
zto	pointer
==	O
NULL	O
)	O
ucuabort	function
(	O
)	O
;	O
zto	pointer
[	O
strcspn	function
(	O
zto	pointer
,	O
" \t\n"	pointer
)	O
]	O
=	O
'\0'	O
;	O
if	O
(	O
*	O
zto	pointer
!=	O
'\0'	O
)	O
ubuffree	function
(	O
zbase	pointer
)	O
;	O
else	O
{	O
ubuffree	function
(	O
zto	pointer
)	O
;	O
zto	pointer
=	O
zbase	pointer
;	O
}	O
}	O
if	O
(	O
pvar	pointer
!=	O
NULL	O
)	O
{	O
zcmd	pointer
=	O
zsysdep_terminal_line	function
(	O
"Remote command to execute: "	pointer
)	O
;	O
if	O
(	O
zcmd	pointer
==	O
NULL	O
)	O
ucuabort	function
(	O
)	O
;	O
zcmd	pointer
[	O
strcspn	function
(	O
zcmd	pointer
,	O
"\n"	pointer
)	O
]	O
=	O
'\0'	O
;	O
zeof	pointer
=	O
zCuvar_eofread	pointer
;	O
}	O
else	O
{	O
zcmd	pointer
=	O
zbufalc	function
(	O
sizeof	O
"cat ; echo; echo ////cuend////"	pointer
+	O
strlen	function
(	O
zfrom	pointer
)	O
)	O
;	O
sprintf	function
(	O
zcmd	pointer
,	O
"cat %s; echo; echo ////cuend////"	pointer
,	O
zfrom	pointer
)	O
;	O
zeof	pointer
=	O
"\n////cuend////\n"	pointer
;	O
}	O
ubuffree	function
(	O
zfrom	pointer
)	O
;	O
e	pointer
=	O
esysdep_user_fopen	function
(	O
zto	pointer
,	O
FALSE	O
,	O
fCuvar_binary	int
)	O
;	O
if	O
(	O
!	O
ffileisopen	O
(	O
e	pointer
)	O
)	O
{	O
const	O
char	O
*	O
zerrstr	pointer
;	O
ubuffree	function
(	O
zcmd	pointer
)	O
;	O
zerrstr	pointer
=	O
strerror	function
(	O
errno	O
)	O
;	O
zalc	pointer
=	O
zbufalc	function
(	O
strlen	function
(	O
zto	pointer
)	O
+	O
sizeof	O
": "	pointer
+	O
strlen	function
(	O
zerrstr	pointer
)	O
)	O
;	O
sprintf	function
(	O
zalc	pointer
,	O
"%s: %s\n"	pointer
,	O
zto	pointer
,	O
zerrstr	pointer
)	O
;	O
ucuputs	O
(	O
zalc	pointer
)	O
;	O
ubuffree	function
(	O
zalc	pointer
)	O
;	O
ucuputs	O
(	O
abCuconnected	array
)	O
;	O
ubuffree	function
(	O
zto	pointer
)	O
;	O
return	O
UUCONF_CMDTABRET_CONTINUE	O
;	O
}	O
if	O
(	O
!	O
fsysdep_cu_copy	function
(	O
FALSE	O
)	O
||	O
!	O
fsysdep_terminal_signals	function
(	O
TRUE	O
)	O
)	O
ucuabort	function
(	O
)	O
;	O
if	O
(	O
!	O
fconn_write	function
(	O
qconn	pointer
,	O
zcmd	pointer
,	O
strlen	function
(	O
zcmd	pointer
)	O
)	O
)	O
ucuabort	function
(	O
)	O
;	O
bcr	char
=	O
'\r'	O
;	O
if	O
(	O
!	O
fconn_write	function
(	O
qconn	pointer
,	O
&	O
bcr	char
,	O
1	int
)	O
)	O
ucuabort	function
(	O
)	O
;	O
ubuffree	function
(	O
zcmd	pointer
)	O
;	O
iPrecstart	int
=	O
0	int
;	O
iPrecend	int
=	O
0	int
;	O
if	O
(	O
pvar	pointer
==	O
NULL	O
)	O
{	O
int	O
b	int
;	O
while	O
(	O
(	O
b	int
=	O
breceive_char	function
(	O
qconn	pointer
,	O
cCuvar_timeout	int
,	O
TRUE	O
)	O
)	O
!=	O
'\n'	O
)	O
{	O
if	O
(	O
b	int
==	O
-	O
2	int
)	O
ucuabort	function
(	O
)	O
;	O
if	O
(	O
b	int
<	O
0	int
)	O
{	O
ucuputs	O
(	O
"[timed out waiting for newline]"	pointer
)	O
;	O
ucuputs	O
(	O
abCuconnected	array
)	O
;	O
ubuffree	function
(	O
zto	pointer
)	O
;	O
return	O
UUCONF_CMDTABRET_CONTINUE	O
;	O
}	O
}	O
}	O
ceoflen	long
=	O
strlen	function
(	O
zeof	pointer
)	O
;	O
zlook	pointer
=	O
zbufalc	function
(	O
ceoflen	long
)	O
;	O
ceofhave	long
=	O
0	int
;	O
ferr	int
=	O
FALSE	O
;	O
while	O
(	O
TRUE	O
)	O
{	O
int	O
b	int
;	O
if	O
(	O
FGOT_SIGNAL	O
(	O
)	O
)	O
{	O
ulog	function
(	O
LOG_ERROR	int
,	O
(	O
const	O
char	O
*	O
)	O
NULL	O
)	O
;	O
ucuputs	O
(	O
"[file receive aborted]"	pointer
)	O
;	O
afSignal	array
[	O
INDEXSIG_SIGINT	O
]	O
=	O
FALSE	O
;	O
break	O
;	O
}	O
b	int
=	O
breceive_char	function
(	O
qconn	pointer
,	O
cCuvar_timeout	int
,	O
TRUE	O
)	O
;	O
if	O
(	O
b	int
==	O
-	O
2	int
)	O
ucuabort	function
(	O
)	O
;	O
if	O
(	O
b	int
<	O
0	int
)	O
{	O
if	O
(	O
ceofhave	long
>	O
0	int
)	O
(	O
void	O
)	O
fwrite	function
(	O
zlook	pointer
,	O
sizeof	O
(	O
char	O
)	O
,	O
ceofhave	long
,	O
e	pointer
)	O
;	O
ucuputs	O
(	O
"[timed out]"	pointer
)	O
;	O
break	O
;	O
}	O
if	O
(	O
b	int
==	O
'\r'	O
&&	O
!	O
fCuvar_binary	int
)	O
continue	O
;	O
if	O
(	O
ceoflen	long
==	O
0	int
)	O
{	O
if	O
(	O
cfilewrite	O
(	O
e	pointer
,	O
&	O
b	int
,	O
1	int
)	O
!=	O
1	int
)	O
{	O
ferr	int
=	O
TRUE	O
;	O
break	O
;	O
}	O
}	O
else	O
{	O
zlook	pointer
[	O
ceofhave	long
]	O
=	O
b	int
;	O
++	O
ceofhave	long
;	O
if	O
(	O
ceofhave	long
==	O
ceoflen	long
)	O
{	O
size_t	long
cmove	long
;	O
char	O
*	O
zmove	pointer
;	O
if	O
(	O
memcmp	function
(	O
zeof	pointer
,	O
zlook	pointer
,	O
ceoflen	long
)	O
==	O
0	int
)	O
{	O
ucuputs	O
(	O
"[file transfer complete]"	pointer
)	O
;	O
break	O
;	O
}	O
if	O
(	O
cfilewrite	O
(	O
e	pointer
,	O
zlook	pointer
,	O
1	int
)	O
!=	O
1	int
)	O
{	O
ferr	int
=	O
TRUE	O
;	O
break	O
;	O
}	O
zmove	pointer
=	O
zlook	pointer
;	O
for	O
(	O
cmove	long
=	O
ceoflen	long
-	O
1	int
,	O
zmove	pointer
=	O
zlook	pointer
;	O
cmove	long
>	O
0	int
;	O
cmove	long
--	O
,	O
zmove	pointer
++	O
)	O
zmove	pointer
[	O
0	int
]	O
=	O
zmove	pointer
[	O
1	int
]	O
;	O
--	O
ceofhave	long
;	O
}	O
}	O
}	O
ubuffree	function
(	O
zlook	pointer
)	O
;	O
if	O
(	O
!	O
fsysdep_sync	function
(	O
e	pointer
,	O
zto	pointer
)	O
)	O
{	O
(	O
void	O
)	O
ffileclose	O
(	O
e	pointer
)	O
;	O
ferr	int
=	O
TRUE	O
;	O
}	O
else	O
{	O
if	O
(	O
!	O
ffileclose	O
(	O
e	pointer
)	O
)	O
ferr	int
=	O
TRUE	O
;	O
}	O
if	O
(	O
ferr	int
)	O
ucuputs	O
(	O
"[file write error]"	pointer
)	O
;	O
if	O
(	O
!	O
fsysdep_cu_copy	function
(	O
TRUE	O
)	O
||	O
!	O
fsysdep_terminal_signals	function
(	O
FALSE	O
)	O
)	O
ucuabort	function
(	O
)	O
;	O
ucuputs	O
(	O
abCuconnected	array
)	O
;	O
ubuffree	function
(	O
zto	pointer
)	O
;	O
return	O
UUCONF_CMDTABRET_CONTINUE	O
;	O
}	O
static	O
boolean	int
fcusend_buf	function
(	O
qconn	pointer
,	O
zbufarg	pointer
,	O
cbufarg	long
)	O
struct	O
sconnection	struct
*	O
qconn	pointer
;	O
const	O
char	O
*	O
zbufarg	pointer
;	O
size_t	long
cbufarg	long
;	O
{	O
const	O
char	O
*	O
zbuf	pointer
;	O
size_t	long
cbuf	long
;	O
int	O
ctries	int
;	O
size_t	long
cbplen	long
;	O
char	O
*	O
zsendbuf	pointer
;	O
zbuf	pointer
=	O
zbufarg	pointer
;	O
cbuf	long
=	O
cbufarg	long
;	O
ctries	int
=	O
0	int
;	O
if	O
(	O
fCuvar_binary	int
)	O
cbplen	long
=	O
strlen	function
(	O
zCuvar_binary_prefix	pointer
)	O
;	O
else	O
cbplen	long
=	O
1	int
;	O
zsendbuf	pointer
=	O
zbufalc	function
(	O
64	int
*	O
(	O
cbplen	long
+	O
1	int
)	O
)	O
;	O
while	O
(	O
cbuf	long
>	O
0	int
)	O
{	O
int	O
csend	long
;	O
char	O
*	O
zput	pointer
;	O
const	O
char	O
*	O
zget	pointer
;	O
boolean	int
fnl	int
;	O
int	O
i	int
;	O
if	O
(	O
FGOT_SIGNAL	O
(	O
)	O
)	O
{	O
ubuffree	function
(	O
zsendbuf	pointer
)	O
;	O
ulog	function
(	O
LOG_ERROR	int
,	O
(	O
const	O
char	O
*	O
)	O
NULL	O
)	O
;	O
ucuputs	O
(	O
"[file send aborted]"	pointer
)	O
;	O
afSignal	array
[	O
INDEXSIG_SIGINT	O
]	O
=	O
FALSE	O
;	O
return	O
FALSE	O
;	O
}	O
iPrecstart	int
=	O
0	int
;	O
iPrecend	int
=	O
0	int
;	O
if	O
(	O
*	O
zbuf	pointer
==	O
'\n'	O
)	O
csend	long
=	O
1	int
;	O
else	O
{	O
const	O
char	O
*	O
znl	pointer
;	O
znl	pointer
=	O
memchr	function
(	O
zbuf	pointer
,	O
'\n'	O
,	O
cbuf	long
)	O
;	O
if	O
(	O
znl	pointer
==	O
NULL	O
)	O
csend	long
=	O
cbuf	long
;	O
else	O
csend	long
=	O
znl	pointer
-	O
zbuf	pointer
;	O
if	O
(	O
csend	long
>	O
64	int
)	O
csend	long
=	O
64	int
;	O
}	O
zput	pointer
=	O
zsendbuf	pointer
;	O
fnl	int
=	O
FALSE	O
;	O
for	O
(	O
i	int
=	O
0	int
,	O
zget	pointer
=	O
zbuf	pointer
;	O
i	int
<	O
csend	long
;	O
i	int
++	O
,	O
zget	pointer
++	O
)	O
{	O
if	O
(	O
isprint	function
(	O
*	O
zget	pointer
)	O
||	O
*	O
zget	pointer
==	O
'\t'	O
)	O
*	O
zput	pointer
++	O
=	O
*	O
zget	pointer
;	O
else	O
if	O
(	O
*	O
zget	pointer
==	O
'\n'	O
)	O
{	O
if	O
(	O
fCuvar_binary	int
)	O
*	O
zput	pointer
++	O
=	O
'\n'	O
;	O
else	O
*	O
zput	pointer
++	O
=	O
'\r'	O
;	O
fnl	int
=	O
TRUE	O
;	O
}	O
else	O
if	O
(	O
fCuvar_binary	int
)	O
{	O
strcpy	function
(	O
zput	pointer
,	O
zCuvar_binary_prefix	pointer
)	O
;	O
zput	pointer
+=	O
cbplen	long
;	O
*	O
zput	pointer
++	O
=	O
*	O
zget	pointer
;	O
}	O
}	O
zbuf	pointer
+=	O
csend	long
;	O
cbuf	long
-=	O
csend	long
;	O
if	O
(	O
zput	pointer
==	O
zsendbuf	pointer
)	O
continue	O
;	O
if	O
(	O
!	O
fsend_data	function
(	O
qconn	pointer
,	O
zsendbuf	pointer
,	O
(	O
size_t	long
)	O
(	O
zput	pointer
-	O
zsendbuf	pointer
)	O
,	O
TRUE	O
)	O
)	O
ucuabort	function
(	O
)	O
;	O
if	O
(	O
(	O
fCuvar_echocheck	int
&&	O
!	O
fCuvar_binary	int
)	O
||	O
(	O
fnl	int
&&	O
*	O
zCuvar_echonl	pointer
!=	O
'\0'	O
)	O
)	O
{	O
long	O
iend	long
;	O
iend	long
=	O
ixsysdep_time	function
(	O
(	O
long	O
*	O
)	O
NULL	O
)	O
+	O
(	O
long	O
)	O
cCuvar_timeout	int
;	O
for	O
(	O
zget	pointer
=	O
zsendbuf	pointer
;	O
zget	pointer
<	O
zput	pointer
;	O
zget	pointer
++	O
)	O
{	O
int	O
bread	int
;	O
int	O
bwant	int
;	O
if	O
(	O
fCuvar_binary	int
?	O
*	O
zget	pointer
==	O
'\n'	O
:	O
*	O
zget	pointer
==	O
'\r'	O
)	O
{	O
bwant	int
=	O
*	O
zCuvar_echonl	pointer
;	O
if	O
(	O
bwant	int
==	O
'\0'	O
)	O
continue	O
;	O
}	O
else	O
{	O
if	O
(	O
!	O
fCuvar_echocheck	int
||	O
!	O
isprint	function
(	O
*	O
zget	pointer
)	O
)	O
continue	O
;	O
bwant	int
=	O
*	O
zget	pointer
;	O
}	O
do	O
{	O
if	O
(	O
FGOT_SIGNAL	O
(	O
)	O
)	O
{	O
ubuffree	function
(	O
zsendbuf	pointer
)	O
;	O
ulog	function
(	O
LOG_ERROR	int
,	O
(	O
const	O
char	O
*	O
)	O
NULL	O
)	O
;	O
ucuputs	O
(	O
"[file send aborted]"	pointer
)	O
;	O
afSignal	array
[	O
INDEXSIG_SIGINT	O
]	O
=	O
FALSE	O
;	O
return	O
FALSE	O
;	O
}	O
bread	int
=	O
breceive_char	function
(	O
qconn	pointer
,	O
iend	long
-	O
ixsysdep_time	function
(	O
(	O
long	O
*	O
)	O
NULL	O
)	O
,	O
TRUE	O
)	O
;	O
if	O
(	O
bread	int
<	O
0	int
)	O
{	O
if	O
(	O
bread	int
==	O
-	O
2	int
)	O
ucuabort	function
(	O
)	O
;	O
if	O
(	O
!	O
fCuvar_binary	int
&&	O
*	O
zCuvar_kill	pointer
!=	O
'\0'	O
)	O
{	O
++	O
ctries	int
;	O
if	O
(	O
ctries	int
<	O
cCuvar_resend	int
)	O
{	O
if	O
(	O
fCuvar_verbose	int
)	O
{	O
printf	function
(	O
"R "	pointer
)	O
;	O
(	O
void	O
)	O
fflush	function
(	O
stdout	pointer
)	O
;	O
}	O
if	O
(	O
!	O
fsend_data	function
(	O
qconn	pointer
,	O
zCuvar_kill	pointer
,	O
1	int
,	O
TRUE	O
)	O
)	O
ucuabort	function
(	O
)	O
;	O
zbuf	pointer
=	O
zbufarg	pointer
;	O
cbuf	long
=	O
cbufarg	long
;	O
break	O
;	O
}	O
}	O
ubuffree	function
(	O
zsendbuf	pointer
)	O
;	O
ucuputs	O
(	O
"[timed out looking for echo]"	pointer
)	O
;	O
return	O
FALSE	O
;	O
}	O
}	O
while	O
(	O
bread	int
!=	O
*	O
zget	pointer
)	O
;	O
if	O
(	O
bread	int
<	O
0	int
)	O
break	O
;	O
}	O
}	O
}	O
ubuffree	function
(	O
zsendbuf	pointer
)	O
;	O
return	O
TRUE	O
;	O
}	O
