static	O
char	O
*	O
pager	pointer
;	O
static	O
char	O
*	O
get_pager_name	function
(	O
void	O
)	O
{	O
if	O
(	O
pager	pointer
)	O
{	O
if	O
(	O
strcmp	function
(	O
pager	pointer
,	O
"-"	pointer
)	O
==	O
0	int
)	O
return	O
NULL	O
;	O
return	O
pager	pointer
;	O
}	O
return	O
getenv	function
(	O
"PAGER"	pointer
)	O
;	O
}	O
void	O
ds_pager	function
(	O
int	O
argc	int
,	O
char	O
*	O
*	O
argv	pointer
)	O
{	O
if	O
(	O
argc	int
==	O
1	int
)	O
{	O
char	O
*	O
p	pointer
=	O
get_pager_name	function
(	O
)	O
;	O
if	O
(	O
p	pointer
)	O
{	O
printf	function
(	O
"%s\n"	pointer
,	O
p	pointer
)	O
;	O
if	O
(	O
!	O
pager	pointer
)	O
printf	function
(	O
"%s\n"	pointer
,	O
_	O
(	O
"(Pager set from environment)"	pointer
)	O
)	O
;	O
}	O
}	O
else	O
xdico_assign_string	function
(	O
&	O
pager	pointer
,	O
argv	pointer
[	O
1	int
]	O
)	O
;	O
}	O
dico_stream_t	pointer
create_output_stream	function
(	O
void	O
)	O
{	O
return	O
dico_fd_stream_create	function
(	O
fileno	function
(	O
stdout	pointer
)	O
,	O
DICO_STREAM_WRITE	int
,	O
1	int
)	O
;	O
}	O
static	O
int	O
get_screen_lines	function
(	O
void	O
)	O
{	O
struct	O
winsize	struct
ws	pointer
;	O
ws	pointer
.	O
ws_col	short
=	O
ws	pointer
.	O
ws_row	short
=	O
0	int
;	O
if	O
(	O
(	O
ioctl	function
(	O
1	int
,	O
TIOCGWINSZ	int
,	O
(	O
char	O
*	O
)	O
&	O
ws	pointer
)	O
<	O
0	int
)	O
||	O
ws	pointer
.	O
ws_row	short
==	O
0	int
)	O
{	O
const	O
char	O
*	O
lines	pointer
=	O
getenv	function
(	O
"LINES"	pointer
)	O
;	O
if	O
(	O
lines	pointer
)	O
ws	pointer
.	O
ws_row	short
=	O
strtol	function
(	O
lines	pointer
,	O
NULL	O
,	O
10	int
)	O
;	O
}	O
return	O
ws	pointer
.	O
ws_row	short
;	O
}	O
struct	O
pfile_stream	struct
{	O
FILE	struct
*	O
fp	pointer
;	O
}	O
;	O
static	O
int	O
fp_write	function
(	O
void	O
*	O
data	pointer
,	O
const	O
char	O
*	O
buf	pointer
,	O
size_t	long
size	long
,	O
size_t	long
*	O
pret	pointer
)	O
{	O
struct	O
pfile_stream	struct
*	O
p	pointer
=	O
data	pointer
;	O
*	O
pret	pointer
=	O
fwrite	function
(	O
buf	pointer
,	O
1	int
,	O
size	long
,	O
p	pointer
->	O
fp	pointer
)	O
;	O
return	O
ferror	function
(	O
p	pointer
->	O
fp	pointer
)	O
;	O
}	O
static	O
int	O
fp_close	function
(	O
void	O
*	O
data	pointer
)	O
{	O
struct	O
pfile_stream	struct
*	O
p	pointer
=	O
data	pointer
;	O
pclose	function
(	O
p	pointer
->	O
fp	pointer
)	O
;	O
return	O
0	int
;	O
}	O
static	O
dico_stream_t	pointer
create_pfile_stream	function
(	O
FILE	struct
*	O
fp	pointer
)	O
{	O
dico_stream_t	pointer
str	pointer
;	O
struct	O
pfile_stream	struct
*	O
s	long
;	O
s	long
=	O
xmalloc	function
(	O
sizeof	O
(	O
*	O
s	long
)	O
)	O
;	O
s	long
->	O
fp	pointer
=	O
fp	pointer
;	O
if	O
(	O
dico_stream_create	function
(	O
&	O
str	pointer
,	O
DICO_STREAM_WRITE	int
,	O
s	long
)	O
)	O
xalloc_die	function
(	O
)	O
;	O
dico_stream_set_write	function
(	O
str	pointer
,	O
fp_write	function
)	O
;	O
dico_stream_set_close	function
(	O
str	pointer
,	O
fp_close	function
)	O
;	O
return	O
str	pointer
;	O
}	O
dico_stream_t	pointer
create_pager_stream	function
(	O
size_t	long
nlines	long
)	O
{	O
char	O
*	O
pager	pointer
=	O
get_pager_name	function
(	O
)	O
;	O
FILE	struct
*	O
fp	pointer
;	O
if	O
(	O
!	O
pager	pointer
||	O
!	O
pager	pointer
[	O
0	int
]	O
||	O
!	O
isatty	function
(	O
fileno	function
(	O
stdout	pointer
)	O
)	O
||	O
nlines	long
<	O
get_screen_lines	function
(	O
)	O
)	O
return	O
create_output_stream	function
(	O
)	O
;	O
fp	pointer
=	O
popen	function
(	O
pager	pointer
,	O
"w"	pointer
)	O
;	O
if	O
(	O
!	O
fp	pointer
)	O
return	O
create_output_stream	function
(	O
)	O
;	O
return	O
create_pfile_stream	function
(	O
fp	pointer
)	O
;	O
}	O
