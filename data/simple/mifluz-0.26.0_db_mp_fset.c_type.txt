static	O
const	O
char	O
revid	array
[	O
]	O
=	O
"$Id: mp_fset.c,v 1.4 2014/04/17 20:27:31 sebdiaz Exp $"	pointer
;	O
int	O
CDB_memp_fset	function
(	O
dbmfp	pointer
,	O
pgaddr	pointer
,	O
flags	int
)	O
DB_MPOOLFILE	struct
*	O
dbmfp	pointer
;	O
void	O
*	O
pgaddr	pointer
;	O
u_int32_t	int
flags	int
;	O
{	O
BH	struct
*	O
bhp	pointer
;	O
DB_ENV	struct
*	O
dbenv	pointer
;	O
DB_MPOOL	struct
*	O
dbmp	pointer
;	O
MPOOL	struct
*	O
c_mp	pointer
;	O
int	O
ret	int
;	O
dbmp	pointer
=	O
dbmfp	pointer
->	O
dbmp	pointer
;	O
dbenv	pointer
=	O
dbmp	pointer
->	O
dbenv	pointer
;	O
PANIC_CHECK	O
(	O
dbenv	pointer
)	O
;	O
if	O
(	O
flags	int
==	O
0	int
)	O
return	O
(	O
CDB___db_ferr	function
(	O
dbenv	pointer
,	O
"CDB_memp_fset"	pointer
,	O
1	int
)	O
)	O
;	O
if	O
(	O
(	O
ret	int
=	O
CDB___db_fchk	function
(	O
dbenv	pointer
,	O
"CDB_memp_fset"	pointer
,	O
flags	int
,	O
DB_MPOOL_DIRTY	int
|	O
DB_MPOOL_CLEAN	int
|	O
DB_MPOOL_DISCARD	int
)	O
)	O
!=	O
0	int
)	O
return	O
(	O
ret	int
)	O
;	O
if	O
(	O
(	O
ret	int
=	O
CDB___db_fcchk	function
(	O
dbenv	pointer
,	O
"CDB_memp_fset"	pointer
,	O
flags	int
,	O
DB_MPOOL_CLEAN	int
,	O
DB_MPOOL_DIRTY	int
)	O
)	O
!=	O
0	int
)	O
return	O
(	O
ret	int
)	O
;	O
if	O
(	O
LF_ISSET	O
(	O
DB_MPOOL_DIRTY	int
)	O
&&	O
F_ISSET	O
(	O
dbmfp	pointer
,	O
MP_READONLY	int
)	O
)	O
{	O
CDB___db_err	function
(	O
dbenv	pointer
,	O
"%s: dirty flag set for readonly file page"	pointer
,	O
CDB___memp_fn	function
(	O
dbmfp	pointer
)	O
)	O
;	O
return	O
(	O
EACCES	int
)	O
;	O
}	O
bhp	pointer
=	O
(	O
BH	struct
*	O
)	O
(	O
(	O
u_int8_t	char
*	O
)	O
pgaddr	pointer
-	O
SSZA	O
(	O
BH	struct
,	O
buf	pointer
)	O
)	O
;	O
c_mp	pointer
=	O
BH_TO_CACHE	O
(	O
dbmp	pointer
,	O
bhp	pointer
)	O
;	O
R_LOCK	O
(	O
dbenv	pointer
,	O
dbmp	pointer
->	O
reginfo	pointer
)	O
;	O
if	O
(	O
LF_ISSET	O
(	O
DB_MPOOL_CLEAN	int
)	O
&&	O
F_ISSET	O
(	O
bhp	pointer
,	O
BH_DIRTY	int
)	O
)	O
{	O
++	O
c_mp	pointer
->	O
stat	pointer
.	O
st_page_clean	int
;	O
--	O
c_mp	pointer
->	O
stat	pointer
.	O
st_page_dirty	int
;	O
F_CLR	O
(	O
bhp	pointer
,	O
BH_DIRTY	int
)	O
;	O
}	O
if	O
(	O
LF_ISSET	O
(	O
DB_MPOOL_DIRTY	int
)	O
&&	O
!	O
F_ISSET	O
(	O
bhp	pointer
,	O
BH_DIRTY	int
)	O
)	O
{	O
--	O
c_mp	pointer
->	O
stat	pointer
.	O
st_page_clean	int
;	O
++	O
c_mp	pointer
->	O
stat	pointer
.	O
st_page_dirty	int
;	O
F_SET	O
(	O
bhp	pointer
,	O
BH_DIRTY	int
)	O
;	O
}	O
if	O
(	O
LF_ISSET	O
(	O
DB_MPOOL_DISCARD	int
)	O
)	O
F_SET	O
(	O
bhp	pointer
,	O
BH_DISCARD	int
)	O
;	O
R_UNLOCK	O
(	O
dbenv	pointer
,	O
dbmp	pointer
->	O
reginfo	pointer
)	O
;	O
return	O
(	O
0	int
)	O
;	O
}	O
