static	O
TOPSF	struct
*	O
gl_topsf	pointer
;	O
static	O
void	O
sig_usr	function
(	O
int	O
signo	int
)	O
;	O
static	O
void	O
usage	function
(	O
char	O
*	O
progname	pointer
)	O
;	O
YYSTYPE	union
yylval	union
;	O
int	O
yydebug	int
=	O
0	int
;	O
int	O
swlex_definition_file	int
=	O
SW_PSF	int
;	O
int	O
main	function
(	O
int	O
argc	pointer
,	O
char	O
*	O
*	O
argv	pointer
)	O
{	O
int	O
nfd	int
;	O
TOPSF	struct
*	O
topsf	pointer
;	O
int	O
ret	int
;	O
int	O
c	int
=	O
0	int
;	O
int	O
with_archive	int
=	O
0	int
;	O
char	O
*	O
progname	pointer
;	O
progname	pointer
=	O
argv	pointer
[	O
0	int
]	O
;	O
yylval	union
.	O
strb	pointer
=	O
strob_open	function
(	O
8	int
)	O
;	O
strcpy	function
(	O
swlex_filename	array
,	O
"none"	pointer
)	O
;	O
while	O
(	O
1	int
)	O
{	O
int	O
option_index	int
=	O
0	int
;	O
static	O
struct	O
option	struct
long_options	array
[	O
]	O
=	O
{	O
{	O
"with-archive"	pointer
,	O
0	int
,	O
0	int
,	O
'a'	O
}	O
,	O
{	O
"help"	pointer
,	O
0	int
,	O
0	int
,	O
132	int
}	O
,	O
{	O
0	int
,	O
0	int
,	O
0	int
,	O
0	int
}	O
}	O
;	O
c	int
=	O
ugetopt_long	function
(	O
argc	pointer
,	O
argv	pointer
,	O
"a"	pointer
,	O
long_options	array
,	O
&	O
option_index	int
)	O
;	O
if	O
(	O
c	int
==	O
-	O
1	int
)	O
break	O
;	O
switch	O
(	O
c	int
)	O
{	O
case	O
'a'	O
:	O
with_archive	int
=	O
1	int
;	O
break	O
;	O
case	O
132	int
:	O
usage	function
(	O
progname	pointer
)	O
;	O
fprintf	function
(	O
stderr	pointer
,	O
"%s reads a RPM and writes a PSF file (defined in Posix 7.2) to stdout.\n"	pointer
"The -a option causes the PSF and the distribution files referenced by the\n"	pointer
"PSF to be written as a cpio archive to stdout.\nend of help.\n"	pointer
,	O
progname	pointer
)	O
;	O
exit	function
(	O
0	int
)	O
;	O
break	O
;	O
default	O
:	O
usage	function
(	O
progname	pointer
)	O
;	O
exit	function
(	O
1	int
)	O
;	O
break	O
;	O
}	O
}	O
if	O
(	O
optind	int
<	O
argc	pointer
)	O
{	O
topsf	pointer
=	O
topsf_open	function
(	O
argv	pointer
[	O
optind	int
]	O
,	O
UINFILE_UXFIO_BUFTYPE_DYNAMIC_MEM	O
,	O
NULL	O
)	O
;	O
}	O
else	O
{	O
topsf	pointer
=	O
topsf_open	function
(	O
"-"	pointer
,	O
UINFILE_UXFIO_BUFTYPE_DYNAMIC_MEM	O
,	O
NULL	O
)	O
;	O
}	O
if	O
(	O
!	O
topsf	pointer
)	O
{	O
exit	function
(	O
1	int
)	O
;	O
}	O
gl_topsf	pointer
=	O
topsf	pointer
;	O
signal	function
(	O
SIGPIPE	int
,	O
sig_usr	function
)	O
;	O
topsf_set_cwd_prefix	function
(	O
topsf	pointer
,	O
rpmpsf_make_package_prefix	function
(	O
topsf	pointer
,	O
""	pointer
)	O
)	O
;	O
if	O
(	O
with_archive	int
)	O
{	O
nfd	int
=	O
open	function
(	O
"/dev/null"	pointer
,	O
O_RDWR	int
)	O
;	O
rpmpsf_write_psf	function
(	O
topsf	pointer
,	O
nfd	int
)	O
;	O
}	O
else	O
{	O
rpmpsf_write_beautify_psf	function
(	O
topsf	pointer
,	O
STDOUT_FILENO	int
)	O
;	O
topsf_close	function
(	O
topsf	pointer
)	O
;	O
exit	function
(	O
0	int
)	O
;	O
}	O
ret	int
=	O
topsf_copypass_swacfl_list	function
(	O
topsf	pointer
,	O
STDOUT_FILENO	int
)	O
;	O
signal	function
(	O
SIGPIPE	int
,	O
SIG_IGN	O
)	O
;	O
topsf_close	function
(	O
topsf	pointer
)	O
;	O
exit	function
(	O
ret	int
)	O
;	O
}	O
static	O
void	O
sig_usr	function
(	O
int	O
signo	int
)	O
{	O
if	O
(	O
signo	int
==	O
SIGPIPE	int
)	O
{	O
topsf_close	function
(	O
gl_topsf	pointer
)	O
;	O
exit	function
(	O
0	int
)	O
;	O
}	O
exit	function
(	O
1	int
)	O
;	O
}	O
static	O
void	O
usage	function
(	O
char	O
*	O
progname	pointer
)	O
{	O
fprintf	function
(	O
stderr	pointer
,	O
"Usage: %s [-a, --with-archive] [--help] [file]\n"	pointer
,	O
progname	pointer
)	O
;	O
}	O
