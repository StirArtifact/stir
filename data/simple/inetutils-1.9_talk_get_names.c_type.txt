char	O
*	O
getlogin	function
(	O
void	O
)	O
;	O
char	O
*	O
ttyname	function
(	O
int	O
)	O
;	O
extern	O
CTL_MSG	struct
msg	struct
;	O
int	O
get_names	function
(	O
int	O
argc	int
,	O
char	O
*	O
argv	array
[	O
]	O
)	O
{	O
char	O
*	O
his_name	pointer
,	O
*	O
my_name	pointer
;	O
char	O
*	O
my_machine_name	pointer
,	O
*	O
his_machine_name	pointer
;	O
char	O
*	O
his_tty	pointer
;	O
register	O
char	O
*	O
cp	pointer
;	O
if	O
(	O
(	O
my_name	pointer
=	O
getlogin	function
(	O
)	O
)	O
==	O
NULL	O
)	O
{	O
struct	O
passwd	struct
*	O
pw	pointer
;	O
if	O
(	O
(	O
pw	pointer
=	O
getpwuid	function
(	O
getuid	function
(	O
)	O
)	O
)	O
==	O
NULL	O
)	O
{	O
printf	function
(	O
"You don't exist. Go away.\n"	pointer
)	O
;	O
exit	function
(	O
-	O
1	int
)	O
;	O
}	O
my_name	pointer
=	O
pw	pointer
->	O
pw_name	pointer
;	O
}	O
my_machine_name	pointer
=	O
localhost	function
(	O
)	O
;	O
if	O
(	O
!	O
my_machine_name	pointer
)	O
{	O
perror	function
(	O
"Cannot get local hostname"	pointer
)	O
;	O
exit	function
(	O
-	O
1	int
)	O
;	O
}	O
for	O
(	O
cp	pointer
=	O
argv	array
[	O
0	int
]	O
;	O
*	O
cp	pointer
&&	O
!	O
strchr	function
(	O
"@:!."	pointer
,	O
*	O
cp	pointer
)	O
;	O
cp	pointer
++	O
)	O
;	O
if	O
(	O
*	O
cp	pointer
==	O
'\0'	O
)	O
{	O
his_name	pointer
=	O
argv	array
[	O
0	int
]	O
;	O
his_machine_name	pointer
=	O
my_machine_name	pointer
;	O
}	O
else	O
{	O
if	O
(	O
*	O
cp	pointer
++	O
==	O
'@'	O
)	O
{	O
his_name	pointer
=	O
argv	array
[	O
0	int
]	O
;	O
his_machine_name	pointer
=	O
cp	pointer
;	O
}	O
else	O
{	O
his_name	pointer
=	O
cp	pointer
;	O
his_machine_name	pointer
=	O
argv	array
[	O
0	int
]	O
;	O
}	O
*	O
--	O
cp	pointer
=	O
'\0'	O
;	O
}	O
if	O
(	O
argc	int
>	O
1	int
)	O
his_tty	pointer
=	O
argv	array
[	O
1	int
]	O
;	O
else	O
his_tty	pointer
=	O
""	pointer
;	O
get_addrs	function
(	O
my_machine_name	pointer
,	O
his_machine_name	pointer
)	O
;	O
msg	struct
.	O
vers	char
=	O
TALK_VERSION	int
;	O
msg	struct
.	O
addr	struct
.	O
sa_family	short
=	O
htons	function
(	O
AF_INET	O
)	O
;	O
msg	struct
.	O
ctl_addr	struct
.	O
sa_family	short
=	O
htons	function
(	O
AF_INET	O
)	O
;	O
msg	struct
.	O
id_num	int
=	O
htonl	function
(	O
0	int
)	O
;	O
strncpy	function
(	O
msg	struct
.	O
l_name	array
,	O
my_name	pointer
,	O
NAME_SIZE	int
)	O
;	O
msg	struct
.	O
l_name	array
[	O
NAME_SIZE	int
-	O
1	int
]	O
=	O
'\0'	O
;	O
strncpy	function
(	O
msg	struct
.	O
r_name	array
,	O
his_name	pointer
,	O
NAME_SIZE	int
)	O
;	O
msg	struct
.	O
r_name	array
[	O
NAME_SIZE	int
-	O
1	int
]	O
=	O
'\0'	O
;	O
strncpy	function
(	O
msg	struct
.	O
r_tty	array
,	O
his_tty	pointer
,	O
TTY_SIZE	int
)	O
;	O
msg	struct
.	O
r_tty	array
[	O
TTY_SIZE	int
-	O
1	int
]	O
=	O
'\0'	O
;	O
free	function
(	O
my_machine_name	pointer
)	O
;	O
return	O
0	int
;	O
}	O
