int	O
to_fig	function
(	O
const	O
GEN_PAR	struct
*	O
pg	pointer
,	O
const	O
OUT_PAR	struct
*	O
po	pointer
)	O
{	O
PlotCmd	enum
cmd	enum
;	O
HPGL_Pt	struct
pt1	struct
;	O
float	O
xcoord2mm	float
,	O
ycoord2mm	float
;	O
FILE	struct
*	O
md	pointer
=	O
NULL	O
;	O
int	O
pen_no	int
;	O
PEN_W	float
pensize	float
;	O
int	O
err	int
=	O
0	int
,	O
figmode	int
,	O
colour	int
;	O
int	O
captype	int
=	O
1	int
;	O
int	O
jointype	int
=	O
1	int
;	O
int	O
i	int
;	O
char	O
*	O
ftype	pointer
=	O
""	pointer
;	O
int	O
npoints	int
=	O
0	int
;	O
long	O
x	int
[	O
MAX_FIG_POINTS	int
]	O
,	O
y	int
[	O
MAX_FIG_POINTS	int
]	O
;	O
if	O
(	O
*	O
po	pointer
->	O
outfile	pointer
!=	O
'-'	O
)	O
{	O
if	O
(	O
(	O
md	pointer
=	O
fopen	function
(	O
po	pointer
->	O
outfile	pointer
,	O
"w"	pointer
)	O
)	O
==	O
NULL	O
)	O
{	O
PError	function
(	O
"hp2xx (mf/tex)"	pointer
)	O
;	O
err	int
=	O
ERROR	O
;	O
goto	O
FIG_exit	O
;	O
}	O
}	O
else	O
{	O
md	pointer
=	O
stdout	pointer
;	O
}	O
if	O
(	O
!	O
pg	pointer
->	O
quiet	int
)	O
Eprintf	function
(	O
"\n\n- Writing %s code to \"%s\"\n"	pointer
,	O
ftype	pointer
,	O
*	O
po	pointer
->	O
outfile	pointer
==	O
'-'	O
?	O
"stdout"	pointer
:	O
po	pointer
->	O
outfile	pointer
)	O
;	O
fprintf	function
(	O
md	pointer
,	O
"#FIG 3.2\n"	pointer
)	O
;	O
fprintf	function
(	O
md	pointer
,	O
"Landscape\nCenter\nInches\nA4\n100 100\nSingle\n-1\n"	pointer
)	O
;	O
fprintf	function
(	O
md	pointer
,	O
"1200 2\n"	pointer
)	O
;	O
for	O
(	O
i	int
=	O
0	int
;	O
i	int
<	O
8	int
;	O
++	O
i	int
)	O
fprintf	function
(	O
md	pointer
,	O
"0 %d #%2.2X%2.2X%2.2X\n"	pointer
,	O
32	int
+	O
i	int
,	O
pt	struct
.	O
clut	array
[	O
i	int
]	O
[	O
0	int
]	O
,	O
pt	struct
.	O
clut	array
[	O
i	int
]	O
[	O
1	int
]	O
,	O
pt	struct
.	O
clut	array
[	O
i	int
]	O
[	O
2	int
]	O
)	O
;	O
pen_no	int
=	O
DEFAULT_PEN_NO	int
;	O
pensize	float
=	O
pt	struct
.	O
width	array
[	O
pen_no	int
]	O
;	O
if	O
(	O
pensize	float
>=	O
MM_PER_DISPLAY_UNIT	int
/	O
10	int
)	O
{	O
if	O
(	O
pg	pointer
->	O
is_color	int
)	O
colour	int
=	O
32	int
+	O
pt	struct
.	O
color	array
[	O
pen_no	int
]	O
;	O
else	O
colour	int
=	O
-	O
1	int
;	O
}	O
else	O
{	O
if	O
(	O
!	O
pg	pointer
->	O
quiet	int
)	O
fprintf	function
(	O
stderr	pointer
,	O
"suppressing very thin line\n"	pointer
)	O
;	O
colour	int
=	O
7	int
;	O
}	O
xcoord2mm	float
=	O
(	O
1200.0	int
/	O
25.4	int
)	O
*	O
po	pointer
->	O
width	array
/	O
(	O
po	pointer
->	O
xmax	double
-	O
po	pointer
->	O
xmin	double
)	O
;	O
ycoord2mm	float
=	O
(	O
1200.0	int
/	O
25.4	int
)	O
*	O
po	pointer
->	O
height	double
/	O
(	O
po	pointer
->	O
ymax	double
-	O
po	pointer
->	O
ymin	double
)	O
;	O
figmode	int
=	O
FIG_NONE	int
;	O
while	O
(	O
(	O
cmd	enum
=	O
PlotCmd_from_tmpfile	function
(	O
)	O
)	O
!=	O
CMD_EOF	int
)	O
switch	O
(	O
cmd	enum
)	O
{	O
case	O
NOP	int
:	O
break	O
;	O
case	O
SET_PEN	int
:	O
if	O
(	O
(	O
pen_no	int
=	O
fgetc	function
(	O
pg	pointer
->	O
td	pointer
)	O
)	O
==	O
EOF	O
)	O
{	O
PError	function
(	O
"Unexpected end of temp. file: "	pointer
)	O
;	O
err	int
=	O
ERROR	O
;	O
goto	O
FIG_exit	O
;	O
}	O
if	O
(	O
figmode	int
==	O
FIG_PLOT	int
)	O
{	O
fig_poly_end	function
(	O
pensize	float
,	O
colour	int
,	O
jointype	int
,	O
captype	int
,	O
md	pointer
,	O
npoints	int
,	O
x	int
,	O
y	int
)	O
;	O
npoints	int
=	O
0	int
;	O
}	O
pensize	float
=	O
pt	struct
.	O
width	array
[	O
pen_no	int
]	O
;	O
if	O
(	O
pensize	float
<	O
MM_PER_DISPLAY_UNIT	int
/	O
10	int
)	O
{	O
colour	int
=	O
7	int
;	O
if	O
(	O
!	O
pg	pointer
->	O
quiet	int
)	O
fprintf	function
(	O
stderr	pointer
,	O
"suppressing very thin line\n"	pointer
)	O
;	O
}	O
else	O
{	O
if	O
(	O
pg	pointer
->	O
is_color	int
)	O
colour	int
=	O
32	int
+	O
pt	struct
.	O
color	array
[	O
pen_no	int
]	O
;	O
else	O
colour	int
=	O
-	O
1	int
;	O
}	O
if	O
(	O
figmode	int
!=	O
FIG_MOVE	int
)	O
figmode	int
=	O
FIG_NONE	int
;	O
break	O
;	O
case	O
DEF_PW	int
:	O
if	O
(	O
!	O
load_pen_width_table	function
(	O
pg	pointer
->	O
td	pointer
)	O
)	O
{	O
PError	function
(	O
"Unexpected end of temp. file"	pointer
)	O
;	O
err	int
=	O
ERROR	O
;	O
goto	O
FIG_exit	O
;	O
}	O
pensize	float
=	O
pt	struct
.	O
width	array
[	O
pen_no	int
]	O
;	O
break	O
;	O
case	O
DEF_PC	int
:	O
if	O
(	O
!	O
load_pen_color_table	function
(	O
pg	pointer
->	O
td	pointer
)	O
)	O
{	O
PError	function
(	O
"Unexpected end of temp. file"	pointer
)	O
;	O
err	int
=	O
ERROR	O
;	O
goto	O
FIG_exit	O
;	O
}	O
if	O
(	O
pg	pointer
->	O
is_color	int
)	O
colour	int
=	O
32	int
+	O
pt	struct
.	O
color	array
[	O
pen_no	int
]	O
;	O
else	O
colour	int
=	O
-	O
1	int
;	O
break	O
;	O
case	O
DEF_LA	int
:	O
if	O
(	O
load_line_attr	function
(	O
pg	pointer
->	O
td	pointer
)	O
<	O
0	int
)	O
{	O
PError	function
(	O
"Unexpected end of temp. file"	pointer
)	O
;	O
err	int
=	O
ERROR	O
;	O
goto	O
FIG_exit	O
;	O
}	O
captype	int
=	O
1	int
;	O
jointype	int
=	O
1	int
;	O
if	O
(	O
pensize	float
>	O
0.35	int
)	O
{	O
switch	O
(	O
CurrentLineAttr	struct
.	O
End	enum
)	O
{	O
case	O
LAE_butt	int
:	O
captype	int
=	O
0	int
;	O
break	O
;	O
case	O
LAE_round	int
:	O
captype	int
=	O
2	int
;	O
break	O
;	O
default	O
:	O
captype	int
=	O
0	int
;	O
break	O
;	O
}	O
switch	O
(	O
CurrentLineAttr	struct
.	O
Join	enum
)	O
{	O
case	O
LAJ_plain_miter	int
:	O
case	O
LAJ_bevel_miter	int
:	O
jointype	int
=	O
0	int
;	O
break	O
;	O
case	O
LAJ_bevelled	int
:	O
jointype	int
=	O
2	int
;	O
break	O
;	O
default	O
:	O
jointype	int
=	O
1	int
;	O
break	O
;	O
}	O
}	O
break	O
;	O
case	O
MOVE_TO	int
:	O
HPGL_Pt_from_tmpfile	function
(	O
&	O
pt1	struct
)	O
;	O
if	O
(	O
figmode	int
==	O
FIG_PLOT	int
)	O
{	O
fig_poly_end	function
(	O
pensize	float
,	O
colour	int
,	O
jointype	int
,	O
captype	int
,	O
md	pointer
,	O
npoints	int
,	O
x	int
,	O
y	int
)	O
;	O
npoints	int
=	O
0	int
;	O
}	O
figmode	int
=	O
FIG_MOVE	int
;	O
break	O
;	O
case	O
DRAW_TO	int
:	O
if	O
(	O
figmode	int
==	O
FIG_NONE	int
)	O
{	O
PError	function
(	O
"No currentpoint in draw from: "	pointer
)	O
;	O
err	int
=	O
ERROR	O
;	O
goto	O
FIG_exit	O
;	O
}	O
else	O
if	O
(	O
figmode	int
==	O
FIG_MOVE	int
)	O
{	O
x	int
[	O
0	int
]	O
=	O
(	O
int	O
)	O
(	O
(	O
pt1	struct
.	O
x	int
-	O
po	pointer
->	O
xmin	double
)	O
*	O
xcoord2mm	float
)	O
;	O
y	int
[	O
0	int
]	O
=	O
(	O
int	O
)	O
(	O
(	O
po	pointer
->	O
ymax	double
-	O
pt1	struct
.	O
y	int
)	O
*	O
ycoord2mm	float
)	O
;	O
npoints	int
=	O
1	int
;	O
}	O
HPGL_Pt_from_tmpfile	function
(	O
&	O
pt1	struct
)	O
;	O
x	int
[	O
npoints	int
]	O
=	O
(	O
int	O
)	O
(	O
(	O
pt1	struct
.	O
x	int
-	O
po	pointer
->	O
xmin	double
)	O
*	O
xcoord2mm	float
)	O
;	O
y	int
[	O
npoints	int
]	O
=	O
(	O
int	O
)	O
(	O
(	O
po	pointer
->	O
ymax	double
-	O
pt1	struct
.	O
y	int
)	O
*	O
ycoord2mm	float
)	O
;	O
npoints	int
++	O
;	O
if	O
(	O
npoints	int
==	O
MAX_FIG_POINTS	int
)	O
{	O
fig_poly_end	function
(	O
pensize	float
,	O
colour	int
,	O
jointype	int
,	O
captype	int
,	O
md	pointer
,	O
npoints	int
,	O
x	int
,	O
y	int
)	O
;	O
npoints	int
=	O
0	int
;	O
}	O
figmode	int
=	O
FIG_PLOT	int
;	O
break	O
;	O
case	O
PLOT_AT	int
:	O
HPGL_Pt_from_tmpfile	function
(	O
&	O
pt1	struct
)	O
;	O
if	O
(	O
figmode	int
==	O
FIG_PLOT	int
)	O
{	O
fig_poly_end	function
(	O
pensize	float
,	O
colour	int
,	O
jointype	int
,	O
captype	int
,	O
md	pointer
,	O
npoints	int
,	O
x	int
,	O
y	int
)	O
;	O
npoints	int
=	O
0	int
;	O
}	O
x	int
[	O
0	int
]	O
=	O
(	O
int	O
)	O
(	O
(	O
pt1	struct
.	O
x	int
-	O
po	pointer
->	O
xmin	double
)	O
*	O
xcoord2mm	float
)	O
;	O
y	int
[	O
0	int
]	O
=	O
(	O
int	O
)	O
(	O
(	O
po	pointer
->	O
ymax	double
-	O
pt1	struct
.	O
y	int
)	O
*	O
ycoord2mm	float
)	O
;	O
npoints	int
=	O
1	int
;	O
fig_poly_end	function
(	O
pensize	float
,	O
colour	int
,	O
jointype	int
,	O
captype	int
,	O
md	pointer
,	O
npoints	int
,	O
x	int
,	O
y	int
)	O
;	O
figmode	int
=	O
FIG_MOVE	int
;	O
break	O
;	O
default	O
:	O
Eprintf	function
(	O
"Illegal cmd in temp. file!"	pointer
)	O
;	O
err	int
=	O
ERROR	O
;	O
goto	O
FIG_exit	O
;	O
}	O
if	O
(	O
figmode	int
==	O
FIG_PLOT	int
)	O
{	O
fig_poly_end	function
(	O
pensize	float
,	O
colour	int
,	O
jointype	int
,	O
captype	int
,	O
md	pointer
,	O
npoints	int
,	O
x	int
,	O
y	int
)	O
;	O
npoints	int
=	O
0	int
;	O
}	O
FIG_exit	O
:	O
if	O
(	O
md	pointer
!=	O
stdout	pointer
&&	O
md	pointer
!=	O
NULL	O
)	O
fclose	function
(	O
md	pointer
)	O
;	O
if	O
(	O
!	O
pg	pointer
->	O
quiet	int
)	O
Eprintf	function
(	O
"\n"	pointer
)	O
;	O
return	O
err	int
;	O
}	O
void	O
fig_poly_end	function
(	O
PEN_W	float
pensize	float
,	O
int	O
colour	int
,	O
int	O
jointype	int
,	O
int	O
captype	int
,	O
FILE	struct
*	O
md	pointer
,	O
int	O
npoints	int
,	O
long	O
*	O
x	int
,	O
long	O
*	O
y	int
)	O
{	O
int	O
i	int
,	O
j	int
;	O
int	O
units	int
;	O
units	int
=	O
(	O
int	O
)	O
ceil	function
(	O
pensize	float
/	O
MM_PER_DISPLAY_UNIT	int
)	O
;	O
fprintf	function
(	O
md	pointer
,	O
"2 1 0 %d %d %d 0 0 -1 0.000 %d %d 0 0 0 %d\n"	pointer
,	O
units	int
,	O
colour	int
,	O
colour	int
,	O
jointype	int
,	O
captype	int
,	O
npoints	int
)	O
;	O
j	int
=	O
0	int
;	O
for	O
(	O
i	int
=	O
0	int
;	O
i	int
<	O
npoints	int
;	O
i	int
++	O
)	O
{	O
fprintf	function
(	O
md	pointer
,	O
" %ld %ld"	pointer
,	O
x	int
[	O
i	int
]	O
,	O
y	int
[	O
i	int
]	O
)	O
;	O
if	O
(	O
++	O
j	int
>	O
10	int
)	O
{	O
fprintf	function
(	O
md	pointer
,	O
"\n"	pointer
)	O
;	O
j	int
=	O
0	int
;	O
}	O
}	O
if	O
(	O
j	int
!=	O
0	int
)	O
fprintf	function
(	O
md	pointer
,	O
"\n"	pointer
)	O
;	O
}	O
