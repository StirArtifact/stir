const	O
char	O
zip_copyright	array
[	O
]	O
=	O
" zip 0.15 Copyright 1998 Gilles Vollant "	pointer
;	O
typedef	O
struct	O
linkedlist_datablock_internal_s	struct
{	O
struct	O
linkedlist_datablock_internal_s	struct
*	O
next_datablock	pointer
;	O
uLong	long
avail_in_this_block	long
;	O
uLong	long
filled_in_this_block	long
;	O
uLong	long
unused	long
;	O
unsigned	O
char	O
data	array
[	O
SIZEDATA_INDATABLOCK	O
]	O
;	O
}	O
linkedlist_datablock_internal	struct
;	O
typedef	O
struct	O
linkedlist_data_s	struct
{	O
linkedlist_datablock_internal	struct
*	O
first_block	pointer
;	O
linkedlist_datablock_internal	struct
*	O
last_block	pointer
;	O
}	O
linkedlist_data	struct
;	O
typedef	O
struct	O
{	O
z_stream	struct
stream	struct
;	O
int	O
stream_initialised	int
;	O
uInt	int
pos_in_buffered_data	int
;	O
uLong	long
pos_local_header	long
;	O
char	O
*	O
central_header	pointer
;	O
uLong	long
size_centralheader	long
;	O
uLong	long
flag	long
;	O
int	O
method	int
;	O
Byte	char
buffered_data	array
[	O
Z_BUFSIZE	O
]	O
;	O
uLong	long
dosDate	long
;	O
uLong	long
crc32	function
;	O
}	O
curfile_info	struct
;	O
typedef	O
struct	O
{	O
FILE	struct
*	O
filezip	pointer
;	O
linkedlist_data	struct
central_dir	struct
;	O
int	O
in_opened_file_inzip	int
;	O
curfile_info	struct
ci	struct
;	O
uLong	long
begin_pos	long
;	O
uLong	long
number_entry	long
;	O
}	O
zip_internal	struct
;	O
local	O
linkedlist_datablock_internal	struct
*	O
allocate_new_datablock	function
(	O
)	O
{	O
linkedlist_datablock_internal	struct
*	O
ldi	pointer
;	O
ldi	pointer
=	O
(	O
linkedlist_datablock_internal	struct
*	O
)	O
ALLOC	O
(	O
sizeof	O
(	O
linkedlist_datablock_internal	struct
)	O
)	O
;	O
if	O
(	O
ldi	pointer
!=	O
NULL	O
)	O
{	O
ldi	pointer
->	O
next_datablock	pointer
=	O
NULL	O
;	O
ldi	pointer
->	O
filled_in_this_block	long
=	O
0	int
;	O
ldi	pointer
->	O
avail_in_this_block	long
=	O
SIZEDATA_INDATABLOCK	O
;	O
}	O
return	O
ldi	pointer
;	O
}	O
local	O
void	O
free_datablock	function
(	O
ldi	pointer
)	O
linkedlist_datablock_internal	struct
*	O
ldi	pointer
;	O
{	O
while	O
(	O
ldi	pointer
!=	O
NULL	O
)	O
{	O
linkedlist_datablock_internal	struct
*	O
ldinext	pointer
=	O
ldi	pointer
->	O
next_datablock	pointer
;	O
TRYFREE	O
(	O
ldi	pointer
)	O
;	O
ldi	pointer
=	O
ldinext	pointer
;	O
}	O
}	O
local	O
void	O
init_linkedlist	function
(	O
ll	pointer
)	O
linkedlist_data	struct
*	O
ll	pointer
;	O
{	O
ll	pointer
->	O
first_block	pointer
=	O
ll	pointer
->	O
last_block	pointer
=	O
NULL	O
;	O
}	O
local	O
void	O
free_linkedlist	function
(	O
ll	pointer
)	O
linkedlist_data	struct
*	O
ll	pointer
;	O
{	O
free_datablock	function
(	O
ll	pointer
->	O
first_block	pointer
)	O
;	O
ll	pointer
->	O
first_block	pointer
=	O
ll	pointer
->	O
last_block	pointer
=	O
NULL	O
;	O
}	O
local	O
int	O
add_data_in_datablock	function
(	O
ll	pointer
,	O
buf	pointer
,	O
len	int
)	O
linkedlist_data	struct
*	O
ll	pointer
;	O
const	O
void	O
*	O
buf	pointer
;	O
uLong	long
len	int
;	O
{	O
linkedlist_datablock_internal	struct
*	O
ldi	pointer
;	O
const	O
unsigned	O
char	O
*	O
from_copy	pointer
;	O
if	O
(	O
ll	pointer
==	O
NULL	O
)	O
return	O
ZIP_INTERNALERROR	O
;	O
if	O
(	O
ll	pointer
->	O
last_block	pointer
==	O
NULL	O
)	O
{	O
ll	pointer
->	O
first_block	pointer
=	O
ll	pointer
->	O
last_block	pointer
=	O
allocate_new_datablock	function
(	O
)	O
;	O
if	O
(	O
ll	pointer
->	O
first_block	pointer
==	O
NULL	O
)	O
return	O
ZIP_INTERNALERROR	O
;	O
}	O
ldi	pointer
=	O
ll	pointer
->	O
last_block	pointer
;	O
from_copy	pointer
=	O
(	O
unsigned	O
char	O
*	O
)	O
buf	pointer
;	O
while	O
(	O
len	int
>	O
0	int
)	O
{	O
uInt	int
copy_this	int
;	O
uInt	int
i	int
;	O
unsigned	O
char	O
*	O
to_copy	pointer
;	O
if	O
(	O
ldi	pointer
->	O
avail_in_this_block	long
==	O
0	int
)	O
{	O
ldi	pointer
->	O
next_datablock	pointer
=	O
allocate_new_datablock	function
(	O
)	O
;	O
if	O
(	O
ldi	pointer
->	O
next_datablock	pointer
==	O
NULL	O
)	O
return	O
ZIP_INTERNALERROR	O
;	O
ldi	pointer
=	O
ldi	pointer
->	O
next_datablock	pointer
;	O
ll	pointer
->	O
last_block	pointer
=	O
ldi	pointer
;	O
}	O
if	O
(	O
ldi	pointer
->	O
avail_in_this_block	long
<	O
len	int
)	O
copy_this	int
=	O
(	O
uInt	int
)	O
ldi	pointer
->	O
avail_in_this_block	long
;	O
else	O
copy_this	int
=	O
(	O
uInt	int
)	O
len	int
;	O
to_copy	pointer
=	O
&	O
(	O
ldi	pointer
->	O
data	array
[	O
ldi	pointer
->	O
filled_in_this_block	long
]	O
)	O
;	O
for	O
(	O
i	int
=	O
0	int
;	O
i	int
<	O
copy_this	int
;	O
i	int
++	O
)	O
*	O
(	O
to_copy	pointer
+	O
i	int
)	O
=	O
*	O
(	O
from_copy	pointer
+	O
i	int
)	O
;	O
ldi	pointer
->	O
filled_in_this_block	long
+=	O
copy_this	int
;	O
ldi	pointer
->	O
avail_in_this_block	long
-=	O
copy_this	int
;	O
from_copy	pointer
+=	O
copy_this	int
;	O
len	int
-=	O
copy_this	int
;	O
}	O
return	O
ZIP_OK	O
;	O
}	O
local	O
int	O
write_datablock	function
(	O
fout	pointer
,	O
ll	pointer
)	O
FILE	struct
*	O
fout	pointer
;	O
linkedlist_data	struct
*	O
ll	pointer
;	O
{	O
linkedlist_datablock_internal	struct
*	O
ldi	pointer
;	O
ldi	pointer
=	O
ll	pointer
->	O
first_block	pointer
;	O
while	O
(	O
ldi	pointer
!=	O
NULL	O
)	O
{	O
if	O
(	O
ldi	pointer
->	O
filled_in_this_block	long
>	O
0	int
)	O
if	O
(	O
fwrite	function
(	O
ldi	pointer
->	O
data	array
,	O
(	O
uInt	int
)	O
ldi	pointer
->	O
filled_in_this_block	long
,	O
1	int
,	O
fout	pointer
)	O
!=	O
1	int
)	O
return	O
ZIP_ERRNO	O
;	O
ldi	pointer
=	O
ldi	pointer
->	O
next_datablock	pointer
;	O
}	O
return	O
ZIP_OK	O
;	O
}	O
local	O
int	O
ziplocal_putValue	function
OF	O
(	O
(	O
FILE	struct
*	O
file	pointer
,	O
uLong	long
x	long
,	O
int	O
nbByte	int
)	O
)	O
;	O
local	O
int	O
ziplocal_putValue	function
(	O
file	pointer
,	O
x	long
,	O
nbByte	int
)	O
FILE	struct
*	O
file	pointer
;	O
uLong	long
x	long
;	O
int	O
nbByte	int
;	O
{	O
unsigned	O
char	O
buf	pointer
[	O
4	int
]	O
;	O
int	O
n	int
;	O
for	O
(	O
n	int
=	O
0	int
;	O
n	int
<	O
nbByte	int
;	O
n	int
++	O
)	O
{	O
buf	pointer
[	O
n	int
]	O
=	O
(	O
unsigned	O
char	O
)	O
(	O
x	long
&	O
0xff	int
)	O
;	O
x	long
>>=	O
8	int
;	O
}	O
if	O
(	O
fwrite	function
(	O
buf	pointer
,	O
nbByte	int
,	O
1	int
,	O
file	pointer
)	O
!=	O
1	int
)	O
return	O
ZIP_ERRNO	O
;	O
else	O
return	O
ZIP_OK	O
;	O
}	O
local	O
void	O
ziplocal_putValue_inmemory	function
OF	O
(	O
(	O
void	O
*	O
dest	pointer
,	O
uLong	long
x	long
,	O
int	O
nbByte	int
)	O
)	O
;	O
local	O
void	O
ziplocal_putValue_inmemory	function
(	O
dest	pointer
,	O
x	long
,	O
nbByte	int
)	O
void	O
*	O
dest	pointer
;	O
uLong	long
x	long
;	O
int	O
nbByte	int
;	O
{	O
unsigned	O
char	O
*	O
buf	pointer
=	O
(	O
unsigned	O
char	O
*	O
)	O
dest	pointer
;	O
int	O
n	int
;	O
for	O
(	O
n	int
=	O
0	int
;	O
n	int
<	O
nbByte	int
;	O
n	int
++	O
)	O
{	O
buf	pointer
[	O
n	int
]	O
=	O
(	O
unsigned	O
char	O
)	O
(	O
x	long
&	O
0xff	int
)	O
;	O
x	long
>>=	O
8	int
;	O
}	O
}	O
local	O
uLong	long
ziplocal_TmzDateToDosDate	function
(	O
ptm	pointer
,	O
dosDate	long
)	O
tm_zip	struct
*	O
ptm	pointer
;	O
uLong	long
dosDate	long
;	O
{	O
uLong	long
year	long
=	O
(	O
uLong	long
)	O
ptm	pointer
->	O
tm_year	int
;	O
if	O
(	O
year	long
>	O
1980	int
)	O
year	long
-=	O
1980	int
;	O
else	O
if	O
(	O
year	long
>	O
80	int
)	O
year	long
-=	O
80	int
;	O
return	O
(	O
uLong	long
)	O
(	O
(	O
(	O
ptm	pointer
->	O
tm_mday	int
)	O
+	O
(	O
32	int
*	O
(	O
ptm	pointer
->	O
tm_mon	int
+	O
1	int
)	O
)	O
+	O
(	O
512	int
*	O
year	long
)	O
)	O
<<	O
16	int
)	O
|	O
(	O
(	O
ptm	pointer
->	O
tm_sec	int
/	O
2	int
)	O
+	O
(	O
32	int
*	O
ptm	pointer
->	O
tm_min	int
)	O
+	O
(	O
2048	int
*	O
(	O
uLong	long
)	O
ptm	pointer
->	O
tm_hour	int
)	O
)	O
;	O
}	O
extern	O
zipFile	pointer
ZEXPORT	O
zipOpen	function
(	O
pathname	pointer
,	O
append	int
)	O
const	O
char	O
*	O
pathname	pointer
;	O
int	O
append	int
;	O
{	O
zip_internal	struct
ziinit	struct
;	O
zip_internal	struct
*	O
zi	pointer
;	O
ziinit	struct
.	O
filezip	pointer
=	O
fopen	function
(	O
pathname	pointer
,	O
(	O
append	int
==	O
0	int
)	O
?	O
"wb"	pointer
:	O
"ab"	pointer
)	O
;	O
if	O
(	O
ziinit	struct
.	O
filezip	pointer
==	O
NULL	O
)	O
return	O
NULL	O
;	O
ziinit	struct
.	O
begin_pos	long
=	O
ftell	function
(	O
ziinit	struct
.	O
filezip	pointer
)	O
;	O
ziinit	struct
.	O
in_opened_file_inzip	int
=	O
0	int
;	O
ziinit	struct
.	O
ci	struct
.	O
stream_initialised	int
=	O
0	int
;	O
ziinit	struct
.	O
number_entry	long
=	O
0	int
;	O
init_linkedlist	function
(	O
&	O
(	O
ziinit	struct
.	O
central_dir	struct
)	O
)	O
;	O
zi	pointer
=	O
(	O
zip_internal	struct
*	O
)	O
ALLOC	O
(	O
sizeof	O
(	O
zip_internal	struct
)	O
)	O
;	O
if	O
(	O
zi	pointer
==	O
NULL	O
)	O
{	O
fclose	function
(	O
ziinit	struct
.	O
filezip	pointer
)	O
;	O
return	O
NULL	O
;	O
}	O
*	O
zi	pointer
=	O
ziinit	struct
;	O
return	O
(	O
zipFile	pointer
)	O
zi	pointer
;	O
}	O
extern	O
int	O
ZEXPORT	O
zipOpenNewFileInZip	function
(	O
file	pointer
,	O
filename	pointer
,	O
zipfi	pointer
,	O
extrafield_local	pointer
,	O
size_extrafield_local	int
,	O
extrafield_global	pointer
,	O
size_extrafield_global	int
,	O
comment	pointer
,	O
method	int
,	O
level	int
)	O
zipFile	pointer
file	pointer
;	O
const	O
char	O
*	O
filename	pointer
;	O
const	O
zip_fileinfo	struct
*	O
zipfi	pointer
;	O
const	O
void	O
*	O
extrafield_local	pointer
;	O
uInt	int
size_extrafield_local	int
;	O
const	O
void	O
*	O
extrafield_global	pointer
;	O
uInt	int
size_extrafield_global	int
;	O
const	O
char	O
*	O
comment	pointer
;	O
int	O
method	int
;	O
int	O
level	int
;	O
{	O
zip_internal	struct
*	O
zi	pointer
;	O
uInt	int
size_filename	int
;	O
uInt	int
size_comment	int
;	O
uInt	int
i	int
;	O
int	O
err	int
=	O
ZIP_OK	O
;	O
if	O
(	O
file	pointer
==	O
NULL	O
)	O
return	O
ZIP_PARAMERROR	O
;	O
if	O
(	O
(	O
method	int
!=	O
0	int
)	O
&&	O
(	O
method	int
!=	O
Z_DEFLATED	int
)	O
)	O
return	O
ZIP_PARAMERROR	O
;	O
zi	pointer
=	O
(	O
zip_internal	struct
*	O
)	O
file	pointer
;	O
if	O
(	O
zi	pointer
->	O
in_opened_file_inzip	int
==	O
1	int
)	O
{	O
err	int
=	O
zipCloseFileInZip	function
(	O
file	pointer
)	O
;	O
if	O
(	O
err	int
!=	O
ZIP_OK	O
)	O
return	O
err	int
;	O
}	O
if	O
(	O
filename	pointer
==	O
NULL	O
)	O
filename	pointer
=	O
"-"	pointer
;	O
if	O
(	O
comment	pointer
==	O
NULL	O
)	O
size_comment	int
=	O
0	int
;	O
else	O
size_comment	int
=	O
strlen	function
(	O
comment	pointer
)	O
;	O
size_filename	int
=	O
strlen	function
(	O
filename	pointer
)	O
;	O
if	O
(	O
zipfi	pointer
==	O
NULL	O
)	O
zi	pointer
->	O
ci	struct
.	O
dosDate	long
=	O
0	int
;	O
else	O
{	O
if	O
(	O
zipfi	pointer
->	O
dosDate	long
!=	O
0	int
)	O
zi	pointer
->	O
ci	struct
.	O
dosDate	long
=	O
zipfi	pointer
->	O
dosDate	long
;	O
else	O
zi	pointer
->	O
ci	struct
.	O
dosDate	long
=	O
ziplocal_TmzDateToDosDate	function
(	O
&	O
zipfi	pointer
->	O
tmz_date	struct
,	O
zipfi	pointer
->	O
dosDate	long
)	O
;	O
}	O
zi	pointer
->	O
ci	struct
.	O
flag	long
=	O
0	int
;	O
if	O
(	O
(	O
level	int
==	O
8	int
)	O
||	O
(	O
level	int
==	O
9	int
)	O
)	O
zi	pointer
->	O
ci	struct
.	O
flag	long
|=	O
2	int
;	O
if	O
(	O
(	O
level	int
==	O
2	int
)	O
)	O
zi	pointer
->	O
ci	struct
.	O
flag	long
|=	O
4	int
;	O
if	O
(	O
(	O
level	int
==	O
1	int
)	O
)	O
zi	pointer
->	O
ci	struct
.	O
flag	long
|=	O
6	int
;	O
zi	pointer
->	O
ci	struct
.	O
crc32	function
=	O
0	int
;	O
zi	pointer
->	O
ci	struct
.	O
method	int
=	O
method	int
;	O
zi	pointer
->	O
ci	struct
.	O
stream_initialised	int
=	O
0	int
;	O
zi	pointer
->	O
ci	struct
.	O
pos_in_buffered_data	int
=	O
0	int
;	O
zi	pointer
->	O
ci	struct
.	O
pos_local_header	long
=	O
ftell	function
(	O
zi	pointer
->	O
filezip	pointer
)	O
;	O
zi	pointer
->	O
ci	struct
.	O
size_centralheader	long
=	O
SIZECENTRALHEADER	O
+	O
size_filename	int
+	O
size_extrafield_global	int
+	O
size_comment	int
;	O
zi	pointer
->	O
ci	struct
.	O
central_header	pointer
=	O
(	O
char	O
*	O
)	O
ALLOC	O
(	O
(	O
uInt	int
)	O
zi	pointer
->	O
ci	struct
.	O
size_centralheader	long
)	O
;	O
ziplocal_putValue_inmemory	function
(	O
zi	pointer
->	O
ci	struct
.	O
central_header	pointer
,	O
(	O
uLong	long
)	O
CENTRALHEADERMAGIC	O
,	O
4	int
)	O
;	O
ziplocal_putValue_inmemory	function
(	O
zi	pointer
->	O
ci	struct
.	O
central_header	pointer
+	O
4	int
,	O
(	O
uLong	long
)	O
VERSIONMADEBY	O
,	O
2	int
)	O
;	O
ziplocal_putValue_inmemory	function
(	O
zi	pointer
->	O
ci	struct
.	O
central_header	pointer
+	O
6	int
,	O
(	O
uLong	long
)	O
20	int
,	O
2	int
)	O
;	O
ziplocal_putValue_inmemory	function
(	O
zi	pointer
->	O
ci	struct
.	O
central_header	pointer
+	O
8	int
,	O
(	O
uLong	long
)	O
zi	pointer
->	O
ci	struct
.	O
flag	long
,	O
2	int
)	O
;	O
ziplocal_putValue_inmemory	function
(	O
zi	pointer
->	O
ci	struct
.	O
central_header	pointer
+	O
10	int
,	O
(	O
uLong	long
)	O
zi	pointer
->	O
ci	struct
.	O
method	int
,	O
2	int
)	O
;	O
ziplocal_putValue_inmemory	function
(	O
zi	pointer
->	O
ci	struct
.	O
central_header	pointer
+	O
12	int
,	O
(	O
uLong	long
)	O
zi	pointer
->	O
ci	struct
.	O
dosDate	long
,	O
4	int
)	O
;	O
ziplocal_putValue_inmemory	function
(	O
zi	pointer
->	O
ci	struct
.	O
central_header	pointer
+	O
16	int
,	O
(	O
uLong	long
)	O
0	int
,	O
4	int
)	O
;	O
ziplocal_putValue_inmemory	function
(	O
zi	pointer
->	O
ci	struct
.	O
central_header	pointer
+	O
20	int
,	O
(	O
uLong	long
)	O
0	int
,	O
4	int
)	O
;	O
ziplocal_putValue_inmemory	function
(	O
zi	pointer
->	O
ci	struct
.	O
central_header	pointer
+	O
24	int
,	O
(	O
uLong	long
)	O
0	int
,	O
4	int
)	O
;	O
ziplocal_putValue_inmemory	function
(	O
zi	pointer
->	O
ci	struct
.	O
central_header	pointer
+	O
28	int
,	O
(	O
uLong	long
)	O
size_filename	int
,	O
2	int
)	O
;	O
ziplocal_putValue_inmemory	function
(	O
zi	pointer
->	O
ci	struct
.	O
central_header	pointer
+	O
30	int
,	O
(	O
uLong	long
)	O
size_extrafield_global	int
,	O
2	int
)	O
;	O
ziplocal_putValue_inmemory	function
(	O
zi	pointer
->	O
ci	struct
.	O
central_header	pointer
+	O
32	int
,	O
(	O
uLong	long
)	O
size_comment	int
,	O
2	int
)	O
;	O
ziplocal_putValue_inmemory	function
(	O
zi	pointer
->	O
ci	struct
.	O
central_header	pointer
+	O
34	int
,	O
(	O
uLong	long
)	O
0	int
,	O
2	int
)	O
;	O
if	O
(	O
zipfi	pointer
==	O
NULL	O
)	O
ziplocal_putValue_inmemory	function
(	O
zi	pointer
->	O
ci	struct
.	O
central_header	pointer
+	O
36	int
,	O
(	O
uLong	long
)	O
0	int
,	O
2	int
)	O
;	O
else	O
ziplocal_putValue_inmemory	function
(	O
zi	pointer
->	O
ci	struct
.	O
central_header	pointer
+	O
36	int
,	O
(	O
uLong	long
)	O
zipfi	pointer
->	O
internal_fa	long
,	O
2	int
)	O
;	O
if	O
(	O
zipfi	pointer
==	O
NULL	O
)	O
ziplocal_putValue_inmemory	function
(	O
zi	pointer
->	O
ci	struct
.	O
central_header	pointer
+	O
38	int
,	O
(	O
uLong	long
)	O
0	int
,	O
4	int
)	O
;	O
else	O
ziplocal_putValue_inmemory	function
(	O
zi	pointer
->	O
ci	struct
.	O
central_header	pointer
+	O
38	int
,	O
(	O
uLong	long
)	O
zipfi	pointer
->	O
external_fa	long
,	O
4	int
)	O
;	O
ziplocal_putValue_inmemory	function
(	O
zi	pointer
->	O
ci	struct
.	O
central_header	pointer
+	O
42	int
,	O
(	O
uLong	long
)	O
zi	pointer
->	O
ci	struct
.	O
pos_local_header	long
,	O
4	int
)	O
;	O
for	O
(	O
i	int
=	O
0	int
;	O
i	int
<	O
size_filename	int
;	O
i	int
++	O
)	O
*	O
(	O
zi	pointer
->	O
ci	struct
.	O
central_header	pointer
+	O
SIZECENTRALHEADER	O
+	O
i	int
)	O
=	O
*	O
(	O
filename	pointer
+	O
i	int
)	O
;	O
for	O
(	O
i	int
=	O
0	int
;	O
i	int
<	O
size_extrafield_global	int
;	O
i	int
++	O
)	O
*	O
(	O
zi	pointer
->	O
ci	struct
.	O
central_header	pointer
+	O
SIZECENTRALHEADER	O
+	O
size_filename	int
+	O
i	int
)	O
=	O
*	O
(	O
(	O
(	O
const	O
char	O
*	O
)	O
extrafield_global	pointer
)	O
+	O
i	int
)	O
;	O
for	O
(	O
i	int
=	O
0	int
;	O
i	int
<	O
size_comment	int
;	O
i	int
++	O
)	O
*	O
(	O
zi	pointer
->	O
ci	struct
.	O
central_header	pointer
+	O
SIZECENTRALHEADER	O
+	O
size_filename	int
+	O
size_extrafield_global	int
+	O
i	int
)	O
=	O
*	O
(	O
filename	pointer
+	O
i	int
)	O
;	O
if	O
(	O
zi	pointer
->	O
ci	struct
.	O
central_header	pointer
==	O
NULL	O
)	O
return	O
ZIP_INTERNALERROR	O
;	O
err	int
=	O
ziplocal_putValue	function
(	O
zi	pointer
->	O
filezip	pointer
,	O
(	O
uLong	long
)	O
LOCALHEADERMAGIC	O
,	O
4	int
)	O
;	O
if	O
(	O
err	int
==	O
ZIP_OK	O
)	O
err	int
=	O
ziplocal_putValue	function
(	O
zi	pointer
->	O
filezip	pointer
,	O
(	O
uLong	long
)	O
20	int
,	O
2	int
)	O
;	O
if	O
(	O
err	int
==	O
ZIP_OK	O
)	O
err	int
=	O
ziplocal_putValue	function
(	O
zi	pointer
->	O
filezip	pointer
,	O
(	O
uLong	long
)	O
zi	pointer
->	O
ci	struct
.	O
flag	long
,	O
2	int
)	O
;	O
if	O
(	O
err	int
==	O
ZIP_OK	O
)	O
err	int
=	O
ziplocal_putValue	function
(	O
zi	pointer
->	O
filezip	pointer
,	O
(	O
uLong	long
)	O
zi	pointer
->	O
ci	struct
.	O
method	int
,	O
2	int
)	O
;	O
if	O
(	O
err	int
==	O
ZIP_OK	O
)	O
err	int
=	O
ziplocal_putValue	function
(	O
zi	pointer
->	O
filezip	pointer
,	O
(	O
uLong	long
)	O
zi	pointer
->	O
ci	struct
.	O
dosDate	long
,	O
4	int
)	O
;	O
if	O
(	O
err	int
==	O
ZIP_OK	O
)	O
err	int
=	O
ziplocal_putValue	function
(	O
zi	pointer
->	O
filezip	pointer
,	O
(	O
uLong	long
)	O
0	int
,	O
4	int
)	O
;	O
if	O
(	O
err	int
==	O
ZIP_OK	O
)	O
err	int
=	O
ziplocal_putValue	function
(	O
zi	pointer
->	O
filezip	pointer
,	O
(	O
uLong	long
)	O
0	int
,	O
4	int
)	O
;	O
if	O
(	O
err	int
==	O
ZIP_OK	O
)	O
err	int
=	O
ziplocal_putValue	function
(	O
zi	pointer
->	O
filezip	pointer
,	O
(	O
uLong	long
)	O
0	int
,	O
4	int
)	O
;	O
if	O
(	O
err	int
==	O
ZIP_OK	O
)	O
err	int
=	O
ziplocal_putValue	function
(	O
zi	pointer
->	O
filezip	pointer
,	O
(	O
uLong	long
)	O
size_filename	int
,	O
2	int
)	O
;	O
if	O
(	O
err	int
==	O
ZIP_OK	O
)	O
err	int
=	O
ziplocal_putValue	function
(	O
zi	pointer
->	O
filezip	pointer
,	O
(	O
uLong	long
)	O
size_extrafield_local	int
,	O
2	int
)	O
;	O
if	O
(	O
(	O
err	int
==	O
ZIP_OK	O
)	O
&&	O
(	O
size_filename	int
>	O
0	int
)	O
)	O
if	O
(	O
fwrite	function
(	O
filename	pointer
,	O
(	O
uInt	int
)	O
size_filename	int
,	O
1	int
,	O
zi	pointer
->	O
filezip	pointer
)	O
!=	O
1	int
)	O
err	int
=	O
ZIP_ERRNO	O
;	O
if	O
(	O
(	O
err	int
==	O
ZIP_OK	O
)	O
&&	O
(	O
size_extrafield_local	int
>	O
0	int
)	O
)	O
if	O
(	O
fwrite	function
(	O
extrafield_local	pointer
,	O
(	O
uInt	int
)	O
size_extrafield_local	int
,	O
1	int
,	O
zi	pointer
->	O
filezip	pointer
)	O
!=	O
1	int
)	O
err	int
=	O
ZIP_ERRNO	O
;	O
zi	pointer
->	O
ci	struct
.	O
stream	struct
.	O
avail_in	int
=	O
(	O
uInt	int
)	O
0	int
;	O
zi	pointer
->	O
ci	struct
.	O
stream	struct
.	O
avail_out	int
=	O
(	O
uInt	int
)	O
Z_BUFSIZE	O
;	O
zi	pointer
->	O
ci	struct
.	O
stream	struct
.	O
next_out	pointer
=	O
zi	pointer
->	O
ci	struct
.	O
buffered_data	array
;	O
zi	pointer
->	O
ci	struct
.	O
stream	struct
.	O
total_in	long
=	O
0	int
;	O
zi	pointer
->	O
ci	struct
.	O
stream	struct
.	O
total_out	long
=	O
0	int
;	O
if	O
(	O
(	O
err	int
==	O
ZIP_OK	O
)	O
&&	O
(	O
zi	pointer
->	O
ci	struct
.	O
method	int
==	O
Z_DEFLATED	int
)	O
)	O
{	O
zi	pointer
->	O
ci	struct
.	O
stream	struct
.	O
zalloc	pointer
=	O
(	O
alloc_func	pointer
)	O
0	int
;	O
zi	pointer
->	O
ci	struct
.	O
stream	struct
.	O
zfree	pointer
=	O
(	O
free_func	pointer
)	O
0	int
;	O
zi	pointer
->	O
ci	struct
.	O
stream	struct
.	O
opaque	pointer
=	O
(	O
voidpf	pointer
)	O
0	int
;	O
err	int
=	O
deflateInit2	O
(	O
&	O
zi	pointer
->	O
ci	struct
.	O
stream	struct
,	O
level	int
,	O
Z_DEFLATED	int
,	O
-	O
MAX_WBITS	int
,	O
DEF_MEM_LEVEL	O
,	O
0	int
)	O
;	O
if	O
(	O
err	int
==	O
Z_OK	int
)	O
zi	pointer
->	O
ci	struct
.	O
stream_initialised	int
=	O
1	int
;	O
}	O
if	O
(	O
err	int
==	O
Z_OK	int
)	O
zi	pointer
->	O
in_opened_file_inzip	int
=	O
1	int
;	O
return	O
err	int
;	O
}	O
extern	O
int	O
ZEXPORT	O
zipWriteInFileInZip	function
(	O
file	pointer
,	O
buf	pointer
,	O
len	int
)	O
zipFile	pointer
file	pointer
;	O
const	O
voidp	pointer
buf	pointer
;	O
unsigned	O
len	int
;	O
{	O
zip_internal	struct
*	O
zi	pointer
;	O
int	O
err	int
=	O
ZIP_OK	O
;	O
if	O
(	O
file	pointer
==	O
NULL	O
)	O
return	O
ZIP_PARAMERROR	O
;	O
zi	pointer
=	O
(	O
zip_internal	struct
*	O
)	O
file	pointer
;	O
if	O
(	O
zi	pointer
->	O
in_opened_file_inzip	int
==	O
0	int
)	O
return	O
ZIP_PARAMERROR	O
;	O
zi	pointer
->	O
ci	struct
.	O
stream	struct
.	O
next_in	pointer
=	O
buf	pointer
;	O
zi	pointer
->	O
ci	struct
.	O
stream	struct
.	O
avail_in	int
=	O
len	int
;	O
zi	pointer
->	O
ci	struct
.	O
crc32	function
=	O
crc32	function
(	O
zi	pointer
->	O
ci	struct
.	O
crc32	function
,	O
buf	pointer
,	O
len	int
)	O
;	O
while	O
(	O
(	O
err	int
==	O
ZIP_OK	O
)	O
&&	O
(	O
zi	pointer
->	O
ci	struct
.	O
stream	struct
.	O
avail_in	int
>	O
0	int
)	O
)	O
{	O
if	O
(	O
zi	pointer
->	O
ci	struct
.	O
stream	struct
.	O
avail_out	int
==	O
0	int
)	O
{	O
if	O
(	O
fwrite	function
(	O
zi	pointer
->	O
ci	struct
.	O
buffered_data	array
,	O
(	O
uInt	int
)	O
zi	pointer
->	O
ci	struct
.	O
pos_in_buffered_data	int
,	O
1	int
,	O
zi	pointer
->	O
filezip	pointer
)	O
!=	O
1	int
)	O
err	int
=	O
ZIP_ERRNO	O
;	O
zi	pointer
->	O
ci	struct
.	O
pos_in_buffered_data	int
=	O
0	int
;	O
zi	pointer
->	O
ci	struct
.	O
stream	struct
.	O
avail_out	int
=	O
(	O
uInt	int
)	O
Z_BUFSIZE	O
;	O
zi	pointer
->	O
ci	struct
.	O
stream	struct
.	O
next_out	pointer
=	O
zi	pointer
->	O
ci	struct
.	O
buffered_data	array
;	O
}	O
if	O
(	O
zi	pointer
->	O
ci	struct
.	O
method	int
==	O
Z_DEFLATED	int
)	O
{	O
uLong	long
uTotalOutBefore	long
=	O
zi	pointer
->	O
ci	struct
.	O
stream	struct
.	O
total_out	long
;	O
err	int
=	O
deflate	function
(	O
&	O
zi	pointer
->	O
ci	struct
.	O
stream	struct
,	O
Z_NO_FLUSH	int
)	O
;	O
zi	pointer
->	O
ci	struct
.	O
pos_in_buffered_data	int
+=	O
(	O
uInt	int
)	O
(	O
zi	pointer
->	O
ci	struct
.	O
stream	struct
.	O
total_out	long
-	O
uTotalOutBefore	long
)	O
;	O
}	O
else	O
{	O
uInt	int
copy_this	int
,	O
i	int
;	O
if	O
(	O
zi	pointer
->	O
ci	struct
.	O
stream	struct
.	O
avail_in	int
<	O
zi	pointer
->	O
ci	struct
.	O
stream	struct
.	O
avail_out	int
)	O
copy_this	int
=	O
zi	pointer
->	O
ci	struct
.	O
stream	struct
.	O
avail_in	int
;	O
else	O
copy_this	int
=	O
zi	pointer
->	O
ci	struct
.	O
stream	struct
.	O
avail_out	int
;	O
for	O
(	O
i	int
=	O
0	int
;	O
i	int
<	O
copy_this	int
;	O
i	int
++	O
)	O
*	O
(	O
(	O
(	O
char	O
*	O
)	O
zi	pointer
->	O
ci	struct
.	O
stream	struct
.	O
next_out	pointer
)	O
+	O
i	int
)	O
=	O
*	O
(	O
(	O
(	O
const	O
char	O
*	O
)	O
zi	pointer
->	O
ci	struct
.	O
stream	struct
.	O
next_in	pointer
)	O
+	O
i	int
)	O
;	O
{	O
zi	pointer
->	O
ci	struct
.	O
stream	struct
.	O
avail_in	int
-=	O
copy_this	int
;	O
zi	pointer
->	O
ci	struct
.	O
stream	struct
.	O
avail_out	int
-=	O
copy_this	int
;	O
zi	pointer
->	O
ci	struct
.	O
stream	struct
.	O
next_in	pointer
+=	O
copy_this	int
;	O
zi	pointer
->	O
ci	struct
.	O
stream	struct
.	O
next_out	pointer
+=	O
copy_this	int
;	O
zi	pointer
->	O
ci	struct
.	O
stream	struct
.	O
total_in	long
+=	O
copy_this	int
;	O
zi	pointer
->	O
ci	struct
.	O
stream	struct
.	O
total_out	long
+=	O
copy_this	int
;	O
zi	pointer
->	O
ci	struct
.	O
pos_in_buffered_data	int
+=	O
copy_this	int
;	O
}	O
}	O
}	O
return	O
0	int
;	O
}	O
extern	O
int	O
ZEXPORT	O
zipCloseFileInZip	function
(	O
file	pointer
)	O
zipFile	pointer
file	pointer
;	O
{	O
zip_internal	struct
*	O
zi	pointer
;	O
int	O
err	int
=	O
ZIP_OK	O
;	O
if	O
(	O
file	pointer
==	O
NULL	O
)	O
return	O
ZIP_PARAMERROR	O
;	O
zi	pointer
=	O
(	O
zip_internal	struct
*	O
)	O
file	pointer
;	O
if	O
(	O
zi	pointer
->	O
in_opened_file_inzip	int
==	O
0	int
)	O
return	O
ZIP_PARAMERROR	O
;	O
zi	pointer
->	O
ci	struct
.	O
stream	struct
.	O
avail_in	int
=	O
0	int
;	O
if	O
(	O
zi	pointer
->	O
ci	struct
.	O
method	int
==	O
Z_DEFLATED	int
)	O
while	O
(	O
err	int
==	O
ZIP_OK	O
)	O
{	O
uLong	long
uTotalOutBefore	long
;	O
if	O
(	O
zi	pointer
->	O
ci	struct
.	O
stream	struct
.	O
avail_out	int
==	O
0	int
)	O
{	O
if	O
(	O
fwrite	function
(	O
zi	pointer
->	O
ci	struct
.	O
buffered_data	array
,	O
(	O
uInt	int
)	O
zi	pointer
->	O
ci	struct
.	O
pos_in_buffered_data	int
,	O
1	int
,	O
zi	pointer
->	O
filezip	pointer
)	O
!=	O
1	int
)	O
err	int
=	O
ZIP_ERRNO	O
;	O
zi	pointer
->	O
ci	struct
.	O
pos_in_buffered_data	int
=	O
0	int
;	O
zi	pointer
->	O
ci	struct
.	O
stream	struct
.	O
avail_out	int
=	O
(	O
uInt	int
)	O
Z_BUFSIZE	O
;	O
zi	pointer
->	O
ci	struct
.	O
stream	struct
.	O
next_out	pointer
=	O
zi	pointer
->	O
ci	struct
.	O
buffered_data	array
;	O
}	O
uTotalOutBefore	long
=	O
zi	pointer
->	O
ci	struct
.	O
stream	struct
.	O
total_out	long
;	O
err	int
=	O
deflate	function
(	O
&	O
zi	pointer
->	O
ci	struct
.	O
stream	struct
,	O
Z_FINISH	int
)	O
;	O
zi	pointer
->	O
ci	struct
.	O
pos_in_buffered_data	int
+=	O
(	O
uInt	int
)	O
(	O
zi	pointer
->	O
ci	struct
.	O
stream	struct
.	O
total_out	long
-	O
uTotalOutBefore	long
)	O
;	O
}	O
if	O
(	O
err	int
==	O
Z_STREAM_END	int
)	O
err	int
=	O
ZIP_OK	O
;	O
if	O
(	O
(	O
zi	pointer
->	O
ci	struct
.	O
pos_in_buffered_data	int
>	O
0	int
)	O
&&	O
(	O
err	int
==	O
ZIP_OK	O
)	O
)	O
if	O
(	O
fwrite	function
(	O
zi	pointer
->	O
ci	struct
.	O
buffered_data	array
,	O
(	O
uInt	int
)	O
zi	pointer
->	O
ci	struct
.	O
pos_in_buffered_data	int
,	O
1	int
,	O
zi	pointer
->	O
filezip	pointer
)	O
!=	O
1	int
)	O
err	int
=	O
ZIP_ERRNO	O
;	O
if	O
(	O
(	O
zi	pointer
->	O
ci	struct
.	O
method	int
==	O
Z_DEFLATED	int
)	O
&&	O
(	O
err	int
==	O
ZIP_OK	O
)	O
)	O
{	O
err	int
=	O
deflateEnd	function
(	O
&	O
zi	pointer
->	O
ci	struct
.	O
stream	struct
)	O
;	O
zi	pointer
->	O
ci	struct
.	O
stream_initialised	int
=	O
0	int
;	O
}	O
ziplocal_putValue_inmemory	function
(	O
zi	pointer
->	O
ci	struct
.	O
central_header	pointer
+	O
16	int
,	O
(	O
uLong	long
)	O
zi	pointer
->	O
ci	struct
.	O
crc32	function
,	O
4	int
)	O
;	O
ziplocal_putValue_inmemory	function
(	O
zi	pointer
->	O
ci	struct
.	O
central_header	pointer
+	O
20	int
,	O
(	O
uLong	long
)	O
zi	pointer
->	O
ci	struct
.	O
stream	struct
.	O
total_out	long
,	O
4	int
)	O
;	O
ziplocal_putValue_inmemory	function
(	O
zi	pointer
->	O
ci	struct
.	O
central_header	pointer
+	O
24	int
,	O
(	O
uLong	long
)	O
zi	pointer
->	O
ci	struct
.	O
stream	struct
.	O
total_in	long
,	O
4	int
)	O
;	O
if	O
(	O
err	int
==	O
ZIP_OK	O
)	O
err	int
=	O
add_data_in_datablock	function
(	O
&	O
zi	pointer
->	O
central_dir	struct
,	O
zi	pointer
->	O
ci	struct
.	O
central_header	pointer
,	O
(	O
uLong	long
)	O
zi	pointer
->	O
ci	struct
.	O
size_centralheader	long
)	O
;	O
free	function
(	O
zi	pointer
->	O
ci	struct
.	O
central_header	pointer
)	O
;	O
if	O
(	O
err	int
==	O
ZIP_OK	O
)	O
{	O
long	O
cur_pos_inzip	long
=	O
ftell	function
(	O
zi	pointer
->	O
filezip	pointer
)	O
;	O
if	O
(	O
fseek	function
(	O
zi	pointer
->	O
filezip	pointer
,	O
zi	pointer
->	O
ci	struct
.	O
pos_local_header	long
+	O
14	int
,	O
SEEK_SET	int
)	O
!=	O
0	int
)	O
err	int
=	O
ZIP_ERRNO	O
;	O
if	O
(	O
err	int
==	O
ZIP_OK	O
)	O
err	int
=	O
ziplocal_putValue	function
(	O
zi	pointer
->	O
filezip	pointer
,	O
(	O
uLong	long
)	O
zi	pointer
->	O
ci	struct
.	O
crc32	function
,	O
4	int
)	O
;	O
if	O
(	O
err	int
==	O
ZIP_OK	O
)	O
err	int
=	O
ziplocal_putValue	function
(	O
zi	pointer
->	O
filezip	pointer
,	O
(	O
uLong	long
)	O
zi	pointer
->	O
ci	struct
.	O
stream	struct
.	O
total_out	long
,	O
4	int
)	O
;	O
if	O
(	O
err	int
==	O
ZIP_OK	O
)	O
err	int
=	O
ziplocal_putValue	function
(	O
zi	pointer
->	O
filezip	pointer
,	O
(	O
uLong	long
)	O
zi	pointer
->	O
ci	struct
.	O
stream	struct
.	O
total_in	long
,	O
4	int
)	O
;	O
if	O
(	O
fseek	function
(	O
zi	pointer
->	O
filezip	pointer
,	O
cur_pos_inzip	long
,	O
SEEK_SET	int
)	O
!=	O
0	int
)	O
err	int
=	O
ZIP_ERRNO	O
;	O
}	O
zi	pointer
->	O
number_entry	long
++	O
;	O
zi	pointer
->	O
in_opened_file_inzip	int
=	O
0	int
;	O
return	O
err	int
;	O
}	O
extern	O
int	O
ZEXPORT	O
zipClose	function
(	O
file	pointer
,	O
global_comment	pointer
)	O
zipFile	pointer
file	pointer
;	O
const	O
char	O
*	O
global_comment	pointer
;	O
{	O
zip_internal	struct
*	O
zi	pointer
;	O
int	O
err	int
=	O
0	int
;	O
uLong	long
size_centraldir	long
=	O
0	int
;	O
uLong	long
centraldir_pos_inzip	long
;	O
uInt	int
size_global_comment	int
;	O
if	O
(	O
file	pointer
==	O
NULL	O
)	O
return	O
ZIP_PARAMERROR	O
;	O
zi	pointer
=	O
(	O
zip_internal	struct
*	O
)	O
file	pointer
;	O
if	O
(	O
zi	pointer
->	O
in_opened_file_inzip	int
==	O
1	int
)	O
{	O
err	int
=	O
zipCloseFileInZip	function
(	O
file	pointer
)	O
;	O
}	O
if	O
(	O
global_comment	pointer
==	O
NULL	O
)	O
size_global_comment	int
=	O
0	int
;	O
else	O
size_global_comment	int
=	O
strlen	function
(	O
global_comment	pointer
)	O
;	O
centraldir_pos_inzip	long
=	O
ftell	function
(	O
zi	pointer
->	O
filezip	pointer
)	O
;	O
if	O
(	O
err	int
==	O
ZIP_OK	O
)	O
{	O
linkedlist_datablock_internal	struct
*	O
ldi	pointer
=	O
zi	pointer
->	O
central_dir	struct
.	O
first_block	pointer
;	O
while	O
(	O
ldi	pointer
!=	O
NULL	O
)	O
{	O
if	O
(	O
(	O
err	int
==	O
ZIP_OK	O
)	O
&&	O
(	O
ldi	pointer
->	O
filled_in_this_block	long
>	O
0	int
)	O
)	O
if	O
(	O
fwrite	function
(	O
ldi	pointer
->	O
data	array
,	O
(	O
uInt	int
)	O
ldi	pointer
->	O
filled_in_this_block	long
,	O
1	int
,	O
zi	pointer
->	O
filezip	pointer
)	O
!=	O
1	int
)	O
err	int
=	O
ZIP_ERRNO	O
;	O
size_centraldir	long
+=	O
ldi	pointer
->	O
filled_in_this_block	long
;	O
ldi	pointer
=	O
ldi	pointer
->	O
next_datablock	pointer
;	O
}	O
}	O
free_datablock	function
(	O
zi	pointer
->	O
central_dir	struct
.	O
first_block	pointer
)	O
;	O
if	O
(	O
err	int
==	O
ZIP_OK	O
)	O
err	int
=	O
ziplocal_putValue	function
(	O
zi	pointer
->	O
filezip	pointer
,	O
(	O
uLong	long
)	O
ENDHEADERMAGIC	O
,	O
4	int
)	O
;	O
if	O
(	O
err	int
==	O
ZIP_OK	O
)	O
err	int
=	O
ziplocal_putValue	function
(	O
zi	pointer
->	O
filezip	pointer
,	O
(	O
uLong	long
)	O
0	int
,	O
2	int
)	O
;	O
if	O
(	O
err	int
==	O
ZIP_OK	O
)	O
err	int
=	O
ziplocal_putValue	function
(	O
zi	pointer
->	O
filezip	pointer
,	O
(	O
uLong	long
)	O
0	int
,	O
2	int
)	O
;	O
if	O
(	O
err	int
==	O
ZIP_OK	O
)	O
err	int
=	O
ziplocal_putValue	function
(	O
zi	pointer
->	O
filezip	pointer
,	O
(	O
uLong	long
)	O
zi	pointer
->	O
number_entry	long
,	O
2	int
)	O
;	O
if	O
(	O
err	int
==	O
ZIP_OK	O
)	O
err	int
=	O
ziplocal_putValue	function
(	O
zi	pointer
->	O
filezip	pointer
,	O
(	O
uLong	long
)	O
zi	pointer
->	O
number_entry	long
,	O
2	int
)	O
;	O
if	O
(	O
err	int
==	O
ZIP_OK	O
)	O
err	int
=	O
ziplocal_putValue	function
(	O
zi	pointer
->	O
filezip	pointer
,	O
(	O
uLong	long
)	O
size_centraldir	long
,	O
4	int
)	O
;	O
if	O
(	O
err	int
==	O
ZIP_OK	O
)	O
err	int
=	O
ziplocal_putValue	function
(	O
zi	pointer
->	O
filezip	pointer
,	O
(	O
uLong	long
)	O
centraldir_pos_inzip	long
,	O
4	int
)	O
;	O
if	O
(	O
err	int
==	O
ZIP_OK	O
)	O
err	int
=	O
ziplocal_putValue	function
(	O
zi	pointer
->	O
filezip	pointer
,	O
(	O
uLong	long
)	O
size_global_comment	int
,	O
2	int
)	O
;	O
if	O
(	O
(	O
err	int
==	O
ZIP_OK	O
)	O
&&	O
(	O
size_global_comment	int
>	O
0	int
)	O
)	O
if	O
(	O
fwrite	function
(	O
global_comment	pointer
,	O
(	O
uInt	int
)	O
size_global_comment	int
,	O
1	int
,	O
zi	pointer
->	O
filezip	pointer
)	O
!=	O
1	int
)	O
err	int
=	O
ZIP_ERRNO	O
;	O
fclose	function
(	O
zi	pointer
->	O
filezip	pointer
)	O
;	O
TRYFREE	O
(	O
zi	pointer
)	O
;	O
return	O
err	int
;	O
}	O
