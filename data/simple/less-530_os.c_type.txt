public	O
int	O
reading	int
;	O
static	O
jmp_buf	array
read_label	array
;	O
extern	O
int	O
sigs	int
;	O
public	O
int	O
iread	function
(	O
fd	int
,	O
buf	pointer
,	O
len	int
)	O
int	O
fd	int
;	O
unsigned	O
char	O
*	O
buf	pointer
;	O
unsigned	O
int	O
len	int
;	O
{	O
int	O
n	int
;	O
start	O
:	O
if	O
(	O
SET_JUMP	O
(	O
read_label	array
)	O
)	O
{	O
reading	int
=	O
0	int
;	O
{	O
sigset_t	struct
mask	struct
;	O
sigemptyset	function
(	O
&	O
mask	struct
)	O
;	O
sigprocmask	function
(	O
SIG_SETMASK	int
,	O
&	O
mask	struct
,	O
NULL	O
)	O
;	O
}	O
return	O
(	O
READ_INTR	O
)	O
;	O
}	O
flush	function
(	O
)	O
;	O
reading	int
=	O
1	int
;	O
n	int
=	O
read	function
(	O
fd	int
,	O
buf	pointer
,	O
len	int
)	O
;	O
{	O
extern	O
int	O
ignore_eoi	int
;	O
if	O
(	O
!	O
ignore_eoi	int
)	O
{	O
static	O
int	O
consecutive_nulls	int
=	O
0	int
;	O
if	O
(	O
n	int
==	O
0	int
)	O
consecutive_nulls	int
++	O
;	O
else	O
consecutive_nulls	int
=	O
0	int
;	O
if	O
(	O
consecutive_nulls	int
>	O
20	int
)	O
quit	function
(	O
QUIT_ERROR	int
)	O
;	O
}	O
}	O
reading	int
=	O
0	int
;	O
if	O
(	O
n	int
<	O
0	int
)	O
{	O
if	O
(	O
errno	O
==	O
EINTR	int
)	O
goto	O
start	O
;	O
if	O
(	O
errno	O
==	O
EAGAIN	int
)	O
goto	O
start	O
;	O
return	O
(	O
-	O
1	int
)	O
;	O
}	O
return	O
(	O
n	int
)	O
;	O
}	O
public	O
void	O
intread	function
(	O
)	O
{	O
LONG_JUMP	O
(	O
read_label	array
,	O
1	int
)	O
;	O
}	O
public	O
time_type	O
get_time	function
(	O
)	O
{	O
time_type	O
t	long
;	O
time	function
(	O
&	O
t	long
)	O
;	O
return	O
(	O
t	long
)	O
;	O
}	O
public	O
char	O
*	O
errno_message	function
(	O
filename	pointer
)	O
char	O
*	O
filename	pointer
;	O
{	O
char	O
*	O
p	pointer
;	O
char	O
*	O
m	pointer
;	O
int	O
len	int
;	O
p	pointer
=	O
strerror	function
(	O
errno	O
)	O
;	O
len	int
=	O
(	O
int	O
)	O
(	O
strlen	function
(	O
filename	pointer
)	O
+	O
strlen	function
(	O
p	pointer
)	O
+	O
3	int
)	O
;	O
m	pointer
=	O
(	O
char	O
*	O
)	O
ecalloc	function
(	O
len	int
,	O
sizeof	O
(	O
char	O
)	O
)	O
;	O
SNPRINTF2	O
(	O
m	pointer
,	O
len	int
,	O
"%s: %s"	pointer
,	O
filename	pointer
,	O
p	pointer
)	O
;	O
return	O
(	O
m	pointer
)	O
;	O
}	O
static	O
POSITION	long
muldiv	function
(	O
val	long
,	O
num	long
,	O
den	long
)	O
POSITION	long
val	long
,	O
num	long
,	O
den	long
;	O
{	O
double	O
v	double
=	O
(	O
(	O
(	O
double	O
)	O
val	long
)	O
*	O
num	long
)	O
/	O
den	long
;	O
return	O
(	O
(	O
POSITION	long
)	O
(	O
v	double
+	O
0.5	int
)	O
)	O
;	O
}	O
public	O
int	O
percentage	function
(	O
num	long
,	O
den	long
)	O
POSITION	long
num	long
;	O
POSITION	long
den	long
;	O
{	O
return	O
(	O
int	O
)	O
muldiv	function
(	O
num	long
,	O
(	O
POSITION	long
)	O
100	int
,	O
den	long
)	O
;	O
}	O
public	O
POSITION	long
percent_pos	function
(	O
pos	long
,	O
percent	int
,	O
fraction	long
)	O
POSITION	long
pos	long
;	O
int	O
percent	int
;	O
long	O
fraction	long
;	O
{	O
POSITION	long
perden	long
=	O
(	O
percent	int
*	O
(	O
NUM_FRAC_DENOM	int
/	O
100	int
)	O
)	O
+	O
(	O
fraction	long
/	O
100	int
)	O
;	O
if	O
(	O
perden	long
==	O
0	int
)	O
return	O
(	O
0	int
)	O
;	O
return	O
(	O
POSITION	long
)	O
muldiv	function
(	O
pos	long
,	O
perden	long
,	O
(	O
POSITION	long
)	O
NUM_FRAC_DENOM	int
)	O
;	O
}	O
