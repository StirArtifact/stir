const	O
char	O
*	O
kawalib	pointer
=	O
KAWALIB	O
;	O
const	O
char	O
*	O
kawajar	pointer
=	O
KAWAJAR	O
;	O
const	O
char	O
*	O
extrapath	pointer
=	O
EXTRAPATH	O
;	O
char	O
*	O
get_classpath	function
(	O
const	O
char	O
*	O
progname	pointer
)	O
{	O
char	O
*	O
classpath	pointer
;	O
int	O
i	int
;	O
const	O
char	O
*	O
path	pointer
=	O
getenv	function
(	O
"KAWALIB"	pointer
)	O
;	O
if	O
(	O
path	pointer
==	O
NULL	O
)	O
{	O
const	O
char	O
*	O
rp	pointer
=	O
progname	pointer
==	O
NULL	O
?	O
NULL	O
:	O
strrchr	function
(	O
progname	pointer
,	O
'/'	O
)	O
;	O
path	pointer
=	O
kawalib	pointer
;	O
if	O
(	O
rp	pointer
!=	O
NULL	O
)	O
{	O
char	O
*	O
buf	pointer
=	O
malloc	function
(	O
strlen	function
(	O
progname	pointer
)	O
+	O
strlen	function
(	O
kawajar	pointer
)	O
+	O
5	int
)	O
;	O
if	O
(	O
buf	pointer
!=	O
NULL	O
)	O
{	O
sprintf	function
(	O
buf	pointer
,	O
"%.*s/../lib/%s"	pointer
,	O
rp	pointer
-	O
progname	pointer
,	O
progname	pointer
,	O
kawajar	pointer
)	O
;	O
if	O
(	O
access	function
(	O
buf	pointer
,	O
R_OK	int
)	O
==	O
0	int
)	O
path	pointer
=	O
buf	pointer
;	O
}	O
}	O
}	O
i	int
=	O
strlen	function
(	O
path	pointer
)	O
;	O
if	O
(	O
i	int
>	O
4	int
&&	O
strcmp	function
(	O
path	pointer
+	O
i	int
-	O
4	int
,	O
".jar"	pointer
)	O
==	O
0	int
)	O
{	O
if	O
(	O
access	function
(	O
path	pointer
,	O
R_OK	int
)	O
<	O
0	int
)	O
{	O
perror	function
(	O
"KAWALIB does not specify a readable .jar file"	pointer
)	O
;	O
exit	function
(	O
0	int
)	O
;	O
}	O
}	O
else	O
{	O
char	O
*	O
buf	pointer
=	O
malloc	function
(	O
i	int
+	O
20	int
)	O
;	O
sprintf	function
(	O
buf	pointer
,	O
"%s/kawa/repl.class"	pointer
,	O
path	pointer
)	O
;	O
if	O
(	O
access	function
(	O
buf	pointer
,	O
R_OK	int
)	O
<	O
0	int
)	O
{	O
perror	function
(	O
"KAWALIB does not contain kawa/repl.class"	pointer
)	O
;	O
exit	function
(	O
0	int
)	O
;	O
}	O
}	O
classpath	pointer
=	O
getenv	function
(	O
"CLASSPATH"	pointer
)	O
;	O
if	O
(	O
classpath	pointer
==	O
NULL	O
)	O
classpath	pointer
=	O
"."	pointer
;	O
int	O
extra_length	int
=	O
strlen	function
(	O
extrapath	pointer
)	O
;	O
const	O
char	O
*	O
extra_sep	pointer
;	O
if	O
(	O
extra_length	int
>	O
0	int
&&	O
extrapath	pointer
[	O
extra_length	int
-	O
1	int
]	O
==	O
':'	O
)	O
{	O
extra_length	int
--	O
;	O
extra_sep	pointer
=	O
":"	pointer
;	O
}	O
else	O
extra_sep	pointer
=	O
""	pointer
;	O
char	O
*	O
buf	pointer
=	O
malloc	function
(	O
strlen	function
(	O
path	pointer
)	O
+	O
strlen	function
(	O
classpath	pointer
)	O
+	O
extra_length	int
+	O
strlen	function
(	O
extra_sep	pointer
)	O
+	O
12	int
)	O
;	O
sprintf	function
(	O
buf	pointer
,	O
"CLASSPATH=%s:%s%s%.*s"	pointer
,	O
classpath	pointer
,	O
path	pointer
,	O
extra_sep	pointer
,	O
extra_length	int
,	O
extrapath	pointer
)	O
;	O
return	O
buf	pointer
;	O
}	O
