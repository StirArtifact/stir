int	O
io_diag_P	int
=	O
0L	int
;	O
void	O
blkio_init	function
(	O
)	O
{	O
return	O
;	O
}	O
void	O
blkio_final	function
(	O
)	O
{	O
return	O
;	O
}	O
int	O
blkio_port_open_P	function
(	O
int	O
fd	int
,	O
int	O
writable_P	int
)	O
{	O
return	O
-	O
1	int
!=	O
fd	int
;	O
}	O
int	O
blkio_create_file	function
(	O
unsigned	O
char	O
*	O
name	int
,	O
int	O
bsiz	int
)	O
{	O
int	O
fd	int
=	O
open	function
(	O
(	O
char	O
*	O
)	O
name	int
,	O
O_RDWR	int
|	O
O_CREAT	int
|	O
O_TRUNC	int
,	O
0666	int
)	O
;	O
if	O
(	O
-	O
1	int
==	O
fd	int
)	O
{	O
dprintf	function
(	O
(	O
diagout	pointer
,	O
"%s: %d: %s\n"	pointer
,	O
__FILE__	O
,	O
__LINE__	O
,	O
strerror	function
(	O
errno	O
)	O
)	O
)	O
;	O
return	O
fd	int
;	O
}	O
{	O
int	O
lret	int
=	O
lockf	function
(	O
fd	int
,	O
F_TLOCK	int
,	O
0L	int
)	O
;	O
if	O
(	O
0	int
==	O
lret	int
)	O
return	O
fd	int
;	O
dprintf	function
(	O
(	O
diagout	pointer
,	O
"%s: %d: %s\n"	pointer
,	O
__FILE__	O
,	O
__LINE__	O
,	O
strerror	function
(	O
errno	O
)	O
)	O
)	O
;	O
if	O
(	O
-	O
1	int
==	O
close	function
(	O
fd	int
)	O
)	O
{	O
dprintf	function
(	O
(	O
diagout	pointer
,	O
"%s: %d: %s\n"	pointer
,	O
__FILE__	O
,	O
__LINE__	O
,	O
strerror	function
(	O
errno	O
)	O
)	O
)	O
;	O
}	O
return	O
-	O
1L	int
;	O
}	O
}	O
int	O
blkio_open_modify_file	function
(	O
unsigned	O
char	O
*	O
name	int
,	O
int	O
bsiz	int
)	O
{	O
int	O
fd	int
=	O
open	function
(	O
(	O
char	O
*	O
)	O
name	int
,	O
O_RDWR	int
)	O
;	O
if	O
(	O
-	O
1	int
==	O
fd	int
)	O
{	O
dprintf	function
(	O
(	O
diagout	pointer
,	O
"%s: %d: %s\n"	pointer
,	O
__FILE__	O
,	O
__LINE__	O
,	O
strerror	function
(	O
errno	O
)	O
)	O
)	O
;	O
return	O
fd	int
;	O
}	O
{	O
int	O
lret	int
=	O
lockf	function
(	O
fd	int
,	O
F_TLOCK	int
,	O
0L	int
)	O
;	O
if	O
(	O
0	int
==	O
lret	int
)	O
return	O
fd	int
;	O
dprintf	function
(	O
(	O
diagout	pointer
,	O
"%s: %d: %s\n"	pointer
,	O
__FILE__	O
,	O
__LINE__	O
,	O
strerror	function
(	O
errno	O
)	O
)	O
)	O
;	O
if	O
(	O
-	O
1	int
==	O
close	function
(	O
fd	int
)	O
)	O
{	O
dprintf	function
(	O
(	O
diagout	pointer
,	O
"%s: %d: %s\n"	pointer
,	O
__FILE__	O
,	O
__LINE__	O
,	O
strerror	function
(	O
errno	O
)	O
)	O
)	O
;	O
}	O
return	O
-	O
1L	int
;	O
}	O
}	O
int	O
blkio_open_read_only_file	function
(	O
unsigned	O
char	O
*	O
name	int
,	O
int	O
bsiz	int
)	O
{	O
int	O
fd	int
=	O
open	function
(	O
(	O
char	O
*	O
)	O
name	int
,	O
O_RDONLY	int
)	O
;	O
if	O
(	O
-	O
1	int
==	O
fd	int
)	O
{	O
dprintf	function
(	O
(	O
diagout	pointer
,	O
"%s: %d: %s\n"	pointer
,	O
__FILE__	O
,	O
__LINE__	O
,	O
strerror	function
(	O
errno	O
)	O
)	O
)	O
;	O
}	O
return	O
fd	int
;	O
}	O
void	O
blkio_file_close	function
(	O
int	O
fd	int
,	O
int	O
bsiz	int
,	O
int	O
mutable_P	int
)	O
{	O
int	O
sts	int
=	O
0L	int
;	O
sts	int
=	O
close	function
(	O
fd	int
)	O
;	O
if	O
(	O
-	O
1	int
==	O
sts	int
)	O
{	O
dprintf	function
(	O
(	O
diagout	pointer
,	O
"%s: %d: %s\n"	pointer
,	O
__FILE__	O
,	O
__LINE__	O
,	O
strerror	function
(	O
errno	O
)	O
)	O
)	O
;	O
}	O
return	O
;	O
}	O
void	O
blkio_flush_to_file	function
(	O
int	O
fd	int
,	O
int	O
metadata_P	int
)	O
{	O
if	O
(	O
metadata_P	int
)	O
fsync	function
(	O
fd	int
)	O
;	O
else	O
fdatasync	function
(	O
fd	int
)	O
;	O
return	O
;	O
}	O
int	O
blkio_read	function
(	O
int	O
fd	int
,	O
unsigned	O
char	O
*	O
blk	pointer
,	O
int	O
bsiz	int
,	O
long	O
blknum	long
)	O
{	O
int	O
rsiz	int
=	O
pread	function
(	O
fd	int
,	O
blk	pointer
,	O
bsiz	int
,	O
(	O
blknum	long
+	O
0ULL	int
)	O
*	O
bsiz	int
)	O
;	O
if	O
(	O
bsiz	int
==	O
rsiz	int
)	O
{	O
if	O
(	O
io_diag_P	int
)	O
{	O
dprintf	function
(	O
(	O
diagout	pointer
,	O
"rd:%*s%c %10ld\n"	pointer
,	O
1	int
+	O
(	O
(	O
blk_level	O
(	O
blk	pointer
)	O
)	O
-	O
(	O
leaf	int
)	O
)	O
,	O
""	pointer
,	O
blk_typ	O
(	O
blk	pointer
)	O
,	O
blknum	long
)	O
)	O
;	O
}	O
if	O
(	O
blk_typ_P	O
(	O
blk	pointer
,	O
frl_typ	int
)	O
)	O
{	O
read_fl_ct	long
=	O
(	O
read_fl_ct	long
)	O
+	O
0x1L	int
;	O
}	O
else	O
read_ct	long
=	O
(	O
read_ct	long
)	O
+	O
0x1L	int
;	O
return	O
1L	int
;	O
}	O
else	O
{	O
if	O
(	O
-	O
1	int
==	O
rsiz	int
)	O
{	O
dprintf	function
(	O
(	O
diagout	pointer
,	O
"%s: %d: %s\n"	pointer
,	O
__FILE__	O
,	O
__LINE__	O
,	O
strerror	function
(	O
errno	O
)	O
)	O
)	O
;	O
}	O
dprintf	function
(	O
(	O
diagout	pointer
,	O
">>>>ERROR<<<<  couldn't read blk %ld (read %d B)\n"	pointer
,	O
blknum	long
,	O
rsiz	int
)	O
)	O
;	O
return	O
0L	int
;	O
}	O
}	O
int	O
blkio_write	function
(	O
int	O
fd	int
,	O
unsigned	O
char	O
*	O
blk	pointer
,	O
int	O
bsiz	int
,	O
long	O
blknum	long
)	O
{	O
int	O
rsiz	int
=	O
pwrite	function
(	O
fd	int
,	O
blk	pointer
,	O
bsiz	int
,	O
(	O
blknum	long
+	O
0ULL	int
)	O
*	O
bsiz	int
)	O
;	O
if	O
(	O
bsiz	int
==	O
rsiz	int
)	O
{	O
if	O
(	O
io_diag_P	int
)	O
{	O
dprintf	function
(	O
(	O
diagout	pointer
,	O
"wr:%*s%c %10ld\n"	pointer
,	O
1	int
+	O
(	O
(	O
blk_level	O
(	O
blk	pointer
)	O
)	O
-	O
(	O
leaf	int
)	O
)	O
,	O
""	pointer
,	O
blk_typ	O
(	O
blk	pointer
)	O
,	O
blknum	long
)	O
)	O
;	O
}	O
if	O
(	O
blk_typ_P	O
(	O
blk	pointer
,	O
frl_typ	int
)	O
)	O
{	O
write_fl_ct	long
=	O
(	O
write_fl_ct	long
)	O
+	O
0x1L	int
;	O
}	O
else	O
write_ct	long
=	O
(	O
write_ct	long
)	O
+	O
0x1L	int
;	O
return	O
1L	int
;	O
}	O
else	O
{	O
if	O
(	O
-	O
1	int
==	O
rsiz	int
)	O
{	O
dprintf	function
(	O
(	O
diagout	pointer
,	O
"%s: %d: %s\n"	pointer
,	O
__FILE__	O
,	O
__LINE__	O
,	O
strerror	function
(	O
errno	O
)	O
)	O
)	O
;	O
}	O
dprintf	function
(	O
(	O
diagout	pointer
,	O
">>>>ERROR<<<<  couldn't write blk %ld; (wrote %d B)\n"	pointer
,	O
blknum	long
,	O
rsiz	int
)	O
)	O
;	O
return	O
0L	int
;	O
}	O
}	O
int	O
blkio_file_extend	function
(	O
int	O
fd	int
,	O
int	O
bsiz	int
,	O
long	O
blknum	long
)	O
{	O
long	O
lsts	long
=	O
lseek	function
(	O
fd	int
,	O
(	O
blknum	long
+	O
0ULL	int
)	O
*	O
bsiz	int
,	O
SEEK_SET	int
)	O
;	O
if	O
(	O
-	O
1L	int
!=	O
lsts	long
)	O
{	O
if	O
(	O
io_diag_P	int
)	O
{	O
dprintf	function
(	O
(	O
diagout	pointer
,	O
"Extended file to blk %ld\n"	pointer
,	O
blknum	long
)	O
)	O
;	O
}	O
return	O
1L	int
;	O
}	O
else	O
{	O
dprintf	function
(	O
(	O
diagout	pointer
,	O
"%s: %d: %s\n"	pointer
,	O
__FILE__	O
,	O
__LINE__	O
,	O
strerror	function
(	O
errno	O
)	O
)	O
)	O
;	O
dprintf	function
(	O
(	O
diagout	pointer
,	O
">>>>ERROR<<<<  couldn't extend file to blk %ld\n"	pointer
,	O
blknum	long
)	O
)	O
;	O
return	O
0L	int
;	O
}	O
}	O
