static	O
intmax_t	long
taru_write_archive_member_data_	function
(	O
TARU	struct
*	O
taru	pointer
,	O
struct	O
new_cpio_header	struct
*	O
file_hdr0	pointer
,	O
int	O
out_file_des	int
,	O
int	O
pad_out_file_des	int
,	O
int	O
input_fd	int
,	O
int	O
(	O
*	O
fout	pointer
)	O
(	O
int	O
)	O
,	O
enum	O
archive_format	enum
archive_format_out	enum
,	O
int	O
adjuct_ofd	int
,	O
FILE_DIGS	struct
*	O
digs	pointer
)	O
{	O
int	O
fd	int
=	O
-	O
1	int
;	O
intmax_t	long
ret	long
=	O
0	int
;	O
char	O
*	O
tmpp	pointer
=	O
ahsStaticGetTarLinkname	function
(	O
file_hdr0	pointer
)	O
;	O
if	O
(	O
(	O
(	O
(	O
file_hdr0	pointer
->	O
c_mode	short
&	O
CP_IFMT	int
)	O
==	O
CP_IFREG	int
)	O
&&	O
(	O
tmpp	pointer
==	O
(	O
char	O
*	O
)	O
NULL	O
||	O
!	O
strlen	function
(	O
tmpp	pointer
)	O
)	O
)	O
)	O
{	O
if	O
(	O
input_fd	int
<	O
0	int
)	O
{	O
E_DEBUG	O
(	O
""	pointer
)	O
;	O
fd	int
=	O
open	function
(	O
ahsStaticGetTarFilename	function
(	O
file_hdr0	pointer
)	O
,	O
O_RDONLY	int
,	O
0	int
)	O
;	O
if	O
(	O
fd	int
<	O
0	int
)	O
{	O
fprintf	function
(	O
stderr	pointer
,	O
"open %s: %s\n"	pointer
,	O
ahsStaticGetTarFilename	function
(	O
file_hdr0	pointer
)	O
,	O
strerror	function
(	O
errno	O
)	O
)	O
;	O
return	O
-	O
1	int
;	O
}	O
input_fd	int
=	O
fd	int
;	O
}	O
if	O
(	O
fout	pointer
==	O
NULL	O
)	O
{	O
ret	long
=	O
swlib_pump_amount8	function
(	O
out_file_des	int
,	O
input_fd	int
,	O
(	O
intmax_t	long
)	O
(	O
file_hdr0	pointer
->	O
c_filesize	long
)	O
,	O
adjuct_ofd	int
,	O
digs	pointer
)	O
;	O
if	O
(	O
ret	long
<	O
0	int
)	O
{	O
E_DEBUG	O
(	O
""	pointer
)	O
;	O
if	O
(	O
fd	int
>=	O
0	int
)	O
close	pointer
(	O
fd	int
)	O
;	O
fprintf	function
(	O
stderr	pointer
,	O
"%s: error in taru_write_archive_member_data: ret=%s\n"	pointer
,	O
swlib_utilname_get	function
(	O
)	O
,	O
swlib_imaxtostr	function
(	O
ret	long
,	O
NULL	O
)	O
)	O
;	O
return	O
-	O
1	int
;	O
}	O
else	O
{	O
if	O
(	O
ret	long
!=	O
(	O
intmax_t	long
)	O
(	O
file_hdr0	pointer
->	O
c_filesize	long
)	O
)	O
{	O
E_DEBUG2	O
(	O
"Error: ret=%s"	pointer
,	O
swlib_imaxtostr	function
(	O
ret	long
,	O
NULL	O
)	O
)	O
;	O
E_DEBUG2	O
(	O
"Error: filesize=%s"	pointer
,	O
swlib_umaxtostr	function
(	O
file_hdr0	pointer
->	O
c_filesize	long
,	O
NULL	O
)	O
)	O
;	O
fprintf	function
(	O
stderr	pointer
,	O
"%s: taru_write_archive_member_data_ internal error. ret=%s\n"	pointer
,	O
swlib_utilname_get	function
(	O
)	O
,	O
swlib_imaxtostr	function
(	O
ret	long
,	O
NULL	O
)	O
)	O
;	O
return	O
-	O
1	int
;	O
}	O
else	O
{	O
}	O
if	O
(	O
(	O
ret	long
+=	O
taru_tape_pad_output	function
(	O
pad_out_file_des	int
,	O
(	O
intmax_t	long
)	O
(	O
file_hdr0	pointer
->	O
c_filesize	long
)	O
,	O
archive_format_out	enum
)	O
)	O
<	O
0	int
)	O
{	O
E_DEBUG	O
(	O
""	pointer
)	O
;	O
if	O
(	O
fd	int
>=	O
0	int
)	O
close	pointer
(	O
fd	int
)	O
;	O
return	O
-	O
1	int
;	O
}	O
if	O
(	O
adjuct_ofd	int
>=	O
0	int
)	O
{	O
if	O
(	O
taru_tape_pad_output	function
(	O
adjuct_ofd	int
,	O
(	O
intmax_t	long
)	O
(	O
file_hdr0	pointer
->	O
c_filesize	long
)	O
,	O
archive_format_out	enum
)	O
<	O
0	int
)	O
{	O
if	O
(	O
fd	int
>=	O
0	int
)	O
close	pointer
(	O
fd	int
)	O
;	O
return	O
-	O
1	int
;	O
}	O
}	O
}	O
}	O
else	O
{	O
ret	long
=	O
(	O
*	O
fout	pointer
)	O
(	O
out_file_des	int
)	O
;	O
}	O
if	O
(	O
fd	int
>=	O
0	int
)	O
close	pointer
(	O
fd	int
)	O
;	O
}	O
return	O
ret	long
;	O
}	O
static	O
int	O
tarui_tape_buffered_write	function
(	O
char	O
*	O
in_buf	pointer
,	O
int	O
out_des	int
,	O
long	O
num_bytes	long
,	O
char	O
*	O
header_buffer	pointer
)	O
{	O
if	O
(	O
header_buffer	pointer
)	O
{	O
memcpy	function
(	O
header_buffer	pointer
,	O
in_buf	pointer
,	O
num_bytes	long
)	O
;	O
return	O
0	int
;	O
}	O
else	O
{	O
return	O
taru_safewrite	function
(	O
out_des	int
,	O
in_buf	pointer
,	O
num_bytes	long
)	O
;	O
}	O
}	O
static	O
int	O
tape_clear_rest_of_block	function
(	O
int	O
out_file_des	int
,	O
char	O
*	O
zeros_512	pointer
,	O
int	O
io_block_size	int
,	O
uintmax_t	long
output_size	long
)	O
{	O
intmax_t	long
rem	long
=	O
output_size	long
%	O
(	O
intmax_t	long
)	O
io_block_size	int
;	O
intmax_t	long
n	long
=	O
rem	long
;	O
int	O
ret	long
=	O
0	int
;	O
int	O
retval	int
=	O
0	int
;	O
while	O
(	O
n	long
<	O
io_block_size	int
&&	O
ret	long
>=	O
0	int
)	O
{	O
if	O
(	O
(	O
io_block_size	int
-	O
n	long
)	O
>	O
512	int
)	O
{	O
ret	long
=	O
tarui_tape_buffered_write	function
(	O
zeros_512	pointer
,	O
out_file_des	int
,	O
512	int
,	O
(	O
char	O
*	O
)	O
(	O
NULL	O
)	O
)	O
;	O
}	O
else	O
{	O
ret	long
=	O
tarui_tape_buffered_write	function
(	O
zeros_512	pointer
,	O
out_file_des	int
,	O
io_block_size	int
-	O
n	long
,	O
(	O
char	O
*	O
)	O
(	O
NULL	O
)	O
)	O
;	O
}	O
if	O
(	O
ret	long
>	O
0	int
)	O
{	O
n	long
+=	O
ret	long
;	O
retval	int
+=	O
ret	long
;	O
}	O
else	O
{	O
fprintf	function
(	O
stderr	pointer
,	O
"taru: tape_clear_rest_of_block: error writing trailer block.\n"	pointer
)	O
;	O
}	O
}	O
return	O
retval	int
;	O
}	O
unsigned	O
long	O
taru_read_for_crc_checksum	function
(	O
int	O
in_file_des	int
,	O
int	O
file_size	int
,	O
char	O
*	O
file_name	pointer
)	O
{	O
unsigned	O
long	O
crc	long
;	O
char	O
buf	pointer
[	O
TARU_BUFSIZ	int
]	O
;	O
int	O
bytes_left	int
;	O
int	O
bytes_read	int
;	O
int	O
i	int
;	O
crc	long
=	O
0	int
;	O
for	O
(	O
bytes_left	int
=	O
file_size	int
;	O
bytes_left	int
>	O
0	int
;	O
bytes_left	int
-=	O
bytes_read	int
)	O
{	O
bytes_read	int
=	O
uxfio_sfread	function
(	O
in_file_des	int
,	O
buf	pointer
,	O
TARU_BUFSIZ	int
)	O
;	O
if	O
(	O
bytes_read	int
<	O
0	int
)	O
fprintf	function
(	O
stderr	pointer
,	O
"cannot read checksum for %s"	pointer
,	O
file_name	pointer
)	O
;	O
if	O
(	O
bytes_read	int
==	O
0	int
)	O
break	O
;	O
for	O
(	O
i	int
=	O
0	int
;	O
i	int
<	O
bytes_read	int
;	O
++	O
i	int
)	O
crc	long
+=	O
buf	pointer
[	O
i	int
]	O
&	O
0xff	int
;	O
}	O
return	O
crc	long
;	O
}	O
static	O
intmax_t	long
tarui_write_archive_member_	function
(	O
TARU	struct
*	O
taru	pointer
,	O
struct	O
stat	struct
*	O
file_stat	pointer
,	O
struct	O
new_cpio_header	struct
*	O
file_hdr0	pointer
,	O
HLLIST	struct
*	O
linkrecord	pointer
,	O
DEFER	struct
*	O
defer	pointer
,	O
PORINODE	struct
*	O
porinode	pointer
,	O
int	O
out_file_des	int
,	O
int	O
input_fd	int
,	O
enum	O
archive_format	enum
archive_format_out	enum
,	O
int	O
tarheaderflags	int
)	O
{	O
intmax_t	long
ret	long
=	O
0	int
;	O
intmax_t	long
ret1	long
=	O
0	int
;	O
size_t	long
sz	long
;	O
off_t	long
old_pos	long
;	O
struct	O
new_cpio_header	struct
*	O
file_hdr	pointer
=	O
ahsStaticCreateFilehdr	function
(	O
)	O
;	O
unsigned	O
long	O
sum	long
;	O
file_hdr0	pointer
->	O
c_chksum	long
=	O
0	int
;	O
if	O
(	O
archive_format_out	enum
==	O
arf_crcascii	int
&&	O
input_fd	int
>=	O
0	int
)	O
{	O
if	O
(	O
file_stat	pointer
)	O
{	O
sz	long
=	O
file_stat	pointer
->	O
st_size	long
;	O
}	O
else	O
{	O
sz	long
=	O
file_hdr0	pointer
->	O
c_filesize	long
;	O
}	O
old_pos	long
=	O
uxfio_lseek	function
(	O
input_fd	int
,	O
(	O
off_t	long
)	O
0	int
,	O
SEEK_CUR	int
)	O
;	O
sum	long
=	O
taru_read_for_crc_checksum	function
(	O
input_fd	int
,	O
sz	long
,	O
""	pointer
)	O
;	O
uxfio_lseek	function
(	O
input_fd	int
,	O
old_pos	long
,	O
SEEK_SET	int
)	O
;	O
file_hdr0	pointer
->	O
c_chksum	long
=	O
sum	long
;	O
}	O
ret	long
=	O
taru_write_archive_member_header	function
(	O
taru	pointer
,	O
file_stat	pointer
,	O
file_hdr0	pointer
,	O
linkrecord	pointer
,	O
defer	pointer
,	O
porinode	pointer
,	O
out_file_des	int
,	O
archive_format_out	enum
,	O
file_hdr	pointer
,	O
tarheaderflags	int
)	O
;	O
if	O
(	O
ret	long
<	O
0	int
)	O
{	O
fprintf	function
(	O
stderr	pointer
,	O
"error in taru_write_archive_member_header() called from"	pointer
" tarui_write_archive_member_().\n"	pointer
)	O
;	O
ahsStaticDeleteFilehdr	function
(	O
file_hdr	pointer
)	O
;	O
return	O
ret	long
;	O
}	O
if	O
(	O
(	O
(	O
file_hdr	pointer
->	O
c_mode	short
&	O
CP_IFMT	int
)	O
==	O
CP_IFREG	int
)	O
&&	O
(	O
ahsStaticGetTarLinkname	function
(	O
file_hdr	pointer
)	O
==	O
(	O
char	O
*	O
)	O
NULL	O
||	O
strlen	function
(	O
ahsStaticGetTarLinkname	function
(	O
file_hdr	pointer
)	O
)	O
==	O
0	int
)	O
&&	O
ret	long
>	O
0	int
)	O
{	O
ret1	long
=	O
taru_write_archive_member_data	function
(	O
taru	pointer
,	O
file_hdr	pointer
,	O
out_file_des	int
,	O
input_fd	int
,	O
(	O
int	O
(	O
*	O
)	O
(	O
int	O
)	O
)	O
(	O
NULL	O
)	O
,	O
archive_format_out	enum
,	O
-	O
1	int
,	O
file_hdr0	pointer
->	O
digsM	pointer
)	O
;	O
if	O
(	O
ret1	long
<	O
0	int
)	O
{	O
ahsStaticDeleteFilehdr	function
(	O
file_hdr	pointer
)	O
;	O
return	O
ret1	long
;	O
}	O
}	O
else	O
{	O
if	O
(	O
file_hdr0	pointer
->	O
digsM	pointer
)	O
taru_digs_init	function
(	O
file_hdr0	pointer
->	O
digsM	pointer
,	O
DIGS_ENABLE_CLEAR	O
,	O
0	int
)	O
;	O
}	O
ahsStaticDeleteFilehdr	function
(	O
file_hdr	pointer
)	O
;	O
return	O
ret	long
+	O
ret1	long
;	O
}	O
static	O
int	O
get_ilen	function
(	O
int	O
rlen	int
)	O
{	O
int	O
i	int
=	O
0	int
;	O
int	O
j	int
=	O
0	int
;	O
int	O
r	int
=	O
rlen	int
;	O
while	O
(	O
r	int
/	O
10	int
>=	O
1	int
)	O
{	O
i	int
++	O
;	O
r	int
=	O
r	int
/	O
10	int
;	O
}	O
i	int
++	O
;	O
r	int
=	O
rlen	int
+	O
i	int
;	O
while	O
(	O
i	int
<	O
99	int
)	O
{	O
j	int
=	O
0	int
;	O
while	O
(	O
r	int
/	O
10	int
>=	O
1	int
)	O
{	O
j	int
++	O
;	O
r	int
=	O
r	int
/	O
10	int
;	O
}	O
j	int
++	O
;	O
if	O
(	O
i	int
==	O
j	int
)	O
return	O
i	int
+	O
rlen	int
;	O
i	int
++	O
;	O
r	int
=	O
rlen	int
+	O
i	int
;	O
}	O
return	O
-	O
1	int
;	O
}	O
static	O
int	O
construct_exthdr_record	function
(	O
STROB	struct
*	O
buf	pointer
,	O
int	O
initial_offset	int
,	O
char	O
*	O
keyword	pointer
,	O
char	O
*	O
value	int
,	O
int	O
len	long
)	O
{	O
int	O
rlen	int
;	O
int	O
ret	long
;	O
rlen	int
=	O
1	int
+	O
strlen	function
(	O
keyword	pointer
)	O
+	O
len	long
+	O
1	int
+	O
1	int
;	O
ret	long
=	O
get_ilen	function
(	O
rlen	int
)	O
;	O
if	O
(	O
ret	long
<	O
0	int
)	O
{	O
fprintf	function
(	O
stderr	pointer
,	O
"internal error in construct_exthdr_record loc=1\n"	pointer
)	O
;	O
exit	function
(	O
120	int
)	O
;	O
}	O
rlen	int
=	O
ret	long
;	O
strob_sprintf_at	function
(	O
buf	pointer
,	O
initial_offset	int
,	O
"%d %s="	pointer
,	O
rlen	int
,	O
keyword	pointer
)	O
;	O
ret	long
=	O
strlen	function
(	O
strob_str	function
(	O
buf	pointer
)	O
+	O
initial_offset	int
)	O
;	O
strob_memcpy_at	function
(	O
buf	pointer
,	O
initial_offset	int
+	O
ret	long
,	O
(	O
void	O
*	O
)	O
value	int
,	O
(	O
size_t	long
)	O
len	long
)	O
;	O
if	O
(	O
(	O
ret	long
+	O
len	long
+	O
1	int
)	O
!=	O
rlen	int
)	O
{	O
fprintf	function
(	O
stderr	pointer
,	O
"internal error in construct_exthdr_record loc=2\n"	pointer
)	O
;	O
exit	function
(	O
121	int
)	O
;	O
}	O
strob_memcpy_at	function
(	O
buf	pointer
,	O
initial_offset	int
+	O
rlen	int
-	O
1	int
,	O
(	O
void	O
*	O
)	O
"\n"	pointer
,	O
1	int
)	O
;	O
return	O
rlen	int
;	O
}	O
static	O
int	O
write_exthdrs_xattr_records	function
(	O
TARU	struct
*	O
taru	pointer
,	O
struct	O
new_cpio_header	struct
*	O
file_hdr	pointer
,	O
int	O
data_len	pointer
)	O
{	O
int	O
ret	long
;	O
STROB	struct
*	O
buf	pointer
;	O
CPLOB	struct
*	O
extlist	pointer
;	O
EXATT	struct
*	O
p	pointer
;	O
char	O
*	O
attr	pointer
;	O
char	O
*	O
value	int
;	O
int	O
valuelen	int
;	O
int	O
index	function
;	O
buf	pointer
=	O
taru	pointer
->	O
exthdr_dataM	pointer
;	O
extlist	pointer
=	O
(	O
CPLOB	struct
*	O
)	O
(	O
file_hdr	pointer
->	O
extattlistM	pointer
)	O
;	O
index	function
=	O
0	int
;	O
while	O
(	O
extlist	pointer
&&	O
(	O
p	pointer
=	O
(	O
EXATT	struct
*	O
)	O
cplob_val	function
(	O
extlist	pointer
,	O
index	function
)	O
)	O
&&	O
p	pointer
->	O
is_in_useM	int
)	O
{	O
strob_sprintf	function
(	O
taru	pointer
->	O
localbufM	pointer
,	O
0	int
,	O
"%s%s%s%s%s"	pointer
,	O
p	pointer
->	O
vendorM	array
,	O
strlen	function
(	O
p	pointer
->	O
vendorM	array
)	O
?	O
"."	pointer
:	O
""	pointer
,	O
p	pointer
->	O
namespaceM	array
,	O
strlen	function
(	O
p	pointer
->	O
namespaceM	array
)	O
?	O
"."	pointer
:	O
""	pointer
,	O
strob_str	function
(	O
(	O
STROB	struct
*	O
)	O
p	pointer
->	O
attrnameM	pointer
)	O
)	O
;	O
value	int
=	O
strob_str	function
(	O
p	pointer
->	O
attrvalueM	pointer
)	O
;	O
valuelen	int
=	O
p	pointer
->	O
lenM	int
;	O
ret	long
=	O
construct_exthdr_record	function
(	O
buf	pointer
,	O
data_len	pointer
,	O
strob_str	function
(	O
taru	pointer
->	O
localbufM	pointer
)	O
,	O
value	int
,	O
valuelen	int
)	O
;	O
if	O
(	O
ret	long
<	O
0	int
)	O
return	O
-	O
1	int
;	O
data_len	pointer
+=	O
ret	long
;	O
index	function
++	O
;	O
}	O
return	O
data_len	pointer
;	O
}	O
static	O
int	O
write_exthdrs_ustar_records	function
(	O
TARU	struct
*	O
taru	pointer
,	O
struct	O
new_cpio_header	struct
*	O
file_hdr	pointer
)	O
{	O
int	O
data_len	pointer
;	O
int	O
ret	long
;	O
STROB	struct
*	O
buf	pointer
;	O
buf	pointer
=	O
taru	pointer
->	O
exthdr_dataM	pointer
;	O
data_len	pointer
=	O
0	int
;	O
if	O
(	O
file_hdr	pointer
->	O
extHeader_needs_maskM	int
&	O
TARU_EHUM_LINKPATH	O
)	O
{	O
ret	long
=	O
construct_exthdr_record	function
(	O
buf	pointer
,	O
data_len	pointer
,	O
PAX_KW_linkpath	pointer
,	O
ahsStaticGetTarLinkname	function
(	O
file_hdr	pointer
)	O
,	O
strlen	function
(	O
ahsStaticGetTarLinkname	function
(	O
file_hdr	pointer
)	O
)	O
)	O
;	O
if	O
(	O
ret	long
<	O
0	int
)	O
return	O
-	O
1	int
;	O
E_DEBUG2	O
(	O
"LINKPATH: [%s]"	pointer
,	O
ahsStaticGetTarLinkname	function
(	O
file_hdr	pointer
)	O
)	O
;	O
strob_chr_index	function
(	O
(	O
STROB	struct
*	O
)	O
(	O
file_hdr	pointer
->	O
c_tar_linkname	pointer
)	O
,	O
TARNAMESIZE	int
,	O
'\0'	O
)	O
;	O
data_len	pointer
+=	O
ret	long
;	O
}	O
if	O
(	O
file_hdr	pointer
->	O
extHeader_needs_maskM	int
&	O
TARU_EHUM_PATH	O
)	O
{	O
ret	long
=	O
construct_exthdr_record	function
(	O
buf	pointer
,	O
data_len	pointer
,	O
PAX_KW_path	pointer
,	O
ahsStaticGetTarFilename	function
(	O
file_hdr	pointer
)	O
,	O
strlen	function
(	O
ahsStaticGetTarFilename	function
(	O
file_hdr	pointer
)	O
)	O
)	O
;	O
if	O
(	O
ret	long
<	O
0	int
)	O
return	O
-	O
2	int
;	O
E_DEBUG2	O
(	O
"PATH: [%s]"	pointer
,	O
ahsStaticGetTarFilename	function
(	O
file_hdr	pointer
)	O
)	O
;	O
strob_chr_index	function
(	O
(	O
STROB	struct
*	O
)	O
(	O
file_hdr	pointer
->	O
c_name	pointer
)	O
,	O
TARNAMESIZE	int
,	O
'\0'	O
)	O
;	O
data_len	pointer
+=	O
ret	long
;	O
}	O
if	O
(	O
file_hdr	pointer
->	O
extHeader_needs_maskM	int
&	O
TARU_EHUM_SIZE	O
)	O
{	O
strob_sprintf	function
(	O
taru	pointer
->	O
localbufM	pointer
,	O
0	int
,	O
"%lu"	pointer
,	O
(	O
unsigned	O
long	O
)	O
(	O
file_hdr	pointer
->	O
c_filesize	long
)	O
)	O
;	O
ret	long
=	O
construct_exthdr_record	function
(	O
buf	pointer
,	O
data_len	pointer
,	O
PAX_KW_size	pointer
,	O
strob_str	function
(	O
taru	pointer
->	O
localbufM	pointer
)	O
,	O
strob_strlen	function
(	O
taru	pointer
->	O
localbufM	pointer
)	O
)	O
;	O
if	O
(	O
ret	long
<	O
0	int
)	O
return	O
-	O
3	int
;	O
file_hdr	pointer
->	O
c_filesize	long
=	O
TAR_MAX_SIZE	int
;	O
data_len	pointer
+=	O
ret	long
;	O
}	O
if	O
(	O
file_hdr	pointer
->	O
extHeader_needs_maskM	int
&	O
TARU_EHUM_UID	O
)	O
{	O
strob_sprintf	function
(	O
taru	pointer
->	O
localbufM	pointer
,	O
0	int
,	O
"%lu"	pointer
,	O
(	O
unsigned	O
long	O
)	O
(	O
file_hdr	pointer
->	O
c_uid	short
)	O
)	O
;	O
ret	long
=	O
construct_exthdr_record	function
(	O
buf	pointer
,	O
data_len	pointer
,	O
PAX_KW_uid	pointer
,	O
strob_str	function
(	O
taru	pointer
->	O
localbufM	pointer
)	O
,	O
strob_strlen	function
(	O
taru	pointer
->	O
localbufM	pointer
)	O
)	O
;	O
if	O
(	O
ret	long
<	O
0	int
)	O
return	O
-	O
4	int
;	O
file_hdr	pointer
->	O
c_uid	short
=	O
TAR_MAX_UID	O
;	O
data_len	pointer
+=	O
ret	long
;	O
}	O
if	O
(	O
file_hdr	pointer
->	O
extHeader_needs_maskM	int
&	O
TARU_EHUM_GID	O
)	O
{	O
strob_sprintf	function
(	O
taru	pointer
->	O
localbufM	pointer
,	O
0	int
,	O
"%lu"	pointer
,	O
(	O
unsigned	O
long	O
)	O
(	O
file_hdr	pointer
->	O
c_gid	short
)	O
)	O
;	O
ret	long
=	O
construct_exthdr_record	function
(	O
buf	pointer
,	O
data_len	pointer
,	O
PAX_KW_gid	pointer
,	O
strob_str	function
(	O
taru	pointer
->	O
localbufM	pointer
)	O
,	O
strob_strlen	function
(	O
taru	pointer
->	O
localbufM	pointer
)	O
)	O
;	O
if	O
(	O
ret	long
<	O
0	int
)	O
return	O
-	O
5	int
;	O
file_hdr	pointer
->	O
c_uid	short
=	O
TAR_MAX_GID	O
;	O
data_len	pointer
+=	O
ret	long
;	O
}	O
if	O
(	O
file_hdr	pointer
->	O
extHeader_needs_maskM	int
&	O
TARU_EHUM_UNAME	O
)	O
{	O
ret	long
=	O
construct_exthdr_record	function
(	O
buf	pointer
,	O
data_len	pointer
,	O
PAX_KW_uname	pointer
,	O
ahsStaticGetTarUsername	function
(	O
file_hdr	pointer
)	O
,	O
strlen	function
(	O
ahsStaticGetTarUsername	function
(	O
file_hdr	pointer
)	O
)	O
)	O
;	O
if	O
(	O
ret	long
<	O
0	int
)	O
return	O
-	O
6	int
;	O
strob_chr_index	function
(	O
(	O
STROB	struct
*	O
)	O
(	O
file_hdr	pointer
->	O
c_username	pointer
)	O
,	O
THB_FL_uname	int
-	O
1	int
,	O
'\0'	O
)	O
;	O
data_len	pointer
+=	O
ret	long
;	O
}	O
if	O
(	O
file_hdr	pointer
->	O
extHeader_needs_maskM	int
&	O
TARU_EHUM_GNAME	O
)	O
{	O
ret	long
=	O
construct_exthdr_record	function
(	O
buf	pointer
,	O
data_len	pointer
,	O
PAX_KW_gname	pointer
,	O
ahsStaticGetTarGroupname	function
(	O
file_hdr	pointer
)	O
,	O
strlen	function
(	O
ahsStaticGetTarGroupname	function
(	O
file_hdr	pointer
)	O
)	O
)	O
;	O
if	O
(	O
ret	long
<	O
0	int
)	O
return	O
-	O
7	int
;	O
strob_chr_index	function
(	O
(	O
STROB	struct
*	O
)	O
(	O
file_hdr	pointer
->	O
c_groupname	pointer
)	O
,	O
THB_FL_gname	int
-	O
1	int
,	O
'\0'	O
)	O
;	O
data_len	pointer
+=	O
ret	long
;	O
}	O
if	O
(	O
file_hdr	pointer
->	O
extHeader_needs_maskM	int
&	O
TARU_EHUM_DEV_MAJ	O
)	O
{	O
strob_sprintf	function
(	O
taru	pointer
->	O
localbufM	pointer
,	O
0	int
,	O
"%lu"	pointer
,	O
(	O
unsigned	O
long	O
)	O
(	O
file_hdr	pointer
->	O
c_dev_maj	long
)	O
)	O
;	O
ret	long
=	O
construct_exthdr_record	function
(	O
buf	pointer
,	O
data_len	pointer
,	O
SWBIS_VENDOR	pointer
"."	pointer
PAX_KW_devmajor	pointer
,	O
strob_str	function
(	O
taru	pointer
->	O
localbufM	pointer
)	O
,	O
strob_strlen	function
(	O
taru	pointer
->	O
localbufM	pointer
)	O
)	O
;	O
if	O
(	O
ret	long
<	O
0	int
)	O
return	O
-	O
8	int
;	O
file_hdr	pointer
->	O
c_dev_maj	long
=	O
TAR_MAX_DEVICE	O
;	O
data_len	pointer
+=	O
ret	long
;	O
}	O
if	O
(	O
file_hdr	pointer
->	O
extHeader_needs_maskM	int
&	O
TARU_EHUM_DEV_MIN	O
)	O
{	O
strob_sprintf	function
(	O
taru	pointer
->	O
localbufM	pointer
,	O
0	int
,	O
"%lu"	pointer
,	O
(	O
unsigned	O
long	O
)	O
(	O
file_hdr	pointer
->	O
c_dev_min	long
)	O
)	O
;	O
ret	long
=	O
construct_exthdr_record	function
(	O
buf	pointer
,	O
data_len	pointer
,	O
SWBIS_VENDOR	pointer
"."	pointer
PAX_KW_devminor	pointer
,	O
strob_str	function
(	O
taru	pointer
->	O
localbufM	pointer
)	O
,	O
strob_strlen	function
(	O
taru	pointer
->	O
localbufM	pointer
)	O
)	O
;	O
if	O
(	O
ret	long
<	O
0	int
)	O
return	O
-	O
9	int
;	O
file_hdr	pointer
->	O
c_dev_min	long
=	O
TAR_MAX_DEVICE	O
;	O
data_len	pointer
+=	O
ret	long
;	O
}	O
return	O
data_len	pointer
;	O
}	O
int	O
taru_safewrite	function
(	O
int	O
fd	int
,	O
void	O
*	O
vbuf	pointer
,	O
size_t	long
amount	long
)	O
{	O
int	O
rc	int
=	O
0	int
;	O
char	O
*	O
buf	pointer
=	O
vbuf	pointer
;	O
while	O
(	O
amount	long
&&	O
(	O
(	O
rc	int
=	O
uxfio_write	function
(	O
fd	int
,	O
buf	pointer
,	O
amount	long
)	O
)	O
<	O
(	O
int	O
)	O
amount	long
)	O
&&	O
rc	int
>	O
0	int
)	O
{	O
buf	pointer
+=	O
rc	int
;	O
amount	long
-=	O
rc	int
;	O
}	O
if	O
(	O
rc	int
<	O
0	int
)	O
return	O
-	O
(	O
(	O
int	O
)	O
(	O
amount	long
)	O
)	O
;	O
return	O
(	O
int	O
)	O
amount	long
;	O
}	O
int	O
taru_write_archive_trailer	function
(	O
TARU	struct
*	O
taru	pointer
,	O
enum	O
archive_format	enum
archive_format_out	enum
,	O
int	O
fd	int
,	O
int	O
io_block_size	int
,	O
uintmax_t	long
bytes_written	long
,	O
int	O
flags	int
)	O
{	O
int	O
ret	long
;	O
int	O
retval	int
=	O
0	int
;	O
struct	O
new_cpio_header	struct
*	O
file_hdr	pointer
=	O
ahsStaticCreateFilehdr	function
(	O
)	O
;	O
char	O
zeros_512	pointer
[	O
512	int
]	O
;	O
int	O
gnu_tar_block_size	int
=	O
10240	int
;	O
memset	function
(	O
zeros_512	pointer
,	O
0x00	int
,	O
512	int
)	O
;	O
if	O
(	O
io_block_size	int
)	O
gnu_tar_block_size	int
=	O
io_block_size	int
;	O
if	O
(	O
archive_format_out	enum
!=	O
arf_tar	int
&&	O
archive_format_out	enum
!=	O
arf_ustar	int
)	O
{	O
io_block_size	int
=	O
512	int
;	O
file_hdr	pointer
->	O
c_ino	short
=	O
0	int
;	O
file_hdr	pointer
->	O
c_mode	short
=	O
0	int
;	O
file_hdr	pointer
->	O
c_uid	short
=	O
0	int
;	O
file_hdr	pointer
->	O
c_gid	short
=	O
0	int
;	O
file_hdr	pointer
->	O
c_nlink	short
=	O
1	int
;	O
file_hdr	pointer
->	O
c_dev_maj	long
=	O
0	int
;	O
file_hdr	pointer
->	O
c_dev_min	long
=	O
0	int
;	O
file_hdr	pointer
->	O
c_rdev_maj	long
=	O
0	int
;	O
file_hdr	pointer
->	O
c_rdev_min	long
=	O
0	int
;	O
file_hdr	pointer
->	O
c_mtime	long
=	O
0	int
;	O
file_hdr	pointer
->	O
c_chksum	long
=	O
0	int
;	O
file_hdr	pointer
->	O
c_filesize	long
=	O
0	int
;	O
file_hdr	pointer
->	O
c_namesize	short
=	O
11	int
;	O
ahsStaticSetTarFilename	function
(	O
file_hdr	pointer
,	O
CPIO_INBAND_EOA_FILENAME	pointer
)	O
;	O
ret	long
=	O
taru_write_out_header	function
(	O
taru	pointer
,	O
file_hdr	pointer
,	O
fd	int
,	O
archive_format_out	enum
,	O
(	O
char	O
*	O
)	O
(	O
NULL	O
)	O
,	O
0	int
)	O
;	O
if	O
(	O
bytes_written	long
)	O
{	O
if	O
(	O
ret	long
>	O
0	int
)	O
bytes_written	long
+=	O
ret	long
;	O
ret	long
+=	O
tape_clear_rest_of_block	function
(	O
fd	int
,	O
zeros_512	pointer
,	O
io_block_size	int
,	O
bytes_written	long
)	O
;	O
}	O
}	O
else	O
{	O
int	O
nblock	int
;	O
if	O
(	O
bytes_written	long
%	O
512	int
)	O
{	O
char	O
tmpbuf	array
[	O
UINTMAX_STRSIZE_BOUND	O
]	O
;	O
fprintf	function
(	O
stderr	pointer
,	O
"internal error, bytes written not multiple of 512, bytes=%s\n"	pointer
,	O
umaxtostr	function
(	O
bytes_written	long
,	O
tmpbuf	array
)	O
)	O
;	O
flags	int
=	O
0	int
;	O
retval	int
=	O
1	int
;	O
}	O
if	O
(	O
flags	int
&	O
TARU_TAR_GNU_BLOCKSIZE_B1	O
)	O
{	O
nblock	int
=	O
2	int
;	O
if	O
(	O
flags	int
&	O
TARU_TAR_BE_LIKE_STAR	O
)	O
{	O
nblock	int
=	O
3	int
;	O
}	O
}	O
else	O
if	O
(	O
flags	int
&	O
TARU_TAR_GNU_OLDGNUTAR	O
)	O
{	O
int	O
n_tar_blocks	int
=	O
gnu_tar_block_size	int
/	O
512	int
;	O
nblock	int
=	O
(	O
bytes_written	long
%	O
gnu_tar_block_size	int
)	O
/	O
512	int
;	O
nblock	int
=	O
n_tar_blocks	int
-	O
nblock	int
;	O
if	O
(	O
nblock	int
<	O
2	int
)	O
nblock	int
+=	O
n_tar_blocks	int
;	O
}	O
else	O
{	O
nblock	int
=	O
2	int
;	O
}	O
ret	long
=	O
0	int
;	O
while	O
(	O
nblock	int
>	O
0	int
)	O
{	O
ret	long
+=	O
tarui_tape_buffered_write	function
(	O
zeros_512	pointer
,	O
fd	int
,	O
512	int
,	O
(	O
char	O
*	O
)	O
(	O
NULL	O
)	O
)	O
;	O
nblock	int
--	O
;	O
}	O
}	O
ahsStaticDeleteFilehdr	function
(	O
file_hdr	pointer
)	O
;	O
if	O
(	O
retval	int
)	O
return	O
-	O
1	int
;	O
return	O
ret	long
;	O
}	O
intmax_t	long
taru_write_archive_member	function
(	O
TARU	struct
*	O
taru	pointer
,	O
char	O
*	O
filename	pointer
,	O
struct	O
stat	struct
*	O
statbuf	pointer
,	O
struct	O
new_cpio_header	struct
*	O
file_hdr0	pointer
,	O
HLLIST	struct
*	O
linkrec	pointer
,	O
DEFER	struct
*	O
defer	pointer
,	O
PORINODE	struct
*	O
porinode	pointer
,	O
int	O
ofd	int
,	O
int	O
in_fd	int
,	O
enum	O
archive_format	enum
format	pointer
,	O
int	O
tarheaderflags	int
)	O
{	O
char	O
linkname	array
[	O
101	int
]	O
;	O
struct	O
stat	struct
st	pointer
;	O
struct	O
new_cpio_header	struct
*	O
file_hdr	pointer
=	O
ahsStaticCreateFilehdr	function
(	O
)	O
;	O
int	O
fd	int
=	O
-	O
1	int
;	O
intmax_t	long
ret	long
=	O
0	int
;	O
int	O
nullfd	int
=	O
-	O
1	int
;	O
char	O
*	O
p	pointer
;	O
int	O
vlen	int
=	O
1024	int
;	O
E_DEBUG	O
(	O
"ENTERING"	pointer
)	O
;	O
E_DEBUG2	O
(	O
"filename=[%s]"	pointer
,	O
filename	pointer
)	O
;	O
*	O
linkname	array
=	O
'\0'	O
;	O
if	O
(	O
statbuf	pointer
)	O
{	O
E_DEBUG	O
(	O
"statbuf"	pointer
)	O
;	O
taru_statbuf2filehdr	function
(	O
file_hdr	pointer
,	O
statbuf	pointer
,	O
NULL	O
,	O
filename	pointer
,	O
linkname	array
)	O
;	O
}	O
else	O
if	O
(	O
file_hdr0	pointer
)	O
{	O
E_DEBUG	O
(	O
"file_hdr0"	pointer
)	O
;	O
taru_filehdr2filehdr	function
(	O
file_hdr	pointer
,	O
file_hdr0	pointer
)	O
;	O
}	O
else	O
{	O
E_DEBUG	O
(	O
"else"	pointer
)	O
;	O
if	O
(	O
lstat	function
(	O
filename	pointer
,	O
&	O
st	pointer
)	O
==	O
0	int
)	O
{	O
statbuf	pointer
=	O
&	O
st	pointer
;	O
E_DEBUG	O
(	O
"lstat"	pointer
)	O
;	O
taru_statbuf2filehdr	function
(	O
file_hdr	pointer
,	O
statbuf	pointer
,	O
NULL	O
,	O
filename	pointer
,	O
linkname	array
)	O
;	O
}	O
else	O
{	O
fprintf	function
(	O
stderr	pointer
,	O
"swbis: %s %s\n"	pointer
,	O
filename	pointer
,	O
strerror	function
(	O
errno	O
)	O
)	O
;	O
ahsStaticDeleteFilehdr	function
(	O
file_hdr	pointer
)	O
;	O
return	O
-	O
1	int
;	O
}	O
}	O
fd	int
=	O
in_fd	int
;	O
if	O
(	O
fd	int
<	O
0	int
)	O
{	O
switch	O
(	O
file_hdr	pointer
->	O
c_mode	short
&	O
CP_IFMT	int
)	O
{	O
case	O
CP_IFDIR	int
:	O
if	O
(	O
access	function
(	O
filename	pointer
,	O
R_OK	int
|	O
X_OK	int
)	O
!=	O
0	int
)	O
{	O
fprintf	function
(	O
stderr	pointer
,	O
"swbis: %s: %s\n"	pointer
,	O
strerror	function
(	O
errno	O
)	O
,	O
filename	pointer
)	O
;	O
ahsStaticDeleteFilehdr	function
(	O
file_hdr	pointer
)	O
;	O
return	O
0	int
;	O
}	O
break	O
;	O
case	O
CP_IFREG	int
:	O
if	O
(	O
file_hdr	pointer
->	O
c_filesize	long
>	O
0	int
)	O
{	O
fd	int
=	O
open	function
(	O
filename	pointer
,	O
O_RDONLY	int
,	O
0	int
)	O
;	O
}	O
else	O
{	O
fd	int
=	O
swbis_devnull_open	O
(	O
"/dev/null"	pointer
,	O
O_RDWR	int
,	O
0	int
)	O
;	O
nullfd	int
=	O
fd	int
;	O
}	O
if	O
(	O
fd	int
<	O
0	int
)	O
{	O
fprintf	function
(	O
stderr	pointer
,	O
"swbis: %s: %s\n"	pointer
,	O
strerror	function
(	O
errno	O
)	O
,	O
filename	pointer
)	O
;	O
ahsStaticDeleteFilehdr	function
(	O
file_hdr	pointer
)	O
;	O
return	O
0	int
;	O
}	O
break	O
;	O
case	O
CP_IFLNK	int
:	O
ahsStaticSetTarLinknameLength	function
(	O
file_hdr	pointer
,	O
vlen	int
)	O
;	O
p	pointer
=	O
ahsStaticGetTarLinkname	function
(	O
file_hdr	pointer
)	O
;	O
*	O
(	O
p	pointer
+	O
vlen	int
-	O
1	int
)	O
=	O
'\0'	O
;	O
ret	long
=	O
swvarfs_u_readlink	function
(	O
NULL	O
,	O
filename	pointer
,	O
p	pointer
,	O
vlen	int
-	O
1	int
)	O
;	O
if	O
(	O
ret	long
<	O
0	int
)	O
{	O
fprintf	function
(	O
stderr	pointer
,	O
"swbis: %s: %s\n"	pointer
,	O
strerror	function
(	O
errno	O
)	O
,	O
filename	pointer
)	O
;	O
}	O
break	O
;	O
default	O
:	O
fd	int
=	O
-	O
1	int
;	O
break	O
;	O
}	O
}	O
ret	long
=	O
tarui_write_archive_member_	function
(	O
taru	pointer
,	O
statbuf	pointer
,	O
file_hdr	pointer
,	O
linkrec	pointer
,	O
defer	pointer
,	O
porinode	pointer
,	O
ofd	int
,	O
fd	int
,	O
format	pointer
,	O
tarheaderflags	int
)	O
;	O
if	O
(	O
fd	int
>=	O
0	int
&&	O
nullfd	int
!=	O
fd	int
)	O
{	O
close	pointer
(	O
fd	int
)	O
;	O
}	O
else	O
{	O
swbis_devnull_close	O
(	O
fd	int
)	O
;	O
}	O
ahsStaticDeleteFilehdr	function
(	O
file_hdr	pointer
)	O
;	O
return	O
ret	long
;	O
}	O
intmax_t	long
taru_write_archive_member_data	function
(	O
TARU	struct
*	O
taru	pointer
,	O
struct	O
new_cpio_header	struct
*	O
file_hdr0	pointer
,	O
int	O
out_file_des	int
,	O
int	O
input_fd	int
,	O
int	O
(	O
*	O
fout	pointer
)	O
(	O
int	O
)	O
,	O
enum	O
archive_format	enum
archive_format_out	enum
,	O
int	O
adjuct_ofd	int
,	O
FILE_DIGS	struct
*	O
digs	pointer
)	O
{	O
intmax_t	long
ret	long
;	O
ret	long
=	O
taru_write_archive_member_data_	function
(	O
taru	pointer
,	O
file_hdr0	pointer
,	O
out_file_des	int
,	O
out_file_des	int
,	O
input_fd	int
,	O
fout	pointer
,	O
archive_format_out	enum
,	O
adjuct_ofd	int
,	O
digs	pointer
)	O
;	O
return	O
ret	long
;	O
}	O
intmax_t	long
taru_write_archive_file_data	function
(	O
TARU	struct
*	O
taru	pointer
,	O
struct	O
new_cpio_header	struct
*	O
file_hdr0	pointer
,	O
int	O
out_file_des	int
,	O
int	O
input_fd	int
,	O
int	O
(	O
*	O
fout	pointer
)	O
(	O
int	O
)	O
,	O
enum	O
archive_format	enum
archive_format_out	enum
,	O
int	O
adjuct_ofd	int
)	O
{	O
intmax_t	long
ret	long
;	O
int	O
nullfd	int
;	O
if	O
(	O
!	O
taru	pointer
)	O
nullfd	int
=	O
swbis_devnull_open	O
(	O
"/dev/null"	pointer
,	O
O_RDWR	int
,	O
0	int
)	O
;	O
else	O
nullfd	int
=	O
taru	pointer
->	O
nullfdM	int
;	O
if	O
(	O
adjuct_ofd	int
>=	O
0	int
)	O
{	O
SWLIB_FATAL	O
(	O
"adjuct_ofd"	pointer
)	O
;	O
}	O
ret	long
=	O
taru_write_archive_member_data_	function
(	O
taru	pointer
,	O
file_hdr0	pointer
,	O
out_file_des	int
,	O
nullfd	int
,	O
input_fd	int
,	O
fout	pointer
,	O
archive_format_out	enum
,	O
-	O
1	int
,	O
file_hdr0	pointer
->	O
digsM	pointer
)	O
;	O
if	O
(	O
!	O
taru	pointer
)	O
swbis_devnull_close	O
(	O
nullfd	int
)	O
;	O
return	O
ret	long
;	O
}	O
int	O
taru_write_archive_member_header	function
(	O
TARU	struct
*	O
taru	pointer
,	O
struct	O
stat	struct
*	O
file_stat	pointer
,	O
struct	O
new_cpio_header	struct
*	O
file_hdr0	pointer
,	O
HLLIST	struct
*	O
linkrecord	pointer
,	O
DEFER	struct
*	O
defer	pointer
,	O
PORINODE	struct
*	O
porinode	pointer
,	O
int	O
out_file_des	int
,	O
enum	O
archive_format	enum
archive_format_out	enum
,	O
struct	O
new_cpio_header	struct
*	O
file_hdr_return	pointer
,	O
int	O
tarheaderflags	int
)	O
{	O
int	O
do_gnu_long_link	int
=	O
0	int
;	O
int	O
do_gnu_long_name	int
=	O
0	int
;	O
int	O
do_gnu_long_link_name_bytes	int
=	O
0	int
;	O
int	O
do_gnu_long_link_link_bytes	int
=	O
0	int
;	O
int	O
do_exthdr_bytes	int
=	O
0	int
;	O
int	O
nfound	pointer
=	O
0	int
,	O
retval	int
=	O
0	int
;	O
int	O
ret	long
;	O
hllist_entry	struct
*	O
link_record_buf	pointer
=	O
NULL	O
;	O
char	O
*	O
tmpp	pointer
;	O
struct	O
new_cpio_header	struct
*	O
file_hdr	pointer
;	O
dev_t	long
v_dev	long
;	O
ino_t	long
v_ino	long
;	O
int	O
is_dir	int
;	O
unsigned	O
long	O
c_type	long
;	O
int	O
do_strip_leading_slash	int
=	O
0	int
;	O
int	O
linkrecord_active	int
;	O
int	O
is_too_long	int
;	O
char	O
link_name	array
[	O
128	int
]	O
;	O
int	O
link_size	int
;	O
char	O
*	O
sbase	pointer
;	O
ETAR	struct
*	O
etar	pointer
;	O
int	O
tar_iflags_numeric_uids	int
=	O
(	O
tarheaderflags	int
&	O
TARU_TAR_NUMERIC_UIDS	O
)	O
;	O
E_DEBUG	O
(	O
"BEGIN"	pointer
)	O
;	O
file_hdr	pointer
=	O
ahsStaticCreateFilehdr	function
(	O
)	O
;	O
linkrecord_active	int
=	O
(	O
linkrecord	pointer
!=	O
NULL	O
&&	O
taru	pointer
->	O
linkrecord_disableM	int
==	O
0	int
)	O
;	O
if	O
(	O
taru	pointer
)	O
{	O
do_strip_leading_slash	int
=	O
tarheaderflags	int
&	O
TARU_TAR_DO_STRIP_LEADING_SLASH	O
;	O
}	O
E_DEBUG2	O
(	O
"HERE tarheaderflags=%d"	pointer
,	O
tarheaderflags	int
)	O
;	O
taru_filehdr2filehdr	function
(	O
file_hdr	pointer
,	O
file_hdr0	pointer
)	O
;	O
SWLIB_ASSERT	O
(	O
file_stat	pointer
==	O
NULL	O
)	O
;	O
if	O
(	O
porinode	pointer
&&	O
!	O
file_stat	pointer
&&	O
(	O
archive_format_out	enum
==	O
arf_oldascii	int
||	O
archive_format_out	enum
==	O
arf_newascii	int
||	O
archive_format_out	enum
==	O
arf_crcascii	int
)	O
)	O
{	O
int	O
mylink	int
=	O
file_hdr	pointer
->	O
c_nlink	short
;	O
E_DEBUG	O
(	O
""	pointer
)	O
;	O
switch	O
(	O
file_hdr	pointer
->	O
c_mode	short
&	O
CP_IFMT	int
)	O
{	O
case	O
CP_IFLNK	int
:	O
case	O
CP_IFDIR	int
:	O
mylink	int
=	O
1	int
;	O
break	O
;	O
}	O
porinode_make_next_inode	function
(	O
porinode	pointer
,	O
mylink	int
,	O
(	O
dev_t	long
)	O
makedev	O
(	O
file_hdr	pointer
->	O
c_dev_maj	long
,	O
file_hdr	pointer
->	O
c_dev_min	long
)	O
,	O
file_hdr	pointer
->	O
c_ino	short
,	O
&	O
v_dev	long
,	O
&	O
v_ino	long
)	O
;	O
file_hdr	pointer
->	O
c_dev_maj	long
=	O
major	O
(	O
v_dev	long
)	O
;	O
file_hdr	pointer
->	O
c_dev_min	long
=	O
minor	O
(	O
v_dev	long
)	O
;	O
file_hdr	pointer
->	O
c_ino	short
=	O
v_ino	long
;	O
}	O
if	O
(	O
do_strip_leading_slash	int
)	O
{	O
E_DEBUG	O
(	O
""	pointer
)	O
;	O
ahsStatic_strip_name_leading_slash	function
(	O
file_hdr	pointer
)	O
;	O
}	O
is_dir	int
=	O
(	O
file_hdr	pointer
->	O
c_mode	short
&	O
CP_IFMT	int
)	O
==	O
CP_IFDIR	int
;	O
c_type	long
=	O
(	O
file_hdr	pointer
->	O
c_mode	short
&	O
CP_IFMT	int
)	O
;	O
E_DEBUG2	O
(	O
"name is [%s]"	pointer
,	O
ahsStaticGetTarFilename	function
(	O
file_hdr	pointer
)	O
)	O
;	O
file_hdr	pointer
->	O
c_namesize	short
=	O
strlen	function
(	O
ahsStaticGetTarFilename	function
(	O
file_hdr	pointer
)	O
)	O
+	O
1	int
;	O
if	O
(	O
archive_format_out	enum
==	O
arf_tar	int
||	O
archive_format_out	enum
==	O
arf_ustar	int
)	O
{	O
is_too_long	int
=	O
taru_is_tar_filename_too_long	function
(	O
ahsStaticGetTarFilename	function
(	O
file_hdr	pointer
)	O
,	O
tarheaderflags	int
,	O
&	O
do_gnu_long_name	int
,	O
0	int
)	O
;	O
if	O
(	O
is_too_long	int
)	O
{	O
E_DEBUG	O
(	O
""	pointer
)	O
;	O
fprintf	function
(	O
stderr	pointer
,	O
"%s: file name too long, not dumped: %s\n"	pointer
,	O
swlib_utilname_get	function
(	O
)	O
,	O
ahsStaticGetTarFilename	function
(	O
file_hdr	pointer
)	O
)	O
;	O
ahsStaticDeleteFilehdr	function
(	O
file_hdr	pointer
)	O
;	O
return	O
-	O
2	int
;	O
}	O
is_too_long	int
=	O
taru_is_tar_linkname_too_long	function
(	O
ahsStaticGetTarLinkname	function
(	O
file_hdr	pointer
)	O
,	O
tarheaderflags	int
,	O
&	O
do_gnu_long_link	int
)	O
;	O
if	O
(	O
is_too_long	int
)	O
{	O
fprintf	function
(	O
stderr	pointer
,	O
"%s: link name too long, not dumped: %s\n"	pointer
,	O
swlib_utilname_get	function
(	O
)	O
,	O
ahsStaticGetTarFilename	function
(	O
file_hdr	pointer
)	O
)	O
;	O
return	O
-	O
3	int
;	O
}	O
E_DEBUG2	O
(	O
"do_gnu_long_link=%d"	pointer
,	O
do_gnu_long_link	int
)	O
;	O
E_DEBUG	O
(	O
""	pointer
)	O
;	O
if	O
(	O
tarheaderflags	int
&	O
TARU_TAR_PAXEXTHDR	O
||	O
tarheaderflags	int
&	O
TARU_TAR_PAXEXTHDR_MD	O
)	O
{	O
if	O
(	O
tar_iflags_numeric_uids	int
==	O
0	int
)	O
{	O
taru_set_filehdr_sysdb_nameid_by_policy	function
(	O
"G"	pointer
,	O
file_hdr	pointer
,	O
'\0'	O
,	O
tar_iflags_numeric_uids	int
)	O
;	O
taru_set_filehdr_sysdb_nameid_by_policy	function
(	O
"U"	pointer
,	O
file_hdr	pointer
,	O
'\0'	O
,	O
tar_iflags_numeric_uids	int
)	O
;	O
}	O
file_hdr	pointer
->	O
extHeader_needs_maskM	int
=	O
taru_fill_exthdr_needs_mask	function
(	O
file_hdr	pointer
,	O
tarheaderflags	int
)	O
;	O
do_gnu_long_name	int
=	O
0	int
;	O
do_gnu_long_link	int
=	O
0	int
;	O
}	O
if	O
(	O
do_gnu_long_name	int
|	O
do_gnu_long_link	int
)	O
{	O
E_DEBUG2	O
(	O
"in do_gnu_long_name: %s"	pointer
,	O
ahsStaticGetTarFilename	function
(	O
file_hdr	pointer
)	O
)	O
;	O
if	O
(	O
(	O
do_gnu_long_link_name_bytes	int
=	O
taru_write_long_link_member	function
(	O
taru	pointer
,	O
out_file_des	int
,	O
ahsStaticGetTarFilename	function
(	O
file_hdr	pointer
)	O
,	O
GNUTYPE_LONGNAME	char
,	O
c_type	long
,	O
tarheaderflags	int
)	O
)	O
!=	O
1024	int
)	O
{	O
fprintf	function
(	O
stderr	pointer
,	O
"internal error writing GNU extension LongLink: %s\n"	pointer
,	O
ahsStaticGetTarFilename	function
(	O
file_hdr	pointer
)	O
)	O
;	O
return	O
-	O
3	int
;	O
}	O
if	O
(	O
(	O
tarheaderflags	int
&	O
TARU_TAR_GNU_OLDGNUTAR	O
)	O
||	O
(	O
tarheaderflags	int
&	O
TARU_TAR_NAMESIZE_99	O
)	O
||	O
0	int
)	O
{	O
ahsStaticSetTarFilenameLength	function
(	O
file_hdr	pointer
,	O
OLDGNU_TARNAMESIZE	int
+	O
1	int
)	O
;	O
*	O
(	O
ahsStaticGetTarFilename	function
(	O
file_hdr	pointer
)	O
+	O
OLDGNU_TARNAMESIZE	int
)	O
=	O
'\0'	O
;	O
}	O
else	O
{	O
ahsStaticSetTarFilenameLength	function
(	O
file_hdr	pointer
,	O
TARNAMESIZE	int
+	O
1	int
)	O
;	O
*	O
(	O
ahsStaticGetTarFilename	function
(	O
file_hdr	pointer
)	O
+	O
TARNAMESIZE	int
)	O
=	O
'\0'	O
;	O
}	O
}	O
else	O
if	O
(	O
(	O
(	O
tarheaderflags	int
&	O
TARU_TAR_PAXEXTHDR	O
)	O
||	O
(	O
tarheaderflags	int
&	O
TARU_TAR_PAXEXTHDR_MD	O
)	O
)	O
&&	O
(	O
file_hdr	pointer
->	O
extHeader_needs_maskM	int
||	O
file_hdr	pointer
->	O
extattlistM	pointer
)	O
)	O
{	O
E_DEBUG	O
(	O
"in pax headers"	pointer
)	O
;	O
taru_set_filehdr_sysdb_nameid_by_policy	function
(	O
"G"	pointer
,	O
file_hdr	pointer
,	O
'\0'	O
,	O
tar_iflags_numeric_uids	int
)	O
;	O
taru_set_filehdr_sysdb_nameid_by_policy	function
(	O
"U"	pointer
,	O
file_hdr	pointer
,	O
'\0'	O
,	O
tar_iflags_numeric_uids	int
)	O
;	O
strob_strcpy	function
(	O
taru	pointer
->	O
exthdr_dataM	pointer
,	O
""	pointer
)	O
;	O
do_exthdr_bytes	int
=	O
write_exthdrs_ustar_records	function
(	O
taru	pointer
,	O
file_hdr	pointer
)	O
;	O
if	O
(	O
do_exthdr_bytes	int
<	O
0	int
)	O
{	O
fprintf	function
(	O
stderr	pointer
,	O
"internal error writing pax extended header POSIX attributes: %s: retval=%d\n"	pointer
,	O
ahsStaticGetTarFilename	function
(	O
file_hdr	pointer
)	O
,	O
do_exthdr_bytes	int
)	O
;	O
return	O
-	O
3	int
;	O
}	O
do_exthdr_bytes	int
=	O
write_exthdrs_xattr_records	function
(	O
taru	pointer
,	O
file_hdr	pointer
,	O
do_exthdr_bytes	int
)	O
;	O
if	O
(	O
do_exthdr_bytes	int
<	O
0	int
)	O
{	O
fprintf	function
(	O
stderr	pointer
,	O
"internal error writing pax extended header xattr attributes: %s: retval=%d\n"	pointer
,	O
ahsStaticGetTarFilename	function
(	O
file_hdr	pointer
)	O
,	O
do_exthdr_bytes	int
)	O
;	O
return	O
-	O
4	int
;	O
}	O
if	O
(	O
do_exthdr_bytes	int
==	O
0	int
)	O
goto	O
NO_EA	O
;	O
etar	pointer
=	O
taru	pointer
->	O
etarM	pointer
;	O
etar	pointer
->	O
etar_tarheaderflagsM	int
=	O
taru	pointer
->	O
taru_tarheaderflagsM	int
;	O
etar_init_hdr	function
(	O
etar	pointer
)	O
;	O
strob_strcpy	function
(	O
taru	pointer
->	O
u_name_bufferM	pointer
,	O
""	pointer
)	O
;	O
strob_sprintf	function
(	O
taru	pointer
->	O
u_name_bufferM	pointer
,	O
STROB_DO_APPEND	int
,	O
"./PaxHeaders.%d/"	pointer
,	O
(	O
int	O
)	O
swlib_get_pax_header_pid	function
(	O
)	O
)	O
;	O
sbase	pointer
=	O
swlib_basename	function
(	O
(	O
STROB	struct
*	O
)	O
NULL	O
,	O
ahsStaticGetTarFilename	function
(	O
file_hdr	pointer
)	O
)	O
;	O
strob_sprintf	function
(	O
taru	pointer
->	O
u_name_bufferM	pointer
,	O
STROB_DO_APPEND	int
,	O
"%s"	pointer
,	O
sbase	pointer
)	O
;	O
etar_set_uid	function
(	O
etar	pointer
,	O
0	int
)	O
;	O
etar_set_gid	function
(	O
etar	pointer
,	O
0	int
)	O
;	O
etar_set_uname	function
(	O
etar	pointer
,	O
""	pointer
)	O
;	O
etar_set_gname	function
(	O
etar	pointer
,	O
""	pointer
)	O
;	O
etar_set_mode_ul	function
(	O
etar	pointer
,	O
(	O
unsigned	O
int	O
)	O
(	O
0644	int
)	O
)	O
;	O
if	O
(	O
etar_set_pathname	function
(	O
etar	pointer
,	O
strob_str	function
(	O
taru	pointer
->	O
u_name_bufferM	pointer
)	O
)	O
)	O
SWLIB_FATAL	O
(	O
"name too long"	pointer
)	O
;	O
etar_set_typeflag	function
(	O
etar	pointer
,	O
XHDTYPE	char
)	O
;	O
etar_set_size	function
(	O
etar	pointer
,	O
do_exthdr_bytes	int
)	O
;	O
etar_set_chksum	function
(	O
etar	pointer
)	O
;	O
if	O
(	O
out_file_des	int
>=	O
UXFIO_FD_MIN	int
)	O
ret	long
=	O
atomicio	function
(	O
(	O
ssize_t	long
(	O
*	O
)	O
(	O
int	O
,	O
void	O
*	O
,	O
size_t	long
)	O
)	O
uxfio_write	function
,	O
out_file_des	int
,	O
(	O
void	O
*	O
)	O
(	O
etar_get_hdr	function
(	O
etar	pointer
)	O
)	O
,	O
(	O
size_t	long
)	O
(	O
TARRECORDSIZE	int
)	O
)	O
;	O
else	O
ret	long
=	O
atomicio	function
(	O
(	O
ssize_t	long
(	O
*	O
)	O
(	O
int	O
,	O
void	O
*	O
,	O
size_t	long
)	O
)	O
write	pointer
,	O
out_file_des	int
,	O
(	O
void	O
*	O
)	O
(	O
etar_get_hdr	function
(	O
etar	pointer
)	O
)	O
,	O
(	O
size_t	long
)	O
(	O
TARRECORDSIZE	int
)	O
)	O
;	O
if	O
(	O
ret	long
!=	O
TARRECORDSIZE	int
)	O
{	O
fprintf	function
(	O
stderr	pointer
,	O
"%s: error writing extended header, out_file_des=%d\n"	pointer
,	O
swlib_utilname_get	function
(	O
)	O
,	O
out_file_des	int
)	O
;	O
fprintf	function
(	O
stderr	pointer
,	O
"%s: error writing extended header, ret=%d\n"	pointer
,	O
swlib_utilname_get	function
(	O
)	O
,	O
ret	long
)	O
;	O
return	O
-	O
11	int
;	O
}	O
if	O
(	O
out_file_des	int
>=	O
UXFIO_FD_MIN	int
)	O
ret	long
=	O
atomicio	function
(	O
(	O
ssize_t	long
(	O
*	O
)	O
(	O
int	O
,	O
void	O
*	O
,	O
size_t	long
)	O
)	O
uxfio_write	function
,	O
out_file_des	int
,	O
(	O
void	O
*	O
)	O
strob_str	function
(	O
taru	pointer
->	O
exthdr_dataM	pointer
)	O
,	O
do_exthdr_bytes	int
)	O
;	O
else	O
ret	long
=	O
atomicio	function
(	O
(	O
ssize_t	long
(	O
*	O
)	O
(	O
int	O
,	O
void	O
*	O
,	O
size_t	long
)	O
)	O
write	pointer
,	O
out_file_des	int
,	O
(	O
void	O
*	O
)	O
strob_str	function
(	O
taru	pointer
->	O
exthdr_dataM	pointer
)	O
,	O
do_exthdr_bytes	int
)	O
;	O
if	O
(	O
ret	long
!=	O
do_exthdr_bytes	int
)	O
{	O
fprintf	function
(	O
stderr	pointer
,	O
"%s: error writing extended data\n"	pointer
,	O
swlib_utilname_get	function
(	O
)	O
)	O
;	O
return	O
-	O
12	int
;	O
}	O
ret	long
=	O
taru_tape_pad_output	function
(	O
out_file_des	int
,	O
(	O
intmax_t	long
)	O
ret	long
,	O
arf_ustar	int
)	O
;	O
if	O
(	O
ret	long
<	O
0	int
)	O
{	O
fprintf	function
(	O
stderr	pointer
,	O
"%s: error writing extended data padding\n"	pointer
,	O
swlib_utilname_get	function
(	O
)	O
)	O
;	O
return	O
-	O
13	int
;	O
}	O
NO_EA	O
:	O
;	O
}	O
else	O
{	O
;	O
}	O
}	O
E_DEBUG2	O
(	O
"c_is_link = %d"	pointer
,	O
file_hdr	pointer
->	O
c_is_tar_lnktype	char
)	O
;	O
if	O
(	O
file_hdr	pointer
->	O
c_is_tar_lnktype	char
==	O
1	int
)	O
{	O
;	O
E_DEBUG2	O
(	O
"linkname is [%s]"	pointer
,	O
ahsStaticGetTarLinkname	function
(	O
file_hdr	pointer
)	O
)	O
;	O
}	O
E_DEBUG	O
(	O
""	pointer
)	O
;	O
switch	O
(	O
file_hdr	pointer
->	O
c_mode	short
&	O
CP_IFMT	int
)	O
{	O
case	O
CP_IFREG	int
:	O
{	O
E_DEBUG	O
(	O
"CP_IFREG"	pointer
)	O
;	O
if	O
(	O
(	O
archive_format_out	enum
==	O
arf_oldascii	int
||	O
archive_format_out	enum
==	O
arf_newascii	int
||	O
archive_format_out	enum
==	O
arf_crcascii	int
)	O
&&	O
(	O
file_hdr	pointer
->	O
c_nlink	short
>	O
1	int
)	O
)	O
{	O
E_DEBUG	O
(	O
""	pointer
)	O
;	O
if	O
(	O
defer	pointer
)	O
{	O
defer_set_taru	function
(	O
defer	pointer
,	O
taru	pointer
)	O
;	O
if	O
(	O
defer_is_last_link	function
(	O
defer	pointer
,	O
file_hdr	pointer
)	O
)	O
{	O
defer_writeout_zero_length_defers	function
(	O
defer	pointer
,	O
file_hdr	pointer
,	O
out_file_des	int
)	O
;	O
}	O
else	O
{	O
defer_add_link_defer	function
(	O
defer	pointer
,	O
file_hdr	pointer
)	O
;	O
break	O
;	O
}	O
}	O
else	O
{	O
fprintf	function
(	O
stderr	pointer
,	O
"taru internal error: cpio hard link handling is disabled (loc=2).\n"	pointer
)	O
;	O
}	O
}	O
else	O
if	O
(	O
archive_format_out	enum
==	O
arf_ustar	int
||	O
archive_format_out	enum
==	O
arf_tar	int
)	O
{	O
if	O
(	O
linkrecord_active	int
)	O
{	O
E_DEBUG	O
(	O
"tar format"	pointer
)	O
;	O
nfound	pointer
=	O
0	int
;	O
if	O
(	O
file_hdr	pointer
->	O
c_nlink	short
>	O
1	int
)	O
{	O
link_record_buf	pointer
=	O
hllist_find_file_entry	function
(	O
linkrecord	pointer
,	O
(	O
dev_t	long
)	O
makedev	O
(	O
file_hdr	pointer
->	O
c_dev_maj	long
,	O
file_hdr	pointer
->	O
c_dev_min	long
)	O
,	O
file_hdr	pointer
->	O
c_ino	short
,	O
1	int
,	O
&	O
nfound	pointer
)	O
;	O
if	O
(	O
nfound	pointer
||	O
file_hdr	pointer
->	O
c_is_tar_lnktype	char
==	O
1	int
)	O
{	O
E_DEBUG	O
(	O
""	pointer
)	O
;	O
if	O
(	O
nfound	pointer
)	O
{	O
ahsStaticSetPaxLinkname	function
(	O
file_hdr	pointer
,	O
link_record_buf	pointer
->	O
path_	pointer
)	O
;	O
}	O
else	O
{	O
;	O
}	O
retval	int
=	O
taru_write_out_header	function
(	O
taru	pointer
,	O
file_hdr	pointer
,	O
out_file_des	int
,	O
archive_format_out	enum
,	O
(	O
char	O
*	O
)	O
(	O
NULL	O
)	O
,	O
tarheaderflags	int
)	O
;	O
break	O
;	O
}	O
else	O
{	O
E_DEBUG	O
(	O
"not found"	pointer
)	O
;	O
}	O
}	O
}	O
else	O
{	O
E_DEBUG	O
(	O
""	pointer
)	O
;	O
if	O
(	O
!	O
linkrecord	pointer
&&	O
0	int
)	O
fprintf	function
(	O
stderr	pointer
,	O
"taru internal error: tar hard link handling is disabled (loc=3).\n"	pointer
)	O
;	O
}	O
tmpp	pointer
=	O
ahsStaticGetTarLinkname	function
(	O
file_hdr	pointer
)	O
;	O
if	O
(	O
tmpp	pointer
&&	O
strlen	function
(	O
tmpp	pointer
)	O
)	O
{	O
E_DEBUG2	O
(	O
"in Hard link: %s"	pointer
,	O
ahsStaticGetTarFilename	function
(	O
file_hdr	pointer
)	O
)	O
;	O
if	O
(	O
do_gnu_long_link	int
)	O
{	O
E_DEBUG2	O
(	O
"in do_gnu_long_link: %s"	pointer
,	O
ahsStaticGetTarFilename	function
(	O
file_hdr	pointer
)	O
)	O
;	O
if	O
(	O
(	O
do_gnu_long_link_link_bytes	int
=	O
taru_write_long_link_member	function
(	O
taru	pointer
,	O
out_file_des	int
,	O
ahsStaticGetTarLinkname	function
(	O
file_hdr	pointer
)	O
,	O
GNUTYPE_LONGLINK	char
,	O
c_type	long
,	O
tarheaderflags	int
)	O
)	O
!=	O
1024	int
)	O
{	O
fprintf	function
(	O
stderr	pointer
,	O
"internal error writing GNU extension LongLink for linkname: %s\n"	pointer
,	O
ahsStaticGetTarLinkname	function
(	O
file_hdr	pointer
)	O
)	O
;	O
return	O
-	O
3	int
;	O
}	O
tmpp	pointer
=	O
ahsStaticGetTarLinkname	function
(	O
file_hdr	pointer
)	O
;	O
*	O
(	O
tmpp	pointer
+	O
(	O
TARLINKNAMESIZE	int
-	O
1	int
)	O
)	O
=	O
'\0'	O
;	O
}	O
}	O
}	O
else	O
{	O
E_DEBUG	O
(	O
""	pointer
)	O
;	O
}	O
E_DEBUG2	O
(	O
"Entering taru_write_out_header: %s"	pointer
,	O
ahsStaticGetTarFilename	function
(	O
file_hdr	pointer
)	O
)	O
;	O
retval	int
=	O
taru_write_out_header	function
(	O
taru	pointer
,	O
file_hdr	pointer
,	O
out_file_des	int
,	O
archive_format_out	enum
,	O
(	O
char	O
*	O
)	O
(	O
NULL	O
)	O
,	O
tarheaderflags	int
)	O
;	O
if	O
(	O
archive_format_out	enum
==	O
arf_ustar	int
||	O
archive_format_out	enum
==	O
arf_tar	int
)	O
{	O
E_DEBUG	O
(	O
""	pointer
)	O
;	O
if	O
(	O
linkrecord_active	int
)	O
{	O
if	O
(	O
file_hdr	pointer
->	O
c_nlink	short
>	O
1	int
)	O
{	O
E_DEBUG	O
(	O
""	pointer
)	O
;	O
hllist_add_record	function
(	O
linkrecord	pointer
,	O
ahsStaticGetTarFilename	function
(	O
file_hdr	pointer
)	O
,	O
(	O
dev_t	long
)	O
makedev	O
(	O
file_hdr	pointer
->	O
c_dev_maj	long
,	O
file_hdr	pointer
->	O
c_dev_min	long
)	O
,	O
file_hdr	pointer
->	O
c_ino	short
)	O
;	O
}	O
}	O
else	O
{	O
E_DEBUG	O
(	O
""	pointer
)	O
;	O
if	O
(	O
!	O
linkrecord	pointer
&&	O
0	int
)	O
fprintf	function
(	O
stderr	pointer
,	O
"taru internal error: tar hard link handling is disabled (loc=4).\n"	pointer
)	O
;	O
}	O
}	O
break	O
;	O
}	O
case	O
CP_IFDIR	int
:	O
E_DEBUG	O
(	O
"CP_IFDIR"	pointer
)	O
;	O
file_hdr	pointer
->	O
c_filesize	long
=	O
0	int
;	O
retval	int
=	O
taru_write_out_header	function
(	O
taru	pointer
,	O
file_hdr	pointer
,	O
out_file_des	int
,	O
archive_format_out	enum
,	O
(	O
char	O
*	O
)	O
(	O
NULL	O
)	O
,	O
tarheaderflags	int
)	O
;	O
break	O
;	O
case	O
CP_IFSOCK	int
:	O
E_DEBUG	O
(	O
"CP_IFSOCK"	pointer
)	O
;	O
fprintf	function
(	O
stderr	pointer
,	O
"%s: %s: socket ignored\n"	pointer
,	O
swlib_utilname_get	function
(	O
)	O
,	O
ahsStaticGetTarFilename	function
(	O
file_hdr	pointer
)	O
)	O
;	O
retval	int
=	O
0	int
;	O
break	O
;	O
case	O
CP_IFIFO	int
:	O
case	O
CP_IFCHR	int
:	O
case	O
CP_IFBLK	int
:	O
E_DEBUG	O
(	O
"CP_FIFO CP_IFCHR CP_IFBLK"	pointer
)	O
;	O
if	O
(	O
archive_format_out	enum
==	O
arf_tar	int
)	O
{	O
fprintf	function
(	O
stderr	pointer
,	O
"%s not dumped: not a regular file"	pointer
,	O
ahsStaticGetTarFilename	function
(	O
file_hdr	pointer
)	O
)	O
;	O
ahsStaticDeleteFilehdr	function
(	O
file_hdr	pointer
)	O
;	O
return	O
0	int
;	O
}	O
else	O
if	O
(	O
archive_format_out	enum
==	O
arf_ustar	int
)	O
{	O
E_DEBUG	O
(	O
""	pointer
)	O
;	O
if	O
(	O
linkrecord_active	int
)	O
{	O
E_DEBUG	O
(	O
""	pointer
)	O
;	O
link_record_buf	pointer
=	O
hllist_find_file_entry	function
(	O
linkrecord	pointer
,	O
(	O
dev_t	long
)	O
makedev	O
(	O
file_hdr	pointer
->	O
c_dev_maj	long
,	O
file_hdr	pointer
->	O
c_dev_min	long
)	O
,	O
file_hdr	pointer
->	O
c_ino	short
,	O
1	int
,	O
&	O
nfound	pointer
)	O
;	O
if	O
(	O
nfound	pointer
)	O
{	O
E_DEBUG	O
(	O
""	pointer
)	O
;	O
file_hdr	pointer
->	O
c_mode	short
|=	O
CP_IFREG	int
;	O
ahsStaticSetPaxLinkname	function
(	O
file_hdr	pointer
,	O
link_record_buf	pointer
->	O
path_	pointer
)	O
;	O
retval	int
=	O
taru_write_out_header	function
(	O
taru	pointer
,	O
file_hdr	pointer
,	O
out_file_des	int
,	O
archive_format_out	enum
,	O
(	O
char	O
*	O
)	O
(	O
NULL	O
)	O
,	O
tarheaderflags	int
)	O
;	O
break	O
;	O
}	O
}	O
else	O
{	O
E_DEBUG	O
(	O
""	pointer
)	O
;	O
}	O
}	O
file_hdr	pointer
->	O
c_filesize	long
=	O
0	int
;	O
E_DEBUG	O
(	O
""	pointer
)	O
;	O
retval	int
=	O
taru_write_out_header	function
(	O
taru	pointer
,	O
file_hdr	pointer
,	O
out_file_des	int
,	O
archive_format_out	enum
,	O
(	O
char	O
*	O
)	O
(	O
NULL	O
)	O
,	O
tarheaderflags	int
)	O
;	O
if	O
(	O
archive_format_out	enum
==	O
arf_ustar	int
||	O
archive_format_out	enum
==	O
arf_tar	int
)	O
{	O
E_DEBUG	O
(	O
""	pointer
)	O
;	O
if	O
(	O
linkrecord_active	int
)	O
{	O
if	O
(	O
file_hdr	pointer
->	O
c_nlink	short
>	O
1	int
)	O
{	O
hllist_add_record	function
(	O
linkrecord	pointer
,	O
ahsStaticGetTarFilename	function
(	O
file_hdr	pointer
)	O
,	O
(	O
dev_t	long
)	O
makedev	O
(	O
file_hdr	pointer
->	O
c_dev_maj	long
,	O
file_hdr	pointer
->	O
c_dev_min	long
)	O
,	O
file_hdr	pointer
->	O
c_ino	short
)	O
;	O
}	O
}	O
else	O
{	O
E_DEBUG	O
(	O
""	pointer
)	O
;	O
}	O
}	O
break	O
;	O
case	O
CP_IFLNK	int
:	O
E_DEBUG	O
(	O
"CP_IFLNK"	pointer
)	O
;	O
{	O
E_DEBUG	O
(	O
""	pointer
)	O
;	O
link_size	int
=	O
strlen	function
(	O
ahsStaticGetTarLinkname	function
(	O
file_hdr	pointer
)	O
)	O
;	O
file_hdr	pointer
->	O
c_filesize	long
=	O
link_size	int
;	O
if	O
(	O
archive_format_out	enum
==	O
arf_tar	int
||	O
archive_format_out	enum
==	O
arf_ustar	int
)	O
{	O
if	O
(	O
do_gnu_long_link	int
==	O
0	int
)	O
{	O
E_DEBUG	O
(	O
"do_gnu_long_link == 0"	pointer
)	O
;	O
if	O
(	O
link_size	int
+	O
1	int
>	O
TARNAMESIZE	int
)	O
{	O
fprintf	function
(	O
stderr	pointer
,	O
"%s: symbolic link too long\n"	pointer
,	O
ahsStaticGetTarFilename	function
(	O
file_hdr	pointer
)	O
)	O
;	O
link_name	array
[	O
TARNAMESIZE	int
]	O
=	O
'\0'	O
;	O
return	O
TARU_HE_LINKNAME_4	O
;	O
}	O
else	O
{	O
retval	int
=	O
taru_write_out_header	function
(	O
taru	pointer
,	O
file_hdr	pointer
,	O
out_file_des	int
,	O
archive_format_out	enum
,	O
(	O
char	O
*	O
)	O
(	O
NULL	O
)	O
,	O
tarheaderflags	int
)	O
;	O
}	O
}	O
else	O
{	O
E_DEBUG	O
(	O
"do_gnu_long_link == 1"	pointer
)	O
;	O
E_DEBUG	O
(	O
"calling taru_write_long_link_member"	pointer
)	O
;	O
if	O
(	O
(	O
do_gnu_long_link_link_bytes	int
=	O
taru_write_long_link_member	function
(	O
taru	pointer
,	O
out_file_des	int
,	O
ahsStaticGetTarLinkname	function
(	O
file_hdr	pointer
)	O
,	O
GNUTYPE_LONGLINK	char
,	O
c_type	long
,	O
tarheaderflags	int
)	O
)	O
!=	O
1024	int
)	O
{	O
fprintf	function
(	O
stderr	pointer
,	O
"internal error writing GNU extension LongLink: %s\n"	pointer
,	O
ahsStaticGetTarLinkname	function
(	O
file_hdr	pointer
)	O
)	O
;	O
return	O
-	O
6	int
;	O
}	O
*	O
(	O
ahsStaticGetTarLinkname	function
(	O
file_hdr	pointer
)	O
+	O
99	int
)	O
=	O
'\0'	O
;	O
file_hdr	pointer
->	O
c_filesize	long
=	O
0	int
;	O
retval	int
=	O
taru_write_out_header	function
(	O
taru	pointer
,	O
file_hdr	pointer
,	O
out_file_des	int
,	O
archive_format_out	enum
,	O
(	O
char	O
*	O
)	O
(	O
NULL	O
)	O
,	O
tarheaderflags	int
)	O
;	O
if	O
(	O
retval	int
<	O
0	int
)	O
return	O
-	O
7	int
;	O
}	O
}	O
else	O
{	O
E_DEBUG	O
(	O
""	pointer
)	O
;	O
retval	int
=	O
taru_write_out_header	function
(	O
taru	pointer
,	O
file_hdr	pointer
,	O
out_file_des	int
,	O
archive_format_out	enum
,	O
(	O
char	O
*	O
)	O
(	O
NULL	O
)	O
,	O
tarheaderflags	int
)	O
;	O
retval	int
+=	O
tarui_tape_buffered_write	function
(	O
ahsStaticGetTarLinkname	function
(	O
file_hdr	pointer
)	O
,	O
out_file_des	int
,	O
link_size	int
,	O
NULL	O
)	O
;	O
retval	int
+=	O
taru_tape_pad_output	function
(	O
out_file_des	int
,	O
(	O
intmax_t	long
)	O
link_size	int
,	O
archive_format_out	enum
)	O
;	O
}	O
}	O
break	O
;	O
default	O
:	O
E_DEBUG	O
(	O
""	pointer
)	O
;	O
fprintf	function
(	O
stderr	pointer
,	O
"%s: unknown file type in archive header: mode=%o: FMT=%o: name=%s \n"	pointer
,	O
swlib_utilname_get	function
(	O
)	O
,	O
(	O
unsigned	O
int	O
)	O
(	O
file_hdr	pointer
->	O
c_mode	short
)	O
,	O
(	O
unsigned	O
int	O
)	O
(	O
file_hdr	pointer
->	O
c_mode	short
&	O
CP_IFMT	int
)	O
,	O
ahsStaticGetTarFilename	function
(	O
file_hdr	pointer
)	O
)	O
;	O
}	O
if	O
(	O
file_hdr_return	pointer
)	O
{	O
E_DEBUG	O
(	O
""	pointer
)	O
;	O
taru_filehdr2filehdr	function
(	O
file_hdr_return	pointer
,	O
file_hdr	pointer
)	O
;	O
}	O
E_DEBUG	O
(	O
""	pointer
)	O
;	O
ahsStaticDeleteFilehdr	function
(	O
file_hdr	pointer
)	O
;	O
return	O
retval	int
+	O
do_gnu_long_link_name_bytes	int
+	O
do_gnu_long_link_link_bytes	int
;	O
}	O
int	O
taru_tape_pad_output	function
(	O
int	O
out_file_des	int
,	O
intmax_t	long
offset	long
,	O
enum	O
archive_format	enum
archive_format	enum
)	O
{	O
intmax_t	long
pad	long
;	O
char	O
zeros_512	pointer
[	O
512	int
]	O
;	O
memset	function
(	O
zeros_512	pointer
,	O
0x00	int
,	O
512	int
)	O
;	O
if	O
(	O
archive_format	enum
==	O
arf_newascii	int
||	O
archive_format	enum
==	O
arf_crcascii	int
)	O
pad	long
=	O
(	O
4	int
-	O
(	O
offset	long
%	O
4	int
)	O
)	O
%	O
4	int
;	O
else	O
if	O
(	O
archive_format	enum
==	O
arf_tar	int
||	O
archive_format	enum
==	O
arf_ustar	int
)	O
pad	long
=	O
(	O
512	int
-	O
(	O
offset	long
%	O
512	int
)	O
)	O
%	O
512	int
;	O
else	O
if	O
(	O
archive_format	enum
!=	O
arf_oldascii	int
&&	O
archive_format	enum
!=	O
arf_hpoldascii	int
)	O
pad	long
=	O
(	O
2	int
-	O
(	O
offset	long
%	O
2	int
)	O
)	O
%	O
2	int
;	O
else	O
pad	long
=	O
0	int
;	O
if	O
(	O
out_file_des	int
<	O
0	int
)	O
{	O
return	O
0	int
;	O
}	O
if	O
(	O
pad	long
!=	O
0	int
)	O
{	O
return	O
tarui_tape_buffered_write	function
(	O
zeros_512	pointer
,	O
out_file_des	int
,	O
pad	long
,	O
(	O
char	O
*	O
)	O
(	O
NULL	O
)	O
)	O
;	O
}	O
else	O
{	O
return	O
0	int
;	O
}	O
}	O
int	O
taru_write_out_header	function
(	O
TARU	struct
*	O
taru	pointer
,	O
struct	O
new_cpio_header	struct
*	O
file_hdr	pointer
,	O
int	O
out_des	int
,	O
enum	O
archive_format	enum
archive_format_out	enum
,	O
char	O
*	O
header_buffer	pointer
,	O
int	O
tarheaderflags	int
)	O
{	O
int	O
ret	long
=	O
0	int
;	O
char	O
*	O
magic_string	pointer
;	O
int	O
do_strip_leading_slash	int
=	O
0	int
;	O
E_DEBUG	O
(	O
"BEGIN"	pointer
)	O
;	O
if	O
(	O
taru	pointer
)	O
{	O
do_strip_leading_slash	int
=	O
tarheaderflags	int
&	O
TARU_TAR_DO_STRIP_LEADING_SLASH	O
;	O
}	O
if	O
(	O
do_strip_leading_slash	int
)	O
{	O
ahsStatic_strip_name_leading_slash	function
(	O
file_hdr	pointer
)	O
;	O
}	O
if	O
(	O
taru	pointer
&&	O
(	O
taru	pointer
->	O
preview_levelM	int
>	O
TARU_PV_0	int
)	O
)	O
{	O
taru_write_preview_line	function
(	O
taru	pointer
,	O
file_hdr	pointer
)	O
;	O
}	O
if	O
(	O
archive_format_out	enum
==	O
arf_newascii	int
||	O
archive_format_out	enum
==	O
arf_crcascii	int
)	O
{	O
char	O
ascii_header	array
[	O
112	int
]	O
;	O
if	O
(	O
archive_format_out	enum
==	O
arf_crcascii	int
)	O
{	O
magic_string	pointer
=	O
"070702"	pointer
;	O
}	O
else	O
{	O
magic_string	pointer
=	O
"070701"	pointer
;	O
file_hdr	pointer
->	O
c_chksum	long
=	O
0	int
;	O
}	O
sprintf	function
(	O
ascii_header	array
,	O
"%6s%08lx%08lx%08lx%08lx%08lx%08lx%08lx%08lx%08lx%08lx%08lx%08lx%08lx"	pointer
,	O
magic_string	pointer
,	O
file_hdr	pointer
->	O
c_ino	short
,	O
file_hdr	pointer
->	O
c_mode	short
,	O
file_hdr	pointer
->	O
c_uid	short
,	O
file_hdr	pointer
->	O
c_gid	short
,	O
file_hdr	pointer
->	O
c_nlink	short
,	O
file_hdr	pointer
->	O
c_mtime	long
,	O
(	O
unsigned	O
long	O
)	O
(	O
file_hdr	pointer
->	O
c_filesize	long
)	O
,	O
file_hdr	pointer
->	O
c_dev_maj	long
,	O
file_hdr	pointer
->	O
c_dev_min	long
,	O
file_hdr	pointer
->	O
c_rdev_maj	long
,	O
file_hdr	pointer
->	O
c_rdev_min	long
,	O
file_hdr	pointer
->	O
c_namesize	short
,	O
file_hdr	pointer
->	O
c_chksum	long
)	O
;	O
ret	long
+=	O
tarui_tape_buffered_write	function
(	O
ascii_header	array
,	O
out_des	int
,	O
110L	int
,	O
header_buffer	pointer
)	O
;	O
if	O
(	O
ret	long
<	O
0	int
)	O
return	O
ret	long
;	O
ret	long
+=	O
tarui_tape_buffered_write	function
(	O
ahsStaticGetTarFilename	function
(	O
file_hdr	pointer
)	O
,	O
out_des	int
,	O
(	O
long	O
)	O
(	O
file_hdr	pointer
->	O
c_namesize	short
)	O
,	O
header_buffer	pointer
)	O
;	O
if	O
(	O
ret	long
<	O
0	int
)	O
return	O
ret	long
;	O
ret	long
+=	O
taru_tape_pad_output	function
(	O
out_des	int
,	O
(	O
intmax_t	long
)	O
(	O
file_hdr	pointer
->	O
c_namesize	short
+	O
110	int
)	O
,	O
archive_format_out	enum
)	O
;	O
return	O
ret	long
;	O
}	O
else	O
if	O
(	O
archive_format_out	enum
==	O
arf_oldascii	int
||	O
archive_format_out	enum
==	O
arf_hpoldascii	int
)	O
{	O
char	O
ascii_header	array
[	O
78	int
]	O
;	O
dev_t	long
dev	long
=	O
0	int
;	O
dev_t	long
rdev	long
=	O
0	int
;	O
if	O
(	O
archive_format_out	enum
==	O
arf_oldascii	int
)	O
{	O
magic_string	pointer
=	O
"070707"	pointer
;	O
dev	long
=	O
makedev	O
(	O
file_hdr	pointer
->	O
c_dev_maj	long
,	O
file_hdr	pointer
->	O
c_dev_min	long
)	O
;	O
rdev	long
=	O
makedev	O
(	O
file_hdr	pointer
->	O
c_rdev_maj	long
,	O
file_hdr	pointer
->	O
c_rdev_min	long
)	O
;	O
}	O
else	O
{	O
magic_string	pointer
=	O
"070707"	pointer
;	O
switch	O
(	O
file_hdr	pointer
->	O
c_mode	short
&	O
CP_IFMT	int
)	O
{	O
case	O
CP_IFCHR	int
:	O
case	O
CP_IFBLK	int
:	O
case	O
CP_IFSOCK	int
:	O
case	O
CP_IFIFO	int
:	O
file_hdr	pointer
->	O
c_filesize	long
=	O
makedev	O
(	O
file_hdr	pointer
->	O
c_rdev_maj	long
,	O
file_hdr	pointer
->	O
c_rdev_min	long
)	O
;	O
rdev	long
=	O
1	int
;	O
break	O
;	O
default	O
:	O
dev	long
=	O
makedev	O
(	O
file_hdr	pointer
->	O
c_dev_maj	long
,	O
file_hdr	pointer
->	O
c_dev_min	long
)	O
;	O
rdev	long
=	O
makedev	O
(	O
file_hdr	pointer
->	O
c_rdev_maj	long
,	O
file_hdr	pointer
->	O
c_rdev_min	long
)	O
;	O
break	O
;	O
}	O
}	O
if	O
(	O
(	O
file_hdr	pointer
->	O
c_ino	short
>>	O
16	int
)	O
!=	O
0	int
)	O
fprintf	function
(	O
stderr	pointer
,	O
"%s: truncating inode number"	pointer
,	O
ahsStaticGetTarFilename	function
(	O
file_hdr	pointer
)	O
)	O
;	O
sprintf	function
(	O
ascii_header	array
,	O
"%6s%06o%06lo%06lo%06lo%06lo%06lo%06o%011lo%06lo%011lo"	pointer
,	O
magic_string	pointer
,	O
(	O
int	O
)	O
(	O
dev	long
&	O
0xFFFF	int
)	O
,	O
file_hdr	pointer
->	O
c_ino	short
&	O
0xFFFF	int
,	O
file_hdr	pointer
->	O
c_mode	short
&	O
0xFFFF	int
,	O
file_hdr	pointer
->	O
c_uid	short
&	O
0xFFFF	int
,	O
file_hdr	pointer
->	O
c_gid	short
&	O
0xFFFF	int
,	O
file_hdr	pointer
->	O
c_nlink	short
&	O
0xFFFF	int
,	O
(	O
int	O
)	O
(	O
rdev	long
&	O
0xFFFF	int
)	O
,	O
file_hdr	pointer
->	O
c_mtime	long
,	O
file_hdr	pointer
->	O
c_namesize	short
&	O
0xFFFF	int
,	O
(	O
unsigned	O
long	O
)	O
(	O
file_hdr	pointer
->	O
c_filesize	long
)	O
)	O
;	O
ret	long
+=	O
tarui_tape_buffered_write	function
(	O
ascii_header	array
,	O
out_des	int
,	O
76L	int
,	O
header_buffer	pointer
)	O
;	O
if	O
(	O
ret	long
<	O
0	int
)	O
return	O
ret	long
;	O
ret	long
+=	O
tarui_tape_buffered_write	function
(	O
ahsStaticGetTarFilename	function
(	O
file_hdr	pointer
)	O
,	O
out_des	int
,	O
(	O
long	O
)	O
file_hdr	pointer
->	O
c_namesize	short
,	O
header_buffer	pointer
)	O
;	O
return	O
ret	long
;	O
}	O
else	O
if	O
(	O
archive_format_out	enum
==	O
arf_tar	int
||	O
archive_format_out	enum
==	O
arf_ustar	int
)	O
{	O
E_DEBUG	O
(	O
"calling taru_write_out_tar_header2"	pointer
)	O
;	O
ret	long
=	O
taru_write_out_tar_header2	function
(	O
taru	pointer
,	O
file_hdr	pointer
,	O
out_des	int
,	O
(	O
char	O
*	O
)	O
(	O
NULL	O
)	O
,	O
ahsStaticGetTarUsername	function
(	O
file_hdr	pointer
)	O
,	O
ahsStaticGetTarGroupname	function
(	O
file_hdr	pointer
)	O
,	O
tarheaderflags	int
)	O
;	O
return	O
ret	long
;	O
}	O
else	O
{	O
struct	O
old_cpio_header	struct
short_hdr	struct
;	O
short_hdr	struct
.	O
c_magic	short
=	O
070707	int
;	O
short_hdr	struct
.	O
c_dev	short
=	O
makedev	O
(	O
file_hdr	pointer
->	O
c_dev_maj	long
,	O
file_hdr	pointer
->	O
c_dev_min	long
)	O
;	O
if	O
(	O
(	O
file_hdr	pointer
->	O
c_ino	short
>>	O
16	int
)	O
!=	O
0	int
)	O
fprintf	function
(	O
stderr	pointer
,	O
"%s: truncating inode number"	pointer
,	O
ahsStaticGetTarFilename	function
(	O
file_hdr	pointer
)	O
)	O
;	O
short_hdr	struct
.	O
c_ino	short
=	O
file_hdr	pointer
->	O
c_ino	short
&	O
0xFFFF	int
;	O
short_hdr	struct
.	O
c_mode	short
=	O
file_hdr	pointer
->	O
c_mode	short
&	O
0xFFFF	int
;	O
short_hdr	struct
.	O
c_uid	short
=	O
file_hdr	pointer
->	O
c_uid	short
&	O
0xFFFF	int
;	O
short_hdr	struct
.	O
c_gid	short
=	O
file_hdr	pointer
->	O
c_gid	short
&	O
0xFFFF	int
;	O
short_hdr	struct
.	O
c_nlink	short
=	O
file_hdr	pointer
->	O
c_nlink	short
&	O
0xFFFF	int
;	O
if	O
(	O
archive_format_out	enum
!=	O
arf_hpbinary	int
)	O
short_hdr	struct
.	O
c_rdev	short
=	O
makedev	O
(	O
file_hdr	pointer
->	O
c_rdev_maj	long
,	O
file_hdr	pointer
->	O
c_rdev_min	long
)	O
;	O
else	O
{	O
switch	O
(	O
file_hdr	pointer
->	O
c_mode	short
&	O
CP_IFMT	int
)	O
{	O
case	O
CP_IFCHR	int
:	O
case	O
CP_IFBLK	int
:	O
case	O
CP_IFSOCK	int
:	O
case	O
CP_IFIFO	int
:	O
file_hdr	pointer
->	O
c_filesize	long
=	O
makedev	O
(	O
file_hdr	pointer
->	O
c_rdev_maj	long
,	O
file_hdr	pointer
->	O
c_rdev_min	long
)	O
;	O
short_hdr	struct
.	O
c_rdev	short
=	O
makedev	O
(	O
0	int
,	O
1	int
)	O
;	O
break	O
;	O
default	O
:	O
short_hdr	struct
.	O
c_rdev	short
=	O
makedev	O
(	O
file_hdr	pointer
->	O
c_rdev_maj	long
,	O
file_hdr	pointer
->	O
c_rdev_min	long
)	O
;	O
break	O
;	O
}	O
}	O
short_hdr	struct
.	O
c_mtimes	array
[	O
0	int
]	O
=	O
file_hdr	pointer
->	O
c_mtime	long
>>	O
16	int
;	O
short_hdr	struct
.	O
c_mtimes	array
[	O
1	int
]	O
=	O
file_hdr	pointer
->	O
c_mtime	long
&	O
0xFFFF	int
;	O
short_hdr	struct
.	O
c_namesize	short
=	O
file_hdr	pointer
->	O
c_namesize	short
&	O
0xFFFF	int
;	O
short_hdr	struct
.	O
c_filesizes	array
[	O
0	int
]	O
=	O
file_hdr	pointer
->	O
c_filesize	long
>>	O
16	int
;	O
short_hdr	struct
.	O
c_filesizes	array
[	O
1	int
]	O
=	O
file_hdr	pointer
->	O
c_filesize	long
&	O
0xFFFF	int
;	O
ret	long
+=	O
tarui_tape_buffered_write	function
(	O
(	O
char	O
*	O
)	O
&	O
short_hdr	struct
,	O
out_des	int
,	O
26L	int
,	O
header_buffer	pointer
)	O
;	O
ret	long
+=	O
tarui_tape_buffered_write	function
(	O
ahsStaticGetTarFilename	function
(	O
file_hdr	pointer
)	O
,	O
out_des	int
,	O
(	O
long	O
)	O
file_hdr	pointer
->	O
c_namesize	short
,	O
header_buffer	pointer
)	O
;	O
if	O
(	O
ret	long
<	O
0	int
)	O
return	O
ret	long
;	O
ret	long
+=	O
taru_tape_pad_output	function
(	O
out_des	int
,	O
(	O
intmax_t	long
)	O
(	O
file_hdr	pointer
->	O
c_namesize	short
+	O
26	int
)	O
,	O
archive_format_out	enum
)	O
;	O
return	O
ret	long
;	O
}	O
return	O
-	O
254	int
;	O
}	O
int	O
taru_process_copy_out	function
(	O
TARU	struct
*	O
taru	pointer
,	O
int	O
input_fd	int
,	O
int	O
out_file_des	int
,	O
DEFER	struct
*	O
defer	pointer
,	O
PORINODE	struct
*	O
porinode	pointer
,	O
enum	O
archive_format	enum
archive_format_out	enum
,	O
int	O
ls_fd	int
,	O
int	O
ls_verbose_level	int
,	O
intmax_t	long
*	O
nb	pointer
,	O
FILE_DIGS	struct
*	O
digs	pointer
)	O
{	O
STROB	struct
*	O
ls_tmp	pointer
;	O
struct	O
new_cpio_header	struct
*	O
file_hdr0	pointer
;	O
union	O
tar_record	union
tar_rec	union
;	O
struct	O
tar_header	struct
*	O
tar_hdr	pointer
=	O
(	O
struct	O
tar_header	struct
*	O
)	O
&	O
tar_rec	union
;	O
char	O
zeros_512	pointer
[	O
512	int
]	O
;	O
int	O
block_number	int
=	O
0	int
;	O
int	O
eoa	pointer
=	O
0	int
;	O
int	O
ret	long
;	O
intmax_t	long
retx	long
;	O
intmax_t	long
retvalx	long
;	O
int	O
read_ret	int
;	O
HLLIST	struct
*	O
hllist	pointer
;	O
E_DEBUG	O
(	O
""	pointer
)	O
;	O
file_hdr0	pointer
=	O
ahsStaticCreateFilehdr	function
(	O
)	O
;	O
memset	function
(	O
zeros_512	pointer
,	O
0x00	int
,	O
512	int
)	O
;	O
hllist	pointer
=	O
hllist_open	function
(	O
)	O
;	O
hllist_disable_add	function
(	O
hllist	pointer
)	O
;	O
hllist_disable_find	function
(	O
hllist	pointer
)	O
;	O
retvalx	long
=	O
0	int
;	O
E_DEBUG	O
(	O
""	pointer
)	O
;	O
taru_digs_delete	function
(	O
file_hdr0	pointer
->	O
digsM	pointer
)	O
;	O
file_hdr0	pointer
->	O
digsM	pointer
=	O
digs	pointer
;	O
E_DEBUG	O
(	O
""	pointer
)	O
;	O
if	O
(	O
ls_fd	int
>=	O
0	int
)	O
{	O
ls_tmp	pointer
=	O
strob_open	function
(	O
120	int
)	O
;	O
}	O
else	O
{	O
ls_tmp	pointer
=	O
NULL	O
;	O
}	O
E_DEBUG	O
(	O
""	pointer
)	O
;	O
eoa	pointer
=	O
0	int
;	O
read_ret	int
=	O
0	int
;	O
while	O
(	O
eoa	pointer
==	O
0	int
)	O
{	O
E_DEBUG	O
(	O
""	pointer
)	O
;	O
read_ret	int
=	O
taru_read_in_tar_header2	function
(	O
taru	pointer
,	O
file_hdr0	pointer
,	O
input_fd	int
,	O
NULL	O
,	O
&	O
eoa	pointer
,	O
0	int
,	O
-	O
1	int
)	O
;	O
if	O
(	O
read_ret	int
<	O
0	int
)	O
break	O
;	O
if	O
(	O
!	O
eoa	pointer
)	O
{	O
E_DEBUG	O
(	O
""	pointer
)	O
;	O
retx	long
=	O
tarui_write_archive_member_	function
(	O
taru	pointer
,	O
(	O
struct	O
stat	struct
*	O
)	O
NULL	O
,	O
file_hdr0	pointer
,	O
hllist	pointer
,	O
defer	pointer
,	O
porinode	pointer
,	O
out_file_des	int
,	O
input_fd	int
,	O
archive_format_out	enum
,	O
taru	pointer
->	O
taru_tarheaderflagsM	int
)	O
;	O
if	O
(	O
retx	long
<	O
0	int
)	O
{	O
return	O
-	O
9	int
;	O
}	O
retvalx	long
+=	O
retx	long
;	O
if	O
(	O
(	O
retx	long
=	O
taru_tape_skip_padding	function
(	O
input_fd	int
,	O
file_hdr0	pointer
->	O
c_filesize	long
,	O
arf_ustar	int
)	O
)	O
<	O
0	int
)	O
{	O
return	O
-	O
8	int
;	O
}	O
if	O
(	O
ls_fd	int
>=	O
0	int
)	O
{	O
taru_print_tar_ls_list	function
(	O
ls_tmp	pointer
,	O
file_hdr0	pointer
,	O
ls_verbose_level	int
)	O
;	O
uxfio_write	function
(	O
ls_fd	int
,	O
strob_str	function
(	O
ls_tmp	pointer
)	O
,	O
strob_strlen	function
(	O
ls_tmp	pointer
)	O
)	O
;	O
}	O
else	O
{	O
;	O
}	O
}	O
E_DEBUG	O
(	O
""	pointer
)	O
;	O
}	O
E_DEBUG	O
(	O
""	pointer
)	O
;	O
if	O
(	O
read_ret	int
<	O
0	int
)	O
return	O
-	O
11	int
;	O
ret	long
=	O
taru_write_archive_trailer	function
(	O
taru	pointer
,	O
archive_format_out	enum
,	O
out_file_des	int
,	O
512	int
,	O
0	int
,	O
0	int
)	O
;	O
E_DEBUG	O
(	O
""	pointer
)	O
;	O
if	O
(	O
ret	long
<=	O
0	int
)	O
return	O
-	O
10	int
;	O
retvalx	long
+=	O
(	O
intmax_t	long
)	O
ret	long
;	O
if	O
(	O
nb	pointer
)	O
*	O
nb	pointer
=	O
(	O
intmax_t	long
)	O
retvalx	long
;	O
if	O
(	O
ls_tmp	pointer
)	O
strob_close	function
(	O
ls_tmp	pointer
)	O
;	O
file_hdr0	pointer
->	O
digsM	pointer
=	O
NULL	O
;	O
ahsStaticDeleteFilehdr	function
(	O
file_hdr0	pointer
)	O
;	O
hllist_close	function
(	O
hllist	pointer
)	O
;	O
E_DEBUG	O
(	O
""	pointer
)	O
;	O
return	O
0	int
;	O
}	O
