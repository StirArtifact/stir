int	O
sockfd	int
,	O
verb	int
=	O
0	int
;	O
struct	O
obstack	struct
query_stk	struct
;	O
int	O
hide_discl	int
=	O
2	int
;	O
const	O
char	O
*	O
server	pointer
=	O
NULL	O
;	O
const	O
char	O
*	O
port	pointer
=	O
NULL	O
;	O
int	O
nopar	int
=	O
0	int
;	O
static	O
struct	O
argp_option	struct
ripe_argp_options	array
[	O
]	O
=	O
{	O
{	O
NULL	O
,	O
'a'	O
,	O
NULL	O
,	O
0	int
,	O
"search all databases"	pointer
}	O
,	O
{	O
NULL	O
,	O
'F'	O
,	O
NULL	O
,	O
0	int
,	O
"fast raw output (implies -r)"	pointer
}	O
,	O
{	O
NULL	O
,	O
'g'	O
,	O
"SOURCE:FIRST-LAST"	pointer
,	O
0	int
,	O
"find updates from SOURCE from serial FIRST to LAST"	pointer
}	O
,	O
{	O
NULL	O
,	O
'i'	O
,	O
"ATTR[,ATTR]..."	pointer
,	O
0	int
,	O
"do an inverse lookup for specified ATTRibutes"	pointer
}	O
,	O
{	O
NULL	O
,	O
'l'	O
,	O
NULL	O
,	O
0	int
,	O
"one level less specific lookup (RPSL only)"	pointer
}	O
,	O
{	O
NULL	O
,	O
'L'	O
,	O
NULL	O
,	O
0	int
,	O
"find all Less specific matches"	pointer
}	O
,	O
{	O
NULL	O
,	O
'M'	O
,	O
NULL	O
,	O
0	int
,	O
"find all More specific matches"	pointer
}	O
,	O
{	O
NULL	O
,	O
'm'	O
,	O
NULL	O
,	O
0	int
,	O
"find first level more specific matches"	pointer
}	O
,	O
{	O
NULL	O
,	O
'r'	O
,	O
NULL	O
,	O
0	int
,	O
"turn off recursive lookups"	pointer
}	O
,	O
{	O
NULL	O
,	O
'R'	O
,	O
NULL	O
,	O
0	int
,	O
"force to show local copy of the domain object even "	pointer
"if it contains referral"	pointer
}	O
,	O
{	O
NULL	O
,	O
'S'	O
,	O
NULL	O
,	O
0	int
,	O
"tell server to leave out syntactic sugar"	pointer
}	O
,	O
{	O
NULL	O
,	O
's'	O
,	O
"SOURCE[,SOURCE]..."	pointer
,	O
0	int
,	O
"search the database from SOURCE"	pointer
}	O
,	O
{	O
NULL	O
,	O
'T'	O
,	O
"TYPE[,TYPE]..."	pointer
,	O
0	int
,	O
"only look for objects of TYPE"	pointer
}	O
,	O
{	O
NULL	O
,	O
'q'	O
,	O
"version|sources"	pointer
,	O
0	int
,	O
"query specified server info (RPSL only)"	pointer
}	O
,	O
{	O
NULL	O
,	O
't'	O
,	O
"TYPE"	pointer
,	O
0	int
,	O
"requests template for object of TYPE ('all' for a list)"	pointer
}	O
,	O
{	O
NULL	O
,	O
'x'	O
,	O
NULL	O
,	O
0	int
,	O
"exact match only (RPSL only)"	pointer
}	O
,	O
{	O
NULL	O
}	O
}	O
;	O
static	O
error_t	int
ripe_argp_parser	function
(	O
int	O
key	int
,	O
char	O
*	O
arg	pointer
,	O
struct	O
argp_state	struct
*	O
state	pointer
)	O
{	O
if	O
(	O
key	int
>	O
0	int
&&	O
(	O
unsigned	O
)	O
key	int
<	O
128	int
)	O
{	O
if	O
(	O
key	int
==	O
't'	O
||	O
key	int
==	O
'v'	O
||	O
key	int
==	O
'q'	O
)	O
nopar	int
=	O
1	int
;	O
obstack_1grow	O
(	O
&	O
query_stk	struct
,	O
'-'	O
)	O
;	O
obstack_1grow	O
(	O
&	O
query_stk	struct
,	O
key	int
)	O
;	O
if	O
(	O
arg	pointer
)	O
{	O
obstack_1grow	O
(	O
&	O
query_stk	struct
,	O
' '	O
)	O
;	O
obstack_grow	O
(	O
&	O
query_stk	struct
,	O
arg	pointer
,	O
strlen	function
(	O
arg	pointer
)	O
)	O
;	O
}	O
return	O
0	int
;	O
}	O
return	O
ARGP_ERR_UNKNOWN	O
;	O
}	O
static	O
struct	O
argp	struct
ripe_argp	struct
=	O
{	O
ripe_argp_options	array
,	O
ripe_argp_parser	function
}	O
;	O
static	O
struct	O
argp_option	struct
gwhois_argp_options	array
[	O
]	O
=	O
{	O
{	O
"verbose"	pointer
,	O
'V'	O
,	O
NULL	O
,	O
0	int
,	O
"explain what is being done"	pointer
}	O
,	O
{	O
"server"	pointer
,	O
'h'	O
,	O
"HOST"	pointer
,	O
0	int
,	O
"connect to server HOST"	pointer
}	O
,	O
{	O
"port"	pointer
,	O
'p'	O
,	O
"PORT"	pointer
,	O
0	int
,	O
"connect to PORT"	pointer
}	O
,	O
{	O
NULL	O
,	O
'H'	O
,	O
NULL	O
,	O
0	int
,	O
"hide legal disclaimers"	pointer
}	O
,	O
{	O
NULL	O
}	O
}	O
;	O
static	O
error_t	int
gwhois_argp_parser	function
(	O
int	O
key	int
,	O
char	O
*	O
arg	pointer
,	O
struct	O
argp_state	struct
*	O
state	pointer
)	O
{	O
char	O
*	O
p	pointer
,	O
*	O
q	pointer
;	O
switch	O
(	O
key	int
)	O
{	O
case	O
'h'	O
:	O
server	pointer
=	O
q	pointer
=	O
malloc	function
(	O
strlen	function
(	O
arg	pointer
)	O
+	O
1	int
)	O
;	O
for	O
(	O
p	pointer
=	O
arg	pointer
;	O
*	O
p	pointer
!=	O
'\0'	O
&&	O
*	O
p	pointer
!=	O
':'	O
;	O
*	O
q	pointer
++	O
=	O
tolower	function
(	O
*	O
p	pointer
++	O
)	O
)	O
;	O
if	O
(	O
*	O
p	pointer
==	O
':'	O
)	O
port	pointer
=	O
p	pointer
+	O
1	int
;	O
*	O
q	pointer
=	O
'\0'	O
;	O
break	O
;	O
case	O
'H'	O
:	O
hide_discl	int
=	O
0	int
;	O
break	O
;	O
case	O
'p'	O
:	O
port	pointer
=	O
arg	pointer
;	O
break	O
;	O
case	O
'V'	O
:	O
verb	int
=	O
1	int
;	O
break	O
;	O
default	O
:	O
return	O
ARGP_ERR_UNKNOWN	O
;	O
}	O
return	O
0	int
;	O
}	O
struct	O
argp_child	struct
gwhois_argp_children	array
[	O
]	O
=	O
{	O
{	O
&	O
ripe_argp	struct
,	O
0	int
,	O
"RIPE-specific options"	pointer
,	O
0	int
}	O
,	O
{	O
NULL	O
}	O
}	O
;	O
static	O
struct	O
argp	struct
gwhois_argp	struct
=	O
{	O
gwhois_argp_options	array
,	O
gwhois_argp_parser	function
,	O
"OBJECT..."	pointer
,	O
"client for the whois directory service"	pointer
,	O
gwhois_argp_children	array
}	O
;	O
const	O
char	O
*	O
program_authors	array
[	O
]	O
=	O
{	O
"Marco d'Itri"	pointer
,	O
NULL	O
}	O
;	O
int	O
main	function
(	O
int	O
argc	int
,	O
char	O
*	O
argv	pointer
[	O
]	O
)	O
{	O
int	O
index	function
;	O
char	O
*	O
fstring	pointer
;	O
char	O
*	O
qstring	pointer
;	O
char	O
*	O
p	pointer
;	O
set_program_name	function
(	O
argv	pointer
[	O
0	int
]	O
)	O
;	O
obstack_init	O
(	O
&	O
query_stk	struct
)	O
;	O
iu_argp_init	O
(	O
"whois"	pointer
,	O
program_authors	array
)	O
;	O
argp_parse	function
(	O
&	O
gwhois_argp	struct
,	O
argc	int
,	O
argv	pointer
,	O
ARGP_IN_ORDER	int
,	O
&	O
index	function
,	O
NULL	O
)	O
;	O
obstack_1grow	O
(	O
&	O
query_stk	struct
,	O
0	int
)	O
;	O
fstring	pointer
=	O
obstack_finish	O
(	O
&	O
query_stk	struct
)	O
;	O
argc	int
-=	O
index	function
;	O
argv	pointer
+=	O
index	function
;	O
if	O
(	O
argc	int
==	O
0	int
&&	O
!	O
nopar	int
)	O
error	function
(	O
EXIT_FAILURE	int
,	O
0	int
,	O
"not enough arguments"	pointer
)	O
;	O
if	O
(	O
!	O
nopar	int
)	O
{	O
while	O
(	O
argc	int
--	O
)	O
{	O
const	O
char	O
*	O
arg	pointer
=	O
*	O
argv	pointer
++	O
;	O
obstack_grow	O
(	O
&	O
query_stk	struct
,	O
arg	pointer
,	O
strlen	function
(	O
arg	pointer
)	O
)	O
;	O
if	O
(	O
argc	int
)	O
obstack_1grow	O
(	O
&	O
query_stk	struct
,	O
' '	O
)	O
;	O
}	O
}	O
obstack_1grow	O
(	O
&	O
query_stk	struct
,	O
0	int
)	O
;	O
qstring	pointer
=	O
obstack_finish	O
(	O
&	O
query_stk	struct
)	O
;	O
if	O
(	O
!	O
server	pointer
&&	O
domfind	function
(	O
qstring	pointer
,	O
gtlds	array
)	O
)	O
{	O
if	O
(	O
verb	int
)	O
puts	function
(	O
_	O
(	O
"Connecting to whois.internic.net."	pointer
)	O
)	O
;	O
sockfd	int
=	O
openconn	function
(	O
"whois.internic.net"	pointer
,	O
NULL	O
)	O
;	O
server	pointer
=	O
query_crsnic	function
(	O
sockfd	int
,	O
qstring	pointer
)	O
;	O
closeconn	function
(	O
sockfd	int
)	O
;	O
if	O
(	O
!	O
server	pointer
)	O
exit	function
(	O
EXIT_SUCCESS	int
)	O
;	O
printf	function
(	O
_	O
(	O
"\nFound InterNIC referral to %s.\n\n"	pointer
)	O
,	O
server	pointer
)	O
;	O
}	O
if	O
(	O
!	O
server	pointer
)	O
{	O
server	pointer
=	O
whichwhois	function
(	O
qstring	pointer
)	O
;	O
switch	O
(	O
server	pointer
[	O
0	int
]	O
)	O
{	O
case	O
0	int
:	O
if	O
(	O
!	O
(	O
server	pointer
=	O
getenv	function
(	O
"WHOIS_SERVER"	pointer
)	O
)	O
)	O
server	pointer
=	O
DEFAULTSERVER	pointer
;	O
if	O
(	O
verb	int
)	O
printf	function
(	O
_	O
(	O
"Using default server %s.\n"	pointer
)	O
,	O
server	pointer
)	O
;	O
break	O
;	O
case	O
1	int
:	O
puts	function
(	O
_	O
(	O
"This TLD has no whois server, but you can access the "	pointer
"whois database at"	pointer
)	O
)	O
;	O
case	O
2	int
:	O
puts	function
(	O
server	pointer
+	O
1	int
)	O
;	O
exit	function
(	O
EXIT_SUCCESS	int
)	O
;	O
case	O
3	int
:	O
puts	function
(	O
_	O
(	O
"This TLD has no whois server."	pointer
)	O
)	O
;	O
exit	function
(	O
EXIT_SUCCESS	int
)	O
;	O
default	O
:	O
if	O
(	O
verb	int
)	O
printf	function
(	O
_	O
(	O
"Using server %s.\n"	pointer
)	O
,	O
server	pointer
)	O
;	O
}	O
}	O
if	O
(	O
getenv	function
(	O
"WHOIS_HIDE"	pointer
)	O
)	O
hide_discl	int
=	O
0	int
;	O
p	pointer
=	O
queryformat	function
(	O
server	pointer
,	O
fstring	pointer
,	O
qstring	pointer
)	O
;	O
if	O
(	O
verb	int
)	O
printf	function
(	O
_	O
(	O
"Query string: \"%s\"\n\n"	pointer
)	O
,	O
p	pointer
)	O
;	O
strcat	function
(	O
p	pointer
,	O
"\r\n"	pointer
)	O
;	O
signal	function
(	O
SIGTERM	int
,	O
sighandler	function
)	O
;	O
signal	function
(	O
SIGINT	int
,	O
sighandler	function
)	O
;	O
sockfd	int
=	O
openconn	function
(	O
server	pointer
,	O
port	pointer
)	O
;	O
do_query	function
(	O
sockfd	int
,	O
p	pointer
)	O
;	O
closeconn	function
(	O
sockfd	int
)	O
;	O
exit	function
(	O
EXIT_SUCCESS	int
)	O
;	O
}	O
const	O
char	O
*	O
whichwhois	function
(	O
const	O
char	O
*	O
s	pointer
)	O
{	O
unsigned	O
long	O
ip	long
;	O
unsigned	O
int	O
i	int
;	O
if	O
(	O
*	O
s	pointer
==	O
'\0'	O
)	O
return	O
"whois.ripe.net"	pointer
;	O
if	O
(	O
strchr	function
(	O
s	pointer
,	O
':'	O
)	O
)	O
{	O
if	O
(	O
strncasecmp	function
(	O
s	pointer
,	O
"2001:2"	pointer
,	O
6	int
)	O
==	O
0	int
)	O
return	O
"whois.apnic.net"	pointer
;	O
if	O
(	O
strncasecmp	function
(	O
s	pointer
,	O
"2001:4"	pointer
,	O
6	int
)	O
==	O
0	int
)	O
return	O
"whois.arin.net"	pointer
;	O
if	O
(	O
strncasecmp	function
(	O
s	pointer
,	O
"2001:6"	pointer
,	O
6	int
)	O
==	O
0	int
)	O
return	O
"whois.ripe.net"	pointer
;	O
return	O
"whois.6bone.net"	pointer
;	O
}	O
if	O
(	O
strchr	function
(	O
s	pointer
,	O
'@'	O
)	O
)	O
return	O
""	pointer
;	O
if	O
(	O
!	O
strpbrk	function
(	O
s	pointer
,	O
".-"	pointer
)	O
)	O
{	O
const	O
char	O
*	O
p	pointer
;	O
for	O
(	O
p	pointer
=	O
s	pointer
;	O
*	O
p	pointer
!=	O
'\0'	O
;	O
p	pointer
++	O
)	O
;	O
if	O
(	O
strncasecmp	function
(	O
s	pointer
,	O
"as"	pointer
,	O
2	int
)	O
==	O
0	int
&&	O
(	O
(	O
s	pointer
[	O
2	int
]	O
>=	O
'0'	O
&&	O
s	pointer
[	O
2	int
]	O
<=	O
'9'	O
)	O
||	O
s	pointer
[	O
2	int
]	O
==	O
' '	O
)	O
)	O
return	O
whereas	function
(	O
atoi	function
(	O
s	pointer
+	O
2	int
)	O
,	O
as_assign	array
)	O
;	O
else	O
if	O
(	O
strncasecmp	function
(	O
p	pointer
-	O
2	int
,	O
"jp"	pointer
,	O
2	int
)	O
==	O
0	int
)	O
return	O
"whois.nic.ad.jp"	pointer
;	O
if	O
(	O
*	O
p	pointer
==	O
'!'	O
)	O
return	O
"whois.networksolutions.com"	pointer
;	O
else	O
return	O
""	pointer
;	O
}	O
if	O
(	O
(	O
ip	long
=	O
myinet_aton	function
(	O
s	pointer
)	O
)	O
)	O
{	O
for	O
(	O
i	int
=	O
0	int
;	O
ip_assign	array
[	O
i	int
]	O
.	O
serv	pointer
;	O
i	int
++	O
)	O
if	O
(	O
(	O
ip	long
&	O
ip_assign	array
[	O
i	int
]	O
.	O
mask	long
)	O
==	O
ip_assign	array
[	O
i	int
]	O
.	O
net	long
)	O
return	O
ip_assign	array
[	O
i	int
]	O
.	O
serv	pointer
;	O
if	O
(	O
verb	int
)	O
puts	function
(	O
_	O
(	O
"I don't know where this IP has been delegated.\n"	pointer
"I'll try ARIN and hope for the best..."	pointer
)	O
)	O
;	O
return	O
"whois.arin.net"	pointer
;	O
}	O
for	O
(	O
i	int
=	O
0	int
;	O
tld_serv	array
[	O
i	int
]	O
;	O
i	int
+=	O
2	int
)	O
if	O
(	O
domcmp	function
(	O
s	pointer
,	O
tld_serv	array
[	O
i	int
]	O
)	O
)	O
return	O
tld_serv	array
[	O
i	int
+	O
1	int
]	O
;	O
if	O
(	O
!	O
strchr	function
(	O
s	pointer
,	O
'.'	O
)	O
)	O
{	O
for	O
(	O
i	int
=	O
0	int
;	O
nic_handles	array
[	O
i	int
]	O
;	O
i	int
+=	O
2	int
)	O
if	O
(	O
strncasecmp	function
(	O
s	pointer
,	O
nic_handles	array
[	O
i	int
]	O
,	O
strlen	function
(	O
nic_handles	array
[	O
i	int
]	O
)	O
)	O
==	O
0	int
)	O
return	O
nic_handles	array
[	O
i	int
+	O
1	int
]	O
;	O
if	O
(	O
verb	int
)	O
puts	function
(	O
_	O
(	O
"I guess it's a netblock name but I don't know where to"	pointer
" look it up."	pointer
)	O
)	O
;	O
return	O
"whois.arin.net"	pointer
;	O
}	O
if	O
(	O
verb	int
)	O
puts	function
(	O
_	O
(	O
"I guess it's a domain but I don't know where to look it"	pointer
" up."	pointer
)	O
)	O
;	O
return	O
""	pointer
;	O
}	O
const	O
char	O
*	O
whereas	function
(	O
int	O
asn	int
,	O
struct	O
as_del	struct
aslist	array
[	O
]	O
)	O
{	O
int	O
i	int
;	O
if	O
(	O
asn	int
>	O
16383	int
)	O
puts	function
(	O
_	O
(	O
"Unknown AS number. Please upgrade this program."	pointer
)	O
)	O
;	O
for	O
(	O
i	int
=	O
0	int
;	O
aslist	array
[	O
i	int
]	O
.	O
serv	pointer
;	O
i	int
++	O
)	O
if	O
(	O
asn	int
>=	O
aslist	array
[	O
i	int
]	O
.	O
first	short
&&	O
asn	int
<=	O
aslist	array
[	O
i	int
]	O
.	O
last	short
)	O
return	O
aslist	array
[	O
i	int
]	O
.	O
serv	pointer
;	O
return	O
"whois.arin.net"	pointer
;	O
}	O
int	O
is_ripe_server	function
(	O
const	O
char	O
*	O
const	O
*	O
srvtab	pointer
,	O
const	O
char	O
*	O
name	pointer
)	O
{	O
struct	O
in_addr	struct
addr	struct
;	O
int	O
isip	int
=	O
0	int
;	O
isip	int
=	O
inet_aton	function
(	O
name	pointer
,	O
&	O
addr	struct
)	O
;	O
for	O
(	O
;	O
*	O
srvtab	pointer
;	O
++	O
srvtab	pointer
)	O
{	O
const	O
char	O
*	O
server	pointer
=	O
*	O
srvtab	pointer
;	O
struct	O
hostent	struct
*	O
hp	pointer
;	O
if	O
(	O
strcmp	function
(	O
server	pointer
,	O
name	pointer
)	O
==	O
0	int
)	O
return	O
1	int
;	O
if	O
(	O
isip	int
&&	O
(	O
hp	pointer
=	O
gethostbyname	function
(	O
server	pointer
)	O
)	O
!=	O
NULL	O
)	O
{	O
char	O
*	O
*	O
pa	pointer
;	O
for	O
(	O
pa	pointer
=	O
hp	pointer
->	O
h_addr_list	pointer
;	O
*	O
pa	pointer
;	O
pa	pointer
++	O
)	O
if	O
(	O
*	O
(	O
unsigned	O
long	O
*	O
)	O
*	O
pa	pointer
==	O
addr	struct
.	O
s_addr	int
)	O
return	O
1	int
;	O
}	O
}	O
return	O
0	int
;	O
}	O
char	O
*	O
queryformat	function
(	O
const	O
char	O
*	O
server	pointer
,	O
const	O
char	O
*	O
flags	int
,	O
const	O
char	O
*	O
query	pointer
)	O
{	O
char	O
*	O
buf	pointer
;	O
int	O
isripe	int
=	O
0	int
;	O
buf	pointer
=	O
malloc	function
(	O
strlen	function
(	O
flags	int
)	O
+	O
strlen	function
(	O
query	pointer
)	O
+	O
10	int
+	O
2	int
+	O
1	int
)	O
;	O
*	O
buf	pointer
=	O
'\0'	O
;	O
isripe	int
=	O
is_ripe_server	function
(	O
ripe_servers	array
,	O
server	pointer
)	O
||	O
is_ripe_server	function
(	O
ripe_servers_old	array
,	O
server	pointer
)	O
;	O
if	O
(	O
isripe	int
)	O
strcat	function
(	O
buf	pointer
,	O
"-V"	pointer
IDSTRING	pointer
" "	pointer
)	O
;	O
if	O
(	O
*	O
flags	int
!=	O
'\0'	O
)	O
{	O
if	O
(	O
!	O
isripe	int
&&	O
strcmp	function
(	O
server	pointer
,	O
"whois.corenic.net"	pointer
)	O
!=	O
0	int
)	O
puts	function
(	O
_	O
(	O
"Warning: RIPE flags ignored for a traditional server."	pointer
)	O
)	O
;	O
else	O
strcat	function
(	O
buf	pointer
,	O
flags	int
)	O
;	O
}	O
if	O
(	O
!	O
isripe	int
&&	O
(	O
strcmp	function
(	O
server	pointer
,	O
"whois.arin.net"	pointer
)	O
==	O
0	int
||	O
strcmp	function
(	O
server	pointer
,	O
"whois.nic.mil"	pointer
)	O
==	O
0	int
)	O
&&	O
strncasecmp	function
(	O
query	pointer
,	O
"AS"	pointer
,	O
2	int
)	O
==	O
0	int
&&	O
query	pointer
[	O
2	int
]	O
>=	O
'0'	O
&&	O
query	pointer
[	O
2	int
]	O
<=	O
'9'	O
)	O
sprintf	function
(	O
buf	pointer
,	O
"AS %s"	pointer
,	O
query	pointer
+	O
2	int
)	O
;	O
else	O
if	O
(	O
!	O
isripe	int
&&	O
strcmp	function
(	O
server	pointer
,	O
"whois.corenic.net"	pointer
)	O
==	O
0	int
)	O
sprintf	function
(	O
buf	pointer
,	O
"--machine %s"	pointer
,	O
query	pointer
)	O
;	O
else	O
if	O
(	O
!	O
isripe	int
&&	O
strcmp	function
(	O
server	pointer
,	O
"whois.ncst.ernet.in"	pointer
)	O
==	O
0	int
&&	O
!	O
strchr	function
(	O
query	pointer
,	O
' '	O
)	O
)	O
sprintf	function
(	O
buf	pointer
,	O
"domain %s"	pointer
,	O
query	pointer
)	O
;	O
else	O
if	O
(	O
!	O
isripe	int
&&	O
strcmp	function
(	O
server	pointer
,	O
"whois.nic.ad.jp"	pointer
)	O
==	O
0	int
)	O
{	O
char	O
*	O
lang	pointer
=	O
getenv	function
(	O
"LANG"	pointer
)	O
;	O
if	O
(	O
!	O
lang	pointer
||	O
(	O
strncmp	function
(	O
lang	pointer
,	O
"ja"	pointer
,	O
2	int
)	O
!=	O
0	int
)	O
)	O
sprintf	function
(	O
buf	pointer
,	O
"%s/e"	pointer
,	O
query	pointer
)	O
;	O
else	O
strcat	function
(	O
buf	pointer
,	O
query	pointer
)	O
;	O
}	O
else	O
strcat	function
(	O
buf	pointer
,	O
query	pointer
)	O
;	O
return	O
buf	pointer
;	O
}	O
void	O
do_query	function
(	O
const	O
int	O
sock	int
,	O
const	O
char	O
*	O
query	pointer
)	O
{	O
char	O
buf	pointer
[	O
200	int
]	O
,	O
*	O
p	pointer
;	O
FILE	struct
*	O
fi	pointer
;	O
int	O
i	int
=	O
0	int
,	O
hide	int
=	O
hide_discl	int
;	O
fi	pointer
=	O
fdopen	function
(	O
sock	int
,	O
"r"	pointer
)	O
;	O
if	O
(	O
write	pointer
(	O
sock	int
,	O
query	pointer
,	O
strlen	function
(	O
query	pointer
)	O
)	O
<	O
0	int
)	O
err_sys	function
(	O
"write"	pointer
)	O
;	O
if	O
(	O
shutdown	function
(	O
sock	int
,	O
1	int
)	O
<	O
0	int
)	O
err_sys	function
(	O
"shutdown"	pointer
)	O
;	O
while	O
(	O
fgets	function
(	O
buf	pointer
,	O
200	int
,	O
fi	pointer
)	O
)	O
{	O
if	O
(	O
hide	int
==	O
1	int
)	O
{	O
if	O
(	O
strncmp	function
(	O
buf	pointer
,	O
hide_strings	array
[	O
i	int
+	O
1	int
]	O
,	O
strlen	function
(	O
hide_strings	array
[	O
i	int
+	O
1	int
]	O
)	O
)	O
==	O
0	int
)	O
hide	int
=	O
2	int
;	O
continue	O
;	O
}	O
if	O
(	O
hide	int
==	O
0	int
)	O
{	O
for	O
(	O
i	int
=	O
0	int
;	O
hide_strings	array
[	O
i	int
]	O
!=	O
NULL	O
;	O
i	int
+=	O
2	int
)	O
{	O
if	O
(	O
strncmp	function
(	O
buf	pointer
,	O
hide_strings	array
[	O
i	int
]	O
,	O
strlen	function
(	O
hide_strings	array
[	O
i	int
]	O
)	O
)	O
==	O
0	int
)	O
{	O
hide	int
=	O
1	int
;	O
break	O
;	O
}	O
}	O
if	O
(	O
hide	int
==	O
1	int
)	O
continue	O
;	O
}	O
if	O
(	O
strncmp	function
(	O
buf	pointer
,	O
"% referto:"	pointer
,	O
10	int
)	O
==	O
0	int
)	O
{	O
char	O
nh	array
[	O
256	int
]	O
,	O
np	array
[	O
16	int
]	O
,	O
nq	array
[	O
1024	int
]	O
;	O
if	O
(	O
sscanf	function
(	O
buf	pointer
,	O
REFERTO_FORMAT	pointer
,	O
nh	array
,	O
np	array
,	O
nq	array
)	O
==	O
3	int
)	O
{	O
int	O
fd	int
;	O
if	O
(	O
verb	int
)	O
printf	function
(	O
_	O
(	O
"Detected referral to %s on %s.\n"	pointer
)	O
,	O
nq	array
,	O
nh	array
)	O
;	O
strcat	function
(	O
nq	array
,	O
"\r\n"	pointer
)	O
;	O
fd	int
=	O
openconn	function
(	O
nh	array
,	O
np	array
)	O
;	O
do_query	function
(	O
fd	int
,	O
nq	array
)	O
;	O
closeconn	function
(	O
fd	int
)	O
;	O
continue	O
;	O
}	O
}	O
for	O
(	O
p	pointer
=	O
buf	pointer
;	O
*	O
p	pointer
&&	O
*	O
p	pointer
!=	O
'\r'	O
&&	O
*	O
p	pointer
!=	O
'\n'	O
;	O
p	pointer
++	O
)	O
;	O
*	O
p	pointer
=	O
'\0'	O
;	O
fprintf	function
(	O
stdout	pointer
,	O
"%s\n"	pointer
,	O
buf	pointer
)	O
;	O
}	O
if	O
(	O
ferror	function
(	O
fi	pointer
)	O
)	O
err_sys	function
(	O
"fgets"	pointer
)	O
;	O
if	O
(	O
hide	int
==	O
1	int
)	O
err_quit	function
(	O
_	O
(	O
"Catastrophic error: disclaimer text has been changed.\n"	pointer
"Please upgrade this program.\n"	pointer
)	O
)	O
;	O
}	O
const	O
char	O
*	O
query_crsnic	function
(	O
const	O
int	O
sock	int
,	O
const	O
char	O
*	O
query	pointer
)	O
{	O
char	O
*	O
temp	union
,	O
buf	pointer
[	O
100	int
]	O
,	O
*	O
ret	pointer
=	O
NULL	O
;	O
FILE	struct
*	O
fi	pointer
;	O
temp	union
=	O
malloc	function
(	O
strlen	function
(	O
query	pointer
)	O
+	O
1	int
+	O
2	int
+	O
1	int
)	O
;	O
*	O
temp	union
=	O
'='	O
;	O
strcpy	function
(	O
temp	union
+	O
1	int
,	O
query	pointer
)	O
;	O
strcat	function
(	O
temp	union
,	O
"\r\n"	pointer
)	O
;	O
fi	pointer
=	O
fdopen	function
(	O
sock	int
,	O
"r"	pointer
)	O
;	O
if	O
(	O
write	pointer
(	O
sock	int
,	O
temp	union
,	O
strlen	function
(	O
temp	union
)	O
)	O
<	O
0	int
)	O
err_sys	function
(	O
"write"	pointer
)	O
;	O
while	O
(	O
fgets	function
(	O
buf	pointer
,	O
100	int
,	O
fi	pointer
)	O
)	O
{	O
if	O
(	O
strncmp	function
(	O
buf	pointer
,	O
"   Whois Server:"	pointer
,	O
16	int
)	O
==	O
0	int
&&	O
!	O
ret	pointer
)	O
{	O
char	O
*	O
p	pointer
,	O
*	O
q	pointer
;	O
for	O
(	O
p	pointer
=	O
buf	pointer
;	O
*	O
p	pointer
!=	O
':'	O
;	O
p	pointer
++	O
)	O
;	O
for	O
(	O
p	pointer
++	O
;	O
*	O
p	pointer
==	O
' '	O
;	O
p	pointer
++	O
)	O
;	O
ret	pointer
=	O
malloc	function
(	O
strlen	function
(	O
p	pointer
)	O
+	O
1	int
)	O
;	O
for	O
(	O
q	pointer
=	O
ret	pointer
;	O
*	O
p	pointer
!=	O
'\n'	O
&&	O
*	O
p	pointer
!=	O
'\r'	O
;	O
*	O
q	pointer
++	O
=	O
*	O
p	pointer
++	O
)	O
;	O
*	O
q	pointer
=	O
'\0'	O
;	O
}	O
fputs	function
(	O
buf	pointer
,	O
stdout	pointer
)	O
;	O
}	O
if	O
(	O
ferror	function
(	O
fi	pointer
)	O
)	O
err_sys	function
(	O
"fgets"	pointer
)	O
;	O
free	function
(	O
temp	union
)	O
;	O
return	O
ret	pointer
;	O
}	O
int	O
openconn	function
(	O
const	O
char	O
*	O
server	pointer
,	O
const	O
char	O
*	O
port	pointer
)	O
{	O
int	O
fd	int
;	O
int	O
i	int
;	O
struct	O
addrinfo	struct
hints	struct
,	O
*	O
res	pointer
,	O
*	O
ressave	pointer
;	O
memset	function
(	O
&	O
hints	struct
,	O
0	int
,	O
sizeof	O
(	O
struct	O
addrinfo	struct
)	O
)	O
;	O
hints	struct
.	O
ai_family	int
=	O
AF_UNSPEC	O
;	O
hints	struct
.	O
ai_socktype	int
=	O
SOCK_STREAM	int
;	O
if	O
(	O
(	O
i	int
=	O
getaddrinfo	function
(	O
server	pointer
,	O
port	pointer
?	O
port	pointer
:	O
"whois"	pointer
,	O
&	O
hints	struct
,	O
&	O
res	pointer
)	O
)	O
!=	O
0	int
)	O
err_quit	function
(	O
"getaddrinfo: %s"	pointer
,	O
gai_strerror	function
(	O
i	int
)	O
)	O
;	O
for	O
(	O
ressave	pointer
=	O
res	pointer
;	O
res	pointer
;	O
res	pointer
=	O
res	pointer
->	O
ai_next	pointer
)	O
{	O
if	O
(	O
(	O
fd	int
=	O
socket	function
(	O
res	pointer
->	O
ai_family	int
,	O
res	pointer
->	O
ai_socktype	int
,	O
res	pointer
->	O
ai_protocol	int
)	O
)	O
<	O
0	int
)	O
continue	O
;	O
if	O
(	O
connect	function
(	O
fd	int
,	O
res	pointer
->	O
ai_addr	pointer
,	O
res	pointer
->	O
ai_addrlen	int
)	O
==	O
0	int
)	O
break	O
;	O
close	pointer
(	O
fd	int
)	O
;	O
}	O
if	O
(	O
!	O
res	pointer
)	O
err_sys	function
(	O
"connect"	pointer
)	O
;	O
freeaddrinfo	function
(	O
ressave	pointer
)	O
;	O
return	O
(	O
fd	int
)	O
;	O
}	O
void	O
closeconn	function
(	O
const	O
int	O
fd	int
)	O
{	O
close	pointer
(	O
fd	int
)	O
;	O
}	O
void	O
sighandler	function
(	O
int	O
signum	int
)	O
{	O
closeconn	function
(	O
sockfd	int
)	O
;	O
err_quit	function
(	O
_	O
(	O
"Interrupted by signal %d..."	pointer
)	O
,	O
signum	int
)	O
;	O
}	O
int	O
domcmp	function
(	O
const	O
char	O
*	O
dom	pointer
,	O
const	O
char	O
*	O
tld	pointer
)	O
{	O
const	O
char	O
*	O
p	pointer
,	O
*	O
q	pointer
;	O
for	O
(	O
p	pointer
=	O
dom	pointer
;	O
*	O
p	pointer
!=	O
'\0'	O
;	O
p	pointer
++	O
)	O
;	O
p	pointer
--	O
;	O
for	O
(	O
q	pointer
=	O
tld	pointer
;	O
*	O
q	pointer
!=	O
'\0'	O
;	O
q	pointer
++	O
)	O
;	O
q	pointer
--	O
;	O
while	O
(	O
p	pointer
>=	O
dom	pointer
&&	O
q	pointer
>=	O
tld	pointer
&&	O
tolower	function
(	O
*	O
p	pointer
)	O
==	O
*	O
q	pointer
)	O
{	O
if	O
(	O
q	pointer
==	O
tld	pointer
)	O
return	O
1	int
;	O
p	pointer
--	O
;	O
q	pointer
--	O
;	O
}	O
return	O
0	int
;	O
}	O
int	O
domfind	function
(	O
const	O
char	O
*	O
dom	pointer
,	O
const	O
char	O
*	O
tldlist	array
[	O
]	O
)	O
{	O
int	O
i	int
;	O
for	O
(	O
i	int
=	O
0	int
;	O
tldlist	array
[	O
i	int
]	O
;	O
i	int
++	O
)	O
if	O
(	O
domcmp	function
(	O
dom	pointer
,	O
tldlist	array
[	O
i	int
]	O
)	O
)	O
return	O
1	int
;	O
return	O
0	int
;	O
}	O
unsigned	O
long	O
myinet_aton	function
(	O
const	O
char	O
*	O
s	pointer
)	O
{	O
int	O
a	int
,	O
b	int
,	O
c	int
,	O
d	int
;	O
if	O
(	O
!	O
s	pointer
)	O
return	O
0	int
;	O
if	O
(	O
sscanf	function
(	O
s	pointer
,	O
"%d.%d.%d.%d"	pointer
,	O
&	O
a	int
,	O
&	O
b	int
,	O
&	O
c	int
,	O
&	O
d	int
)	O
!=	O
4	int
)	O
return	O
0	int
;	O
return	O
(	O
a	int
<<	O
24	int
)	O
+	O
(	O
b	int
<<	O
16	int
)	O
+	O
(	O
c	int
<<	O
8	int
)	O
+	O
d	int
;	O
}	O
void	O
err_sys	function
(	O
const	O
char	O
*	O
fmt	pointer
,	O
...	O
)	O
{	O
va_list	array
ap	array
;	O
va_start	O
(	O
ap	array
,	O
fmt	pointer
)	O
;	O
vfprintf	function
(	O
stderr	pointer
,	O
fmt	pointer
,	O
ap	array
)	O
;	O
fprintf	function
(	O
stderr	pointer
,	O
": %s\n"	pointer
,	O
strerror	function
(	O
errno	O
)	O
)	O
;	O
va_end	O
(	O
ap	array
)	O
;	O
exit	function
(	O
EXIT_FAILURE	int
)	O
;	O
}	O
void	O
err_quit	function
(	O
const	O
char	O
*	O
fmt	pointer
,	O
...	O
)	O
{	O
va_list	array
ap	array
;	O
va_start	O
(	O
ap	array
,	O
fmt	pointer
)	O
;	O
vfprintf	function
(	O
stderr	pointer
,	O
fmt	pointer
,	O
ap	array
)	O
;	O
fputs	function
(	O
"\n"	pointer
,	O
stderr	pointer
)	O
;	O
va_end	O
(	O
ap	array
)	O
;	O
exit	function
(	O
EXIT_FAILURE	int
)	O
;	O
}	O
