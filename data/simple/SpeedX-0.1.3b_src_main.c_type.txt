int	O
XShmGetEventBase	function
(	O
Display	struct
*	O
dpy	pointer
)	O
;	O
int	O
mit_shm	int
;	O
int	O
factor	short
;	O
int	O
bpl	int
;	O
int	O
bitmap_pad	int
;	O
int	O
bitmap_bit_order	int
;	O
char	O
*	O
screen_buffer	pointer
,	O
*	O
screen_buffer2	pointer
;	O
char	O
*	O
sky	pointer
;	O
void	O
init_display	function
(	O
void	O
)	O
{	O
int	O
i	int
;	O
printf	function
(	O
". Drawing Initialised ..."	pointer
)	O
;	O
fflush	function
(	O
stdout	pointer
)	O
;	O
if	O
(	O
(	O
display	pointer
=	O
XOpenDisplay	function
(	O
DisplayName	array
)	O
)	O
==	O
NULL	O
)	O
{	O
printf	function
(	O
"ERREUR! (Display invalide : %s)\n"	pointer
,	O
DisplayName	array
)	O
;	O
exit	function
(	O
1	int
)	O
;	O
}	O
screen	pointer
=	O
DefaultScreen	O
(	O
display	pointer
)	O
;	O
depth	int
=	O
DefaultDepth	O
(	O
display	pointer
,	O
screen	pointer
)	O
;	O
bpp	int
=	O
0	int
;	O
for	O
(	O
i	int
=	O
0	int
;	O
i	int
<	O
(	O
(	O
_XPrivDisplay	pointer
)	O
display	pointer
)	O
->	O
nformats	int
;	O
i	int
++	O
)	O
{	O
ScreenFormat	struct
sf	struct
=	O
(	O
(	O
_XPrivDisplay	pointer
)	O
display	pointer
)	O
->	O
pixmap_format	pointer
[	O
i	int
]	O
;	O
if	O
(	O
sf	struct
.	O
depth	int
==	O
(	O
int	O
)	O
depth	int
)	O
{	O
bpp	int
=	O
sf	struct
.	O
bits_per_pixel	int
;	O
}	O
}	O
bitmap_bit_order	int
=	O
BitmapBitOrder	O
(	O
display	pointer
)	O
;	O
switch	O
(	O
bpp	int
)	O
{	O
case	O
8	int
:	O
factor	short
=	O
1	int
;	O
bitmap_pad	int
=	O
8	int
;	O
break	O
;	O
case	O
15	int
:	O
case	O
16	int
:	O
factor	short
=	O
2	int
;	O
bitmap_pad	int
=	O
16	int
;	O
break	O
;	O
case	O
24	int
:	O
factor	short
=	O
3	int
;	O
bitmap_pad	int
=	O
32	int
;	O
break	O
;	O
case	O
32	int
:	O
factor	short
=	O
4	int
;	O
bitmap_pad	int
=	O
32	int
;	O
break	O
;	O
default	O
:	O
factor	short
=	O
0	int
;	O
printf	function
(	O
"Error : (This graphics mode is not managed ..)\n"	pointer
)	O
;	O
exit	function
(	O
1	int
)	O
;	O
break	O
;	O
}	O
visual	pointer
=	O
DefaultVisual	O
(	O
display	pointer
,	O
screen	pointer
)	O
;	O
root_width	int
=	O
DisplayWidth	O
(	O
display	pointer
,	O
screen	pointer
)	O
;	O
root_height	int
=	O
DisplayHeight	O
(	O
display	pointer
,	O
screen	pointer
)	O
;	O
root	long
=	O
DefaultRootWindow	O
(	O
display	pointer
)	O
;	O
printf	function
(	O
"OK\n"	pointer
)	O
;	O
}	O
void	O
init_win	function
(	O
)	O
{	O
unsigned	O
long	O
win_mask	long
;	O
XSetWindowAttributes	struct
win_attr	struct
;	O
XSizeHints	struct
win_hint	struct
;	O
printf	function
(	O
". Window Initialised..."	pointer
)	O
;	O
fflush	function
(	O
stdout	pointer
)	O
;	O
mit_shm	int
=	O
0	int
;	O
{	O
int	O
major	int
,	O
minor	int
;	O
Bool	int
pix	int
;	O
mit_shm	int
=	O
XShmQueryVersion	function
(	O
display	pointer
,	O
&	O
major	int
,	O
&	O
minor	int
,	O
&	O
pix	int
)	O
;	O
CompletionType	int
=	O
XShmGetEventBase	function
(	O
display	pointer
)	O
+	O
ShmCompletion	int
;	O
if	O
(	O
multi	int
)	O
{	O
mit_shm	int
=	O
0	int
;	O
}	O
}	O
win_mask	long
=	O
CWBackPixel	O
|	O
CWBorderPixel	O
;	O
win_attr	struct
.	O
border_pixel	long
=	O
BlackPixel	O
(	O
display	pointer
,	O
screen	pointer
)	O
;	O
win_attr	struct
.	O
background_pixel	long
=	O
BlackPixel	O
(	O
display	pointer
,	O
screen	pointer
)	O
;	O
if	O
(	O
dble	int
==	O
0	int
)	O
if	O
(	O
multi	int
==	O
0	int
)	O
{	O
win	long
=	O
XCreateWindow	function
(	O
display	pointer
,	O
root	long
,	O
root_width	int
>>	O
1	int
,	O
root_height	int
>>	O
2	int
,	O
WIDTH	int
,	O
HEIGHT	int
,	O
BORDER	int
,	O
depth	int
,	O
InputOutput	int
,	O
CopyFromParent	int
,	O
win_mask	long
,	O
&	O
win_attr	struct
)	O
;	O
}	O
else	O
{	O
win	long
=	O
XCreateWindow	function
(	O
display	pointer
,	O
root	long
,	O
root_width	int
>>	O
2	int
,	O
root_height	int
>>	O
1	int
,	O
(	O
WIDTH	int
)	O
,	O
(	O
HEIGHT	int
)	O
,	O
BORDER	int
,	O
depth	int
,	O
InputOutput	int
,	O
CopyFromParent	int
,	O
win_mask	long
,	O
&	O
win_attr	struct
)	O
;	O
printf	function
(	O
"MULTI 1\n"	pointer
)	O
;	O
}	O
else	O
if	O
(	O
multi	int
==	O
0	int
)	O
{	O
win	long
=	O
XCreateWindow	function
(	O
display	pointer
,	O
root	long
,	O
root_width	int
>>	O
2	int
,	O
root_height	int
>>	O
2	int
,	O
(	O
WIDTH	int
*	O
2	int
)	O
,	O
(	O
HEIGHT	int
*	O
2	int
)	O
,	O
BORDER	int
,	O
depth	int
,	O
InputOutput	int
,	O
CopyFromParent	int
,	O
win_mask	long
,	O
&	O
win_attr	struct
)	O
;	O
printf	function
(	O
"MULTI 0\n"	pointer
)	O
;	O
}	O
else	O
{	O
win	long
=	O
XCreateWindow	function
(	O
display	pointer
,	O
root	long
,	O
root_width	int
>>	O
2	int
,	O
root_height	int
>>	O
2	int
,	O
(	O
WIDTH	int
)	O
,	O
(	O
HEIGHT	int
)	O
,	O
BORDER	int
,	O
depth	int
,	O
InputOutput	int
,	O
CopyFromParent	int
,	O
win_mask	long
,	O
&	O
win_attr	struct
)	O
;	O
printf	function
(	O
"MULTI 1\n"	pointer
)	O
;	O
}	O
multi	int
=	O
0	int
;	O
win_hint	struct
.	O
flags	char
=	O
PPosition	O
|	O
PMinSize	O
|	O
PMaxSize	O
;	O
win_hint	struct
.	O
x	int
=	O
0	int
;	O
win_hint	struct
.	O
y	int
=	O
0	int
;	O
if	O
(	O
dble	int
==	O
0	int
)	O
{	O
win_hint	struct
.	O
max_width	int
=	O
win_hint	struct
.	O
min_width	int
=	O
WIDTH	int
;	O
win_hint	struct
.	O
max_height	int
=	O
win_hint	struct
.	O
min_height	int
=	O
HEIGHT	int
;	O
}	O
else	O
{	O
win_hint	struct
.	O
max_width	int
=	O
win_hint	struct
.	O
min_width	int
=	O
WIDTH	int
*	O
2	int
;	O
win_hint	struct
.	O
max_height	int
=	O
win_hint	struct
.	O
min_height	int
=	O
HEIGHT	int
*	O
2	int
;	O
}	O
XSetWMNormalHints	function
(	O
display	pointer
,	O
win	long
,	O
&	O
win_hint	struct
)	O
;	O
if	O
(	O
multi	int
)	O
XSetWMNormalHints	function
(	O
display	pointer
,	O
win2	long
,	O
&	O
win_hint	struct
)	O
;	O
if	O
(	O
depth	int
==	O
8	int
)	O
{	O
cmap	long
=	O
XCreateColormap	function
(	O
display	pointer
,	O
win	long
,	O
visual	pointer
,	O
AllocAll	int
)	O
;	O
XSetWindowColormap	function
(	O
display	pointer
,	O
win	long
,	O
cmap	long
)	O
;	O
if	O
(	O
multi	int
)	O
XSetWindowColormap	function
(	O
display	pointer
,	O
win2	long
,	O
cmap	long
)	O
;	O
}	O
XMapWindow	function
(	O
display	pointer
,	O
win	long
)	O
;	O
if	O
(	O
multi	int
)	O
XMapWindow	function
(	O
display	pointer
,	O
win2	long
)	O
;	O
XFlush	function
(	O
display	pointer
)	O
;	O
XSelectInput	function
(	O
display	pointer
,	O
win	long
,	O
KeyPressMask	O
|	O
KeyReleaseMask	O
|	O
FocusChangeMask	O
)	O
;	O
if	O
(	O
multi	int
)	O
XSelectInput	function
(	O
display	pointer
,	O
win2	long
,	O
KeyPressMask	O
|	O
KeyReleaseMask	O
|	O
FocusChangeMask	O
)	O
;	O
gcVal	struct
.	O
foreground	long
=	O
0	int
;	O
gcVal	struct
.	O
background	long
=	O
WhitePixel	O
(	O
display	pointer
,	O
screen	pointer
)	O
;	O
gcMask	long
=	O
GCForeground	O
|	O
GCBackground	O
;	O
gc	pointer
=	O
XCreateGC	function
(	O
display	pointer
,	O
win	long
,	O
gcMask	long
,	O
&	O
gcVal	struct
)	O
;	O
{	O
Cursor	long
c	long
;	O
c	long
=	O
XCreateFontCursor	function
(	O
display	pointer
,	O
XC_circle	int
)	O
;	O
XDefineCursor	function
(	O
display	pointer
,	O
win	long
,	O
c	long
)	O
;	O
}	O
XAutoRepeatOn	function
(	O
display	pointer
)	O
;	O
init_table_perspective	function
(	O
)	O
;	O
if	O
(	O
multi	int
)	O
{	O
XStoreName	function
(	O
display	pointer
,	O
win	long
,	O
"SpeedX : 1"	pointer
)	O
;	O
XStoreName	function
(	O
display	pointer
,	O
win2	long
,	O
"SpeedX : 2"	pointer
)	O
;	O
}	O
else	O
XStoreName	function
(	O
display	pointer
,	O
win	long
,	O
"SpeedX"	pointer
)	O
;	O
if	O
(	O
depth	int
==	O
8	int
)	O
{	O
XColor	struct
xc	struct
;	O
unsigned	O
int	O
r	int
,	O
g	int
,	O
b	array
;	O
for	O
(	O
b	array
=	O
0	int
;	O
b	array
<	O
8	int
;	O
b	array
++	O
)	O
{	O
for	O
(	O
g	int
=	O
0	int
;	O
g	int
<	O
8	int
;	O
g	int
++	O
)	O
{	O
for	O
(	O
r	int
=	O
0	int
;	O
r	int
<	O
4	int
;	O
r	int
++	O
)	O
{	O
xc	struct
.	O
pixel	long
=	O
b	array
|	O
g	int
<<	O
3	int
|	O
r	int
<<	O
6	int
;	O
xc	struct
.	O
red	short
=	O
r	int
<<	O
14	int
;	O
xc	struct
.	O
green	short
=	O
g	int
<<	O
13	int
;	O
xc	struct
.	O
blue	short
=	O
b	array
<<	O
13	int
;	O
xc	struct
.	O
flags	char
=	O
DoRed	O
|	O
DoGreen	O
|	O
DoBlue	O
;	O
XStoreColor	function
(	O
display	pointer
,	O
cmap	long
,	O
&	O
xc	struct
)	O
;	O
}	O
}	O
}	O
}	O
printf	function
(	O
"OK\n"	pointer
)	O
;	O
}	O
void	O
init_buffers	function
(	O
void	O
)	O
{	O
int	O
taille_img	int
;	O
printf	function
(	O
". Buffers Initialisation ..."	pointer
)	O
;	O
fflush	function
(	O
stdout	pointer
)	O
;	O
bpl	int
=	O
factor	short
*	O
WIDTH	int
;	O
if	O
(	O
dble	int
!=	O
0	int
)	O
bpl	int
=	O
2	int
*	O
bpl	int
;	O
screen_buffer	pointer
=	O
(	O
char	O
*	O
)	O
calloc	function
(	O
factor	short
*	O
(	O
WIDTH	int
)	O
*	O
(	O
HEIGHT	int
)	O
,	O
sizeof	O
(	O
char	O
)	O
)	O
;	O
if	O
(	O
dble	int
!=	O
0	int
)	O
screen_buffer2	pointer
=	O
(	O
char	O
*	O
)	O
calloc	function
(	O
4	int
*	O
factor	short
*	O
(	O
WIDTH	int
)	O
*	O
(	O
HEIGHT	int
)	O
,	O
sizeof	O
(	O
char	O
)	O
)	O
;	O
sky	pointer
=	O
(	O
char	O
*	O
)	O
calloc	function
(	O
factor	short
*	O
(	O
WIDTH	int
)	O
*	O
(	O
HEIGHT	int
)	O
,	O
sizeof	O
(	O
char	O
)	O
)	O
;	O
bool	int
=	O
1	int
;	O
if	O
(	O
dble	int
==	O
0	int
)	O
{	O
if	O
(	O
mit_shm	int
)	O
{	O
xim	pointer
=	O
XShmCreateImage	function
(	O
display	pointer
,	O
CopyFromParent	int
,	O
(	O
unsigned	O
int	O
)	O
depth	int
,	O
ZPixmap	int
,	O
0	int
,	O
shminfo	struct
,	O
WIDTH	int
,	O
HEIGHT	int
)	O
;	O
}	O
else	O
{	O
xim	pointer
=	O
XCreateImage	function
(	O
display	pointer
,	O
CopyFromParent	int
,	O
(	O
unsigned	O
int	O
)	O
depth	int
,	O
ZPixmap	int
,	O
0	int
,	O
screen_buffer	pointer
,	O
WIDTH	int
,	O
HEIGHT	int
,	O
bitmap_pad	int
,	O
bpl	int
)	O
;	O
}	O
}	O
else	O
{	O
if	O
(	O
mit_shm	int
)	O
{	O
xim	pointer
=	O
XShmCreateImage	function
(	O
display	pointer
,	O
CopyFromParent	int
,	O
(	O
unsigned	O
int	O
)	O
depth	int
,	O
ZPixmap	int
,	O
0	int
,	O
shminfo	struct
,	O
WIDTH	int
*	O
2	int
,	O
HEIGHT	int
*	O
2	int
)	O
;	O
}	O
else	O
{	O
xim	pointer
=	O
XCreateImage	function
(	O
display	pointer
,	O
CopyFromParent	int
,	O
(	O
unsigned	O
int	O
)	O
depth	int
,	O
ZPixmap	int
,	O
0	int
,	O
screen_buffer2	pointer
,	O
WIDTH	int
*	O
2	int
,	O
HEIGHT	int
*	O
2	int
,	O
bitmap_pad	int
,	O
bpl	int
)	O
;	O
}	O
}	O
switch	O
(	O
rand	function
(	O
)	O
%	O
2	int
)	O
{	O
case	O
0	int
:	O
taille_img	int
=	O
init	function
(	O
&	O
sky	pointer
,	O
0	int
,	O
depth	int
)	O
;	O
break	O
;	O
case	O
1	int
:	O
taille_img	int
=	O
init	function
(	O
&	O
sky	pointer
,	O
1	int
,	O
depth	int
)	O
;	O
break	O
;	O
}	O
if	O
(	O
mit_shm	int
)	O
{	O
key_t	int
clef	int
;	O
int	O
id	int
;	O
int	O
size	int
=	O
-	O
1	int
;	O
size	int
=	O
factor	short
*	O
WIDTH	int
*	O
HEIGHT	int
;	O
if	O
(	O
dble	int
)	O
size	int
*=	O
4	int
;	O
{	O
int	O
key_id	int
=	O
1	int
;	O
do	O
{	O
clef	int
=	O
ftok	function
(	O
"."	pointer
,	O
key_id	int
)	O
;	O
key_id	int
++	O
;	O
}	O
while	O
(	O
(	O
id	int
=	O
shmget	function
(	O
clef	int
,	O
size	int
,	O
IPC_CREAT	int
|	O
0777	int
)	O
)	O
==	O
-	O
1	int
)	O
;	O
}	O
shminfo	struct
[	O
0	int
]	O
.	O
shmid	int
=	O
id	int
;	O
if	O
(	O
dble	int
==	O
0	int
)	O
{	O
if	O
(	O
screen_buffer	pointer
!=	O
NULL	O
)	O
free	function
(	O
screen_buffer	pointer
)	O
;	O
xim	pointer
->	O
data	pointer
=	O
screen_buffer	pointer
=	O
shminfo	struct
[	O
0	int
]	O
.	O
shmaddr	pointer
=	O
(	O
void	O
*	O
)	O
shmat	function
(	O
id	int
,	O
0	int
,	O
0	int
)	O
;	O
}	O
else	O
{	O
if	O
(	O
screen_buffer2	pointer
!=	O
NULL	O
)	O
free	function
(	O
screen_buffer2	pointer
)	O
;	O
xim	pointer
->	O
data	pointer
=	O
screen_buffer2	pointer
=	O
shminfo	struct
[	O
0	int
]	O
.	O
shmaddr	pointer
=	O
(	O
void	O
*	O
)	O
shmat	function
(	O
id	int
,	O
0	int
,	O
0	int
)	O
;	O
}	O
shminfo	struct
[	O
0	int
]	O
.	O
readOnly	int
=	O
False	int
;	O
if	O
(	O
!	O
XShmAttach	function
(	O
display	pointer
,	O
shminfo	struct
)	O
)	O
{	O
}	O
XSync	function
(	O
display	pointer
,	O
0	int
)	O
;	O
shmctl	function
(	O
shminfo	struct
[	O
0	int
]	O
.	O
shmid	int
,	O
IPC_RMID	int
,	O
0	int
)	O
;	O
XShmPutImage	function
(	O
display	pointer
,	O
win	long
,	O
gc	pointer
,	O
xim	pointer
,	O
0	int
,	O
0	int
,	O
0	int
,	O
0	int
,	O
WIDTH	int
,	O
HEIGHT	int
,	O
False	int
)	O
;	O
}	O
printf	function
(	O
"OK\n"	pointer
)	O
;	O
}	O
int	O
main	function
(	O
int	O
argc	int
,	O
char	O
*	O
argv	array
[	O
]	O
)	O
{	O
OptionParsing	function
(	O
argc	int
,	O
argv	array
)	O
;	O
srand	function
(	O
(	O
unsigned	O
int	O
)	O
time	long
(	O
NULL	O
)	O
)	O
;	O
init_display	function
(	O
)	O
;	O
init_keyboard	function
(	O
display	pointer
)	O
;	O
init_win	function
(	O
)	O
;	O
init_buffers	function
(	O
)	O
;	O
init_world	function
(	O
)	O
;	O
switch	O
(	O
player	int
)	O
{	O
case	O
-	O
1	int
:	O
printf	function
(	O
"Sorry ! Every cars have a pilot.\n"	pointer
)	O
;	O
printf	function
(	O
"Come back later !.\n"	pointer
)	O
;	O
exit	function
(	O
0	int
)	O
;	O
break	O
;	O
case	O
0	int
:	O
printf	function
(	O
"You are the server.\n"	pointer
)	O
;	O
break	O
;	O
default	O
:	O
printf	function
(	O
"You are a client [IPC].\n"	pointer
)	O
;	O
break	O
;	O
}	O
printf	function
(	O
"   * depth = %d\n"	pointer
,	O
depth	int
)	O
;	O
printf	function
(	O
"   * bpp   = %d\n"	pointer
,	O
bpp	int
)	O
;	O
if	O
(	O
autorun	int
!=	O
1	int
)	O
{	O
loop	function
(	O
display	pointer
)	O
;	O
}	O
else	O
auto_run	function
(	O
)	O
;	O
{	O
if	O
(	O
mit_shm	int
)	O
{	O
XShmDetach	function
(	O
display	pointer
,	O
shminfo	struct
)	O
;	O
shmctl	function
(	O
shminfo	struct
[	O
0	int
]	O
.	O
shmid	int
,	O
IPC_RMID	int
,	O
0	int
)	O
;	O
shmdt	function
(	O
shminfo	struct
[	O
0	int
]	O
.	O
shmaddr	pointer
)	O
;	O
}	O
if	O
(	O
!	O
mit_shm	int
)	O
free	function
(	O
screen_buffer	pointer
)	O
;	O
XDestroyWindow	function
(	O
display	pointer
,	O
win	long
)	O
;	O
XCloseDisplay	function
(	O
display	pointer
)	O
;	O
free	function
(	O
sky	pointer
)	O
;	O
Free_sprite	function
(	O
)	O
;	O
liberation	function
(	O
)	O
;	O
}	O
return	O
0	int
;	O
}	O
