enum	O
rush_wtmp_dir	enum
rush_wtmp_dir	enum
=	O
rush_wtmp_forward	int
;	O
static	O
int	O
wtmp_fd	int
=	O
-	O
1	int
;	O
static	O
size_t	long
wtmp_recsize	long
=	O
0	int
;	O
int	O
rush_wtmp_open	function
(	O
const	O
char	O
*	O
name	pointer
,	O
int	O
rw	int
)	O
{	O
int	O
fd	int
;	O
fd	int
=	O
open	function
(	O
name	pointer
,	O
rw	int
?	O
O_RDWR	int
|	O
O_CREAT	int
:	O
O_RDONLY	int
,	O
rushdb_file_mode	int
)	O
;	O
if	O
(	O
fd	int
==	O
-	O
1	int
)	O
return	O
-	O
1	int
;	O
wtmp_fd	int
=	O
fd	int
;	O
return	O
0	int
;	O
}	O
int	O
rush_wtmp_close	function
(	O
)	O
{	O
int	O
rc	int
=	O
close	function
(	O
wtmp_fd	int
)	O
;	O
wtmp_fd	int
=	O
-	O
1	int
;	O
return	O
rc	int
;	O
}	O
int	O
rush_wtmp_rewind	function
(	O
void	O
)	O
{	O
int	O
whence	int
;	O
switch	O
(	O
rush_wtmp_dir	enum
)	O
{	O
case	O
rush_wtmp_forward	int
:	O
whence	int
=	O
SEEK_SET	int
;	O
break	O
;	O
case	O
rush_wtmp_backward	int
:	O
whence	int
=	O
SEEK_END	int
;	O
break	O
;	O
default	O
:	O
abort	function
(	O
)	O
;	O
}	O
return	O
lseek	function
(	O
wtmp_fd	int
,	O
0	int
,	O
whence	int
)	O
==	O
-	O
1	int
;	O
}	O
void	O
rush_wtmp_set_dir	function
(	O
enum	O
rush_wtmp_dir	enum
dir	enum
)	O
{	O
rush_wtmp_dir	enum
=	O
dir	enum
;	O
rush_wtmp_rewind	function
(	O
)	O
;	O
}	O
int	O
rush_wtmp_seek	function
(	O
off_t	long
off	long
)	O
{	O
off_t	long
rc	int
=	O
lseek	function
(	O
wtmp_fd	int
,	O
off	long
,	O
SEEK_SET	int
)	O
;	O
if	O
(	O
rc	int
==	O
off	long
)	O
{	O
wtmp_recsize	long
=	O
0	int
;	O
return	O
0	int
;	O
}	O
return	O
1	int
;	O
}	O
struct	O
rush_wtmp	struct
*	O
alloc_wtmp	function
(	O
size_t	long
reclen	long
)	O
{	O
struct	O
rush_wtmp	struct
*	O
wtmp	pointer
=	O
malloc	function
(	O
sizeof	O
(	O
*	O
wtmp	pointer
)	O
+	O
reclen	long
-	O
sizeof	O
(	O
size_t	long
)	O
)	O
;	O
if	O
(	O
wtmp	pointer
)	O
wtmp	pointer
->	O
reclen	long
=	O
reclen	long
;	O
return	O
wtmp	pointer
;	O
}	O
enum	O
rushdb_result	enum
rush_wtmp_read_fwd	function
(	O
struct	O
rush_wtmp	struct
*	O
*	O
pwtmp	pointer
)	O
{	O
struct	O
rush_wtmp	struct
*	O
wtmprec	pointer
;	O
size_t	long
reclen	long
,	O
left	long
;	O
ssize_t	long
size	long
;	O
char	O
*	O
p	pointer
,	O
*	O
s	pointer
;	O
if	O
(	O
wtmp_fd	int
==	O
-	O
1	int
)	O
{	O
errno	O
=	O
EINVAL	int
;	O
return	O
rushdb_result_fail	int
;	O
}	O
size	long
=	O
read	function
(	O
wtmp_fd	int
,	O
&	O
reclen	long
,	O
sizeof	O
(	O
reclen	long
)	O
)	O
;	O
if	O
(	O
size	long
==	O
0	int
)	O
return	O
rushdb_result_eof	int
;	O
if	O
(	O
size	long
!=	O
sizeof	O
(	O
reclen	long
)	O
)	O
return	O
rushdb_result_fail	int
;	O
wtmp_recsize	long
=	O
reclen	long
;	O
wtmprec	pointer
=	O
alloc_wtmp	function
(	O
reclen	long
)	O
;	O
if	O
(	O
!	O
wtmprec	pointer
)	O
return	O
rushdb_result_fail	int
;	O
p	pointer
=	O
RUSH_WTMP_DATA_PTR	O
(	O
wtmprec	pointer
)	O
;	O
reclen	long
-=	O
sizeof	O
(	O
reclen	long
)	O
;	O
left	long
=	O
reclen	long
;	O
while	O
(	O
left	long
)	O
{	O
ssize_t	long
n	long
=	O
read	function
(	O
wtmp_fd	int
,	O
p	pointer
,	O
left	long
)	O
;	O
if	O
(	O
n	long
==	O
-	O
1	int
)	O
goto	O
errlab	O
;	O
p	pointer
+=	O
n	long
;	O
left	long
-=	O
n	long
;	O
}	O
p	pointer
=	O
(	O
char	O
*	O
)	O
(	O
wtmprec	pointer
+	O
1	int
)	O
;	O
s	pointer
=	O
p	pointer
;	O
wtmprec	pointer
->	O
user	pointer
=	O
s	pointer
;	O
s	pointer
+=	O
strlen	function
(	O
s	pointer
)	O
+	O
1	int
;	O
if	O
(	O
s	pointer
-	O
p	pointer
>	O
reclen	long
)	O
goto	O
errlab	O
;	O
wtmprec	pointer
->	O
rule	pointer
=	O
s	pointer
;	O
s	pointer
+=	O
strlen	function
(	O
s	pointer
)	O
+	O
1	int
;	O
if	O
(	O
s	pointer
-	O
p	pointer
>	O
reclen	long
)	O
goto	O
errlab	O
;	O
wtmprec	pointer
->	O
command	pointer
=	O
s	pointer
;	O
*	O
pwtmp	pointer
=	O
wtmprec	pointer
;	O
return	O
rushdb_result_ok	int
;	O
errlab	O
:	O
free	function
(	O
wtmprec	pointer
)	O
;	O
rush_wtmp_close	function
(	O
)	O
;	O
return	O
rushdb_result_fail	int
;	O
}	O
enum	O
rushdb_result	enum
rush_wtmp_read	function
(	O
struct	O
rush_wtmp	struct
*	O
*	O
pwtmp	pointer
)	O
{	O
size_t	long
reclen	long
;	O
enum	O
rushdb_result	enum
res	enum
;	O
switch	O
(	O
rush_wtmp_dir	enum
)	O
{	O
case	O
rush_wtmp_forward	int
:	O
res	enum
=	O
rush_wtmp_read_fwd	function
(	O
pwtmp	pointer
)	O
;	O
if	O
(	O
lseek	function
(	O
wtmp_fd	int
,	O
sizeof	O
(	O
reclen	long
)	O
,	O
SEEK_CUR	int
)	O
==	O
-	O
1	int
)	O
res	enum
=	O
rushdb_result_fail	int
;	O
break	O
;	O
case	O
rush_wtmp_backward	int
:	O
if	O
(	O
lseek	function
(	O
wtmp_fd	int
,	O
0	int
,	O
SEEK_CUR	int
)	O
==	O
0	int
)	O
return	O
rushdb_result_eof	int
;	O
if	O
(	O
lseek	function
(	O
wtmp_fd	int
,	O
-	O
sizeof	O
(	O
reclen	long
)	O
,	O
SEEK_CUR	int
)	O
==	O
-	O
1	int
)	O
return	O
rushdb_result_fail	int
;	O
if	O
(	O
read	function
(	O
wtmp_fd	int
,	O
&	O
reclen	long
,	O
sizeof	O
(	O
reclen	long
)	O
)	O
!=	O
sizeof	O
(	O
reclen	long
)	O
)	O
return	O
rushdb_result_fail	int
;	O
if	O
(	O
lseek	function
(	O
wtmp_fd	int
,	O
-	O
(	O
reclen	long
+	O
sizeof	O
(	O
reclen	long
)	O
)	O
,	O
SEEK_CUR	int
)	O
==	O
-	O
1	int
)	O
return	O
rushdb_result_fail	int
;	O
res	enum
=	O
rush_wtmp_read_fwd	function
(	O
pwtmp	pointer
)	O
;	O
if	O
(	O
res	enum
==	O
rushdb_result_ok	int
)	O
{	O
if	O
(	O
lseek	function
(	O
wtmp_fd	int
,	O
-	O
reclen	long
,	O
SEEK_CUR	int
)	O
==	O
-	O
1	int
)	O
return	O
rushdb_result_fail	int
;	O
}	O
break	O
;	O
default	O
:	O
abort	function
(	O
)	O
;	O
}	O
return	O
res	enum
;	O
}	O
size_t	long
rush_wtmp_reclen	function
(	O
struct	O
rush_wtmp	struct
*	O
src	pointer
)	O
{	O
size_t	long
reclen	long
=	O
sizeof	O
(	O
struct	O
rush_wtmp	struct
)	O
+	O
strlen	function
(	O
src	pointer
->	O
user	pointer
)	O
+	O
1	int
+	O
strlen	function
(	O
src	pointer
->	O
rule	pointer
)	O
+	O
1	int
+	O
strlen	function
(	O
src	pointer
->	O
command	pointer
)	O
+	O
1	int
;	O
return	O
reclen	long
;	O
}	O
struct	O
rush_wtmp	struct
*	O
rush_wtmp_copy	function
(	O
struct	O
rush_wtmp	struct
*	O
src	pointer
)	O
{	O
size_t	long
reclen	long
=	O
rush_wtmp_reclen	function
(	O
src	pointer
)	O
;	O
struct	O
rush_wtmp	struct
*	O
dst	pointer
=	O
malloc	function
(	O
reclen	long
)	O
;	O
if	O
(	O
dst	pointer
)	O
{	O
char	O
*	O
p	pointer
;	O
dst	pointer
->	O
reclen	long
=	O
reclen	long
;	O
dst	pointer
->	O
pid	int
=	O
src	pointer
->	O
pid	int
;	O
dst	pointer
->	O
start	struct
=	O
src	pointer
->	O
start	struct
;	O
dst	pointer
->	O
stop	struct
=	O
src	pointer
->	O
stop	struct
;	O
p	pointer
=	O
(	O
char	O
*	O
)	O
(	O
dst	pointer
+	O
1	int
)	O
;	O
strcpy	function
(	O
p	pointer
,	O
src	pointer
->	O
user	pointer
)	O
;	O
dst	pointer
->	O
user	pointer
=	O
NULL	O
;	O
p	pointer
+=	O
strlen	function
(	O
p	pointer
)	O
+	O
1	int
;	O
dst	pointer
->	O
rule	pointer
=	O
NULL	O
;	O
strcpy	function
(	O
p	pointer
,	O
src	pointer
->	O
rule	pointer
)	O
;	O
p	pointer
+=	O
strlen	function
(	O
p	pointer
)	O
+	O
1	int
;	O
dst	pointer
->	O
command	pointer
=	O
NULL	O
;	O
strcpy	function
(	O
p	pointer
,	O
src	pointer
->	O
command	pointer
)	O
;	O
p	pointer
+=	O
strlen	function
(	O
p	pointer
)	O
+	O
1	int
;	O
}	O
return	O
dst	pointer
;	O
}	O
off_t	long
rush_wtmp_append	function
(	O
struct	O
rush_wtmp	struct
*	O
wtmp	pointer
)	O
{	O
size_t	long
left	long
;	O
char	O
*	O
p	pointer
;	O
off_t	long
off	long
;	O
struct	O
rush_wtmp	struct
*	O
record	pointer
;	O
if	O
(	O
wtmp_fd	int
==	O
-	O
1	int
)	O
{	O
errno	O
=	O
EINVAL	int
;	O
return	O
-	O
1	int
;	O
}	O
off	long
=	O
lseek	function
(	O
wtmp_fd	int
,	O
0	int
,	O
SEEK_END	int
)	O
;	O
if	O
(	O
off	long
==	O
-	O
1	int
)	O
return	O
-	O
1	int
;	O
record	pointer
=	O
rush_wtmp_copy	function
(	O
wtmp	pointer
)	O
;	O
rushdb_lock	function
(	O
wtmp_fd	int
,	O
record	pointer
->	O
reclen	long
,	O
off	long
,	O
SEEK_SET	int
,	O
RUSH_LOCK_WRITE	int
)	O
;	O
left	long
=	O
record	pointer
->	O
reclen	long
;	O
p	pointer
=	O
(	O
char	O
*	O
)	O
record	pointer
;	O
while	O
(	O
left	long
)	O
{	O
ssize_t	long
n	long
=	O
write	function
(	O
wtmp_fd	int
,	O
p	pointer
,	O
left	long
)	O
;	O
if	O
(	O
n	long
==	O
-	O
1	int
)	O
goto	O
errlab	O
;	O
p	pointer
+=	O
n	long
;	O
left	long
-=	O
n	long
;	O
}	O
if	O
(	O
write	function
(	O
wtmp_fd	int
,	O
&	O
record	pointer
->	O
reclen	long
,	O
sizeof	O
(	O
record	pointer
->	O
reclen	long
)	O
)	O
!=	O
sizeof	O
(	O
wtmp	pointer
->	O
reclen	long
)	O
)	O
goto	O
errlab	O
;	O
rushdb_unlock	function
(	O
wtmp_fd	int
,	O
record	pointer
->	O
reclen	long
,	O
off	long
,	O
SEEK_SET	int
)	O
;	O
wtmp_recsize	long
=	O
record	pointer
->	O
reclen	long
;	O
free	function
(	O
record	pointer
)	O
;	O
return	O
off	long
;	O
errlab	O
:	O
rushdb_unlock	function
(	O
wtmp_fd	int
,	O
record	pointer
->	O
reclen	long
,	O
off	long
,	O
SEEK_SET	int
)	O
;	O
rush_wtmp_close	function
(	O
)	O
;	O
return	O
-	O
1	int
;	O
}	O
int	O
rush_wtmp_update	function
(	O
struct	O
timeval	struct
*	O
tv	pointer
)	O
{	O
struct	O
rush_wtmp	struct
wtmp	pointer
;	O
if	O
(	O
lseek	function
(	O
wtmp_fd	int
,	O
-	O
(	O
wtmp_recsize	long
+	O
sizeof	O
(	O
size_t	long
)	O
)	O
,	O
SEEK_CUR	int
)	O
==	O
-	O
1	int
)	O
return	O
1	int
;	O
if	O
(	O
read	function
(	O
wtmp_fd	int
,	O
&	O
wtmp	pointer
,	O
sizeof	O
wtmp	pointer
)	O
!=	O
sizeof	O
wtmp	pointer
)	O
return	O
1	int
;	O
if	O
(	O
lseek	function
(	O
wtmp_fd	int
,	O
-	O
sizeof	O
(	O
wtmp	pointer
)	O
,	O
SEEK_CUR	int
)	O
==	O
-	O
1	int
)	O
return	O
1	int
;	O
wtmp	pointer
.	O
stop	struct
=	O
*	O
tv	pointer
;	O
return	O
write	function
(	O
wtmp_fd	int
,	O
&	O
wtmp	pointer
,	O
sizeof	O
wtmp	pointer
)	O
!=	O
sizeof	O
wtmp	pointer
;	O
}	O
