int	O
del_defer_block_deletes_P	int
=	O
0	int
;	O
int	O
del_delete_bck	function
(	O
ENTRY	struct
*	O
ent	pointer
)	O
{	O
unsigned	O
char	O
*	O
blk	pointer
=	O
ent_blk	O
(	O
ent	pointer
)	O
;	O
int	O
win_P	int
=	O
!	O
(	O
del_defer_block_deletes_P	int
)	O
;	O
if	O
(	O
win_P	int
)	O
{	O
ents_ent_update_access_P	function
(	O
ent	pointer
,	O
accwrite	O
,	O
accnone	O
)	O
;	O
{	O
ENTRY	struct
*	O
prent	pointer
=	O
prev_blk_ent	function
(	O
ent	pointer
,	O
blk_level	O
(	O
blk	pointer
)	O
)	O
;	O
win_P	int
=	O
ents_ent_update_access_P	function
(	O
ent	pointer
,	O
accnone	O
,	O
accwrite	O
)	O
;	O
if	O
(	O
(	O
win_P	int
)	O
&&	O
(	O
prent	pointer
)	O
)	O
win_P	int
=	O
ents_ent_update_access_P	function
(	O
prent	pointer
,	O
accread	O
,	O
accwrite	O
)	O
;	O
win_P	int
=	O
(	O
win_P	int
)	O
&&	O
(	O
1	int
==	O
(	O
ent_ref	O
(	O
ent	pointer
)	O
)	O
)	O
;	O
if	O
(	O
win_P	int
)	O
{	O
if	O
(	O
!	O
(	O
at_root_level_P	function
(	O
ent_seg	O
(	O
ent	pointer
)	O
,	O
blk	pointer
)	O
)	O
)	O
{	O
int	O
skey_pos	int
=	O
split_key_pos	function
(	O
blk	pointer
)	O
;	O
if	O
(	O
0	int
<	O
(	O
skey_pos	int
)	O
)	O
{	O
long	O
top_num	long
=	O
blk_top_id	O
(	O
blk	pointer
)	O
;	O
SEGD	struct
*	O
seg	pointer
=	O
ent_seg	O
(	O
ent	pointer
)	O
;	O
int	O
level	int
=	O
blk_level	O
(	O
blk	pointer
)	O
;	O
unsigned	O
char	O
key_str	pointer
[	O
0x100	int
]	O
;	O
int	O
k_len	int
=	O
recon_this_key	function
(	O
blk	pointer
,	O
skey_pos	int
,	O
key_str	pointer
,	O
0	int
,	O
0x100	int
)	O
;	O
win_P	int
=	O
parent_delete_update_P	function
(	O
seg	pointer
,	O
top_num	long
,	O
level	int
,	O
ent_id	O
(	O
ent	pointer
)	O
,	O
key_str	pointer
,	O
k_len	int
)	O
;	O
}	O
}	O
win_P	int
=	O
(	O
win_P	int
)	O
&&	O
(	O
1	int
==	O
(	O
ent_ref	O
(	O
ent	pointer
)	O
)	O
)	O
;	O
if	O
(	O
win_P	int
)	O
{	O
if	O
(	O
prent	pointer
)	O
{	O
blk_set_nxt_id	O
(	O
ent_blk	O
(	O
prent	pointer
)	O
,	O
blk_nxt_id	O
(	O
blk	pointer
)	O
)	O
;	O
ent_set_dty	O
(	O
prent	pointer
,	O
!	O
0	int
)	O
;	O
ents_ent_write	function
(	O
prent	pointer
)	O
;	O
}	O
win_P	int
=	O
blk_free	function
(	O
ent	pointer
)	O
;	O
if	O
(	O
!	O
(	O
win_P	int
)	O
)	O
dprintf	function
(	O
(	O
diagout	pointer
,	O
">>>>ERROR<<<< %s: could not free %ld:%ld\n"	pointer
,	O
"blk_delete"	pointer
,	O
seg_id	O
(	O
ent_seg	O
(	O
ent	pointer
)	O
)	O
,	O
ent_id	O
(	O
ent	pointer
)	O
)	O
)	O
;	O
}	O
}	O
if	O
(	O
prent	pointer
)	O
release_ent	function
(	O
prent	pointer
,	O
ent_acc	O
(	O
prent	pointer
)	O
)	O
;	O
}	O
}	O
if	O
(	O
win_P	int
)	O
{	O
block_deletes	int
=	O
(	O
block_deletes	int
)	O
+	O
1	int
;	O
}	O
else	O
{	O
deferred_deletes	int
=	O
1	int
+	O
(	O
deferred_deletes	int
)	O
;	O
dprintf	function
(	O
(	O
diagout	pointer
,	O
"Can't delete block %lu\n"	pointer
,	O
ent_id	O
(	O
ent	pointer
)	O
)	O
)	O
;	O
}	O
return	O
win_P	int
;	O
}	O
int	O
parent_delete_update_P	function
(	O
SEGD	struct
*	O
seg	pointer
,	O
long	O
top_id	long
,	O
int	O
level	int
,	O
long	O
old_id	long
,	O
unsigned	O
char	O
*	O
key_str	pointer
,	O
int	O
k_len	int
)	O
{	O
int	O
pkt	pointer
[	O
pkt_size	int
]	O
;	O
int	O
ans	int
=	O
-	O
1	int
;	O
unsigned	O
char	O
ans_str	pointer
[	O
4	int
]	O
;	O
{	O
ENTRY	struct
*	O
ent	pointer
=	O
find_ent	function
(	O
get_ent	function
(	O
seg	pointer
,	O
top_id	long
,	O
accnone	O
)	O
,	O
1	int
+	O
(	O
level	int
)	O
,	O
-	O
1	int
,	O
key_str	pointer
,	O
k_len	int
)	O
;	O
if	O
(	O
!	O
(	O
ent	pointer
)	O
)	O
;	O
else	O
if	O
(	O
ents_ent_update_access_P	function
(	O
ent	pointer
,	O
accread	O
,	O
accwrite	O
)	O
)	O
{	O
ent	pointer
=	O
chain_find	function
(	O
ent	pointer
,	O
accwrite	O
,	O
key_str	pointer
,	O
k_len	int
,	O
pkt	pointer
)	O
;	O
}	O
else	O
{	O
release_ent	function
(	O
ent	pointer
,	O
accread	O
)	O
;	O
ent	pointer
=	O
0	int
;	O
}	O
if	O
(	O
ent	pointer
)	O
{	O
ans	int
=	O
del_chain_rem	function
(	O
ent	pointer
,	O
key_str	pointer
,	O
k_len	int
,	O
ans_str	pointer
,	O
pkt	pointer
,	O
wcb_sar	int
)	O
;	O
if	O
(	O
(	O
ans	int
)	O
>=	O
0	int
)	O
if	O
(	O
(	O
old_id	long
)	O
!=	O
(	O
str2long	function
(	O
ans_str	pointer
,	O
0	int
)	O
)	O
)	O
dprintf	function
(	O
(	O
diagout	pointer
,	O
">>>>ERROR<<<< %s: bad value %lu in deleted down pointer %lu told\n"	pointer
,	O
"parent_delete_update_P"	pointer
,	O
str2long	function
(	O
ans_str	pointer
,	O
0	int
)	O
,	O
old_id	long
)	O
)	O
;	O
release_ent	function
(	O
ent	pointer
,	O
accwrite	O
)	O
;	O
}	O
if	O
(	O
(	O
ent	pointer
)	O
||	O
(	O
(	O
ans	int
)	O
>=	O
0	int
)	O
)	O
return	O
!	O
0	int
;	O
else	O
{	O
dprintf	function
(	O
(	O
diagout	pointer
,	O
"WARNING: %s blk=%ld:%ld, level=%d, key=%.*s\n"	pointer
,	O
"parent_delete_update_P"	pointer
,	O
seg_id	O
(	O
seg	pointer
)	O
,	O
old_id	long
,	O
level	int
,	O
k_len	int
,	O
key_str	pointer
)	O
)	O
;	O
return	O
0	int
;	O
}	O
}	O
}	O
int	O
del_chain_rem	function
(	O
ENTRY	struct
*	O
ent	pointer
,	O
unsigned	O
char	O
*	O
key_str	pointer
,	O
int	O
k_len	int
,	O
unsigned	O
char	O
*	O
ans_str	pointer
,	O
int	O
*	O
pkt	pointer
,	O
int	O
wcb	int
)	O
{	O
if	O
(	O
(	O
pkt_match_type	O
(	O
pkt	pointer
)	O
)	O
==	O
(	O
match	O
)	O
)	O
{	O
int	O
alen	int
=	O
success	int
;	O
if	O
(	O
ans_str	pointer
)	O
alen	int
=	O
get_this_val	function
(	O
ent_blk	O
(	O
ent	pointer
)	O
,	O
pkt_match_pos	O
(	O
pkt	pointer
)	O
,	O
ans_str	pointer
)	O
;	O
blk_remove_key_and_val	function
(	O
ent_blk	O
(	O
ent	pointer
)	O
,	O
pkt_match_pos	O
(	O
pkt	pointer
)	O
,	O
seg_bsiz	O
(	O
ent_seg	O
(	O
ent	pointer
)	O
)	O
)	O
;	O
ent_set_dty	O
(	O
ent	pointer
,	O
!	O
0	int
)	O
;	O
if	O
(	O
(	O
blk_empty_P	O
(	O
ent_blk	O
(	O
ent	pointer
)	O
)	O
)	O
&&	O
(	O
!	O
(	O
end_of_chain_P	O
(	O
ent_blk	O
(	O
ent	pointer
)	O
)	O
)	O
)	O
)	O
{	O
del_delete_bck	function
(	O
ent	pointer
)	O
;	O
}	O
else	O
if	O
(	O
(	O
(	O
wcb_sar	int
)	O
&	O
(	O
wcb	int
)	O
)	O
||	O
(	O
(	O
blk_level	O
(	O
ent_blk	O
(	O
ent	pointer
)	O
)	O
)	O
>	O
(	O
leaf	int
)	O
)	O
)	O
ents_ent_write	function
(	O
ent	pointer
)	O
;	O
return	O
alen	int
;	O
}	O
else	O
return	O
notpres	O
;	O
}	O
