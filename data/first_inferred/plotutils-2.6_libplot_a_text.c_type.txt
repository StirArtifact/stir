double	O
_pl_a_paint_text_string	function
(	O
R___	O
(	O
Plotter	struct
*	O
_plotter	pointer
)	O
const	O
unsigned	O
char	O
*	O
s	pointer
,	O
int	O
h_just	int
,	O
int	O
v_just	int
)	O
{	O
int	O
i	int
,	O
master_font_index	int
;	O
int	O
justify_code	int
;	O
double	O
width	array
;	O
unsigned	O
char	O
*	O
ptr	pointer
;	O
double	O
theta	double
,	O
costheta	double
,	O
sintheta	double
;	O
double	O
norm	double
;	O
double	O
dx0	int
,	O
dy0	int
,	O
dx1	int
,	O
dy1	int
,	O
dx2	int
,	O
dy2	int
,	O
dx3	int
,	O
dy3	int
;	O
double	O
font_ascent	double
,	O
font_descent	double
,	O
up	double
,	O
down	double
;	O
double	O
user_font_size	double
=	O
_plotter	pointer
->	O
drawstate	pointer
->	O
true_font_size	double
;	O
double	O
device_font_size	double
;	O
double	O
user_text_transformation_matrix	array
[	O
6	int
]	O
;	O
double	O
text_transformation_matrix	array
[	O
6	int
]	O
;	O
double	O
lshift	double
;	O
bool	enum
pcl_font	enum
;	O
if	O
(	O
v_just	int
!=	O
PL_JUST_BASE	int
)	O
return	O
0.0	int
;	O
if	O
(	O
*	O
s	pointer
==	O
(	O
unsigned	O
char	O
)	O
'\0'	O
)	O
return	O
0.0	int
;	O
if	O
(	O
_plotter	pointer
->	O
drawstate	pointer
->	O
font_type	int
!=	O
PL_F_POSTSCRIPT	int
&&	O
_plotter	pointer
->	O
drawstate	pointer
->	O
font_type	int
!=	O
PL_F_PCL	int
)	O
return	O
0.0	int
;	O
pcl_font	enum
=	O
(	O
_plotter	pointer
->	O
drawstate	pointer
->	O
font_type	int
==	O
PL_F_PCL	int
?	O
true	int
:	O
false	int
)	O
;	O
if	O
(	O
pcl_font	enum
)	O
master_font_index	int
=	O
(	O
_pl_g_pcl_typeface_info	array
[	O
_plotter	pointer
->	O
drawstate	pointer
->	O
typeface_index	int
]	O
.	O
fonts	array
)	O
[	O
_plotter	pointer
->	O
drawstate	pointer
->	O
font_index	int
]	O
;	O
else	O
master_font_index	int
=	O
(	O
_pl_g_ps_typeface_info	array
[	O
_plotter	pointer
->	O
drawstate	pointer
->	O
typeface_index	int
]	O
.	O
fonts	array
)	O
[	O
_plotter	pointer
->	O
drawstate	pointer
->	O
font_index	int
]	O
;	O
if	O
(	O
pcl_font	enum
)	O
{	O
font_ascent	double
=	O
(	O
double	O
)	O
(	O
(	O
_pl_g_pcl_font_info	array
[	O
master_font_index	int
]	O
)	O
.	O
font_ascent	double
)	O
;	O
font_descent	double
=	O
(	O
double	O
)	O
(	O
(	O
_pl_g_pcl_font_info	array
[	O
master_font_index	int
]	O
)	O
.	O
font_descent	double
)	O
;	O
}	O
else	O
{	O
font_ascent	double
=	O
(	O
double	O
)	O
(	O
(	O
_pl_g_ps_font_info	array
[	O
master_font_index	int
]	O
)	O
.	O
font_ascent	double
)	O
;	O
font_descent	double
=	O
(	O
double	O
)	O
(	O
(	O
_pl_g_ps_font_info	array
[	O
master_font_index	int
]	O
)	O
.	O
font_descent	double
)	O
;	O
}	O
up	double
=	O
user_font_size	double
*	O
font_ascent	double
/	O
1000.0	int
;	O
down	double
=	O
user_font_size	double
*	O
font_descent	double
/	O
1000.0	int
;	O
theta	double
=	O
M_PI	int
*	O
_plotter	pointer
->	O
drawstate	pointer
->	O
text_rotation	double
/	O
180.0	int
;	O
sintheta	double
=	O
sin	function
(	O
theta	double
)	O
;	O
costheta	double
=	O
cos	function
(	O
theta	double
)	O
;	O
user_text_transformation_matrix	array
[	O
0	int
]	O
=	O
costheta	double
;	O
user_text_transformation_matrix	array
[	O
1	int
]	O
=	O
sintheta	double
;	O
user_text_transformation_matrix	array
[	O
2	int
]	O
=	O
-	O
sintheta	double
;	O
user_text_transformation_matrix	array
[	O
3	int
]	O
=	O
costheta	double
;	O
user_text_transformation_matrix	array
[	O
4	int
]	O
=	O
_plotter	pointer
->	O
drawstate	pointer
->	O
pos	struct
.	O
x	double
;	O
user_text_transformation_matrix	array
[	O
5	int
]	O
=	O
_plotter	pointer
->	O
drawstate	pointer
->	O
pos	struct
.	O
y	double
;	O
_matrix_product	function
(	O
user_text_transformation_matrix	array
,	O
_plotter	pointer
->	O
drawstate	pointer
->	O
transform	struct
.	O
m	array
,	O
text_transformation_matrix	array
)	O
;	O
norm	double
=	O
_matrix_norm	function
(	O
text_transformation_matrix	array
)	O
;	O
if	O
(	O
norm	double
==	O
0.0	int
)	O
return	O
0.0	int
;	O
device_font_size	double
=	O
norm	double
*	O
user_font_size	double
;	O
for	O
(	O
i	int
=	O
0	int
;	O
i	int
<	O
4	int
;	O
i	int
++	O
)	O
text_transformation_matrix	array
[	O
i	int
]	O
/=	O
norm	double
;	O
strcpy	function
(	O
_plotter	pointer
->	O
data	pointer
->	O
page	pointer
->	O
point	pointer
,	O
"0 To\n"	pointer
)	O
;	O
_update_buffer	function
(	O
_plotter	pointer
->	O
data	pointer
->	O
page	pointer
)	O
;	O
for	O
(	O
i	int
=	O
0	int
;	O
i	int
<	O
6	int
;	O
i	int
++	O
)	O
{	O
sprintf	function
(	O
_plotter	pointer
->	O
data	pointer
->	O
page	pointer
->	O
point	pointer
,	O
"%.4f "	pointer
,	O
text_transformation_matrix	array
[	O
i	int
]	O
)	O
;	O
_update_buffer	function
(	O
_plotter	pointer
->	O
data	pointer
->	O
page	pointer
)	O
;	O
}	O
strcpy	function
(	O
_plotter	pointer
->	O
data	pointer
->	O
page	pointer
->	O
point	pointer
,	O
"0 Tp\nTP\n"	pointer
)	O
;	O
_update_buffer	function
(	O
_plotter	pointer
->	O
data	pointer
->	O
page	pointer
)	O
;	O
strcpy	function
(	O
_plotter	pointer
->	O
data	pointer
->	O
page	pointer
->	O
point	pointer
,	O
"0 Tr\n"	pointer
)	O
;	O
_update_buffer	function
(	O
_plotter	pointer
->	O
data	pointer
->	O
page	pointer
)	O
;	O
_pl_a_set_fill_color	function
(	O
R___	O
(	O
_plotter	pointer
)	O
true	int
)	O
;	O
_pl_a_set_pen_color	function
(	O
S___	O
(	O
_plotter	pointer
)	O
)	O
;	O
{	O
const	O
char	O
*	O
ps_name	pointer
;	O
if	O
(	O
pcl_font	enum
)	O
ps_name	pointer
=	O
_pl_g_pcl_font_info	array
[	O
master_font_index	int
]	O
.	O
ps_name	pointer
;	O
else	O
ps_name	pointer
=	O
_pl_g_ps_font_info	array
[	O
master_font_index	int
]	O
.	O
ps_name	pointer
;	O
sprintf	function
(	O
_plotter	pointer
->	O
data	pointer
->	O
page	pointer
->	O
point	pointer
,	O
"/_%s %.4f Tf\n"	pointer
,	O
ps_name	pointer
,	O
device_font_size	double
)	O
;	O
_update_buffer	function
(	O
_plotter	pointer
->	O
data	pointer
->	O
page	pointer
)	O
;	O
}	O
strcpy	function
(	O
_plotter	pointer
->	O
data	pointer
->	O
page	pointer
->	O
point	pointer
,	O
"100 Tz\n"	pointer
)	O
;	O
_update_buffer	function
(	O
_plotter	pointer
->	O
data	pointer
->	O
page	pointer
)	O
;	O
strcpy	function
(	O
_plotter	pointer
->	O
data	pointer
->	O
page	pointer
->	O
point	pointer
,	O
"0 Tt\n"	pointer
)	O
;	O
_update_buffer	function
(	O
_plotter	pointer
->	O
data	pointer
->	O
page	pointer
)	O
;	O
strcpy	function
(	O
_plotter	pointer
->	O
data	pointer
->	O
page	pointer
->	O
point	pointer
,	O
"0 TA\n"	pointer
)	O
;	O
_update_buffer	function
(	O
_plotter	pointer
->	O
data	pointer
->	O
page	pointer
)	O
;	O
strcpy	function
(	O
_plotter	pointer
->	O
data	pointer
->	O
page	pointer
->	O
point	pointer
,	O
"0 0 0 TC\n"	pointer
)	O
;	O
_update_buffer	function
(	O
_plotter	pointer
->	O
data	pointer
->	O
page	pointer
)	O
;	O
strcpy	function
(	O
_plotter	pointer
->	O
data	pointer
->	O
page	pointer
->	O
point	pointer
,	O
"100 100 100 TW\n"	pointer
)	O
;	O
_update_buffer	function
(	O
_plotter	pointer
->	O
data	pointer
->	O
page	pointer
)	O
;	O
strcpy	function
(	O
_plotter	pointer
->	O
data	pointer
->	O
page	pointer
->	O
point	pointer
,	O
"0 0 0 Ti\n"	pointer
)	O
;	O
_update_buffer	function
(	O
_plotter	pointer
->	O
data	pointer
->	O
page	pointer
)	O
;	O
switch	O
(	O
h_just	int
)	O
{	O
case	O
PL_JUST_LEFT	int
:	O
default	O
:	O
justify_code	int
=	O
0	int
;	O
break	O
;	O
case	O
PL_JUST_CENTER	int
:	O
justify_code	int
=	O
1	int
;	O
break	O
;	O
case	O
PL_JUST_RIGHT	int
:	O
justify_code	int
=	O
2	int
;	O
break	O
;	O
}	O
sprintf	function
(	O
_plotter	pointer
->	O
data	pointer
->	O
page	pointer
->	O
point	pointer
,	O
"%d Ta\n"	pointer
,	O
justify_code	int
)	O
;	O
_update_buffer	function
(	O
_plotter	pointer
->	O
data	pointer
->	O
page	pointer
)	O
;	O
strcpy	function
(	O
_plotter	pointer
->	O
data	pointer
->	O
page	pointer
->	O
point	pointer
,	O
"0 Tq\n"	pointer
)	O
;	O
_update_buffer	function
(	O
_plotter	pointer
->	O
data	pointer
->	O
page	pointer
)	O
;	O
strcpy	function
(	O
_plotter	pointer
->	O
data	pointer
->	O
page	pointer
->	O
point	pointer
,	O
"0 0 Tl\n"	pointer
)	O
;	O
_update_buffer	function
(	O
_plotter	pointer
->	O
data	pointer
->	O
page	pointer
)	O
;	O
width	array
=	O
_plotter	pointer
->	O
get_text_width	pointer
(	O
R___	O
(	O
_plotter	pointer
)	O
s	pointer
)	O
;	O
switch	O
(	O
h_just	int
)	O
{	O
case	O
PL_JUST_LEFT	int
:	O
default	O
:	O
lshift	double
=	O
0.0	int
;	O
break	O
;	O
case	O
PL_JUST_CENTER	int
:	O
lshift	double
=	O
0.5	int
;	O
break	O
;	O
case	O
PL_JUST_RIGHT	int
:	O
lshift	double
=	O
1.0	int
;	O
break	O
;	O
}	O
dx0	int
=	O
costheta	double
*	O
(	O
-	O
lshift	double
)	O
*	O
width	array
-	O
sintheta	double
*	O
(	O
-	O
down	double
)	O
;	O
dy0	int
=	O
sintheta	double
*	O
(	O
-	O
lshift	double
)	O
*	O
width	array
+	O
costheta	double
*	O
(	O
-	O
down	double
)	O
;	O
dx1	int
=	O
costheta	double
*	O
(	O
-	O
lshift	double
)	O
*	O
width	array
-	O
sintheta	double
*	O
up	double
;	O
dy1	int
=	O
sintheta	double
*	O
(	O
-	O
lshift	double
)	O
*	O
width	array
+	O
costheta	double
*	O
up	double
;	O
dx2	int
=	O
costheta	double
*	O
(	O
1.0	int
-	O
lshift	double
)	O
*	O
width	array
-	O
sintheta	double
*	O
(	O
-	O
down	double
)	O
;	O
dy2	int
=	O
sintheta	double
*	O
(	O
1.0	int
-	O
lshift	double
)	O
*	O
width	array
+	O
costheta	double
*	O
(	O
-	O
down	double
)	O
;	O
dx3	int
=	O
costheta	double
*	O
(	O
1.0	int
-	O
lshift	double
)	O
*	O
width	array
-	O
sintheta	double
*	O
up	double
;	O
dy3	int
=	O
sintheta	double
*	O
(	O
1.0	int
-	O
lshift	double
)	O
*	O
width	array
+	O
costheta	double
*	O
up	double
;	O
_update_bbox	function
(	O
_plotter	pointer
->	O
data	pointer
->	O
page	pointer
,	O
XD	O
(	O
(	O
_plotter	pointer
->	O
drawstate	pointer
->	O
pos	struct
)	O
.	O
x	double
+	O
dx0	int
,	O
(	O
_plotter	pointer
->	O
drawstate	pointer
->	O
pos	struct
)	O
.	O
y	double
+	O
dy0	int
)	O
,	O
YD	O
(	O
(	O
_plotter	pointer
->	O
drawstate	pointer
->	O
pos	struct
)	O
.	O
x	double
+	O
dx0	int
,	O
(	O
_plotter	pointer
->	O
drawstate	pointer
->	O
pos	struct
)	O
.	O
y	double
+	O
dy0	int
)	O
)	O
;	O
_update_bbox	function
(	O
_plotter	pointer
->	O
data	pointer
->	O
page	pointer
,	O
XD	O
(	O
(	O
_plotter	pointer
->	O
drawstate	pointer
->	O
pos	struct
)	O
.	O
x	double
+	O
dx1	int
,	O
(	O
_plotter	pointer
->	O
drawstate	pointer
->	O
pos	struct
)	O
.	O
y	double
+	O
dy1	int
)	O
,	O
YD	O
(	O
(	O
_plotter	pointer
->	O
drawstate	pointer
->	O
pos	struct
)	O
.	O
x	double
+	O
dx1	int
,	O
(	O
_plotter	pointer
->	O
drawstate	pointer
->	O
pos	struct
)	O
.	O
y	double
+	O
dy1	int
)	O
)	O
;	O
_update_bbox	function
(	O
_plotter	pointer
->	O
data	pointer
->	O
page	pointer
,	O
XD	O
(	O
(	O
_plotter	pointer
->	O
drawstate	pointer
->	O
pos	struct
)	O
.	O
x	double
+	O
dx2	int
,	O
(	O
_plotter	pointer
->	O
drawstate	pointer
->	O
pos	struct
)	O
.	O
y	double
+	O
dy2	int
)	O
,	O
YD	O
(	O
(	O
_plotter	pointer
->	O
drawstate	pointer
->	O
pos	struct
)	O
.	O
x	double
+	O
dx2	int
,	O
(	O
_plotter	pointer
->	O
drawstate	pointer
->	O
pos	struct
)	O
.	O
y	double
+	O
dy2	int
)	O
)	O
;	O
_update_bbox	function
(	O
_plotter	pointer
->	O
data	pointer
->	O
page	pointer
,	O
XD	O
(	O
(	O
_plotter	pointer
->	O
drawstate	pointer
->	O
pos	struct
)	O
.	O
x	double
+	O
dx3	int
,	O
(	O
_plotter	pointer
->	O
drawstate	pointer
->	O
pos	struct
)	O
.	O
y	double
+	O
dy3	int
)	O
,	O
YD	O
(	O
(	O
_plotter	pointer
->	O
drawstate	pointer
->	O
pos	struct
)	O
.	O
x	double
+	O
dx3	int
,	O
(	O
_plotter	pointer
->	O
drawstate	pointer
->	O
pos	struct
)	O
.	O
y	double
+	O
dy3	int
)	O
)	O
;	O
ptr	pointer
=	O
(	O
unsigned	O
char	O
*	O
)	O
_plotter	pointer
->	O
data	pointer
->	O
page	pointer
->	O
point	pointer
;	O
*	O
ptr	pointer
++	O
=	O
'('	O
;	O
while	O
(	O
*	O
s	pointer
)	O
{	O
switch	O
(	O
*	O
s	pointer
)	O
{	O
case	O
'('	O
:	O
case	O
')'	O
:	O
case	O
'\\'	O
:	O
*	O
ptr	pointer
++	O
=	O
(	O
unsigned	O
char	O
)	O
'\\'	O
;	O
*	O
ptr	pointer
++	O
=	O
*	O
s	pointer
++	O
;	O
break	O
;	O
default	O
:	O
if	O
GOOD_PRINTABLE_ASCII	O
(	O
*	O
s	pointer
)	O
*	O
ptr	pointer
++	O
=	O
*	O
s	pointer
++	O
;	O
else	O
{	O
sprintf	function
(	O
(	O
char	O
*	O
)	O
ptr	pointer
,	O
"\\%03o"	pointer
,	O
(	O
unsigned	O
int	O
)	O
*	O
s	pointer
)	O
;	O
ptr	pointer
+=	O
4	int
;	O
s	pointer
++	O
;	O
}	O
break	O
;	O
}	O
}	O
*	O
ptr	pointer
++	O
=	O
')'	O
;	O
*	O
ptr	pointer
=	O
(	O
unsigned	O
char	O
)	O
'\0'	O
;	O
_update_buffer	function
(	O
_plotter	pointer
->	O
data	pointer
->	O
page	pointer
)	O
;	O
strcpy	function
(	O
_plotter	pointer
->	O
data	pointer
->	O
page	pointer
->	O
point	pointer
,	O
" Tx\n"	pointer
)	O
;	O
_update_buffer	function
(	O
_plotter	pointer
->	O
data	pointer
->	O
page	pointer
)	O
;	O
strcpy	function
(	O
_plotter	pointer
->	O
data	pointer
->	O
page	pointer
->	O
point	pointer
,	O
"TO\n"	pointer
)	O
;	O
_update_buffer	function
(	O
_plotter	pointer
->	O
data	pointer
->	O
page	pointer
)	O
;	O
if	O
(	O
pcl_font	enum
)	O
_plotter	pointer
->	O
data	pointer
->	O
page	pointer
->	O
pcl_font_used	array
[	O
master_font_index	int
]	O
=	O
true	int
;	O
else	O
_plotter	pointer
->	O
data	pointer
->	O
page	pointer
->	O
ps_font_used	array
[	O
master_font_index	int
]	O
=	O
true	int
;	O
return	O
width	array
;	O
}	O
