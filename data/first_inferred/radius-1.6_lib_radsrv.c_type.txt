int	O
grad_server_send_reply	function
(	O
int	O
fd	int
,	O
grad_request_t	struct
*	O
radreq	pointer
,	O
int	O
reply_code	int
,	O
grad_avp_t	struct
*	O
reply_pairs	pointer
,	O
char	O
*	O
reply_msg	pointer
)	O
{	O
void	O
*	O
pdu	pointer
;	O
size_t	long
length	short
;	O
length	short
=	O
grad_create_pdu	function
(	O
&	O
pdu	pointer
,	O
reply_code	int
,	O
radreq	pointer
->	O
id	char
,	O
radreq	pointer
->	O
authenticator	array
,	O
radreq	pointer
->	O
secret	pointer
,	O
reply_pairs	pointer
,	O
reply_msg	pointer
)	O
;	O
if	O
(	O
length	short
>	O
0	int
)	O
{	O
struct	O
sockaddr	struct
saremote	struct
;	O
struct	O
sockaddr_in	struct
*	O
sin	pointer
;	O
char	O
buf	pointer
[	O
GRAD_MAX_LONGNAME	int
]	O
;	O
sin	pointer
=	O
(	O
struct	O
sockaddr_in	struct
*	O
)	O
&	O
saremote	struct
;	O
memset	function
(	O
(	O
char	O
*	O
)	O
sin	pointer
,	O
'\0'	O
,	O
sizeof	O
(	O
saremote	struct
)	O
)	O
;	O
sin	pointer
->	O
sin_family	short
=	O
AF_INET	O
;	O
sin	pointer
->	O
sin_addr	struct
.	O
s_addr	int
=	O
htonl	function
(	O
radreq	pointer
->	O
ipaddr	int
)	O
;	O
sin	pointer
->	O
sin_port	short
=	O
htons	function
(	O
radreq	pointer
->	O
udp_port	short
)	O
;	O
GRAD_DEBUG4	O
(	O
1	int
,	O
"Sending %s of id %d to %s (nas %s)"	pointer
,	O
grad_request_code_to_name	function
(	O
reply_code	int
)	O
,	O
radreq	pointer
->	O
id	char
,	O
grad_ip_iptostr	function
(	O
radreq	pointer
->	O
ipaddr	int
,	O
NULL	O
)	O
,	O
grad_nas_request_to_name	function
(	O
radreq	pointer
,	O
buf	pointer
,	O
sizeof	O
buf	pointer
)	O
)	O
;	O
sendto	function
(	O
fd	int
,	O
pdu	pointer
,	O
length	short
,	O
0	int
,	O
&	O
saremote	struct
,	O
sizeof	O
(	O
struct	O
sockaddr_in	struct
)	O
)	O
;	O
grad_free	function
(	O
pdu	pointer
)	O
;	O
}	O
return	O
length	short
;	O
}	O
int	O
grad_server_send_challenge	function
(	O
int	O
fd	int
,	O
grad_request_t	struct
*	O
radreq	pointer
,	O
grad_avp_t	struct
*	O
reply_pairs	pointer
,	O
char	O
*	O
msg	pointer
,	O
char	O
*	O
state	pointer
)	O
{	O
void	O
*	O
pdu	pointer
;	O
size_t	long
length	short
;	O
grad_avp_t	struct
*	O
p	pointer
=	O
grad_avp_create_string	function
(	O
DA_STATE	int
,	O
state	pointer
)	O
;	O
grad_avp_t	struct
*	O
reply	pointer
;	O
reply	pointer
=	O
grad_avl_dup	function
(	O
reply_pairs	pointer
)	O
;	O
grad_avl_merge	function
(	O
&	O
reply	pointer
,	O
&	O
p	pointer
)	O
;	O
length	short
=	O
grad_create_pdu	function
(	O
&	O
pdu	pointer
,	O
RT_ACCESS_CHALLENGE	int
,	O
radreq	pointer
->	O
id	char
,	O
radreq	pointer
->	O
authenticator	array
,	O
radreq	pointer
->	O
secret	pointer
,	O
reply	pointer
,	O
msg	pointer
)	O
;	O
grad_avl_free	function
(	O
reply	pointer
)	O
;	O
grad_avl_free	function
(	O
p	pointer
)	O
;	O
if	O
(	O
length	short
>	O
0	int
)	O
{	O
struct	O
sockaddr	struct
saremote	struct
;	O
struct	O
sockaddr_in	struct
*	O
sin	pointer
;	O
char	O
buf	pointer
[	O
GRAD_MAX_LONGNAME	int
]	O
;	O
sin	pointer
=	O
(	O
struct	O
sockaddr_in	struct
*	O
)	O
&	O
saremote	struct
;	O
memset	function
(	O
(	O
char	O
*	O
)	O
sin	pointer
,	O
'\0'	O
,	O
sizeof	O
(	O
saremote	struct
)	O
)	O
;	O
sin	pointer
->	O
sin_family	short
=	O
AF_INET	O
;	O
sin	pointer
->	O
sin_addr	struct
.	O
s_addr	int
=	O
htonl	function
(	O
radreq	pointer
->	O
ipaddr	int
)	O
;	O
sin	pointer
->	O
sin_port	short
=	O
htons	function
(	O
radreq	pointer
->	O
udp_port	short
)	O
;	O
GRAD_DEBUG3	O
(	O
1	int
,	O
"Sending Challenge of id %d to %s (nas %s)"	pointer
,	O
radreq	pointer
->	O
id	char
,	O
grad_ip_iptostr	function
(	O
radreq	pointer
->	O
ipaddr	int
,	O
NULL	O
)	O
,	O
grad_nas_request_to_name	function
(	O
radreq	pointer
,	O
buf	pointer
,	O
sizeof	O
buf	pointer
)	O
)	O
;	O
sendto	function
(	O
fd	int
,	O
pdu	pointer
,	O
length	short
,	O
0	int
,	O
&	O
saremote	struct
,	O
sizeof	O
(	O
struct	O
sockaddr_in	struct
)	O
)	O
;	O
grad_free	function
(	O
pdu	pointer
)	O
;	O
}	O
grad_avp_free	function
(	O
p	pointer
)	O
;	O
return	O
length	short
;	O
}	O
