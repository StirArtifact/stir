uLong	long
filetime	function
(	O
f	pointer
,	O
tmzip	pointer
,	O
dt	pointer
)	O
char	O
*	O
f	pointer
;	O
tm_zip	struct
*	O
tmzip	pointer
;	O
uLong	long
*	O
dt	pointer
;	O
{	O
int	O
ret	int
=	O
0	int
;	O
struct	O
stat	struct
s	pointer
;	O
struct	O
tm	struct
*	O
filedate	pointer
;	O
time_t	long
tm_t	long
=	O
0	int
;	O
if	O
(	O
strcmp	function
(	O
f	pointer
,	O
"-"	pointer
)	O
!=	O
0	int
)	O
{	O
char	O
name	pointer
[	O
MAXFILENAME	O
+	O
1	int
]	O
;	O
int	O
len	int
=	O
strlen	function
(	O
f	pointer
)	O
;	O
if	O
(	O
len	int
>	O
MAXFILENAME	O
)	O
len	int
=	O
MAXFILENAME	O
;	O
strncpy	function
(	O
name	pointer
,	O
f	pointer
,	O
MAXFILENAME	O
-	O
1	int
)	O
;	O
name	pointer
[	O
MAXFILENAME	O
]	O
=	O
'\0'	O
;	O
if	O
(	O
name	pointer
[	O
len	int
-	O
1	int
]	O
==	O
'/'	O
)	O
name	pointer
[	O
len	int
-	O
1	int
]	O
=	O
'\0'	O
;	O
if	O
(	O
stat	struct
(	O
name	pointer
,	O
&	O
s	pointer
)	O
==	O
0	int
)	O
{	O
tm_t	long
=	O
s	pointer
.	O
st_mtime	O
;	O
ret	int
=	O
1	int
;	O
}	O
}	O
filedate	pointer
=	O
localtime	function
(	O
&	O
tm_t	long
)	O
;	O
tmzip	pointer
->	O
tm_sec	int
=	O
filedate	pointer
->	O
tm_sec	int
;	O
tmzip	pointer
->	O
tm_min	int
=	O
filedate	pointer
->	O
tm_min	int
;	O
tmzip	pointer
->	O
tm_hour	int
=	O
filedate	pointer
->	O
tm_hour	int
;	O
tmzip	pointer
->	O
tm_mday	int
=	O
filedate	pointer
->	O
tm_mday	int
;	O
tmzip	pointer
->	O
tm_mon	int
=	O
filedate	pointer
->	O
tm_mon	int
;	O
tmzip	pointer
->	O
tm_year	int
=	O
filedate	pointer
->	O
tm_year	int
;	O
return	O
ret	int
;	O
}	O
int	O
check_exist_file	function
(	O
filename	pointer
)	O
const	O
char	O
*	O
filename	pointer
;	O
{	O
FILE	struct
*	O
ftestexist	pointer
;	O
int	O
ret	int
=	O
1	int
;	O
ftestexist	pointer
=	O
FOPEN_FUNC	O
(	O
filename	pointer
,	O
"rb"	pointer
)	O
;	O
if	O
(	O
ftestexist	pointer
==	O
NULL	O
)	O
ret	int
=	O
0	int
;	O
else	O
fclose	function
(	O
ftestexist	pointer
)	O
;	O
return	O
ret	int
;	O
}	O
void	O
do_banner	function
(	O
)	O
{	O
printf	function
(	O
"MiniZip 1.1, demo of zLib + MiniZip64 package, written by Gilles Vollant\n"	pointer
)	O
;	O
printf	function
(	O
"more info on MiniZip at http://www.winimage.com/zLibDll/minizip.html\n\n"	pointer
)	O
;	O
}	O
void	O
do_help	function
(	O
)	O
{	O
printf	function
(	O
"Usage : minizip [-o] [-a] [-0 to -9] [-p password] [-j] file.zip [files_to_add]\n\n"	pointer
"  -o  Overwrite existing file.zip\n"	pointer
"  -a  Append to existing file.zip\n"	pointer
"  -0  Store only\n"	pointer
"  -1  Compress faster\n"	pointer
"  -9  Compress better\n\n"	pointer
"  -j  exclude path. store only the file name.\n\n"	pointer
)	O
;	O
}	O
int	O
getFileCrc	function
(	O
const	O
char	O
*	O
filenameinzip	pointer
,	O
void	O
*	O
buf	pointer
,	O
unsigned	O
long	O
size_buf	long
,	O
unsigned	O
long	O
*	O
result_crc	pointer
)	O
{	O
unsigned	O
long	O
calculate_crc	long
=	O
0	int
;	O
int	O
err	int
=	O
ZIP_OK	O
;	O
FILE	struct
*	O
fin	pointer
=	O
FOPEN_FUNC	O
(	O
filenameinzip	pointer
,	O
"rb"	pointer
)	O
;	O
unsigned	O
long	O
size_read	long
=	O
0	int
;	O
unsigned	O
long	O
total_read	long
=	O
0	int
;	O
if	O
(	O
fin	pointer
==	O
NULL	O
)	O
{	O
err	int
=	O
ZIP_ERRNO	O
;	O
}	O
if	O
(	O
err	int
==	O
ZIP_OK	O
)	O
do	O
{	O
err	int
=	O
ZIP_OK	O
;	O
size_read	long
=	O
(	O
int	O
)	O
fread	function
(	O
buf	pointer
,	O
1	int
,	O
size_buf	long
,	O
fin	pointer
)	O
;	O
if	O
(	O
size_read	long
<	O
size_buf	long
)	O
if	O
(	O
feof	function
(	O
fin	pointer
)	O
==	O
0	int
)	O
{	O
printf	function
(	O
"error in reading %s\n"	pointer
,	O
filenameinzip	pointer
)	O
;	O
err	int
=	O
ZIP_ERRNO	O
;	O
}	O
if	O
(	O
size_read	long
>	O
0	int
)	O
calculate_crc	long
=	O
crc32	function
(	O
calculate_crc	long
,	O
buf	pointer
,	O
size_read	long
)	O
;	O
total_read	long
+=	O
size_read	long
;	O
}	O
while	O
(	O
(	O
err	int
==	O
ZIP_OK	O
)	O
&&	O
(	O
size_read	long
>	O
0	int
)	O
)	O
;	O
if	O
(	O
fin	pointer
)	O
fclose	function
(	O
fin	pointer
)	O
;	O
*	O
result_crc	pointer
=	O
calculate_crc	long
;	O
printf	function
(	O
"file %s crc %lx\n"	pointer
,	O
filenameinzip	pointer
,	O
calculate_crc	long
)	O
;	O
return	O
err	int
;	O
}	O
int	O
isLargeFile	function
(	O
const	O
char	O
*	O
filename	pointer
)	O
{	O
int	O
largeFile	int
=	O
0	int
;	O
ZPOS64_T	long long
pos	long
=	O
0	int
;	O
FILE	struct
*	O
pFile	pointer
=	O
FOPEN_FUNC	O
(	O
filename	pointer
,	O
"rb"	pointer
)	O
;	O
if	O
(	O
pFile	pointer
!=	O
NULL	O
)	O
{	O
int	O
n	int
=	O
FSEEKO_FUNC	O
(	O
pFile	pointer
,	O
0	int
,	O
SEEK_END	int
)	O
;	O
pos	long
=	O
FTELLO_FUNC	O
(	O
pFile	pointer
)	O
;	O
printf	function
(	O
"File : %s is %lld bytes\n"	pointer
,	O
filename	pointer
,	O
pos	long
)	O
;	O
if	O
(	O
pos	long
>=	O
0xffffffff	int
)	O
largeFile	int
=	O
1	int
;	O
fclose	function
(	O
pFile	pointer
)	O
;	O
}	O
return	O
largeFile	int
;	O
}	O
int	O
main	function
(	O
argc	int
,	O
argv	array
)	O
int	O
argc	int
;	O
char	O
*	O
argv	array
[	O
]	O
;	O
{	O
int	O
i	int
;	O
int	O
opt_overwrite	int
=	O
0	int
;	O
int	O
opt_compress_level	int
=	O
Z_DEFAULT_COMPRESSION	O
;	O
int	O
opt_exclude_path	int
=	O
0	int
;	O
int	O
zipfilenamearg	int
=	O
0	int
;	O
char	O
filename_try	array
[	O
MAXFILENAME	O
+	O
16	int
]	O
;	O
int	O
zipok	int
;	O
int	O
err	int
=	O
0	int
;	O
int	O
size_buf	long
=	O
0	int
;	O
void	O
*	O
buf	pointer
=	O
NULL	O
;	O
const	O
char	O
*	O
password	pointer
=	O
NULL	O
;	O
do_banner	function
(	O
)	O
;	O
if	O
(	O
argc	int
==	O
1	int
)	O
{	O
do_help	function
(	O
)	O
;	O
return	O
0	int
;	O
}	O
else	O
{	O
for	O
(	O
i	int
=	O
1	int
;	O
i	int
<	O
argc	int
;	O
i	int
++	O
)	O
{	O
if	O
(	O
(	O
*	O
argv	array
[	O
i	int
]	O
)	O
==	O
'-'	O
)	O
{	O
const	O
char	O
*	O
p	pointer
=	O
argv	array
[	O
i	int
]	O
+	O
1	int
;	O
while	O
(	O
(	O
*	O
p	pointer
)	O
!=	O
'\0'	O
)	O
{	O
char	O
c	int
=	O
*	O
(	O
p	pointer
++	O
)	O
;	O
;	O
if	O
(	O
(	O
c	int
==	O
'o'	O
)	O
||	O
(	O
c	int
==	O
'O'	O
)	O
)	O
opt_overwrite	int
=	O
1	int
;	O
if	O
(	O
(	O
c	int
==	O
'a'	O
)	O
||	O
(	O
c	int
==	O
'A'	O
)	O
)	O
opt_overwrite	int
=	O
2	int
;	O
if	O
(	O
(	O
c	int
>=	O
'0'	O
)	O
&&	O
(	O
c	int
<=	O
'9'	O
)	O
)	O
opt_compress_level	int
=	O
c	int
-	O
'0'	O
;	O
if	O
(	O
(	O
c	int
==	O
'j'	O
)	O
||	O
(	O
c	int
==	O
'J'	O
)	O
)	O
opt_exclude_path	int
=	O
1	int
;	O
if	O
(	O
(	O
(	O
c	int
==	O
'p'	O
)	O
||	O
(	O
c	int
==	O
'P'	O
)	O
)	O
&&	O
(	O
i	int
+	O
1	int
<	O
argc	int
)	O
)	O
{	O
password	pointer
=	O
argv	array
[	O
i	int
+	O
1	int
]	O
;	O
i	int
++	O
;	O
}	O
}	O
}	O
else	O
{	O
if	O
(	O
zipfilenamearg	int
==	O
0	int
)	O
{	O
zipfilenamearg	int
=	O
i	int
;	O
}	O
}	O
}	O
}	O
size_buf	long
=	O
WRITEBUFFERSIZE	O
;	O
buf	pointer
=	O
(	O
void	O
*	O
)	O
malloc	function
(	O
size_buf	long
)	O
;	O
if	O
(	O
buf	pointer
==	O
NULL	O
)	O
{	O
printf	function
(	O
"Error allocating memory\n"	pointer
)	O
;	O
return	O
ZIP_INTERNALERROR	O
;	O
}	O
if	O
(	O
zipfilenamearg	int
==	O
0	int
)	O
{	O
zipok	int
=	O
0	int
;	O
}	O
else	O
{	O
int	O
i	int
,	O
len	int
;	O
int	O
dot_found	int
=	O
0	int
;	O
zipok	int
=	O
1	int
;	O
strncpy	function
(	O
filename_try	array
,	O
argv	array
[	O
zipfilenamearg	int
]	O
,	O
MAXFILENAME	O
-	O
1	int
)	O
;	O
filename_try	array
[	O
MAXFILENAME	O
]	O
=	O
'\0'	O
;	O
len	int
=	O
(	O
int	O
)	O
strlen	function
(	O
filename_try	array
)	O
;	O
for	O
(	O
i	int
=	O
0	int
;	O
i	int
<	O
len	int
;	O
i	int
++	O
)	O
if	O
(	O
filename_try	array
[	O
i	int
]	O
==	O
'.'	O
)	O
dot_found	int
=	O
1	int
;	O
if	O
(	O
dot_found	int
==	O
0	int
)	O
strcat	function
(	O
filename_try	array
,	O
".zip"	pointer
)	O
;	O
if	O
(	O
opt_overwrite	int
==	O
2	int
)	O
{	O
if	O
(	O
check_exist_file	function
(	O
filename_try	array
)	O
==	O
0	int
)	O
opt_overwrite	int
=	O
1	int
;	O
}	O
else	O
if	O
(	O
opt_overwrite	int
==	O
0	int
)	O
if	O
(	O
check_exist_file	function
(	O
filename_try	array
)	O
!=	O
0	int
)	O
{	O
char	O
rep	char
=	O
0	int
;	O
do	O
{	O
char	O
answer	array
[	O
128	int
]	O
;	O
int	O
ret	int
;	O
printf	function
(	O
"The file %s exists. Overwrite ? [y]es, [n]o, [a]ppend : "	pointer
,	O
filename_try	array
)	O
;	O
ret	int
=	O
scanf	function
(	O
"%1s"	pointer
,	O
answer	array
)	O
;	O
if	O
(	O
ret	int
!=	O
1	int
)	O
{	O
exit	function
(	O
EXIT_FAILURE	int
)	O
;	O
}	O
rep	char
=	O
answer	array
[	O
0	int
]	O
;	O
if	O
(	O
(	O
rep	char
>=	O
'a'	O
)	O
&&	O
(	O
rep	char
<=	O
'z'	O
)	O
)	O
rep	char
-=	O
0x20	int
;	O
}	O
while	O
(	O
(	O
rep	char
!=	O
'Y'	O
)	O
&&	O
(	O
rep	char
!=	O
'N'	O
)	O
&&	O
(	O
rep	char
!=	O
'A'	O
)	O
)	O
;	O
if	O
(	O
rep	char
==	O
'N'	O
)	O
zipok	int
=	O
0	int
;	O
if	O
(	O
rep	char
==	O
'A'	O
)	O
opt_overwrite	int
=	O
2	int
;	O
}	O
}	O
if	O
(	O
zipok	int
==	O
1	int
)	O
{	O
zipFile	pointer
zf	pointer
;	O
int	O
errclose	int
;	O
zf	pointer
=	O
zipOpen64	function
(	O
filename_try	array
,	O
(	O
opt_overwrite	int
==	O
2	int
)	O
?	O
2	int
:	O
0	int
)	O
;	O
if	O
(	O
zf	pointer
==	O
NULL	O
)	O
{	O
printf	function
(	O
"error opening %s\n"	pointer
,	O
filename_try	array
)	O
;	O
err	int
=	O
ZIP_ERRNO	O
;	O
}	O
else	O
printf	function
(	O
"creating %s\n"	pointer
,	O
filename_try	array
)	O
;	O
for	O
(	O
i	int
=	O
zipfilenamearg	int
+	O
1	int
;	O
(	O
i	int
<	O
argc	int
)	O
&&	O
(	O
err	int
==	O
ZIP_OK	O
)	O
;	O
i	int
++	O
)	O
{	O
if	O
(	O
!	O
(	O
(	O
(	O
(	O
*	O
(	O
argv	array
[	O
i	int
]	O
)	O
)	O
==	O
'-'	O
)	O
||	O
(	O
(	O
*	O
(	O
argv	array
[	O
i	int
]	O
)	O
)	O
==	O
'/'	O
)	O
)	O
&&	O
(	O
(	O
argv	array
[	O
i	int
]	O
[	O
1	int
]	O
==	O
'o'	O
)	O
||	O
(	O
argv	array
[	O
i	int
]	O
[	O
1	int
]	O
==	O
'O'	O
)	O
||	O
(	O
argv	array
[	O
i	int
]	O
[	O
1	int
]	O
==	O
'a'	O
)	O
||	O
(	O
argv	array
[	O
i	int
]	O
[	O
1	int
]	O
==	O
'A'	O
)	O
||	O
(	O
argv	array
[	O
i	int
]	O
[	O
1	int
]	O
==	O
'p'	O
)	O
||	O
(	O
argv	array
[	O
i	int
]	O
[	O
1	int
]	O
==	O
'P'	O
)	O
||	O
(	O
(	O
argv	array
[	O
i	int
]	O
[	O
1	int
]	O
>=	O
'0'	O
)	O
||	O
(	O
argv	array
[	O
i	int
]	O
[	O
1	int
]	O
<=	O
'9'	O
)	O
)	O
)	O
&&	O
(	O
strlen	function
(	O
argv	array
[	O
i	int
]	O
)	O
==	O
2	int
)	O
)	O
)	O
{	O
FILE	struct
*	O
fin	pointer
;	O
int	O
size_read	long
;	O
const	O
char	O
*	O
filenameinzip	pointer
=	O
argv	array
[	O
i	int
]	O
;	O
const	O
char	O
*	O
savefilenameinzip	pointer
;	O
zip_fileinfo	struct
zi	struct
;	O
unsigned	O
long	O
crcFile	long
=	O
0	int
;	O
int	O
zip64	int
=	O
0	int
;	O
zi	struct
.	O
tmz_date	struct
.	O
tm_sec	int
=	O
zi	struct
.	O
tmz_date	struct
.	O
tm_min	int
=	O
zi	struct
.	O
tmz_date	struct
.	O
tm_hour	int
=	O
zi	struct
.	O
tmz_date	struct
.	O
tm_mday	int
=	O
zi	struct
.	O
tmz_date	struct
.	O
tm_mon	int
=	O
zi	struct
.	O
tmz_date	struct
.	O
tm_year	int
=	O
0	int
;	O
zi	struct
.	O
dosDate	long
=	O
0	int
;	O
zi	struct
.	O
internal_fa	long
=	O
0	int
;	O
zi	struct
.	O
external_fa	long
=	O
0	int
;	O
filetime	function
(	O
filenameinzip	pointer
,	O
&	O
zi	struct
.	O
tmz_date	struct
,	O
&	O
zi	struct
.	O
dosDate	long
)	O
;	O
if	O
(	O
(	O
password	pointer
!=	O
NULL	O
)	O
&&	O
(	O
err	int
==	O
ZIP_OK	O
)	O
)	O
err	int
=	O
getFileCrc	function
(	O
filenameinzip	pointer
,	O
buf	pointer
,	O
size_buf	long
,	O
&	O
crcFile	long
)	O
;	O
zip64	int
=	O
isLargeFile	function
(	O
filenameinzip	pointer
)	O
;	O
savefilenameinzip	pointer
=	O
filenameinzip	pointer
;	O
while	O
(	O
savefilenameinzip	pointer
[	O
0	int
]	O
==	O
'\\'	O
||	O
savefilenameinzip	pointer
[	O
0	int
]	O
==	O
'/'	O
)	O
{	O
savefilenameinzip	pointer
++	O
;	O
}	O
if	O
(	O
opt_exclude_path	int
)	O
{	O
const	O
char	O
*	O
tmpptr	pointer
;	O
const	O
char	O
*	O
lastslash	pointer
=	O
0	int
;	O
for	O
(	O
tmpptr	pointer
=	O
savefilenameinzip	pointer
;	O
*	O
tmpptr	pointer
;	O
tmpptr	pointer
++	O
)	O
{	O
if	O
(	O
*	O
tmpptr	pointer
==	O
'\\'	O
||	O
*	O
tmpptr	pointer
==	O
'/'	O
)	O
{	O
lastslash	pointer
=	O
tmpptr	pointer
;	O
}	O
}	O
if	O
(	O
lastslash	pointer
!=	O
NULL	O
)	O
{	O
savefilenameinzip	pointer
=	O
lastslash	pointer
+	O
1	int
;	O
}	O
}	O
err	int
=	O
zipOpenNewFileInZip3_64	function
(	O
zf	pointer
,	O
savefilenameinzip	pointer
,	O
&	O
zi	struct
,	O
NULL	O
,	O
0	int
,	O
NULL	O
,	O
0	int
,	O
NULL	O
,	O
(	O
opt_compress_level	int
!=	O
0	int
)	O
?	O
Z_DEFLATED	int
:	O
0	int
,	O
opt_compress_level	int
,	O
0	int
,	O
-	O
MAX_WBITS	int
,	O
DEF_MEM_LEVEL	int
,	O
Z_DEFAULT_STRATEGY	int
,	O
password	pointer
,	O
crcFile	long
,	O
zip64	int
)	O
;	O
if	O
(	O
err	int
!=	O
ZIP_OK	O
)	O
printf	function
(	O
"error in opening %s in zipfile\n"	pointer
,	O
filenameinzip	pointer
)	O
;	O
else	O
{	O
fin	pointer
=	O
FOPEN_FUNC	O
(	O
filenameinzip	pointer
,	O
"rb"	pointer
)	O
;	O
if	O
(	O
fin	pointer
==	O
NULL	O
)	O
{	O
err	int
=	O
ZIP_ERRNO	O
;	O
printf	function
(	O
"error in opening %s for reading\n"	pointer
,	O
filenameinzip	pointer
)	O
;	O
}	O
}	O
if	O
(	O
err	int
==	O
ZIP_OK	O
)	O
do	O
{	O
err	int
=	O
ZIP_OK	O
;	O
size_read	long
=	O
(	O
int	O
)	O
fread	function
(	O
buf	pointer
,	O
1	int
,	O
size_buf	long
,	O
fin	pointer
)	O
;	O
if	O
(	O
size_read	long
<	O
size_buf	long
)	O
if	O
(	O
feof	function
(	O
fin	pointer
)	O
==	O
0	int
)	O
{	O
printf	function
(	O
"error in reading %s\n"	pointer
,	O
filenameinzip	pointer
)	O
;	O
err	int
=	O
ZIP_ERRNO	O
;	O
}	O
if	O
(	O
size_read	long
>	O
0	int
)	O
{	O
err	int
=	O
zipWriteInFileInZip	function
(	O
zf	pointer
,	O
buf	pointer
,	O
size_read	long
)	O
;	O
if	O
(	O
err	int
<	O
0	int
)	O
{	O
printf	function
(	O
"error in writing %s in the zipfile\n"	pointer
,	O
filenameinzip	pointer
)	O
;	O
}	O
}	O
}	O
while	O
(	O
(	O
err	int
==	O
ZIP_OK	O
)	O
&&	O
(	O
size_read	long
>	O
0	int
)	O
)	O
;	O
if	O
(	O
fin	pointer
)	O
fclose	function
(	O
fin	pointer
)	O
;	O
if	O
(	O
err	int
<	O
0	int
)	O
err	int
=	O
ZIP_ERRNO	O
;	O
else	O
{	O
err	int
=	O
zipCloseFileInZip	function
(	O
zf	pointer
)	O
;	O
if	O
(	O
err	int
!=	O
ZIP_OK	O
)	O
printf	function
(	O
"error in closing %s in the zipfile\n"	pointer
,	O
filenameinzip	pointer
)	O
;	O
}	O
}	O
}	O
errclose	int
=	O
zipClose	function
(	O
zf	pointer
,	O
NULL	O
)	O
;	O
if	O
(	O
errclose	int
!=	O
ZIP_OK	O
)	O
printf	function
(	O
"error in closing %s\n"	pointer
,	O
filename_try	array
)	O
;	O
}	O
else	O
{	O
do_help	function
(	O
)	O
;	O
}	O
free	function
(	O
buf	pointer
)	O
;	O
return	O
0	int
;	O
}	O
