error_t	int
fshelp_set_active	function
(	O
struct	O
transbox	struct
*	O
box	pointer
,	O
mach_port_t	O
active	int
,	O
int	O
excl	int
)	O
{	O
int	O
cancel	int
;	O
if	O
(	O
excl	int
)	O
{	O
if	O
(	O
box	pointer
->	O
flags	int
&	O
TRANSBOX_STARTING	int
)	O
return	O
EBUSY	int
;	O
if	O
(	O
box	pointer
->	O
active	int
!=	O
MACH_PORT_NULL	O
)	O
{	O
mach_port_urefs_t	O
dead_refs	O
;	O
error_t	int
err	int
=	O
mach_port_get_refs	function
(	O
mach_task_self	function
(	O
)	O
,	O
box	pointer
->	O
active	int
,	O
MACH_PORT_RIGHT_DEAD_NAME	O
,	O
&	O
dead_refs	O
)	O
;	O
if	O
(	O
!	O
err	int
&&	O
dead_refs	O
==	O
0	int
)	O
return	O
EBUSY	int
;	O
}	O
}	O
while	O
(	O
box	pointer
->	O
flags	int
&	O
TRANSBOX_STARTING	int
)	O
{	O
box	pointer
->	O
flags	int
|=	O
TRANSBOX_WANTED	int
;	O
cancel	int
=	O
pthread_hurd_cond_wait_np	function
(	O
&	O
box	pointer
->	O
wakeup	int
,	O
box	pointer
->	O
lock	pointer
)	O
;	O
if	O
(	O
cancel	int
)	O
return	O
EINTR	int
;	O
}	O
if	O
(	O
box	pointer
->	O
active	int
!=	O
MACH_PORT_NULL	O
)	O
mach_port_deallocate	function
(	O
mach_task_self	function
(	O
)	O
,	O
box	pointer
->	O
active	int
)	O
;	O
box	pointer
->	O
active	int
=	O
active	int
;	O
return	O
0	int
;	O
}	O
