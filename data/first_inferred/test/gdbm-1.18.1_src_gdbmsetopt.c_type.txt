static	O
int	O
getbool	function
(	O
void	O
*	O
optval	pointer
,	O
int	O
optlen	int
)	O
{	O
int	O
n	int
;	O
if	O
(	O
!	O
optval	pointer
||	O
optlen	int
!=	O
sizeof	O
(	O
int	O
)	O
||	O
(	O
(	O
(	O
n	int
=	O
*	O
(	O
int	O
*	O
)	O
optval	pointer
)	O
!=	O
TRUE	int
)	O
&&	O
n	int
!=	O
FALSE	int
)	O
)	O
return	O
-	O
1	int
;	O
return	O
n	int
;	O
}	O
static	O
int	O
get_size	function
(	O
void	O
*	O
optval	pointer
,	O
int	O
optlen	int
,	O
size_t	long
*	O
ret	pointer
)	O
{	O
if	O
(	O
!	O
optval	pointer
)	O
return	O
-	O
1	int
;	O
if	O
(	O
optlen	int
==	O
sizeof	O
(	O
unsigned	O
)	O
)	O
*	O
ret	pointer
=	O
*	O
(	O
unsigned	O
*	O
)	O
optval	pointer
;	O
else	O
if	O
(	O
optlen	int
==	O
sizeof	O
(	O
unsigned	O
long	O
)	O
)	O
*	O
ret	pointer
=	O
*	O
(	O
unsigned	O
long	O
*	O
)	O
optval	pointer
;	O
else	O
if	O
(	O
optlen	int
==	O
sizeof	O
(	O
size_t	long
)	O
)	O
*	O
ret	pointer
=	O
*	O
(	O
size_t	long
*	O
)	O
optval	pointer
;	O
else	O
return	O
-	O
1	int
;	O
return	O
0	int
;	O
}	O
static	O
int	O
setopt_gdbm_setcachesize	function
(	O
GDBM_FILE	pointer
dbf	pointer
,	O
void	O
*	O
optval	pointer
,	O
int	O
optlen	int
)	O
{	O
size_t	long
sz	long
;	O
if	O
(	O
dbf	pointer
->	O
bucket_cache	pointer
!=	O
NULL	O
)	O
{	O
GDBM_SET_ERRNO	O
(	O
dbf	pointer
,	O
GDBM_OPT_ALREADY_SET	int
,	O
FALSE	int
)	O
;	O
return	O
-	O
1	int
;	O
}	O
if	O
(	O
get_size	function
(	O
optval	pointer
,	O
optlen	int
,	O
&	O
sz	long
)	O
)	O
{	O
GDBM_SET_ERRNO	O
(	O
dbf	pointer
,	O
GDBM_OPT_ILLEGAL	int
,	O
FALSE	int
)	O
;	O
return	O
-	O
1	int
;	O
}	O
return	O
_gdbm_init_cache	function
(	O
dbf	pointer
,	O
(	O
sz	long
>	O
9	int
)	O
?	O
sz	long
:	O
10	int
)	O
;	O
}	O
static	O
int	O
setopt_gdbm_getcachesize	function
(	O
GDBM_FILE	pointer
dbf	pointer
,	O
void	O
*	O
optval	pointer
,	O
int	O
optlen	int
)	O
{	O
if	O
(	O
!	O
optval	pointer
||	O
optlen	int
!=	O
sizeof	O
(	O
size_t	long
)	O
)	O
{	O
GDBM_SET_ERRNO	O
(	O
dbf	pointer
,	O
GDBM_OPT_ILLEGAL	int
,	O
FALSE	int
)	O
;	O
return	O
-	O
1	int
;	O
}	O
*	O
(	O
size_t	long
*	O
)	O
optval	pointer
=	O
dbf	pointer
->	O
cache_size	long
;	O
return	O
0	int
;	O
}	O
static	O
int	O
setopt_gdbm_fastmode	function
(	O
GDBM_FILE	pointer
dbf	pointer
,	O
void	O
*	O
optval	pointer
,	O
int	O
optlen	int
)	O
{	O
int	O
n	int
;	O
if	O
(	O
(	O
n	int
=	O
getbool	function
(	O
optval	pointer
,	O
optlen	int
)	O
)	O
==	O
-	O
1	int
)	O
{	O
GDBM_SET_ERRNO	O
(	O
dbf	pointer
,	O
GDBM_OPT_ILLEGAL	int
,	O
FALSE	int
)	O
;	O
return	O
-	O
1	int
;	O
}	O
dbf	pointer
->	O
fast_write	int
=	O
n	int
;	O
return	O
0	int
;	O
}	O
static	O
int	O
setopt_gdbm_setsyncmode	function
(	O
GDBM_FILE	pointer
dbf	pointer
,	O
void	O
*	O
optval	pointer
,	O
int	O
optlen	int
)	O
{	O
int	O
n	int
;	O
if	O
(	O
(	O
n	int
=	O
getbool	function
(	O
optval	pointer
,	O
optlen	int
)	O
)	O
==	O
-	O
1	int
)	O
{	O
GDBM_SET_ERRNO	O
(	O
dbf	pointer
,	O
GDBM_OPT_ILLEGAL	int
,	O
FALSE	int
)	O
;	O
return	O
-	O
1	int
;	O
}	O
dbf	pointer
->	O
fast_write	int
=	O
!	O
n	int
;	O
return	O
0	int
;	O
}	O
static	O
int	O
setopt_gdbm_getsyncmode	function
(	O
GDBM_FILE	pointer
dbf	pointer
,	O
void	O
*	O
optval	pointer
,	O
int	O
optlen	int
)	O
{	O
if	O
(	O
!	O
optval	pointer
||	O
optlen	int
!=	O
sizeof	O
(	O
int	O
)	O
)	O
{	O
GDBM_SET_ERRNO	O
(	O
dbf	pointer
,	O
GDBM_OPT_ILLEGAL	int
,	O
FALSE	int
)	O
;	O
return	O
-	O
1	int
;	O
}	O
*	O
(	O
int	O
*	O
)	O
optval	pointer
=	O
!	O
dbf	pointer
->	O
fast_write	int
;	O
return	O
0	int
;	O
}	O
static	O
int	O
setopt_gdbm_setcentfree	function
(	O
GDBM_FILE	pointer
dbf	pointer
,	O
void	O
*	O
optval	pointer
,	O
int	O
optlen	int
)	O
{	O
int	O
n	int
;	O
if	O
(	O
(	O
n	int
=	O
getbool	function
(	O
optval	pointer
,	O
optlen	int
)	O
)	O
==	O
-	O
1	int
)	O
{	O
GDBM_SET_ERRNO	O
(	O
dbf	pointer
,	O
GDBM_OPT_ILLEGAL	int
,	O
FALSE	int
)	O
;	O
return	O
-	O
1	int
;	O
}	O
dbf	pointer
->	O
central_free	int
=	O
n	int
;	O
return	O
0	int
;	O
}	O
static	O
int	O
setopt_gdbm_getcentfree	function
(	O
GDBM_FILE	pointer
dbf	pointer
,	O
void	O
*	O
optval	pointer
,	O
int	O
optlen	int
)	O
{	O
if	O
(	O
!	O
optval	pointer
||	O
optlen	int
!=	O
sizeof	O
(	O
int	O
)	O
)	O
{	O
GDBM_SET_ERRNO	O
(	O
dbf	pointer
,	O
GDBM_OPT_ILLEGAL	int
,	O
FALSE	int
)	O
;	O
return	O
-	O
1	int
;	O
}	O
*	O
(	O
int	O
*	O
)	O
optval	pointer
=	O
!	O
dbf	pointer
->	O
central_free	int
;	O
return	O
0	int
;	O
}	O
static	O
int	O
setopt_gdbm_setcoalesceblks	function
(	O
GDBM_FILE	pointer
dbf	pointer
,	O
void	O
*	O
optval	pointer
,	O
int	O
optlen	int
)	O
{	O
int	O
n	int
;	O
if	O
(	O
(	O
n	int
=	O
getbool	function
(	O
optval	pointer
,	O
optlen	int
)	O
)	O
==	O
-	O
1	int
)	O
{	O
GDBM_SET_ERRNO	O
(	O
dbf	pointer
,	O
GDBM_OPT_ILLEGAL	int
,	O
FALSE	int
)	O
;	O
return	O
-	O
1	int
;	O
}	O
dbf	pointer
->	O
coalesce_blocks	int
=	O
n	int
;	O
return	O
0	int
;	O
}	O
static	O
int	O
setopt_gdbm_getcoalesceblks	function
(	O
GDBM_FILE	pointer
dbf	pointer
,	O
void	O
*	O
optval	pointer
,	O
int	O
optlen	int
)	O
{	O
if	O
(	O
!	O
optval	pointer
||	O
optlen	int
!=	O
sizeof	O
(	O
int	O
)	O
)	O
{	O
GDBM_SET_ERRNO	O
(	O
dbf	pointer
,	O
GDBM_OPT_ILLEGAL	int
,	O
FALSE	int
)	O
;	O
return	O
-	O
1	int
;	O
}	O
*	O
(	O
int	O
*	O
)	O
optval	pointer
=	O
dbf	pointer
->	O
coalesce_blocks	int
;	O
return	O
0	int
;	O
}	O
static	O
int	O
setopt_gdbm_setmmap	function
(	O
GDBM_FILE	pointer
dbf	pointer
,	O
void	O
*	O
optval	pointer
,	O
int	O
optlen	int
)	O
{	O
int	O
n	int
;	O
if	O
(	O
(	O
n	int
=	O
getbool	function
(	O
optval	pointer
,	O
optlen	int
)	O
)	O
==	O
-	O
1	int
)	O
{	O
GDBM_SET_ERRNO	O
(	O
dbf	pointer
,	O
GDBM_OPT_ILLEGAL	int
,	O
FALSE	int
)	O
;	O
return	O
-	O
1	int
;	O
}	O
gdbm_file_sync	function
(	O
dbf	pointer
)	O
;	O
if	O
(	O
n	int
==	O
dbf	pointer
->	O
memory_mapping	int
)	O
return	O
0	int
;	O
if	O
(	O
n	int
)	O
{	O
if	O
(	O
_gdbm_mapped_init	function
(	O
dbf	pointer
)	O
==	O
0	int
)	O
dbf	pointer
->	O
memory_mapping	int
=	O
TRUE	int
;	O
else	O
return	O
-	O
1	int
;	O
}	O
else	O
{	O
_gdbm_mapped_unmap	function
(	O
dbf	pointer
)	O
;	O
dbf	pointer
->	O
memory_mapping	int
=	O
FALSE	int
;	O
}	O
return	O
0	int
;	O
}	O
static	O
int	O
setopt_gdbm_getmmap	function
(	O
GDBM_FILE	pointer
dbf	pointer
,	O
void	O
*	O
optval	pointer
,	O
int	O
optlen	int
)	O
{	O
if	O
(	O
!	O
optval	pointer
||	O
optlen	int
!=	O
sizeof	O
(	O
int	O
)	O
)	O
{	O
GDBM_SET_ERRNO	O
(	O
dbf	pointer
,	O
GDBM_OPT_ILLEGAL	int
,	O
FALSE	int
)	O
;	O
return	O
-	O
1	int
;	O
}	O
*	O
(	O
int	O
*	O
)	O
optval	pointer
=	O
dbf	pointer
->	O
memory_mapping	int
;	O
return	O
0	int
;	O
}	O
static	O
int	O
setopt_gdbm_setmaxmapsize	function
(	O
GDBM_FILE	pointer
dbf	pointer
,	O
void	O
*	O
optval	pointer
,	O
int	O
optlen	int
)	O
{	O
size_t	long
page_size	long
=	O
sysconf	function
(	O
_SC_PAGESIZE	int
)	O
;	O
size_t	long
sz	long
;	O
if	O
(	O
get_size	function
(	O
optval	pointer
,	O
optlen	int
,	O
&	O
sz	long
)	O
)	O
{	O
GDBM_SET_ERRNO	O
(	O
dbf	pointer
,	O
GDBM_OPT_ILLEGAL	int
,	O
FALSE	int
)	O
;	O
return	O
-	O
1	int
;	O
}	O
dbf	pointer
->	O
mapped_size_max	long
=	O
(	O
(	O
sz	long
+	O
page_size	long
-	O
1	int
)	O
/	O
page_size	long
)	O
*	O
page_size	long
;	O
_gdbm_mapped_init	function
(	O
dbf	pointer
)	O
;	O
return	O
0	int
;	O
}	O
static	O
int	O
setopt_gdbm_getmaxmapsize	function
(	O
GDBM_FILE	pointer
dbf	pointer
,	O
void	O
*	O
optval	pointer
,	O
int	O
optlen	int
)	O
{	O
if	O
(	O
!	O
optval	pointer
||	O
optlen	int
!=	O
sizeof	O
(	O
size_t	long
)	O
)	O
{	O
GDBM_SET_ERRNO	O
(	O
dbf	pointer
,	O
GDBM_OPT_ILLEGAL	int
,	O
FALSE	int
)	O
;	O
return	O
-	O
1	int
;	O
}	O
*	O
(	O
size_t	long
*	O
)	O
optval	pointer
=	O
dbf	pointer
->	O
mapped_size_max	long
;	O
return	O
0	int
;	O
}	O
static	O
int	O
setopt_gdbm_getflags	function
(	O
GDBM_FILE	pointer
dbf	pointer
,	O
void	O
*	O
optval	pointer
,	O
int	O
optlen	int
)	O
{	O
if	O
(	O
!	O
optval	pointer
||	O
optlen	int
!=	O
sizeof	O
(	O
int	O
)	O
)	O
{	O
GDBM_SET_ERRNO	O
(	O
dbf	pointer
,	O
GDBM_OPT_ILLEGAL	int
,	O
FALSE	int
)	O
;	O
return	O
-	O
1	int
;	O
}	O
else	O
{	O
int	O
flags	int
=	O
dbf	pointer
->	O
read_write	int
;	O
if	O
(	O
!	O
dbf	pointer
->	O
fast_write	int
)	O
flags	int
|=	O
GDBM_SYNC	int
;	O
if	O
(	O
!	O
dbf	pointer
->	O
file_locking	int
)	O
flags	int
|=	O
GDBM_NOLOCK	int
;	O
if	O
(	O
!	O
dbf	pointer
->	O
memory_mapping	int
)	O
flags	int
|=	O
GDBM_NOMMAP	int
;	O
*	O
(	O
int	O
*	O
)	O
optval	pointer
=	O
flags	int
;	O
}	O
return	O
0	int
;	O
}	O
static	O
int	O
setopt_gdbm_getdbname	function
(	O
GDBM_FILE	pointer
dbf	pointer
,	O
void	O
*	O
optval	pointer
,	O
int	O
optlen	int
)	O
{	O
if	O
(	O
!	O
optval	pointer
||	O
optlen	int
!=	O
sizeof	O
(	O
char	O
*	O
)	O
)	O
{	O
GDBM_SET_ERRNO	O
(	O
dbf	pointer
,	O
GDBM_OPT_ILLEGAL	int
,	O
FALSE	int
)	O
;	O
return	O
-	O
1	int
;	O
}	O
else	O
{	O
char	O
*	O
p	pointer
=	O
strdup	function
(	O
dbf	pointer
->	O
name	pointer
)	O
;	O
if	O
(	O
!	O
p	pointer
)	O
{	O
GDBM_SET_ERRNO	O
(	O
dbf	pointer
,	O
GDBM_MALLOC_ERROR	int
,	O
FALSE	int
)	O
;	O
return	O
-	O
1	int
;	O
}	O
*	O
(	O
char	O
*	O
*	O
)	O
optval	pointer
=	O
p	pointer
;	O
}	O
return	O
0	int
;	O
}	O
static	O
int	O
setopt_gdbm_getblocksize	function
(	O
GDBM_FILE	pointer
dbf	pointer
,	O
void	O
*	O
optval	pointer
,	O
int	O
optlen	int
)	O
{	O
if	O
(	O
optval	pointer
&&	O
optlen	int
==	O
sizeof	O
(	O
int	O
)	O
)	O
{	O
*	O
(	O
int	O
*	O
)	O
optval	pointer
=	O
dbf	pointer
->	O
header	pointer
->	O
block_size	int
;	O
return	O
0	int
;	O
}	O
GDBM_SET_ERRNO	O
(	O
dbf	pointer
,	O
GDBM_OPT_ILLEGAL	int
,	O
FALSE	int
)	O
;	O
return	O
-	O
1	int
;	O
}	O
typedef	O
int	O
(	O
*	O
setopt_handler	pointer
)	O
(	O
GDBM_FILE	pointer
,	O
void	O
*	O
,	O
int	O
)	O
;	O
static	O
setopt_handler	pointer
setopt_handler_tab	array
[	O
]	O
=	O
{	O
[	O
GDBM_SETCACHESIZE	int
]	O
=	O
setopt_gdbm_setcachesize	function
,	O
[	O
GDBM_GETCACHESIZE	int
]	O
=	O
setopt_gdbm_getcachesize	function
,	O
[	O
GDBM_FASTMODE	int
]	O
=	O
setopt_gdbm_fastmode	function
,	O
[	O
GDBM_SETSYNCMODE	int
]	O
=	O
setopt_gdbm_setsyncmode	function
,	O
[	O
GDBM_GETSYNCMODE	int
]	O
=	O
setopt_gdbm_getsyncmode	function
,	O
[	O
GDBM_SETCENTFREE	int
]	O
=	O
setopt_gdbm_setcentfree	function
,	O
[	O
GDBM_GETCENTFREE	int
]	O
=	O
setopt_gdbm_getcentfree	function
,	O
[	O
GDBM_SETCOALESCEBLKS	int
]	O
=	O
setopt_gdbm_setcoalesceblks	function
,	O
[	O
GDBM_GETCOALESCEBLKS	int
]	O
=	O
setopt_gdbm_getcoalesceblks	function
,	O
[	O
GDBM_SETMMAP	int
]	O
=	O
setopt_gdbm_setmmap	function
,	O
[	O
GDBM_GETMMAP	int
]	O
=	O
setopt_gdbm_getmmap	function
,	O
[	O
GDBM_SETMAXMAPSIZE	int
]	O
=	O
setopt_gdbm_setmaxmapsize	function
,	O
[	O
GDBM_GETMAXMAPSIZE	int
]	O
=	O
setopt_gdbm_getmaxmapsize	function
,	O
[	O
GDBM_GETFLAGS	int
]	O
=	O
setopt_gdbm_getflags	function
,	O
[	O
GDBM_GETDBNAME	int
]	O
=	O
setopt_gdbm_getdbname	function
,	O
[	O
GDBM_GETBLOCKSIZE	int
]	O
=	O
setopt_gdbm_getblocksize	function
,	O
}	O
;	O
int	O
gdbm_setopt	function
(	O
GDBM_FILE	pointer
dbf	pointer
,	O
int	O
optflag	int
,	O
void	O
*	O
optval	pointer
,	O
int	O
optlen	int
)	O
{	O
GDBM_ASSERT_CONSISTENCY	O
(	O
dbf	pointer
,	O
-	O
1	int
)	O
;	O
if	O
(	O
optflag	int
>=	O
0	int
&&	O
optflag	int
<	O
sizeof	O
(	O
setopt_handler_tab	array
)	O
/	O
sizeof	O
(	O
setopt_handler_tab	array
[	O
0	int
]	O
)	O
&&	O
setopt_handler_tab	array
[	O
optflag	int
]	O
)	O
return	O
setopt_handler_tab	array
[	O
optflag	int
]	O
(	O
dbf	pointer
,	O
optval	pointer
,	O
optlen	int
)	O
;	O
GDBM_SET_ERRNO	O
(	O
dbf	pointer
,	O
GDBM_OPT_ILLEGAL	int
,	O
FALSE	int
)	O
;	O
return	O
-	O
1	int
;	O
}	O
