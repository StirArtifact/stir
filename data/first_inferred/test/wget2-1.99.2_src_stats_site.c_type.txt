enum	O
{	O
STATS_METHOD_GET	int
=	O
1	int
,	O
STATS_METHOD_HEAD	int
=	O
2	int
,	O
STATS_METHOD_POST	int
=	O
3	int
,	O
}	O
;	O
typedef	O
struct	O
{	O
wget_iri	struct
*	O
iri	*
;	O
long	O
long	O
size_downloaded	long
,	O
size_decompressed	int
;	O
long	O
long	O
request_start	long
;	O
long	O
long	O
response_end	long
;	O
long	O
long	O
initial_response_duration	long
;	O
unsigned	O
long	O
long	O
id	long
,	O
parent_id	int
;	O
int	O
status	int
,	O
signature_status	int
;	O
char	O
encoding	*
,	O
method	int
;	O
const	O
char	O
*	O
mime_type	*
;	O
bool	bool
redirect	bool
:	O
1	int
;	O
time_t	long
last_modified	long
;	O
}	O
site_stats_t	struct
;	O
static	O
wget_vector	struct
*	O
data	*
;	O
static	O
wget_thread_mutex	*
mutex	*
;	O
static	O
wget_hashmap	struct
*	O
docs	*
;	O
static	O
FILE	struct
*	O
fp	*
;	O
static	O
void	O
free_stats	function
(	O
void	O
*	O
stats	*
)	O
{	O
site_stats_t	struct
*	O
s	*
=	O
stats	*
;	O
if	O
(	O
s	*
)	O
{	O
xfree	function
(	O
s	*
->	O
mime_type	*
)	O
;	O
xfree	function
(	O
s	*
)	O
;	O
}	O
}	O
void	O
site_stats_init	function
(	O
FILE	struct
*	O
fpout	*
)	O
{	O
wget_thread_mutex_init	function
(	O
&	O
mutex	*
)	O
;	O
data	*
=	O
wget_vector_create	function
(	O
8	int
,	O
NULL	O
)	O
;	O
wget_vector_set_destructor	function
(	O
data	*
,	O
free_stats	*
)	O
;	O
fp	*
=	O
fpout	*
;	O
}	O
void	O
site_stats_exit	function
(	O
void	O
)	O
{	O
wget_stringmap_free	function
(	O
&	O
docs	struct
)	O
;	O
wget_vector_free	function
(	O
&	O
data	*
)	O
;	O
wget_thread_mutex_destroy	function
(	O
&	O
mutex	*
)	O
;	O
}	O
void	O
stats_site_add	function
(	O
wget_http_response	struct
*	O
resp	*
,	O
wget_gpg_info_t	struct
*	O
gpg_info	*
)	O
{	O
JOB	struct
*	O
job	*
=	O
resp	*
->	O
req	*
->	O
user_data	*
;	O
wget_iri	struct
*	O
iri	*
=	O
job	*
->	O
iri	*
;	O
if	O
(	O
gpg_info	*
)	O
{	O
wget_thread_mutex_lock	function
(	O
mutex	*
)	O
;	O
if	O
(	O
!	O
docs	*
)	O
{	O
docs	*
=	O
wget_stringmap_create	function
(	O
128	int
)	O
;	O
wget_stringmap_set_key_destructor	function
(	O
docs	*
,	O
NULL	O
)	O
;	O
wget_stringmap_set_value_destructor	function
(	O
docs	*
,	O
NULL	O
)	O
;	O
for	O
(	O
int	O
it	int
=	O
0	int
;	O
it	int
<	O
wget_vector_size	function
(	O
data	*
)	O
;	O
it	int
++	O
)	O
{	O
site_stats_t	struct
*	O
e	*
=	O
wget_vector_get	function
(	O
data	*
,	O
it	int
)	O
;	O
wget_stringmap_put	function
(	O
docs	*
,	O
e	*
->	O
iri	*
->	O
uri	*
,	O
e	int
)	O
;	O
}	O
}	O
char	O
*	O
p	*
,	O
*	O
uri	*
=	O
wget_strdup	function
(	O
iri	*
->	O
uri	*
)	O
;	O
if	O
(	O
(	O
p	*
=	O
strrchr	function
(	O
uri	*
,	O
'.'	O
)	O
)	O
)	O
*	O
p	*
=	O
0	int
;	O
site_stats_t	struct
*	O
doc	*
;	O
wget_stringmap_get	function
(	O
docs	*
,	O
uri	*
,	O
&	O
doc	*
)	O
;	O
xfree	function
(	O
uri	*
)	O
;	O
if	O
(	O
doc	*
)	O
{	O
if	O
(	O
gpg_info	*
->	O
valid_sigs	*
)	O
doc	*
->	O
signature_status	int
=	O
1	int
;	O
else	O
if	O
(	O
gpg_info	*
->	O
invalid_sigs	int
)	O
doc	*
->	O
signature_status	int
=	O
2	int
;	O
else	O
if	O
(	O
gpg_info	*
->	O
bad_sigs	*
)	O
doc	*
->	O
signature_status	int
=	O
3	int
;	O
else	O
if	O
(	O
gpg_info	*
->	O
missing_sigs	*
)	O
doc	*
->	O
signature_status	int
=	O
4	int
;	O
wget_thread_mutex_unlock	function
(	O
mutex	*
)	O
;	O
return	O
;	O
}	O
wget_thread_mutex_unlock	function
(	O
mutex	*
)	O
;	O
}	O
site_stats_t	struct
*	O
doc	*
=	O
wget_calloc	function
(	O
1	int
,	O
sizeof	O
(	O
site_stats_t	*
)	O
)	O
;	O
doc	*
->	O
id	int
=	O
job	*
->	O
id	int
;	O
doc	*
->	O
parent_id	int
=	O
job	*
->	O
parent_id	*
;	O
doc	*
->	O
iri	*
=	O
iri	*
;	O
doc	*
->	O
status	int
=	O
resp	*
->	O
code	int
;	O
doc	*
->	O
encoding	*
=	O
resp	*
->	O
content_encoding	*
;	O
doc	*
->	O
redirect	int
=	O
!	O
!	O
job	*
->	O
redirection_level	*
;	O
doc	*
->	O
mime_type	*
=	O
wget_strdup	function
(	O
resp	*
->	O
content_type	*
)	O
;	O
doc	*
->	O
last_modified	*
=	O
resp	*
->	O
last_modified	*
;	O
doc	*
->	O
request_start	*
=	O
resp	*
->	O
req	*
->	O
request_start	*
;	O
doc	*
->	O
response_end	*
=	O
resp	*
->	O
response_end	*
;	O
doc	*
->	O
initial_response_duration	*
=	O
resp	*
->	O
req	*
->	O
first_response_start	*
-	O
resp	*
->	O
req	*
->	O
request_start	*
;	O
doc	*
->	O
size_downloaded	*
=	O
resp	*
->	O
cur_downloaded	*
;	O
doc	*
->	O
size_decompressed	*
=	O
resp	*
->	O
body	*
->	O
length	long
;	O
if	O
(	O
!	O
wget_strcasecmp_ascii	function
(	O
resp	*
->	O
req	*
->	O
method	*
,	O
"GET"	*
)	O
)	O
{	O
doc	*
->	O
method	*
=	O
STATS_METHOD_GET	*
;	O
}	O
else	O
if	O
(	O
!	O
wget_strcasecmp_ascii	function
(	O
resp	*
->	O
req	*
->	O
method	*
,	O
"HEAD"	*
)	O
)	O
{	O
doc	*
->	O
size_downloaded	*
=	O
resp	*
->	O
content_length	*
;	O
doc	*
->	O
method	*
=	O
STATS_METHOD_HEAD	*
;	O
}	O
else	O
if	O
(	O
!	O
wget_strcasecmp_ascii	function
(	O
resp	*
->	O
req	*
->	O
method	*
,	O
"POST"	*
)	O
)	O
{	O
doc	*
->	O
method	*
=	O
STATS_METHOD_POST	*
;	O
}	O
wget_thread_mutex_lock	function
(	O
mutex	*
)	O
;	O
wget_vector_add	function
(	O
data	*
,	O
doc	*
)	O
;	O
if	O
(	O
docs	*
)	O
wget_stringmap_put	function
(	O
docs	*
,	O
doc	*
->	O
iri	*
->	O
uri	*
,	O
doc	*
)	O
;	O
wget_thread_mutex_unlock	function
(	O
mutex	*
)	O
;	O
}	O
static	O
int	O
print_human_entry	function
(	O
FILE	struct
*	O
_fp	*
,	O
site_stats_t	struct
*	O
doc	*
)	O
{	O
long	O
long	O
transfer_time	long
=	O
doc	*
->	O
response_end	long
-	O
doc	*
->	O
request_start	long
;	O
wget_fprintf	function
(	O
_fp	*
,	O
"  %6d %5lld %6lld %s\n"	*
,	O
doc	*
->	O
status	int
,	O
transfer_time	*
,	O
doc	*
->	O
size_downloaded	*
,	O
doc	*
->	O
iri	*
->	O
uri	*
)	O
;	O
return	O
0	int
;	O
}	O
static	O
int	O
print_csv_entry	function
(	O
FILE	struct
*	O
_fp	*
,	O
site_stats_t	struct
*	O
doc	*
)	O
{	O
long	O
long	O
transfer_time	long
=	O
doc	*
->	O
response_end	long
-	O
doc	*
->	O
request_start	long
;	O
wget_fprintf	function
(	O
_fp	*
,	O
"%llu,%llu,%s,%d,%d,%d,%lld,%lld,%lld,%lld,%d,%d,%ld,%s\n"	*
,	O
doc	*
->	O
id	int
,	O
doc	*
->	O
parent_id	*
,	O
doc	*
->	O
iri	*
->	O
uri	*
,	O
doc	*
->	O
status	int
,	O
!	O
doc	*
->	O
redirect	*
,	O
doc	*
->	O
method	int
,	O
doc	*
->	O
size_downloaded	*
,	O
doc	*
->	O
size_decompressed	*
,	O
transfer_time	*
,	O
doc	*
->	O
initial_response_duration	*
,	O
doc	*
->	O
encoding	*
,	O
doc	*
->	O
signature_status	*
,	O
doc	*
->	O
last_modified	*
,	O
doc	*
->	O
mime_type	*
)	O
;	O
return	O
0	int
;	O
}	O
static	O
void	O
print_human	function
(	O
void	O
)	O
{	O
wget_fprintf	function
(	O
fp	*
,	O
"\nSite Statistics:\n"	*
)	O
;	O
wget_fprintf	function
(	O
fp	*
,	O
"  %6s %5s %6s %s\n"	*
,	O
"Status"	*
,	O
"ms"	*
,	O
"Size"	*
,	O
"URL"	*
)	O
;	O
wget_vector_browse	function
(	O
data	*
,	O
(	O
wget_vector_browse_fn	struct
*	O
)	O
print_human_entry	*
,	O
fp	*
)	O
;	O
}	O
static	O
void	O
print_csv	function
(	O
void	O
)	O
{	O
wget_fprintf	function
(	O
fp	*
,	O
"ID,ParentID,URL,Status,Link,Method,Size,SizeDecompressed,TransferTime,ResponseTime,Encoding,Verification,Last-Modified,Content-Type\n"	*
)	O
;	O
wget_vector_browse	function
(	O
data	*
,	O
(	O
wget_vector_browse_fn	struct
*	O
)	O
print_csv_entry	*
,	O
fp	*
)	O
;	O
}	O
void	O
site_stats_print	function
(	O
void	O
)	O
{	O
if	O
(	O
config	struct
.	O
stats_site_args	*
->	O
format	*
==	O
WGET_STATS_FORMAT_HUMAN	int
)	O
print_human	function
(	O
)	O
;	O
else	O
print_csv	function
(	O
)	O
;	O
}	O