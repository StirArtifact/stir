static	O
const	O
char	O
*	O
current_folder	*
=	O
NULL	O
;	O
int	O
rcpt_mask	int
=	O
RCPT_DEFAULT	int
;	O
int	O
mh_auto_install	int
=	O
1	int
;	O
mu_property_t	*
mh_read_property_file	function
(	O
char	O
*	O
name	*
,	O
int	O
ro	int
)	O
{	O
mu_property_t	*
prop	*
;	O
struct	O
mu_mh_prop	struct
*	O
mhprop	*
;	O
int	O
rc	int
;	O
mhprop	int
=	O
mu_zalloc	function
(	O
sizeof	O
(	O
mhprop	array
[	O
0	int
]	O
)	O
)	O
;	O
mhprop	*
->	O
filename	*
=	O
name	*
;	O
mhprop	*
->	O
ro	*
=	O
ro	*
;	O
rc	int
=	O
mu_property_create_init	function
(	O
&	O
prop	*
,	O
mu_mh_property_init	*
,	O
mhprop	*
)	O
;	O
if	O
(	O
rc	int
)	O
{	O
mu_diag_funcall	function
(	O
MU_DIAG_ERROR	O
,	O
"mu_property_create_init"	*
,	O
name	*
,	O
rc	int
)	O
;	O
exit	function
(	O
1	int
)	O
;	O
}	O
return	O
prop	*
;	O
}	O
static	O
int	O
prop_merger	function
(	O
const	O
char	O
*	O
field	*
,	O
const	O
char	O
*	O
value	*
,	O
void	O
*	O
data	*
)	O
{	O
mu_property_t	*
dst	*
=	O
data	*
;	O
return	O
mu_property_set_value	function
(	O
dst	*
,	O
field	*
,	O
value	*
,	O
1	int
)	O
;	O
}	O
void	O
mh_property_merge	function
(	O
mu_property_t	*
dst	*
,	O
mu_property_t	*
src	*
)	O
{	O
int	O
rc	int
;	O
if	O
(	O
!	O
src	*
)	O
return	O
;	O
rc	int
=	O
mu_mhprop_iterate	function
(	O
src	*
,	O
prop_merger	*
,	O
dst	*
)	O
;	O
if	O
(	O
rc	int
)	O
{	O
mu_diag_funcall	function
(	O
MU_DIAG_ERROR	O
,	O
"mu_mhprop_iterate"	*
,	O
NULL	O
,	O
rc	int
)	O
;	O
exit	function
(	O
1	int
)	O
;	O
}	O
}	O
void	O
_mh_init_global_context	function
(	O
)	O
{	O
char	O
*	O
p	*
,	O
*	O
ctx_name	*
;	O
if	O
(	O
mu_mh_context	*
)	O
return	O
;	O
p	*
=	O
getenv	function
(	O
"CONTEXT"	*
)	O
;	O
if	O
(	O
!	O
p	*
)	O
p	*
=	O
MH_CONTEXT_FILE	*
;	O
ctx_name	*
=	O
mh_expand_name	function
(	O
NULL	O
,	O
p	*
,	O
NAME_ANY	*
)	O
;	O
mu_mh_context	*
=	O
mh_read_property_file	function
(	O
ctx_name	*
,	O
0	int
)	O
;	O
if	O
(	O
!	O
current_folder	*
)	O
current_folder	*
=	O
mh_global_context_get	function
(	O
"Current-Folder"	*
,	O
mh_global_profile_get	function
(	O
"Inbox"	*
,	O
"inbox"	*
)	O
)	O
;	O
}	O
void	O
mh_read_profile	function
(	O
)	O
{	O
char	O
*	O
p	*
;	O
const	O
char	O
*	O
fallback	*
;	O
p	*
=	O
getenv	function
(	O
"MH"	*
)	O
;	O
if	O
(	O
p	*
)	O
p	*
=	O
mu_tilde_expansion	function
(	O
p	*
,	O
MU_HIERARCHY_DELIMITER	char
,	O
NULL	O
)	O
;	O
else	O
{	O
char	O
*	O
home	*
=	O
mu_get_homedir	function
(	O
)	O
;	O
if	O
(	O
!	O
home	*
)	O
abort	function
(	O
)	O
;	O
p	*
=	O
mh_safe_make_file_name	function
(	O
home	*
,	O
MH_USER_PROFILE	*
)	O
;	O
free	function
(	O
home	*
)	O
;	O
}	O
if	O
(	O
mh_auto_install	*
&&	O
access	function
(	O
p	*
,	O
R_OK	int
)	O
)	O
mh_install	function
(	O
p	*
,	O
1	int
)	O
;	O
mu_mh_profile	*
=	O
mh_read_property_file	function
(	O
p	*
,	O
0	int
)	O
;	O
mu_set_folder_directory	function
(	O
mh_get_dir	function
(	O
)	O
)	O
;	O
mh_set_reply_regex	function
(	O
mh_global_profile_get	function
(	O
"Reply-Regex"	*
,	O
NULL	O
)	O
)	O
;	O
fallback	*
=	O
mh_global_profile_get	function
(	O
"Decode-Fallback"	*
,	O
NULL	O
)	O
;	O
if	O
(	O
fallback	int
&&	O
mu_set_default_fallback	function
(	O
fallback	*
)	O
)	O
mu_error	function
(	O
_	O
(	O
"Incorrect value for decode-fallback"	*
)	O
)	O
;	O
_mh_init_global_context	function
(	O
)	O
;	O
}	O
const	O
char	O
*	O
mh_current_folder	function
(	O
)	O
{	O
return	O
mh_global_context_get	function
(	O
"Current-Folder"	*
,	O
mh_global_profile_get	function
(	O
"Inbox"	*
,	O
"inbox"	*
)	O
)	O
;	O
}	O
const	O
char	O
*	O
mh_set_current_folder	function
(	O
const	O
char	O
*	O
val	*
)	O
{	O
int	O
rc	int
=	O
mh_global_context_set	function
(	O
"Current-Folder"	*
,	O
val	*
)	O
;	O
if	O
(	O
rc	int
)	O
{	O
mu_diag_funcall	function
(	O
MU_DIAG_ERROR	O
,	O
"mh_global_context_set"	*
,	O
"Current-Folder"	*
,	O
rc	int
)	O
;	O
exit	function
(	O
1	int
)	O
;	O
}	O
current_folder	*
=	O
mh_current_folder	function
(	O
)	O
;	O
return	O
current_folder	*
;	O
}	O
mu_property_t	*
mh_mailbox_get_property	function
(	O
mu_mailbox_t	*
mbox	*
)	O
{	O
mu_property_t	*
prop	*
;	O
int	O
rc	int
=	O
mu_mailbox_get_property	function
(	O
mbox	*
,	O
&	O
prop	*
)	O
;	O
if	O
(	O
rc	int
)	O
{	O
mu_diag_funcall	function
(	O
MU_DIAG_ERROR	O
,	O
"mu_mailbox_get_property"	*
,	O
NULL	O
,	O
rc	int
)	O
;	O
exit	function
(	O
1	int
)	O
;	O
}	O
return	O
prop	*
;	O
}	O
void	O
mh_global_sequences_drop	function
(	O
mu_mailbox_t	*
mbox	*
)	O
{	O
mu_property_t	*
prop	*
=	O
mh_mailbox_get_property	function
(	O
mbox	*
)	O
;	O
int	O
rc	int
=	O
mu_property_clear	function
(	O
prop	*
)	O
;	O
if	O
(	O
rc	int
)	O
{	O
mu_diag_funcall	function
(	O
MU_DIAG_ERROR	O
,	O
"mu_property_clear"	*
,	O
NULL	O
,	O
rc	int
)	O
;	O
exit	function
(	O
1	int
)	O
;	O
}	O
}	O
const	O
char	O
*	O
mh_global_sequences_get	function
(	O
mu_mailbox_t	*
mbox	*
,	O
const	O
char	O
*	O
name	*
,	O
const	O
char	O
*	O
defval	*
)	O
{	O
mu_property_t	*
prop	*
=	O
mh_mailbox_get_property	function
(	O
mbox	*
)	O
;	O
const	O
char	O
*	O
s	*
;	O
int	O
rc	int
=	O
mu_property_sget_value	function
(	O
prop	*
,	O
name	*
,	O
&	O
s	*
)	O
;	O
if	O
(	O
rc	int
==	O
MU_ERR_NOENT	O
)	O
s	*
=	O
defval	int
;	O
else	O
if	O
(	O
rc	int
)	O
{	O
mu_diag_funcall	function
(	O
MU_DIAG_ERROR	O
,	O
"mu_property_sget_value"	*
,	O
name	*
,	O
rc	int
)	O
;	O
exit	function
(	O
1	int
)	O
;	O
}	O
return	O
s	*
;	O
}	O
void	O
mh_global_sequences_set	function
(	O
mu_mailbox_t	*
mbox	*
,	O
const	O
char	O
*	O
name	*
,	O
const	O
char	O
*	O
value	*
)	O
{	O
mu_property_t	*
prop	*
=	O
mh_mailbox_get_property	function
(	O
mbox	*
)	O
;	O
int	O
rc	int
=	O
mu_property_set_value	function
(	O
prop	*
,	O
name	*
,	O
value	*
,	O
1	int
)	O
;	O
if	O
(	O
rc	int
&&	O
!	O
(	O
!	O
value	*
&&	O
rc	int
==	O
MU_ERR_NOENT	O
)	O
)	O
{	O
mu_diag_funcall	function
(	O
MU_DIAG_ERROR	O
,	O
"mu_property_set_value"	*
,	O
name	*
,	O
rc	int
)	O
;	O
exit	function
(	O
1	int
)	O
;	O
}	O
}	O
void	O
mh_global_sequences_iterate	function
(	O
mu_mailbox_t	*
mbox	*
,	O
mu_mhprop_iterator_t	*
fp	*
,	O
void	O
*	O
data	*
)	O
{	O
int	O
rc	int
;	O
mu_iterator_t	*
itr	*
;	O
mu_property_t	*
prop	*
=	O
mh_mailbox_get_property	function
(	O
mbox	*
)	O
;	O
rc	int
=	O
mu_property_get_iterator	function
(	O
prop	*
,	O
&	O
itr	*
)	O
;	O
if	O
(	O
rc	int
)	O
{	O
mu_diag_funcall	function
(	O
MU_DIAG_ERROR	O
,	O
"mu_property_get_iterator"	*
,	O
NULL	O
,	O
rc	int
)	O
;	O
exit	function
(	O
1	int
)	O
;	O
}	O
mu_mhprop_iterate	function
(	O
prop	*
,	O
fp	*
,	O
data	*
)	O
;	O
}	O
void	O
mh_global_save_state	function
(	O
)	O
{	O
int	O
rc	int
;	O
mh_global_context_set	function
(	O
"Current-Folder"	*
,	O
current_folder	*
)	O
;	O
rc	int
=	O
mu_property_save	function
(	O
mu_mh_context	*
)	O
;	O
if	O
(	O
rc	int
)	O
{	O
mu_diag_funcall	function
(	O
MU_DIAG_ERROR	O
,	O
"mu_property_save"	*
,	O
"context"	*
,	O
rc	int
)	O
;	O
exit	function
(	O
1	int
)	O
;	O
}	O
}	O