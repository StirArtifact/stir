struct	O
sockaddr_in	struct
daemon_addr	struct
=	O
{	O
AF_INET	O
}	O
;	O
struct	O
sockaddr_in	struct
ctl_addr	struct
=	O
{	O
AF_INET	O
}	O
;	O
struct	O
sockaddr_in	struct
my_addr	struct
=	O
{	O
AF_INET	O
}	O
;	O
struct	O
in_addr	struct
my_machine_addr	struct
;	O
struct	O
in_addr	struct
his_machine_addr	struct
;	O
unsigned	O
short	O
daemon_port	char
;	O
int	O
ctl_sockt	int
;	O
int	O
sockt	int
;	O
int	O
invitation_waiting	int
=	O
0	int
;	O
CTL_MSG	struct
msg	struct
;	O
int	O
open_sockt	function
(	O
void	O
)	O
{	O
socklen_t	int
length	int
;	O
my_addr	struct
.	O
sin_addr	struct
=	O
my_machine_addr	struct
;	O
my_addr	struct
.	O
sin_port	short
=	O
0	int
;	O
sockt	int
=	O
socket	function
(	O
AF_INET	O
,	O
SOCK_STREAM	int
,	O
0	int
)	O
;	O
if	O
(	O
sockt	int
<=	O
0	int
)	O
p_error	function
(	O
"Bad socket"	*
)	O
;	O
if	O
(	O
bind	function
(	O
sockt	int
,	O
(	O
struct	O
sockaddr	struct
*	O
)	O
&	O
my_addr	struct
,	O
sizeof	O
(	O
my_addr	struct
)	O
)	O
!=	O
0	int
)	O
p_error	function
(	O
"Binding local socket"	*
)	O
;	O
length	int
=	O
sizeof	O
(	O
my_addr	struct
)	O
;	O
if	O
(	O
getsockname	function
(	O
sockt	int
,	O
(	O
struct	O
sockaddr	struct
*	O
)	O
&	O
my_addr	struct
,	O
&	O
length	int
)	O
==	O
-	O
1	int
)	O
p_error	function
(	O
"Bad address for socket"	*
)	O
;	O
return	O
0	int
;	O
}	O
int	O
open_ctl	function
(	O
void	O
)	O
{	O
socklen_t	int
length	int
;	O
ctl_addr	struct
.	O
sin_port	short
=	O
0	int
;	O
ctl_addr	struct
.	O
sin_addr	struct
=	O
my_machine_addr	struct
;	O
ctl_sockt	int
=	O
socket	function
(	O
AF_INET	O
,	O
SOCK_DGRAM	int
,	O
0	int
)	O
;	O
if	O
(	O
ctl_sockt	int
<=	O
0	int
)	O
p_error	function
(	O
"Bad socket"	*
)	O
;	O
if	O
(	O
bind	function
(	O
ctl_sockt	int
,	O
(	O
struct	O
sockaddr	struct
*	O
)	O
&	O
ctl_addr	struct
,	O
sizeof	O
(	O
ctl_addr	struct
)	O
)	O
!=	O
0	int
)	O
p_error	function
(	O
"Couldn't bind to control socket"	*
)	O
;	O
length	int
=	O
sizeof	O
(	O
ctl_addr	struct
)	O
;	O
if	O
(	O
getsockname	function
(	O
ctl_sockt	int
,	O
(	O
struct	O
sockaddr	struct
*	O
)	O
&	O
ctl_addr	struct
,	O
&	O
length	int
)	O
==	O
-	O
1	int
)	O
p_error	function
(	O
"Bad address for ctl socket"	*
)	O
;	O
return	O
0	int
;	O
}	O