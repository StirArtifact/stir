void	O
psout	function
(	O
struct	O
proc_stat_list	struct
*	O
procs	*
,	O
char	O
*	O
fmt_string	*
,	O
int	O
posix_fmt	int
,	O
struct	O
ps_fmt_specs	struct
*	O
specs	*
,	O
char	O
*	O
sort_key_name	*
,	O
int	O
sort_reverse	int
,	O
int	O
output_width	int
,	O
int	O
print_heading	int
,	O
int	O
squash_bogus_fields	int
,	O
int	O
squash_nominal_fields	int
,	O
int	O
top	int
)	O
{	O
error_t	O
err	int
;	O
struct	O
ps_stream	struct
*	O
output	*
;	O
struct	O
ps_fmt	struct
*	O
fmt	*
;	O
err	int
=	O
ps_fmt_create	function
(	O
fmt_string	*
,	O
posix_fmt	*
,	O
specs	*
,	O
&	O
fmt	*
)	O
;	O
if	O
(	O
err	int
)	O
{	O
char	O
*	O
problem	*
;	O
ps_fmt_creation_error	function
(	O
fmt_string	*
,	O
posix_fmt	*
,	O
specs	*
,	O
&	O
problem	*
)	O
;	O
error	function
(	O
4	int
,	O
0	int
,	O
"%s"	*
,	O
problem	*
)	O
;	O
}	O
if	O
(	O
squash_bogus_fields	*
)	O
{	O
ps_flags_t	O
bogus_flags	int
=	O
ps_fmt_needs	function
(	O
fmt	*
)	O
;	O
err	int
=	O
proc_stat_list_find_bogus_flags	function
(	O
procs	O
,	O
&	O
bogus_flags	struct
)	O
;	O
if	O
(	O
err	int
)	O
error	function
(	O
0	int
,	O
err	int
,	O
"Couldn't remove bogus fields"	*
)	O
;	O
else	O
ps_fmt_squash_flags	function
(	O
fmt	*
,	O
bogus_flags	*
)	O
;	O
}	O
if	O
(	O
squash_nominal_fields	int
)	O
{	O
int	O
nominal	function
(	O
struct	O
ps_fmt_field	struct
*	O
field	*
)	O
{	O
return	O
!	O
(	O
field	*
->	O
flags	int
&	O
PS_FMT_FIELD_KEEP	int
)	O
&&	O
proc_stat_list_spec_nominal	function
(	O
procs	O
,	O
field	*
->	O
spec	struct
)	O
;	O
}	O
ps_fmt_squash	function
(	O
fmt	*
,	O
nominal	*
)	O
;	O
}	O
if	O
(	O
sort_key_name	*
)	O
{	O
const	O
struct	O
ps_fmt_spec	struct
*	O
sort_key	*
;	O
if	O
(	O
*	O
sort_key_name	*
==	O
'-'	O
)	O
{	O
sort_reverse	int
=	O
1	int
;	O
sort_key_name	*
++	O
;	O
}	O
sort_key	*
=	O
ps_fmt_specs_find	function
(	O
specs	*
,	O
sort_key_name	*
)	O
;	O
if	O
(	O
sort_key	*
==	O
NULL	O
)	O
error	function
(	O
3	int
,	O
0	int
,	O
"%s: bad sort key"	*
,	O
sort_key_name	*
)	O
;	O
err	int
=	O
proc_stat_list_sort	function
(	O
procs	O
,	O
sort_key	*
,	O
sort_reverse	*
)	O
;	O
if	O
(	O
err	O
)	O
error	function
(	O
0	int
,	O
err	*
,	O
"Couldn't sort processes"	*
)	O
;	O
}	O
err	int
=	O
ps_stream_create	function
(	O
stdout	*
,	O
&	O
output	*
)	O
;	O
if	O
(	O
err	int
)	O
error	function
(	O
5	int
,	O
err	int
,	O
"Can't make output stream"	*
)	O
;	O
if	O
(	O
print_heading	*
)	O
{	O
if	O
(	O
procs	*
->	O
num_procs	int
>	O
0	int
)	O
{	O
err	int
=	O
ps_fmt_write_titles	function
(	O
fmt	*
,	O
output	*
)	O
;	O
if	O
(	O
err	int
)	O
error	function
(	O
0	int
,	O
err	int
,	O
"Can't print titles"	*
)	O
;	O
ps_stream_newline	function
(	O
output	*
)	O
;	O
}	O
else	O
error	function
(	O
1	int
,	O
0	int
,	O
"No applicable processes"	*
)	O
;	O
}	O
if	O
(	O
output_width	*
)	O
{	O
int	O
deduce_term_size	function
(	O
int	O
fd	int
,	O
char	O
*	O
type	*
,	O
int	O
*	O
width	*
,	O
int	O
*	O
height	*
)	O
;	O
if	O
(	O
output_width	int
<	O
0	int
)	O
if	O
(	O
!	O
deduce_term_size	function
(	O
1	int
,	O
getenv	function
(	O
"TERM"	*
)	O
,	O
&	O
output_width	*
,	O
0	int
)	O
)	O
output_width	int
=	O
80	int
;	O
ps_fmt_set_output_width	function
(	O
fmt	*
,	O
output_width	*
)	O
;	O
}	O
if	O
(	O
top	O
)	O
{	O
int	O
filter	function
(	O
struct	O
proc_stat	O
*	O
ps	*
)	O
{	O
return	O
--	O
top	int
>=	O
0	int
;	O
}	O
if	O
(	O
top	O
<	O
0	int
)	O
{	O
top	struct
+=	O
procs	O
->	O
num_procs	*
;	O
proc_stat_list_filter1	function
(	O
procs	O
,	O
filter	*
,	O
0	int
,	O
1	int
)	O
;	O
}	O
else	O
proc_stat_list_filter1	function
(	O
procs	O
,	O
filter	*
,	O
0	int
,	O
0	int
)	O
;	O
}	O
err	int
=	O
proc_stat_list_fmt	function
(	O
procs	O
,	O
fmt	*
,	O
output	*
)	O
;	O
if	O
(	O
err	int
)	O
error	function
(	O
5	int
,	O
err	*
,	O
"Couldn't output process status"	*
)	O
;	O
}	O