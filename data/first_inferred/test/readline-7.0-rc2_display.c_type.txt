static	O
void	O
update_line	function
PARAMS	O
(	O
(	O
char	O
*	O
,	O
char	O
*	O
,	O
int	O
,	O
int	O
,	O
int	O
,	O
int	O
)	O
)	O
;	O
static	O
void	O
space_to_eol	function
PARAMS	O
(	O
(	O
int	O
)	O
)	O
;	O
static	O
void	O
delete_chars	function
PARAMS	O
(	O
(	O
int	O
)	O
)	O
;	O
static	O
void	O
insert_some_chars	function
PARAMS	O
(	O
(	O
char	O
*	O
,	O
int	O
,	O
int	O
)	O
)	O
;	O
static	O
void	O
open_some_spaces	function
PARAMS	O
(	O
(	O
int	O
)	O
)	O
;	O
static	O
void	O
cr	function
PARAMS	O
(	O
(	O
void	O
)	O
)	O
;	O
static	O
void	O
redraw_prompt	function
PARAMS	O
(	O
(	O
char	O
*	O
)	O
)	O
;	O
static	O
char	O
*	O
expand_prompt	function
PARAMS	O
(	O
(	O
char	O
*	O
,	O
int	O
,	O
int	O
*	O
,	O
int	O
*	O
,	O
int	O
*	O
,	O
int	O
*	O
)	O
)	O
;	O
struct	O
line_state	struct
{	O
char	O
*	O
line	pointer
;	O
int	O
*	O
lbreaks	pointer
;	O
int	O
lbsize	int
;	O
int	O
wbsize	int
;	O
int	O
*	O
wrapped_line	pointer
;	O
}	O
;	O
static	O
struct	O
line_state	struct
line_state_array	array
[	O
2	int
]	O
;	O
static	O
struct	O
line_state	struct
*	O
line_state_visible	pointer
=	O
&	O
line_state_array	array
[	O
0	int
]	O
;	O
static	O
struct	O
line_state	struct
*	O
line_state_invisible	pointer
=	O
&	O
line_state_array	array
[	O
1	int
]	O
;	O
static	O
int	O
line_structures_initialized	int
=	O
0	int
;	O
static	O
int	O
_rl_col_width	function
PARAMS	O
(	O
(	O
const	O
char	O
*	O
,	O
int	O
,	O
int	O
,	O
int	O
)	O
)	O
;	O
rl_voidfunc_t	function
*	O
rl_redisplay_function	pointer
=	O
rl_redisplay	function
;	O
int	O
rl_display_fixed	int
=	O
0	int
;	O
int	O
_rl_suppress_redisplay	int
=	O
0	int
;	O
int	O
_rl_want_redisplay	int
=	O
0	int
;	O
char	O
*	O
rl_display_prompt	pointer
=	O
(	O
char	O
*	O
)	O
NULL	O
;	O
char	O
*	O
_rl_emacs_mode_str	pointer
;	O
int	O
_rl_emacs_modestr_len	int
;	O
char	O
*	O
_rl_vi_ins_mode_str	pointer
;	O
int	O
_rl_vi_ins_modestr_len	int
;	O
char	O
*	O
_rl_vi_cmd_mode_str	pointer
;	O
int	O
_rl_vi_cmd_modestr_len	int
;	O
int	O
_rl_last_c_pos	int
=	O
0	int
;	O
int	O
_rl_last_v_pos	int
=	O
0	int
;	O
static	O
int	O
cpos_adjusted	int
;	O
static	O
int	O
cpos_buffer_position	int
;	O
static	O
int	O
displaying_prompt_first_line	int
;	O
static	O
int	O
prompt_multibyte_chars	int
;	O
int	O
_rl_vis_botlin	int
=	O
0	int
;	O
static	O
int	O
_rl_inv_botlin	int
=	O
0	int
;	O
static	O
int	O
last_lmargin	int
;	O
static	O
char	O
*	O
msg_buf	pointer
=	O
0	int
;	O
static	O
int	O
msg_bufsiz	int
=	O
0	int
;	O
static	O
int	O
forced_display	int
;	O
static	O
int	O
line_size	int
=	O
1024	int
;	O
static	O
char	O
*	O
local_prompt	pointer
,	O
*	O
local_prompt_prefix	pointer
;	O
static	O
int	O
local_prompt_len	int
;	O
static	O
int	O
prompt_visible_length	int
,	O
prompt_prefix_length	int
;	O
static	O
int	O
visible_wrap_offset	int
;	O
static	O
int	O
wrap_offset	int
;	O
static	O
int	O
prompt_last_invisible	int
;	O
static	O
int	O
visible_first_line_len	int
;	O
static	O
int	O
prompt_invis_chars_first_line	int
;	O
static	O
int	O
prompt_last_screen_line	int
;	O
static	O
int	O
prompt_physical_chars	int
;	O
static	O
int	O
modmark	int
;	O
static	O
char	O
*	O
saved_local_prompt	pointer
;	O
static	O
char	O
*	O
saved_local_prefix	pointer
;	O
static	O
int	O
saved_last_invisible	int
;	O
static	O
int	O
saved_visible_length	int
;	O
static	O
int	O
saved_prefix_length	int
;	O
static	O
int	O
saved_local_length	int
;	O
static	O
int	O
saved_invis_chars_first_line	int
;	O
static	O
int	O
saved_physical_chars	int
;	O
static	O
char	O
*	O
prompt_modestr	function
(	O
lenp	pointer
)	O
int	O
*	O
lenp	pointer
;	O
{	O
if	O
(	O
rl_editing_mode	int
==	O
emacs_mode	int
)	O
{	O
if	O
(	O
lenp	pointer
)	O
*	O
lenp	pointer
=	O
_rl_emacs_mode_str	pointer
?	O
_rl_emacs_modestr_len	int
:	O
RL_EMACS_MODESTR_DEFLEN	int
;	O
return	O
_rl_emacs_mode_str	pointer
?	O
_rl_emacs_mode_str	pointer
:	O
RL_EMACS_MODESTR_DEFAULT	pointer
;	O
}	O
else	O
if	O
(	O
_rl_keymap	pointer
==	O
vi_insertion_keymap	array
)	O
{	O
if	O
(	O
lenp	pointer
)	O
*	O
lenp	pointer
=	O
_rl_vi_ins_mode_str	pointer
?	O
_rl_vi_ins_modestr_len	int
:	O
RL_VI_INS_MODESTR_DEFLEN	int
;	O
return	O
_rl_vi_ins_mode_str	pointer
?	O
_rl_vi_ins_mode_str	pointer
:	O
RL_VI_INS_MODESTR_DEFAULT	pointer
;	O
}	O
else	O
{	O
if	O
(	O
lenp	pointer
)	O
*	O
lenp	pointer
=	O
_rl_vi_cmd_mode_str	pointer
?	O
_rl_vi_cmd_modestr_len	int
:	O
RL_VI_CMD_MODESTR_DEFLEN	int
;	O
return	O
_rl_vi_cmd_mode_str	pointer
?	O
_rl_vi_cmd_mode_str	pointer
:	O
RL_VI_CMD_MODESTR_DEFAULT	pointer
;	O
}	O
}	O
static	O
char	O
*	O
expand_prompt	function
(	O
pmt	pointer
,	O
flags	int
,	O
lp	pointer
,	O
lip	pointer
,	O
niflp	pointer
,	O
vlp	pointer
)	O
char	O
*	O
pmt	pointer
;	O
int	O
flags	int
;	O
int	O
*	O
lp	pointer
,	O
*	O
lip	pointer
,	O
*	O
niflp	pointer
,	O
*	O
vlp	pointer
;	O
{	O
char	O
*	O
r	pointer
,	O
*	O
ret	pointer
,	O
*	O
p	pointer
,	O
*	O
igstart	pointer
,	O
*	O
nprompt	pointer
,	O
*	O
ms	pointer
;	O
int	O
l	int
,	O
rl	int
,	O
last	int
,	O
ignoring	int
,	O
ninvis	int
,	O
invfl	int
,	O
invflset	int
,	O
ind	int
,	O
pind	int
,	O
physchars	int
;	O
int	O
mlen	int
;	O
ms	pointer
=	O
(	O
(	O
(	O
pmt	pointer
==	O
rl_prompt	pointer
)	O
^	O
(	O
flags	int
&	O
PMT_MULTILINE	int
)	O
)	O
&&	O
_rl_show_mode_in_prompt	int
)	O
?	O
prompt_modestr	function
(	O
&	O
mlen	int
)	O
:	O
0	int
;	O
if	O
(	O
ms	pointer
)	O
{	O
l	int
=	O
strlen	function
(	O
pmt	pointer
)	O
;	O
nprompt	pointer
=	O
(	O
char	O
*	O
)	O
xmalloc	function
(	O
l	int
+	O
mlen	int
+	O
1	int
)	O
;	O
memcpy	function
(	O
nprompt	pointer
,	O
ms	pointer
,	O
mlen	int
)	O
;	O
strcpy	function
(	O
nprompt	pointer
+	O
mlen	int
,	O
pmt	pointer
)	O
;	O
}	O
else	O
nprompt	pointer
=	O
pmt	pointer
;	O
if	O
(	O
(	O
MB_CUR_MAX	O
<=	O
1	int
||	O
rl_byte_oriented	int
)	O
&&	O
strchr	function
(	O
nprompt	pointer
,	O
RL_PROMPT_START_IGNORE	char
)	O
==	O
0	int
)	O
{	O
r	pointer
=	O
(	O
nprompt	pointer
==	O
pmt	pointer
)	O
?	O
savestring	O
(	O
pmt	pointer
)	O
:	O
nprompt	pointer
;	O
if	O
(	O
lp	pointer
)	O
*	O
lp	pointer
=	O
strlen	function
(	O
r	pointer
)	O
;	O
if	O
(	O
lip	pointer
)	O
*	O
lip	pointer
=	O
0	int
;	O
if	O
(	O
niflp	pointer
)	O
*	O
niflp	pointer
=	O
0	int
;	O
if	O
(	O
vlp	pointer
)	O
*	O
vlp	pointer
=	O
lp	pointer
?	O
*	O
lp	pointer
:	O
strlen	function
(	O
r	pointer
)	O
;	O
return	O
r	pointer
;	O
}	O
l	int
=	O
strlen	function
(	O
nprompt	pointer
)	O
;	O
r	pointer
=	O
ret	pointer
=	O
(	O
char	O
*	O
)	O
xmalloc	function
(	O
l	int
+	O
1	int
)	O
;	O
rl	int
=	O
physchars	int
=	O
0	int
;	O
invfl	int
=	O
0	int
;	O
invflset	int
=	O
0	int
;	O
igstart	pointer
=	O
0	int
;	O
for	O
(	O
ignoring	int
=	O
last	int
=	O
ninvis	int
=	O
0	int
,	O
p	pointer
=	O
nprompt	pointer
;	O
p	pointer
&&	O
*	O
p	pointer
;	O
p	pointer
++	O
)	O
{	O
if	O
(	O
ignoring	int
==	O
0	int
&&	O
*	O
p	pointer
==	O
RL_PROMPT_START_IGNORE	char
)	O
{	O
ignoring	int
=	O
1	int
;	O
igstart	pointer
=	O
p	pointer
;	O
continue	O
;	O
}	O
else	O
if	O
(	O
ignoring	int
&&	O
*	O
p	pointer
==	O
RL_PROMPT_END_IGNORE	char
)	O
{	O
ignoring	int
=	O
0	int
;	O
if	O
(	O
p	pointer
!=	O
(	O
igstart	pointer
+	O
1	int
)	O
)	O
last	int
=	O
r	pointer
-	O
ret	pointer
-	O
1	int
;	O
continue	O
;	O
}	O
else	O
{	O
if	O
(	O
MB_CUR_MAX	O
>	O
1	int
&&	O
rl_byte_oriented	int
==	O
0	int
)	O
{	O
pind	int
=	O
p	pointer
-	O
nprompt	pointer
;	O
ind	int
=	O
_rl_find_next_mbchar	function
(	O
nprompt	pointer
,	O
pind	int
,	O
1	int
,	O
MB_FIND_NONZERO	int
)	O
;	O
l	int
=	O
ind	int
-	O
pind	int
;	O
while	O
(	O
l	int
--	O
)	O
*	O
r	pointer
++	O
=	O
*	O
p	pointer
++	O
;	O
if	O
(	O
!	O
ignoring	int
)	O
{	O
rl	int
+=	O
ind	int
-	O
pind	int
;	O
physchars	int
+=	O
_rl_col_width	function
(	O
nprompt	pointer
,	O
pind	int
,	O
ind	int
,	O
0	int
)	O
;	O
}	O
else	O
ninvis	int
+=	O
ind	int
-	O
pind	int
;	O
p	pointer
--	O
;	O
}	O
else	O
{	O
*	O
r	pointer
++	O
=	O
*	O
p	pointer
;	O
if	O
(	O
!	O
ignoring	int
)	O
{	O
rl	int
++	O
;	O
physchars	int
++	O
;	O
}	O
else	O
ninvis	int
++	O
;	O
}	O
if	O
(	O
invflset	int
==	O
0	int
&&	O
rl	int
>=	O
_rl_screenwidth	int
)	O
{	O
invfl	int
=	O
ninvis	int
;	O
invflset	int
=	O
1	int
;	O
}	O
}	O
}	O
if	O
(	O
rl	int
<	O
_rl_screenwidth	int
)	O
invfl	int
=	O
ninvis	int
;	O
*	O
r	pointer
=	O
'\0'	O
;	O
if	O
(	O
lp	pointer
)	O
*	O
lp	pointer
=	O
rl	int
;	O
if	O
(	O
lip	pointer
)	O
*	O
lip	pointer
=	O
last	int
;	O
if	O
(	O
niflp	pointer
)	O
*	O
niflp	pointer
=	O
invfl	int
;	O
if	O
(	O
vlp	pointer
)	O
*	O
vlp	pointer
=	O
physchars	int
;	O
if	O
(	O
nprompt	pointer
!=	O
pmt	pointer
)	O
free	function
(	O
nprompt	pointer
)	O
;	O
return	O
ret	pointer
;	O
}	O
char	O
*	O
_rl_strip_prompt	function
(	O
pmt	pointer
)	O
char	O
*	O
pmt	pointer
;	O
{	O
char	O
*	O
ret	pointer
;	O
ret	pointer
=	O
expand_prompt	function
(	O
pmt	pointer
,	O
0	int
,	O
(	O
int	O
*	O
)	O
NULL	O
,	O
(	O
int	O
*	O
)	O
NULL	O
,	O
(	O
int	O
*	O
)	O
NULL	O
,	O
(	O
int	O
*	O
)	O
NULL	O
)	O
;	O
return	O
ret	pointer
;	O
}	O
void	O
_rl_reset_prompt	function
(	O
)	O
{	O
rl_visible_prompt_length	int
=	O
rl_expand_prompt	function
(	O
rl_prompt	pointer
)	O
;	O
}	O
int	O
rl_expand_prompt	function
(	O
prompt	pointer
)	O
char	O
*	O
prompt	pointer
;	O
{	O
char	O
*	O
p	pointer
,	O
*	O
t	pointer
;	O
int	O
c	int
;	O
FREE	O
(	O
local_prompt	pointer
)	O
;	O
FREE	O
(	O
local_prompt_prefix	pointer
)	O
;	O
local_prompt	pointer
=	O
local_prompt_prefix	pointer
=	O
(	O
char	O
*	O
)	O
0	int
;	O
local_prompt_len	int
=	O
0	int
;	O
prompt_last_invisible	int
=	O
prompt_invis_chars_first_line	int
=	O
0	int
;	O
prompt_visible_length	int
=	O
prompt_physical_chars	int
=	O
0	int
;	O
if	O
(	O
prompt	pointer
==	O
0	int
||	O
*	O
prompt	pointer
==	O
0	int
)	O
return	O
(	O
0	int
)	O
;	O
p	pointer
=	O
strrchr	function
(	O
prompt	pointer
,	O
'\n'	O
)	O
;	O
if	O
(	O
p	pointer
==	O
0	int
)	O
{	O
local_prompt	pointer
=	O
expand_prompt	function
(	O
prompt	pointer
,	O
0	int
,	O
&	O
prompt_visible_length	int
,	O
&	O
prompt_last_invisible	int
,	O
&	O
prompt_invis_chars_first_line	int
,	O
&	O
prompt_physical_chars	int
)	O
;	O
local_prompt_prefix	pointer
=	O
(	O
char	O
*	O
)	O
0	int
;	O
local_prompt_len	int
=	O
local_prompt	pointer
?	O
strlen	function
(	O
local_prompt	pointer
)	O
:	O
0	int
;	O
return	O
(	O
prompt_visible_length	int
)	O
;	O
}	O
else	O
{	O
t	pointer
=	O
++	O
p	pointer
;	O
local_prompt	pointer
=	O
expand_prompt	function
(	O
p	pointer
,	O
PMT_MULTILINE	int
,	O
&	O
prompt_visible_length	int
,	O
&	O
prompt_last_invisible	int
,	O
&	O
prompt_invis_chars_first_line	int
,	O
&	O
prompt_physical_chars	int
)	O
;	O
c	int
=	O
*	O
t	pointer
;	O
*	O
t	pointer
=	O
'\0'	O
;	O
local_prompt_prefix	pointer
=	O
expand_prompt	function
(	O
prompt	pointer
,	O
PMT_MULTILINE	int
,	O
&	O
prompt_prefix_length	int
,	O
(	O
int	O
*	O
)	O
NULL	O
,	O
(	O
int	O
*	O
)	O
NULL	O
,	O
(	O
int	O
*	O
)	O
NULL	O
)	O
;	O
*	O
t	pointer
=	O
c	int
;	O
local_prompt_len	int
=	O
local_prompt	pointer
?	O
strlen	function
(	O
local_prompt	pointer
)	O
:	O
0	int
;	O
return	O
(	O
prompt_prefix_length	int
)	O
;	O
}	O
}	O
static	O
void	O
init_line_structures	function
(	O
minsize	int
)	O
int	O
minsize	int
;	O
{	O
register	O
int	O
n	int
;	O
if	O
(	O
invisible_line	O
==	O
0	int
)	O
{	O
if	O
(	O
line_size	int
<	O
minsize	int
)	O
line_size	int
=	O
minsize	int
;	O
visible_line	O
=	O
(	O
char	O
*	O
)	O
xmalloc	function
(	O
line_size	int
)	O
;	O
invisible_line	O
=	O
(	O
char	O
*	O
)	O
xmalloc	function
(	O
line_size	int
)	O
;	O
}	O
else	O
if	O
(	O
line_size	int
<	O
minsize	int
)	O
{	O
line_size	int
*=	O
2	int
;	O
if	O
(	O
line_size	int
<	O
minsize	int
)	O
line_size	int
=	O
minsize	int
;	O
visible_line	O
=	O
(	O
char	O
*	O
)	O
xrealloc	function
(	O
visible_line	O
,	O
line_size	int
)	O
;	O
invisible_line	O
=	O
(	O
char	O
*	O
)	O
xrealloc	function
(	O
invisible_line	O
,	O
line_size	int
)	O
;	O
}	O
for	O
(	O
n	int
=	O
minsize	int
;	O
n	int
<	O
line_size	int
;	O
n	int
++	O
)	O
{	O
visible_line	O
[	O
n	int
]	O
=	O
0	int
;	O
invisible_line	O
[	O
n	int
]	O
=	O
1	int
;	O
}	O
if	O
(	O
vis_lbreaks	O
==	O
0	int
)	O
{	O
inv_lbsize	O
=	O
vis_lbsize	O
=	O
256	int
;	O
line_state_visible	pointer
->	O
wbsize	int
=	O
vis_lbsize	O
;	O
line_state_visible	pointer
->	O
wrapped_line	pointer
=	O
(	O
int	O
*	O
)	O
xmalloc	function
(	O
line_state_visible	pointer
->	O
wbsize	int
*	O
sizeof	O
(	O
int	O
)	O
)	O
;	O
line_state_invisible	pointer
->	O
wbsize	int
=	O
inv_lbsize	O
;	O
line_state_invisible	pointer
->	O
wrapped_line	pointer
=	O
(	O
int	O
*	O
)	O
xmalloc	function
(	O
line_state_invisible	pointer
->	O
wbsize	int
*	O
sizeof	O
(	O
int	O
)	O
)	O
;	O
inv_lbreaks	O
=	O
(	O
int	O
*	O
)	O
xmalloc	function
(	O
inv_lbsize	O
*	O
sizeof	O
(	O
int	O
)	O
)	O
;	O
vis_lbreaks	O
=	O
(	O
int	O
*	O
)	O
xmalloc	function
(	O
vis_lbsize	O
*	O
sizeof	O
(	O
int	O
)	O
)	O
;	O
inv_lbreaks	O
[	O
0	int
]	O
=	O
vis_lbreaks	O
[	O
0	int
]	O
=	O
0	int
;	O
}	O
line_structures_initialized	int
=	O
1	int
;	O
}	O
void	O
rl_redisplay	function
(	O
)	O
{	O
register	O
int	O
in	int
,	O
out	int
,	O
c	int
,	O
linenum	int
,	O
cursor_linenum	int
;	O
register	O
char	O
*	O
line	pointer
;	O
int	O
inv_botlin	int
,	O
lb_botlin	int
,	O
lb_linenum	int
,	O
o_cpos	int
;	O
int	O
newlines	int
,	O
lpos	int
,	O
temp	int
,	O
n0	int
,	O
num	int
,	O
prompt_lines_estimate	int
;	O
char	O
*	O
prompt_this_line	pointer
;	O
int	O
mb_cur_max	int
=	O
MB_CUR_MAX	O
;	O
wchar_t	int
wc	int
;	O
size_t	long
wc_bytes	long
;	O
int	O
wc_width	int
;	O
mbstate_t	struct
ps	struct
;	O
int	O
_rl_wrapped_multicolumn	int
=	O
0	int
;	O
if	O
(	O
_rl_echoing_p	int
==	O
0	int
)	O
return	O
;	O
_rl_block_sigint	function
(	O
)	O
;	O
RL_SETSTATE	O
(	O
RL_STATE_REDISPLAYING	int
)	O
;	O
if	O
(	O
!	O
rl_display_prompt	pointer
)	O
rl_display_prompt	pointer
=	O
""	pointer
;	O
if	O
(	O
line_structures_initialized	int
==	O
0	int
)	O
{	O
init_line_structures	function
(	O
0	int
)	O
;	O
rl_on_new_line	function
(	O
)	O
;	O
}	O
cpos_buffer_position	int
=	O
-	O
1	int
;	O
prompt_multibyte_chars	int
=	O
prompt_visible_length	int
-	O
prompt_physical_chars	int
;	O
line	pointer
=	O
invisible_line	O
;	O
out	int
=	O
inv_botlin	int
=	O
0	int
;	O
modmark	int
=	O
0	int
;	O
if	O
(	O
_rl_mark_modified_lines	int
&&	O
current_history	function
(	O
)	O
&&	O
rl_undo_list	pointer
)	O
{	O
line	pointer
[	O
out	int
++	O
]	O
=	O
'*'	O
;	O
line	pointer
[	O
out	int
]	O
=	O
'\0'	O
;	O
modmark	int
=	O
1	int
;	O
}	O
if	O
(	O
visible_line	O
[	O
0	int
]	O
!=	O
invisible_line	O
[	O
0	int
]	O
)	O
rl_display_fixed	int
=	O
0	int
;	O
if	O
(	O
rl_display_prompt	pointer
==	O
rl_prompt	pointer
||	O
local_prompt	pointer
)	O
{	O
if	O
(	O
local_prompt_prefix	pointer
&&	O
forced_display	int
)	O
_rl_output_some_chars	function
(	O
local_prompt_prefix	pointer
,	O
strlen	function
(	O
local_prompt_prefix	pointer
)	O
)	O
;	O
if	O
(	O
local_prompt_len	int
>	O
0	int
)	O
{	O
temp	int
=	O
local_prompt_len	int
+	O
out	int
+	O
2	int
;	O
if	O
(	O
temp	int
>=	O
line_size	int
)	O
{	O
line_size	int
=	O
(	O
temp	int
+	O
1024	int
)	O
-	O
(	O
temp	int
%	O
1024	int
)	O
;	O
visible_line	O
=	O
(	O
char	O
*	O
)	O
xrealloc	function
(	O
visible_line	O
,	O
line_size	int
)	O
;	O
line	pointer
=	O
invisible_line	O
=	O
(	O
char	O
*	O
)	O
xrealloc	function
(	O
invisible_line	O
,	O
line_size	int
)	O
;	O
}	O
strncpy	function
(	O
line	pointer
+	O
out	int
,	O
local_prompt	pointer
,	O
local_prompt_len	int
)	O
;	O
out	int
+=	O
local_prompt_len	int
;	O
}	O
line	pointer
[	O
out	int
]	O
=	O
'\0'	O
;	O
wrap_offset	int
=	O
local_prompt_len	int
-	O
prompt_visible_length	int
;	O
}	O
else	O
{	O
int	O
pmtlen	int
;	O
prompt_this_line	pointer
=	O
strrchr	function
(	O
rl_display_prompt	pointer
,	O
'\n'	O
)	O
;	O
if	O
(	O
!	O
prompt_this_line	pointer
)	O
prompt_this_line	pointer
=	O
rl_display_prompt	pointer
;	O
else	O
{	O
prompt_this_line	pointer
++	O
;	O
pmtlen	int
=	O
prompt_this_line	pointer
-	O
rl_display_prompt	pointer
;	O
if	O
(	O
forced_display	int
)	O
{	O
_rl_output_some_chars	function
(	O
rl_display_prompt	pointer
,	O
pmtlen	int
)	O
;	O
if	O
(	O
pmtlen	int
<	O
2	int
||	O
prompt_this_line	pointer
[	O
-	O
2	int
]	O
!=	O
'\r'	O
)	O
cr	function
(	O
)	O
;	O
}	O
}	O
prompt_physical_chars	int
=	O
pmtlen	int
=	O
strlen	function
(	O
prompt_this_line	pointer
)	O
;	O
temp	int
=	O
pmtlen	int
+	O
out	int
+	O
2	int
;	O
if	O
(	O
temp	int
>=	O
line_size	int
)	O
{	O
line_size	int
=	O
(	O
temp	int
+	O
1024	int
)	O
-	O
(	O
temp	int
%	O
1024	int
)	O
;	O
visible_line	O
=	O
(	O
char	O
*	O
)	O
xrealloc	function
(	O
visible_line	O
,	O
line_size	int
)	O
;	O
line	pointer
=	O
invisible_line	O
=	O
(	O
char	O
*	O
)	O
xrealloc	function
(	O
invisible_line	O
,	O
line_size	int
)	O
;	O
}	O
strncpy	function
(	O
line	pointer
+	O
out	int
,	O
prompt_this_line	pointer
,	O
pmtlen	int
)	O
;	O
out	int
+=	O
pmtlen	int
;	O
line	pointer
[	O
out	int
]	O
=	O
'\0'	O
;	O
wrap_offset	int
=	O
prompt_invis_chars_first_line	int
=	O
0	int
;	O
}	O
inv_lbreaks	O
[	O
newlines	int
=	O
0	int
]	O
=	O
0	int
;	O
lpos	int
=	O
prompt_physical_chars	int
+	O
modmark	int
;	O
memset	function
(	O
line_state_invisible	pointer
->	O
wrapped_line	pointer
,	O
0	int
,	O
line_state_invisible	pointer
->	O
wbsize	int
*	O
sizeof	O
(	O
int	O
)	O
)	O
;	O
num	int
=	O
0	int
;	O
prompt_lines_estimate	int
=	O
lpos	int
/	O
_rl_screenwidth	int
;	O
while	O
(	O
lpos	int
>=	O
_rl_screenwidth	int
)	O
{	O
int	O
z	int
,	O
p	pointer
;	O
int	O
nocorrect	int
,	O
wadjust	int
;	O
nocorrect	int
=	O
0	int
;	O
wadjust	int
=	O
(	O
newlines	int
==	O
0	int
)	O
?	O
prompt_invis_chars_first_line	int
:	O
(	O
(	O
newlines	int
==	O
prompt_lines_estimate	int
)	O
?	O
wrap_offset	int
:	O
prompt_invis_chars_first_line	int
)	O
;	O
if	O
(	O
mb_cur_max	int
>	O
1	int
&&	O
rl_byte_oriented	int
==	O
0	int
&&	O
prompt_multibyte_chars	int
>	O
0	int
)	O
{	O
nocorrect	int
=	O
1	int
;	O
n0	int
=	O
num	int
;	O
temp	int
=	O
local_prompt_len	int
;	O
while	O
(	O
num	int
<	O
temp	int
)	O
{	O
z	int
=	O
_rl_col_width	function
(	O
local_prompt	pointer
,	O
n0	int
,	O
num	int
,	O
1	int
)	O
-	O
wadjust	int
;	O
if	O
(	O
z	int
>	O
_rl_screenwidth	int
)	O
{	O
num	int
=	O
_rl_find_prev_mbchar	function
(	O
local_prompt	pointer
,	O
num	int
,	O
MB_FIND_ANY	int
)	O
;	O
break	O
;	O
}	O
else	O
if	O
(	O
z	int
==	O
_rl_screenwidth	int
)	O
{	O
p	pointer
=	O
_rl_find_prev_mbchar	function
(	O
local_prompt	pointer
,	O
num	int
,	O
MB_FIND_ANY	int
)	O
;	O
num	int
=	O
_rl_find_next_mbchar	function
(	O
local_prompt	pointer
,	O
p	pointer
,	O
1	int
,	O
MB_FIND_ANY	int
)	O
;	O
break	O
;	O
}	O
num	int
++	O
;	O
}	O
temp	int
=	O
num	int
;	O
}	O
else	O
temp	int
=	O
(	O
(	O
newlines	int
+	O
1	int
)	O
*	O
_rl_screenwidth	int
)	O
;	O
if	O
(	O
nocorrect	int
==	O
0	int
)	O
temp	int
+=	O
wadjust	int
;	O
inv_lbreaks	O
[	O
++	O
newlines	int
]	O
=	O
temp	int
;	O
if	O
(	O
mb_cur_max	int
>	O
1	int
&&	O
rl_byte_oriented	int
==	O
0	int
&&	O
prompt_multibyte_chars	int
>	O
0	int
)	O
lpos	int
-=	O
_rl_col_width	function
(	O
local_prompt	pointer
,	O
n0	int
,	O
num	int
,	O
1	int
)	O
-	O
wadjust	int
;	O
else	O
lpos	int
-=	O
_rl_screenwidth	int
;	O
}	O
prompt_last_screen_line	int
=	O
newlines	int
;	O
lb_linenum	int
=	O
0	int
;	O
in	int
=	O
0	int
;	O
if	O
(	O
mb_cur_max	int
>	O
1	int
&&	O
rl_byte_oriented	int
==	O
0	int
)	O
{	O
memset	function
(	O
&	O
ps	struct
,	O
0	int
,	O
sizeof	O
(	O
mbstate_t	struct
)	O
)	O
;	O
wc_bytes	long
=	O
mbrtowc	function
(	O
&	O
wc	int
,	O
rl_line_buffer	pointer
,	O
rl_end	int
,	O
&	O
ps	struct
)	O
;	O
}	O
else	O
wc_bytes	long
=	O
1	int
;	O
while	O
(	O
in	int
<	O
rl_end	int
)	O
{	O
c	int
=	O
(	O
unsigned	O
char	O
)	O
rl_line_buffer	pointer
[	O
in	int
]	O
;	O
if	O
(	O
mb_cur_max	int
>	O
1	int
&&	O
rl_byte_oriented	int
==	O
0	int
)	O
{	O
if	O
(	O
MB_INVALIDCH	O
(	O
wc_bytes	long
)	O
)	O
{	O
wc_bytes	long
=	O
1	int
;	O
wc_width	int
=	O
1	int
;	O
memset	function
(	O
&	O
ps	struct
,	O
0	int
,	O
sizeof	O
(	O
mbstate_t	struct
)	O
)	O
;	O
}	O
else	O
if	O
(	O
MB_NULLWCH	O
(	O
wc_bytes	long
)	O
)	O
break	O
;	O
else	O
{	O
temp	int
=	O
WCWIDTH	O
(	O
wc	int
)	O
;	O
wc_width	int
=	O
(	O
temp	int
>=	O
0	int
)	O
?	O
temp	int
:	O
1	int
;	O
}	O
}	O
if	O
(	O
out	int
+	O
8	int
>=	O
line_size	int
)	O
{	O
line_size	int
*=	O
2	int
;	O
visible_line	O
=	O
(	O
char	O
*	O
)	O
xrealloc	function
(	O
visible_line	O
,	O
line_size	int
)	O
;	O
invisible_line	O
=	O
(	O
char	O
*	O
)	O
xrealloc	function
(	O
invisible_line	O
,	O
line_size	int
)	O
;	O
line	pointer
=	O
invisible_line	O
;	O
}	O
if	O
(	O
in	int
==	O
rl_point	int
)	O
{	O
cpos_buffer_position	int
=	O
out	int
;	O
lb_linenum	int
=	O
newlines	int
;	O
}	O
if	O
(	O
META_CHAR	O
(	O
c	int
)	O
&&	O
_rl_output_meta_chars	int
==	O
0	int
)	O
{	O
if	O
(	O
_rl_output_meta_chars	int
==	O
0	int
)	O
{	O
sprintf	function
(	O
line	pointer
+	O
out	int
,	O
"\\%o"	pointer
,	O
c	int
)	O
;	O
if	O
(	O
lpos	int
+	O
4	int
>=	O
_rl_screenwidth	int
)	O
{	O
temp	int
=	O
_rl_screenwidth	int
-	O
lpos	int
;	O
CHECK_INV_LBREAKS	O
(	O
)	O
;	O
inv_lbreaks	O
[	O
++	O
newlines	int
]	O
=	O
out	int
+	O
temp	int
;	O
lpos	int
=	O
4	int
-	O
temp	int
;	O
}	O
else	O
lpos	int
+=	O
4	int
;	O
out	int
+=	O
4	int
;	O
}	O
else	O
{	O
line	pointer
[	O
out	int
++	O
]	O
=	O
c	int
;	O
CHECK_LPOS	O
(	O
)	O
;	O
}	O
}	O
else	O
if	O
(	O
c	int
==	O
'\t'	O
)	O
{	O
register	O
int	O
newout	int
;	O
newout	int
=	O
out	int
+	O
8	int
-	O
lpos	int
%	O
8	int
;	O
temp	int
=	O
newout	int
-	O
out	int
;	O
if	O
(	O
lpos	int
+	O
temp	int
>=	O
_rl_screenwidth	int
)	O
{	O
register	O
int	O
temp2	int
;	O
temp2	int
=	O
_rl_screenwidth	int
-	O
lpos	int
;	O
CHECK_INV_LBREAKS	O
(	O
)	O
;	O
inv_lbreaks	O
[	O
++	O
newlines	int
]	O
=	O
out	int
+	O
temp2	int
;	O
lpos	int
=	O
temp	int
-	O
temp2	int
;	O
while	O
(	O
out	int
<	O
newout	int
)	O
line	pointer
[	O
out	int
++	O
]	O
=	O
' '	O
;	O
}	O
else	O
{	O
while	O
(	O
out	int
<	O
newout	int
)	O
line	pointer
[	O
out	int
++	O
]	O
=	O
' '	O
;	O
lpos	int
+=	O
temp	int
;	O
}	O
}	O
else	O
if	O
(	O
c	int
==	O
'\n'	O
&&	O
_rl_horizontal_scroll_mode	int
==	O
0	int
&&	O
_rl_term_up	pointer
&&	O
*	O
_rl_term_up	pointer
)	O
{	O
line	pointer
[	O
out	int
++	O
]	O
=	O
'\0'	O
;	O
CHECK_INV_LBREAKS	O
(	O
)	O
;	O
inv_lbreaks	O
[	O
++	O
newlines	int
]	O
=	O
out	int
;	O
lpos	int
=	O
0	int
;	O
}	O
else	O
if	O
(	O
CTRL_CHAR	O
(	O
c	int
)	O
||	O
c	int
==	O
RUBOUT	int
)	O
{	O
line	pointer
[	O
out	int
++	O
]	O
=	O
'^'	O
;	O
CHECK_LPOS	O
(	O
)	O
;	O
line	pointer
[	O
out	int
++	O
]	O
=	O
CTRL_CHAR	O
(	O
c	int
)	O
?	O
UNCTRL	O
(	O
c	int
)	O
:	O
'?'	O
;	O
CHECK_LPOS	O
(	O
)	O
;	O
}	O
else	O
{	O
if	O
(	O
mb_cur_max	int
>	O
1	int
&&	O
rl_byte_oriented	int
==	O
0	int
)	O
{	O
register	O
int	O
i	int
;	O
_rl_wrapped_multicolumn	int
=	O
0	int
;	O
if	O
(	O
_rl_screenwidth	int
<	O
lpos	int
+	O
wc_width	int
)	O
for	O
(	O
i	int
=	O
lpos	int
;	O
i	int
<	O
_rl_screenwidth	int
;	O
i	int
++	O
)	O
{	O
line	pointer
[	O
out	int
++	O
]	O
=	O
' '	O
;	O
_rl_wrapped_multicolumn	int
++	O
;	O
CHECK_LPOS	O
(	O
)	O
;	O
}	O
if	O
(	O
in	int
==	O
rl_point	int
)	O
{	O
cpos_buffer_position	int
=	O
out	int
;	O
lb_linenum	int
=	O
newlines	int
;	O
}	O
for	O
(	O
i	int
=	O
in	int
;	O
i	int
<	O
in	int
+	O
wc_bytes	long
;	O
i	int
++	O
)	O
line	pointer
[	O
out	int
++	O
]	O
=	O
rl_line_buffer	pointer
[	O
i	int
]	O
;	O
for	O
(	O
i	int
=	O
0	int
;	O
i	int
<	O
wc_width	int
;	O
i	int
++	O
)	O
CHECK_LPOS	O
(	O
)	O
;	O
}	O
else	O
{	O
line	pointer
[	O
out	int
++	O
]	O
=	O
c	int
;	O
CHECK_LPOS	O
(	O
)	O
;	O
}	O
}	O
if	O
(	O
mb_cur_max	int
>	O
1	int
&&	O
rl_byte_oriented	int
==	O
0	int
)	O
{	O
in	int
+=	O
wc_bytes	long
;	O
wc_bytes	long
=	O
mbrtowc	function
(	O
&	O
wc	int
,	O
rl_line_buffer	pointer
+	O
in	int
,	O
rl_end	int
-	O
in	int
,	O
&	O
ps	struct
)	O
;	O
}	O
else	O
in	int
++	O
;	O
}	O
line	pointer
[	O
out	int
]	O
=	O
'\0'	O
;	O
if	O
(	O
cpos_buffer_position	int
<	O
0	int
)	O
{	O
cpos_buffer_position	int
=	O
out	int
;	O
lb_linenum	int
=	O
newlines	int
;	O
}	O
inv_botlin	int
=	O
lb_botlin	int
=	O
_rl_inv_botlin	int
=	O
newlines	int
;	O
CHECK_INV_LBREAKS	O
(	O
)	O
;	O
inv_lbreaks	O
[	O
newlines	int
+	O
1	int
]	O
=	O
out	int
;	O
cursor_linenum	int
=	O
lb_linenum	int
;	O
displaying_prompt_first_line	int
=	O
1	int
;	O
if	O
(	O
_rl_horizontal_scroll_mode	int
==	O
0	int
&&	O
_rl_term_up	pointer
&&	O
*	O
_rl_term_up	pointer
)	O
{	O
int	O
nleft	int
,	O
pos	int
,	O
changed_screen_line	int
,	O
tx	int
;	O
if	O
(	O
!	O
rl_display_fixed	int
||	O
forced_display	int
)	O
{	O
forced_display	int
=	O
0	int
;	O
if	O
(	O
out	int
>=	O
_rl_screenchars	int
)	O
{	O
if	O
(	O
mb_cur_max	int
>	O
1	int
&&	O
rl_byte_oriented	int
==	O
0	int
)	O
out	int
=	O
_rl_find_prev_mbchar	function
(	O
line	pointer
,	O
_rl_screenchars	int
,	O
MB_FIND_ANY	int
)	O
;	O
else	O
out	int
=	O
_rl_screenchars	int
-	O
1	int
;	O
}	O
for	O
(	O
linenum	int
=	O
0	int
;	O
linenum	int
<=	O
inv_botlin	int
;	O
linenum	int
++	O
)	O
{	O
o_cpos	int
=	O
_rl_last_c_pos	int
;	O
cpos_adjusted	int
=	O
0	int
;	O
update_line	function
(	O
VIS_LINE	O
(	O
linenum	int
)	O
,	O
INV_LINE	O
(	O
linenum	int
)	O
,	O
linenum	int
,	O
VIS_LLEN	O
(	O
linenum	int
)	O
,	O
INV_LLEN	O
(	O
linenum	int
)	O
,	O
inv_botlin	int
)	O
;	O
if	O
(	O
linenum	int
==	O
0	int
&&	O
(	O
mb_cur_max	int
>	O
1	int
&&	O
rl_byte_oriented	int
==	O
0	int
)	O
&&	O
OLD_CPOS_IN_PROMPT	O
(	O
)	O
)	O
_rl_last_c_pos	int
-=	O
prompt_invis_chars_first_line	int
;	O
else	O
if	O
(	O
linenum	int
==	O
prompt_last_screen_line	int
&&	O
prompt_physical_chars	int
>	O
_rl_screenwidth	int
&&	O
(	O
mb_cur_max	int
>	O
1	int
&&	O
rl_byte_oriented	int
==	O
0	int
)	O
&&	O
cpos_adjusted	int
==	O
0	int
&&	O
_rl_last_c_pos	int
!=	O
o_cpos	int
&&	O
_rl_last_c_pos	int
>	O
(	O
prompt_last_invisible	int
-	O
_rl_screenwidth	int
-	O
prompt_invis_chars_first_line	int
)	O
)	O
_rl_last_c_pos	int
-=	O
(	O
wrap_offset	int
-	O
prompt_invis_chars_first_line	int
)	O
;	O
if	O
(	O
linenum	int
==	O
0	int
&&	O
inv_botlin	int
==	O
0	int
&&	O
_rl_last_c_pos	int
==	O
out	int
&&	O
(	O
wrap_offset	int
>	O
visible_wrap_offset	int
)	O
&&	O
(	O
_rl_last_c_pos	int
<	O
visible_first_line_len	int
)	O
)	O
{	O
if	O
(	O
mb_cur_max	int
>	O
1	int
&&	O
rl_byte_oriented	int
==	O
0	int
)	O
nleft	int
=	O
_rl_screenwidth	int
-	O
_rl_last_c_pos	int
;	O
else	O
nleft	int
=	O
_rl_screenwidth	int
+	O
wrap_offset	int
-	O
_rl_last_c_pos	int
;	O
if	O
(	O
nleft	int
)	O
_rl_clear_to_eol	function
(	O
nleft	int
)	O
;	O
}	O
if	O
(	O
linenum	int
==	O
0	int
)	O
visible_first_line_len	int
=	O
(	O
inv_botlin	int
>	O
0	int
)	O
?	O
inv_lbreaks	O
[	O
1	int
]	O
:	O
out	int
-	O
wrap_offset	int
;	O
}	O
if	O
(	O
_rl_vis_botlin	int
>	O
inv_botlin	int
)	O
{	O
char	O
*	O
tt	pointer
;	O
for	O
(	O
;	O
linenum	int
<=	O
_rl_vis_botlin	int
;	O
linenum	int
++	O
)	O
{	O
tt	pointer
=	O
VIS_CHARS	O
(	O
linenum	int
)	O
;	O
_rl_move_vert	function
(	O
linenum	int
)	O
;	O
_rl_move_cursor_relative	function
(	O
0	int
,	O
tt	pointer
)	O
;	O
_rl_clear_to_eol	function
(	O
(	O
linenum	int
==	O
_rl_vis_botlin	int
)	O
?	O
strlen	function
(	O
tt	pointer
)	O
:	O
_rl_screenwidth	int
)	O
;	O
}	O
}	O
_rl_vis_botlin	int
=	O
inv_botlin	int
;	O
changed_screen_line	int
=	O
_rl_last_v_pos	int
!=	O
cursor_linenum	int
;	O
if	O
(	O
changed_screen_line	int
)	O
{	O
_rl_move_vert	function
(	O
cursor_linenum	int
)	O
;	O
if	O
(	O
(	O
mb_cur_max	int
==	O
1	int
||	O
rl_byte_oriented	int
)	O
&&	O
cursor_linenum	int
==	O
0	int
&&	O
wrap_offset	int
)	O
_rl_last_c_pos	int
+=	O
wrap_offset	int
;	O
}	O
nleft	int
=	O
prompt_visible_length	int
+	O
wrap_offset	int
;	O
if	O
(	O
cursor_linenum	int
==	O
0	int
&&	O
wrap_offset	int
>	O
0	int
&&	O
_rl_last_c_pos	int
>	O
0	int
&&	O
_rl_last_c_pos	int
<	O
PROMPT_ENDING_INDEX	O
&&	O
local_prompt	pointer
)	O
{	O
if	O
(	O
_rl_term_cr	pointer
)	O
tputs	function
(	O
_rl_term_cr	pointer
,	O
1	int
,	O
_rl_output_character_function	function
)	O
;	O
if	O
(	O
modmark	int
)	O
_rl_output_some_chars	function
(	O
"*"	pointer
,	O
1	int
)	O
;	O
_rl_output_some_chars	function
(	O
local_prompt	pointer
,	O
nleft	int
)	O
;	O
if	O
(	O
mb_cur_max	int
>	O
1	int
&&	O
rl_byte_oriented	int
==	O
0	int
)	O
_rl_last_c_pos	int
=	O
_rl_col_width	function
(	O
local_prompt	pointer
,	O
0	int
,	O
nleft	int
,	O
1	int
)	O
-	O
wrap_offset	int
+	O
modmark	int
;	O
else	O
_rl_last_c_pos	int
=	O
nleft	int
+	O
modmark	int
;	O
}	O
pos	int
=	O
inv_lbreaks	O
[	O
cursor_linenum	int
]	O
;	O
nleft	int
=	O
cpos_buffer_position	int
-	O
pos	int
;	O
if	O
(	O
wrap_offset	int
&&	O
cursor_linenum	int
==	O
0	int
&&	O
nleft	int
<	O
_rl_last_c_pos	int
)	O
{	O
if	O
(	O
mb_cur_max	int
>	O
1	int
&&	O
rl_byte_oriented	int
==	O
0	int
)	O
tx	int
=	O
_rl_col_width	function
(	O
&	O
visible_line	O
[	O
pos	int
]	O
,	O
0	int
,	O
nleft	int
,	O
1	int
)	O
-	O
visible_wrap_offset	int
;	O
else	O
tx	int
=	O
nleft	int
;	O
if	O
(	O
tx	int
>=	O
0	int
&&	O
_rl_last_c_pos	int
>	O
tx	int
)	O
{	O
_rl_backspace	function
(	O
_rl_last_c_pos	int
-	O
tx	int
)	O
;	O
_rl_last_c_pos	int
=	O
tx	int
;	O
}	O
}	O
if	O
(	O
mb_cur_max	int
>	O
1	int
&&	O
rl_byte_oriented	int
==	O
0	int
)	O
_rl_move_cursor_relative	function
(	O
nleft	int
,	O
&	O
invisible_line	O
[	O
pos	int
]	O
)	O
;	O
else	O
if	O
(	O
nleft	int
!=	O
_rl_last_c_pos	int
)	O
_rl_move_cursor_relative	function
(	O
nleft	int
,	O
&	O
invisible_line	O
[	O
pos	int
]	O
)	O
;	O
}	O
}	O
else	O
{	O
int	O
lmargin	int
,	O
ndisp	int
,	O
nleft	int
,	O
phys_c_pos	int
,	O
t	pointer
;	O
_rl_last_v_pos	int
=	O
0	int
;	O
ndisp	int
=	O
cpos_buffer_position	int
-	O
wrap_offset	int
;	O
nleft	int
=	O
prompt_visible_length	int
+	O
wrap_offset	int
;	O
phys_c_pos	int
=	O
cpos_buffer_position	int
-	O
(	O
last_lmargin	int
?	O
last_lmargin	int
:	O
wrap_offset	int
)	O
;	O
t	pointer
=	O
_rl_screenwidth	int
/	O
3	int
;	O
if	O
(	O
phys_c_pos	int
>	O
_rl_screenwidth	int
-	O
2	int
)	O
{	O
lmargin	int
=	O
cpos_buffer_position	int
-	O
(	O
2	int
*	O
t	pointer
)	O
;	O
if	O
(	O
lmargin	int
<	O
0	int
)	O
lmargin	int
=	O
0	int
;	O
if	O
(	O
wrap_offset	int
&&	O
lmargin	int
>	O
0	int
&&	O
lmargin	int
<	O
nleft	int
)	O
lmargin	int
=	O
nleft	int
;	O
}	O
else	O
if	O
(	O
ndisp	int
<	O
_rl_screenwidth	int
-	O
2	int
)	O
lmargin	int
=	O
0	int
;	O
else	O
if	O
(	O
phys_c_pos	int
<	O
1	int
)	O
{	O
lmargin	int
=	O
(	O
(	O
cpos_buffer_position	int
-	O
1	int
)	O
/	O
t	pointer
)	O
*	O
t	pointer
;	O
if	O
(	O
wrap_offset	int
&&	O
lmargin	int
>	O
0	int
&&	O
lmargin	int
<	O
nleft	int
)	O
lmargin	int
=	O
nleft	int
;	O
}	O
else	O
lmargin	int
=	O
last_lmargin	int
;	O
displaying_prompt_first_line	int
=	O
lmargin	int
<	O
nleft	int
;	O
if	O
(	O
lmargin	int
>	O
0	int
)	O
line	pointer
[	O
lmargin	int
]	O
=	O
'<'	O
;	O
t	pointer
=	O
lmargin	int
+	O
M_OFFSET	O
(	O
lmargin	int
,	O
wrap_offset	int
)	O
+	O
_rl_screenwidth	int
;	O
if	O
(	O
t	pointer
<	O
out	int
)	O
line	pointer
[	O
t	pointer
-	O
1	int
]	O
=	O
'>'	O
;	O
if	O
(	O
rl_display_fixed	int
==	O
0	int
||	O
forced_display	int
||	O
lmargin	int
!=	O
last_lmargin	int
)	O
{	O
forced_display	int
=	O
0	int
;	O
o_cpos	int
=	O
_rl_last_c_pos	int
;	O
cpos_adjusted	int
=	O
0	int
;	O
update_line	function
(	O
&	O
visible_line	O
[	O
last_lmargin	int
]	O
,	O
&	O
invisible_line	O
[	O
lmargin	int
]	O
,	O
0	int
,	O
_rl_screenwidth	int
+	O
visible_wrap_offset	int
,	O
_rl_screenwidth	int
+	O
(	O
lmargin	int
?	O
0	int
:	O
wrap_offset	int
)	O
,	O
0	int
)	O
;	O
if	O
(	O
(	O
mb_cur_max	int
>	O
1	int
&&	O
rl_byte_oriented	int
==	O
0	int
)	O
&&	O
displaying_prompt_first_line	int
&&	O
OLD_CPOS_IN_PROMPT	O
(	O
)	O
)	O
_rl_last_c_pos	int
-=	O
prompt_invis_chars_first_line	int
;	O
t	pointer
=	O
_rl_last_c_pos	int
-	O
M_OFFSET	O
(	O
lmargin	int
,	O
wrap_offset	int
)	O
;	O
if	O
(	O
(	O
M_OFFSET	O
(	O
lmargin	int
,	O
wrap_offset	int
)	O
>	O
visible_wrap_offset	int
)	O
&&	O
(	O
_rl_last_c_pos	int
==	O
out	int
)	O
&&	O
displaying_prompt_first_line	int
&&	O
t	pointer
<	O
visible_first_line_len	int
)	O
{	O
nleft	int
=	O
_rl_screenwidth	int
-	O
t	pointer
;	O
_rl_clear_to_eol	function
(	O
nleft	int
)	O
;	O
}	O
visible_first_line_len	int
=	O
out	int
-	O
lmargin	int
-	O
M_OFFSET	O
(	O
lmargin	int
,	O
wrap_offset	int
)	O
;	O
if	O
(	O
visible_first_line_len	int
>	O
_rl_screenwidth	int
)	O
visible_first_line_len	int
=	O
_rl_screenwidth	int
;	O
_rl_move_cursor_relative	function
(	O
cpos_buffer_position	int
-	O
lmargin	int
,	O
&	O
invisible_line	O
[	O
lmargin	int
]	O
)	O
;	O
last_lmargin	int
=	O
lmargin	int
;	O
}	O
}	O
fflush	function
(	O
rl_outstream	pointer
)	O
;	O
{	O
struct	O
line_state	struct
*	O
vtemp	pointer
=	O
line_state_visible	pointer
;	O
line_state_visible	pointer
=	O
line_state_invisible	pointer
;	O
line_state_invisible	pointer
=	O
vtemp	pointer
;	O
rl_display_fixed	int
=	O
0	int
;	O
if	O
(	O
_rl_horizontal_scroll_mode	int
&&	O
last_lmargin	int
)	O
visible_wrap_offset	int
=	O
0	int
;	O
else	O
visible_wrap_offset	int
=	O
wrap_offset	int
;	O
}	O
RL_UNSETSTATE	O
(	O
RL_STATE_REDISPLAYING	int
)	O
;	O
_rl_release_sigint	function
(	O
)	O
;	O
}	O
static	O
void	O
update_line	function
(	O
old	pointer
,	O
new	pointer
,	O
current_line	int
,	O
omax	int
,	O
nmax	int
,	O
inv_botlin	int
)	O
register	O
char	O
*	O
old	pointer
,	O
*	O
new	pointer
;	O
int	O
current_line	int
,	O
omax	int
,	O
nmax	int
,	O
inv_botlin	int
;	O
{	O
register	O
char	O
*	O
ofd	pointer
,	O
*	O
ols	pointer
,	O
*	O
oe	pointer
,	O
*	O
nfd	pointer
,	O
*	O
nls	pointer
,	O
*	O
ne	pointer
;	O
int	O
temp	int
,	O
lendiff	int
,	O
wsatend	int
,	O
od	int
,	O
nd	int
,	O
twidth	int
,	O
o_cpos	int
;	O
int	O
current_invis_chars	int
;	O
int	O
col_lendiff	int
,	O
col_temp	int
;	O
int	O
bytes_to_insert	int
;	O
int	O
mb_cur_max	int
=	O
MB_CUR_MAX	O
;	O
mbstate_t	struct
ps_new	struct
,	O
ps_old	struct
;	O
int	O
new_offset	int
,	O
old_offset	int
;	O
if	O
(	O
mb_cur_max	int
>	O
1	int
&&	O
rl_byte_oriented	int
==	O
0	int
)	O
temp	int
=	O
_rl_last_c_pos	int
;	O
else	O
temp	int
=	O
_rl_last_c_pos	int
-	O
WRAP_OFFSET	O
(	O
_rl_last_v_pos	int
,	O
visible_wrap_offset	int
)	O
;	O
if	O
(	O
temp	int
==	O
_rl_screenwidth	int
&&	O
_rl_term_autowrap	int
&&	O
!	O
_rl_horizontal_scroll_mode	int
&&	O
_rl_last_v_pos	int
==	O
current_line	int
-	O
1	int
)	O
{	O
if	O
(	O
mb_cur_max	int
>	O
1	int
&&	O
rl_byte_oriented	int
==	O
0	int
)	O
{	O
wchar_t	int
wc	int
;	O
mbstate_t	struct
ps	struct
;	O
int	O
tempwidth	int
,	O
bytes	int
;	O
size_t	long
ret	pointer
;	O
if	O
(	O
current_line	int
<	O
line_state_visible	pointer
->	O
wbsize	int
&&	O
line_state_visible	pointer
->	O
wrapped_line	pointer
[	O
current_line	int
]	O
>	O
0	int
)	O
_rl_clear_to_eol	function
(	O
line_state_visible	pointer
->	O
wrapped_line	pointer
[	O
current_line	int
]	O
)	O
;	O
memset	function
(	O
&	O
ps	struct
,	O
0	int
,	O
sizeof	O
(	O
mbstate_t	struct
)	O
)	O
;	O
ret	pointer
=	O
mbrtowc	function
(	O
&	O
wc	int
,	O
new	pointer
,	O
mb_cur_max	int
,	O
&	O
ps	struct
)	O
;	O
if	O
(	O
MB_INVALIDCH	O
(	O
ret	pointer
)	O
)	O
{	O
tempwidth	int
=	O
1	int
;	O
ret	pointer
=	O
1	int
;	O
}	O
else	O
if	O
(	O
MB_NULLWCH	O
(	O
ret	pointer
)	O
)	O
tempwidth	int
=	O
0	int
;	O
else	O
tempwidth	int
=	O
WCWIDTH	O
(	O
wc	int
)	O
;	O
if	O
(	O
tempwidth	int
>	O
0	int
)	O
{	O
int	O
count	int
,	O
i	int
;	O
bytes	int
=	O
ret	pointer
;	O
for	O
(	O
count	int
=	O
0	int
;	O
count	int
<	O
bytes	int
;	O
count	int
++	O
)	O
putc	function
(	O
new	pointer
[	O
count	int
]	O
,	O
rl_outstream	pointer
)	O
;	O
_rl_last_c_pos	int
=	O
tempwidth	int
;	O
_rl_last_v_pos	int
++	O
;	O
memset	function
(	O
&	O
ps	struct
,	O
0	int
,	O
sizeof	O
(	O
mbstate_t	struct
)	O
)	O
;	O
ret	pointer
=	O
mbrtowc	function
(	O
&	O
wc	int
,	O
old	pointer
,	O
mb_cur_max	int
,	O
&	O
ps	struct
)	O
;	O
if	O
(	O
ret	pointer
!=	O
0	int
&&	O
bytes	int
!=	O
0	int
)	O
{	O
if	O
(	O
MB_INVALIDCH	O
(	O
ret	pointer
)	O
)	O
ret	pointer
=	O
1	int
;	O
memmove	function
(	O
old	pointer
+	O
bytes	int
,	O
old	pointer
+	O
ret	pointer
,	O
strlen	function
(	O
old	pointer
+	O
ret	pointer
)	O
)	O
;	O
memcpy	function
(	O
old	pointer
,	O
new	pointer
,	O
bytes	int
)	O
;	O
omax	int
+=	O
bytes	int
-	O
ret	pointer
;	O
for	O
(	O
i	int
=	O
current_line	int
+	O
1	int
;	O
i	int
<=	O
inv_botlin	int
+	O
1	int
;	O
i	int
++	O
)	O
vis_lbreaks	O
[	O
i	int
]	O
+=	O
bytes	int
-	O
ret	pointer
;	O
}	O
}	O
else	O
{	O
putc	function
(	O
' '	O
,	O
rl_outstream	pointer
)	O
;	O
_rl_last_c_pos	int
=	O
1	int
;	O
_rl_last_v_pos	int
++	O
;	O
if	O
(	O
old	pointer
[	O
0	int
]	O
&&	O
new	pointer
[	O
0	int
]	O
)	O
old	pointer
[	O
0	int
]	O
=	O
new	pointer
[	O
0	int
]	O
;	O
}	O
}	O
else	O
{	O
if	O
(	O
new	pointer
[	O
0	int
]	O
)	O
putc	function
(	O
new	pointer
[	O
0	int
]	O
,	O
rl_outstream	pointer
)	O
;	O
else	O
putc	function
(	O
' '	O
,	O
rl_outstream	pointer
)	O
;	O
_rl_last_c_pos	int
=	O
1	int
;	O
_rl_last_v_pos	int
++	O
;	O
if	O
(	O
old	pointer
[	O
0	int
]	O
&&	O
new	pointer
[	O
0	int
]	O
)	O
old	pointer
[	O
0	int
]	O
=	O
new	pointer
[	O
0	int
]	O
;	O
}	O
}	O
if	O
(	O
mb_cur_max	int
>	O
1	int
&&	O
rl_byte_oriented	int
==	O
0	int
)	O
{	O
temp	int
=	O
(	O
omax	int
<	O
nmax	int
)	O
?	O
omax	int
:	O
nmax	int
;	O
if	O
(	O
memcmp	function
(	O
old	pointer
,	O
new	pointer
,	O
temp	int
)	O
==	O
0	int
)	O
{	O
new_offset	int
=	O
old_offset	int
=	O
temp	int
;	O
ofd	pointer
=	O
old	pointer
+	O
temp	int
;	O
nfd	pointer
=	O
new	pointer
+	O
temp	int
;	O
}	O
else	O
{	O
memset	function
(	O
&	O
ps_new	struct
,	O
0	int
,	O
sizeof	O
(	O
mbstate_t	struct
)	O
)	O
;	O
memset	function
(	O
&	O
ps_old	struct
,	O
0	int
,	O
sizeof	O
(	O
mbstate_t	struct
)	O
)	O
;	O
if	O
(	O
omax	int
==	O
nmax	int
&&	O
STREQN	O
(	O
new	pointer
,	O
old	pointer
,	O
omax	int
)	O
)	O
{	O
old_offset	int
=	O
omax	int
;	O
new_offset	int
=	O
nmax	int
;	O
ofd	pointer
=	O
old	pointer
+	O
omax	int
;	O
nfd	pointer
=	O
new	pointer
+	O
nmax	int
;	O
}	O
else	O
{	O
new_offset	int
=	O
old_offset	int
=	O
0	int
;	O
for	O
(	O
ofd	pointer
=	O
old	pointer
,	O
nfd	pointer
=	O
new	pointer
;	O
(	O
ofd	pointer
-	O
old	pointer
<	O
omax	int
)	O
&&	O
*	O
ofd	pointer
&&	O
_rl_compare_chars	function
(	O
old	pointer
,	O
old_offset	int
,	O
&	O
ps_old	struct
,	O
new	pointer
,	O
new_offset	int
,	O
&	O
ps_new	struct
)	O
;	O
)	O
{	O
old_offset	int
=	O
_rl_find_next_mbchar	function
(	O
old	pointer
,	O
old_offset	int
,	O
1	int
,	O
MB_FIND_ANY	int
)	O
;	O
new_offset	int
=	O
_rl_find_next_mbchar	function
(	O
new	pointer
,	O
new_offset	int
,	O
1	int
,	O
MB_FIND_ANY	int
)	O
;	O
ofd	pointer
=	O
old	pointer
+	O
old_offset	int
;	O
nfd	pointer
=	O
new	pointer
+	O
new_offset	int
;	O
}	O
}	O
}	O
}	O
else	O
for	O
(	O
ofd	pointer
=	O
old	pointer
,	O
nfd	pointer
=	O
new	pointer
;	O
(	O
ofd	pointer
-	O
old	pointer
<	O
omax	int
)	O
&&	O
*	O
ofd	pointer
&&	O
(	O
*	O
ofd	pointer
==	O
*	O
nfd	pointer
)	O
;	O
ofd	pointer
++	O
,	O
nfd	pointer
++	O
)	O
;	O
for	O
(	O
od	int
=	O
ofd	pointer
-	O
old	pointer
,	O
oe	pointer
=	O
ofd	pointer
;	O
od	int
<	O
omax	int
&&	O
*	O
oe	pointer
;	O
oe	pointer
++	O
,	O
od	int
++	O
)	O
;	O
for	O
(	O
nd	int
=	O
nfd	pointer
-	O
new	pointer
,	O
ne	pointer
=	O
nfd	pointer
;	O
nd	int
<	O
nmax	int
&&	O
*	O
ne	pointer
;	O
ne	pointer
++	O
,	O
nd	int
++	O
)	O
;	O
if	O
(	O
ofd	pointer
==	O
oe	pointer
&&	O
nfd	pointer
==	O
ne	pointer
)	O
return	O
;	O
if	O
(	O
mb_cur_max	int
>	O
1	int
&&	O
rl_byte_oriented	int
==	O
0	int
&&	O
_rl_utf8locale	int
)	O
{	O
wchar_t	int
wc	int
;	O
mbstate_t	struct
ps	struct
=	O
{	O
0	int
}	O
;	O
int	O
t	pointer
;	O
t	pointer
=	O
mbrtowc	function
(	O
&	O
wc	int
,	O
ofd	pointer
,	O
mb_cur_max	int
,	O
&	O
ps	struct
)	O
;	O
if	O
(	O
t	pointer
>	O
0	int
&&	O
UNICODE_COMBINING_CHAR	O
(	O
wc	int
)	O
&&	O
WCWIDTH	O
(	O
wc	int
)	O
==	O
0	int
)	O
{	O
old_offset	int
=	O
_rl_find_prev_mbchar	function
(	O
old	pointer
,	O
ofd	pointer
-	O
old	pointer
,	O
MB_FIND_ANY	int
)	O
;	O
new_offset	int
=	O
_rl_find_prev_mbchar	function
(	O
new	pointer
,	O
nfd	pointer
-	O
new	pointer
,	O
MB_FIND_ANY	int
)	O
;	O
ofd	pointer
=	O
old	pointer
+	O
old_offset	int
;	O
nfd	pointer
=	O
new	pointer
+	O
new_offset	int
;	O
}	O
}	O
wsatend	int
=	O
1	int
;	O
if	O
(	O
mb_cur_max	int
>	O
1	int
&&	O
rl_byte_oriented	int
==	O
0	int
)	O
{	O
ols	pointer
=	O
old	pointer
+	O
_rl_find_prev_mbchar	function
(	O
old	pointer
,	O
oe	pointer
-	O
old	pointer
,	O
MB_FIND_ANY	int
)	O
;	O
nls	pointer
=	O
new	pointer
+	O
_rl_find_prev_mbchar	function
(	O
new	pointer
,	O
ne	pointer
-	O
new	pointer
,	O
MB_FIND_ANY	int
)	O
;	O
while	O
(	O
(	O
ols	pointer
>	O
ofd	pointer
)	O
&&	O
(	O
nls	pointer
>	O
nfd	pointer
)	O
)	O
{	O
memset	function
(	O
&	O
ps_old	struct
,	O
0	int
,	O
sizeof	O
(	O
mbstate_t	struct
)	O
)	O
;	O
memset	function
(	O
&	O
ps_new	struct
,	O
0	int
,	O
sizeof	O
(	O
mbstate_t	struct
)	O
)	O
;	O
if	O
(	O
_rl_compare_chars	function
(	O
old	pointer
,	O
ols	pointer
-	O
old	pointer
,	O
&	O
ps_old	struct
,	O
new	pointer
,	O
nls	pointer
-	O
new	pointer
,	O
&	O
ps_new	struct
)	O
==	O
0	int
)	O
break	O
;	O
if	O
(	O
*	O
ols	pointer
==	O
' '	O
)	O
wsatend	int
=	O
0	int
;	O
ols	pointer
=	O
old	pointer
+	O
_rl_find_prev_mbchar	function
(	O
old	pointer
,	O
ols	pointer
-	O
old	pointer
,	O
MB_FIND_ANY	int
)	O
;	O
nls	pointer
=	O
new	pointer
+	O
_rl_find_prev_mbchar	function
(	O
new	pointer
,	O
nls	pointer
-	O
new	pointer
,	O
MB_FIND_ANY	int
)	O
;	O
}	O
}	O
else	O
{	O
ols	pointer
=	O
oe	pointer
-	O
1	int
;	O
nls	pointer
=	O
ne	pointer
-	O
1	int
;	O
while	O
(	O
(	O
ols	pointer
>	O
ofd	pointer
)	O
&&	O
(	O
nls	pointer
>	O
nfd	pointer
)	O
&&	O
(	O
*	O
ols	pointer
==	O
*	O
nls	pointer
)	O
)	O
{	O
if	O
(	O
*	O
ols	pointer
!=	O
' '	O
)	O
wsatend	int
=	O
0	int
;	O
ols	pointer
--	O
;	O
nls	pointer
--	O
;	O
}	O
}	O
if	O
(	O
wsatend	int
)	O
{	O
ols	pointer
=	O
oe	pointer
;	O
nls	pointer
=	O
ne	pointer
;	O
}	O
else	O
if	O
(	O
_rl_compare_chars	function
(	O
ols	pointer
,	O
0	int
,	O
NULL	O
,	O
nls	pointer
,	O
0	int
,	O
NULL	O
)	O
==	O
0	int
)	O
{	O
if	O
(	O
*	O
ols	pointer
)	O
{	O
if	O
(	O
mb_cur_max	int
>	O
1	int
&&	O
rl_byte_oriented	int
==	O
0	int
)	O
ols	pointer
=	O
old	pointer
+	O
_rl_find_next_mbchar	function
(	O
old	pointer
,	O
ols	pointer
-	O
old	pointer
,	O
1	int
,	O
MB_FIND_ANY	int
)	O
;	O
else	O
ols	pointer
++	O
;	O
}	O
if	O
(	O
*	O
nls	pointer
)	O
{	O
if	O
(	O
mb_cur_max	int
>	O
1	int
&&	O
rl_byte_oriented	int
==	O
0	int
)	O
nls	pointer
=	O
new	pointer
+	O
_rl_find_next_mbchar	function
(	O
new	pointer
,	O
nls	pointer
-	O
new	pointer
,	O
1	int
,	O
MB_FIND_ANY	int
)	O
;	O
else	O
nls	pointer
++	O
;	O
}	O
}	O
current_invis_chars	int
=	O
W_OFFSET	O
(	O
current_line	int
,	O
wrap_offset	int
)	O
;	O
if	O
(	O
_rl_last_v_pos	int
!=	O
current_line	int
)	O
{	O
_rl_move_vert	function
(	O
current_line	int
)	O
;	O
if	O
(	O
current_line	int
==	O
0	int
)	O
visible_wrap_offset	int
=	O
prompt_invis_chars_first_line	int
;	O
if	O
(	O
(	O
mb_cur_max	int
==	O
1	int
||	O
rl_byte_oriented	int
)	O
&&	O
current_line	int
==	O
0	int
&&	O
visible_wrap_offset	int
)	O
_rl_last_c_pos	int
+=	O
visible_wrap_offset	int
;	O
}	O
lendiff	int
=	O
local_prompt_len	int
;	O
if	O
(	O
lendiff	int
>	O
nmax	int
)	O
lendiff	int
=	O
nmax	int
;	O
od	int
=	O
ofd	pointer
-	O
old	pointer
;	O
nd	int
=	O
nfd	pointer
-	O
new	pointer
;	O
if	O
(	O
current_line	int
==	O
0	int
&&	O
!	O
_rl_horizontal_scroll_mode	int
&&	O
_rl_term_cr	pointer
&&	O
lendiff	int
>	O
prompt_visible_length	int
&&	O
_rl_last_c_pos	int
>	O
0	int
&&	O
(	O
(	O
(	O
od	int
>	O
0	int
||	O
nd	int
>	O
0	int
)	O
&&	O
(	O
od	int
<=	O
prompt_last_invisible	int
||	O
nd	int
<=	O
prompt_last_invisible	int
)	O
)	O
||	O
(	O
(	O
od	int
>=	O
lendiff	int
)	O
&&	O
_rl_last_c_pos	int
<	O
PROMPT_ENDING_INDEX	O
)	O
)	O
)	O
{	O
tputs	function
(	O
_rl_term_cr	pointer
,	O
1	int
,	O
_rl_output_character_function	function
)	O
;	O
if	O
(	O
modmark	int
)	O
_rl_output_some_chars	function
(	O
"*"	pointer
,	O
1	int
)	O
;	O
_rl_output_some_chars	function
(	O
local_prompt	pointer
,	O
lendiff	int
)	O
;	O
if	O
(	O
mb_cur_max	int
>	O
1	int
&&	O
rl_byte_oriented	int
==	O
0	int
)	O
{	O
_rl_last_c_pos	int
=	O
_rl_col_width	function
(	O
local_prompt	pointer
,	O
0	int
,	O
lendiff	int
,	O
1	int
)	O
-	O
wrap_offset	int
+	O
modmark	int
;	O
cpos_adjusted	int
=	O
1	int
;	O
}	O
else	O
_rl_last_c_pos	int
=	O
lendiff	int
+	O
modmark	int
;	O
if	O
(	O
(	O
od	int
<=	O
prompt_last_invisible	int
||	O
nd	int
<=	O
prompt_last_invisible	int
)	O
&&	O
omax	int
==	O
nmax	int
&&	O
lendiff	int
>	O
(	O
ols	pointer
-	O
old	pointer
)	O
&&	O
lendiff	int
>	O
(	O
nls	pointer
-	O
new	pointer
)	O
)	O
return	O
;	O
if	O
(	O
(	O
od	int
<=	O
prompt_last_invisible	int
||	O
nd	int
<=	O
prompt_last_invisible	int
)	O
)	O
{	O
nfd	pointer
=	O
new	pointer
+	O
lendiff	int
;	O
nd	int
=	O
lendiff	int
;	O
temp	int
=	O
ne	pointer
-	O
nfd	pointer
;	O
if	O
(	O
temp	int
>	O
0	int
)	O
{	O
_rl_output_some_chars	function
(	O
nfd	pointer
,	O
temp	int
)	O
;	O
if	O
(	O
mb_cur_max	int
>	O
1	int
&&	O
rl_byte_oriented	int
==	O
0	int
)	O
_rl_last_c_pos	int
+=	O
_rl_col_width	function
(	O
new	pointer
,	O
nd	int
,	O
ne	pointer
-	O
new	pointer
,	O
1	int
)	O
;	O
else	O
_rl_last_c_pos	int
+=	O
temp	int
;	O
}	O
if	O
(	O
nmax	int
<	O
omax	int
)	O
goto	O
clear_rest_of_line	O
;	O
else	O
return	O
;	O
}	O
}	O
o_cpos	int
=	O
_rl_last_c_pos	int
;	O
_rl_move_cursor_relative	function
(	O
od	int
,	O
old	pointer
)	O
;	O
if	O
(	O
current_line	int
==	O
0	int
&&	O
mb_cur_max	int
>	O
1	int
&&	O
rl_byte_oriented	int
==	O
0	int
&&	O
(	O
_rl_last_c_pos	int
>	O
0	int
||	O
o_cpos	int
>	O
0	int
)	O
&&	O
_rl_last_c_pos	int
==	O
prompt_physical_chars	int
)	O
cpos_adjusted	int
=	O
1	int
;	O
lendiff	int
=	O
(	O
nls	pointer
-	O
nfd	pointer
)	O
-	O
(	O
ols	pointer
-	O
ofd	pointer
)	O
;	O
if	O
(	O
mb_cur_max	int
>	O
1	int
&&	O
rl_byte_oriented	int
==	O
0	int
)	O
col_lendiff	int
=	O
_rl_col_width	function
(	O
new	pointer
,	O
nfd	pointer
-	O
new	pointer
,	O
nls	pointer
-	O
new	pointer
,	O
1	int
)	O
-	O
_rl_col_width	function
(	O
old	pointer
,	O
ofd	pointer
-	O
old	pointer
,	O
ols	pointer
-	O
old	pointer
,	O
1	int
)	O
;	O
else	O
col_lendiff	int
=	O
lendiff	int
;	O
if	O
(	O
current_line	int
==	O
0	int
&&	O
current_invis_chars	int
!=	O
visible_wrap_offset	int
)	O
{	O
if	O
(	O
mb_cur_max	int
>	O
1	int
&&	O
rl_byte_oriented	int
==	O
0	int
)	O
{	O
lendiff	int
+=	O
visible_wrap_offset	int
-	O
current_invis_chars	int
;	O
col_lendiff	int
+=	O
visible_wrap_offset	int
-	O
current_invis_chars	int
;	O
}	O
else	O
{	O
lendiff	int
+=	O
visible_wrap_offset	int
-	O
current_invis_chars	int
;	O
col_lendiff	int
=	O
lendiff	int
;	O
}	O
}	O
temp	int
=	O
ne	pointer
-	O
nfd	pointer
;	O
if	O
(	O
mb_cur_max	int
>	O
1	int
&&	O
rl_byte_oriented	int
==	O
0	int
)	O
col_temp	int
=	O
_rl_col_width	function
(	O
new	pointer
,	O
nfd	pointer
-	O
new	pointer
,	O
ne	pointer
-	O
new	pointer
,	O
1	int
)	O
;	O
else	O
col_temp	int
=	O
temp	int
;	O
bytes_to_insert	int
=	O
nls	pointer
-	O
nfd	pointer
;	O
if	O
(	O
col_lendiff	int
>	O
0	int
)	O
{	O
int	O
gl	int
=	O
current_line	int
>=	O
_rl_vis_botlin	int
&&	O
inv_botlin	int
>	O
_rl_vis_botlin	int
;	O
if	O
(	O
lendiff	int
<	O
0	int
)	O
{	O
_rl_output_some_chars	function
(	O
nfd	pointer
,	O
temp	int
)	O
;	O
_rl_last_c_pos	int
+=	O
col_temp	int
;	O
if	O
(	O
current_line	int
==	O
0	int
&&	O
displaying_prompt_first_line	int
&&	O
wrap_offset	int
&&	O
(	O
(	O
nfd	pointer
-	O
new	pointer
)	O
<=	O
prompt_last_invisible	int
)	O
)	O
{	O
_rl_last_c_pos	int
-=	O
wrap_offset	int
;	O
cpos_adjusted	int
=	O
1	int
;	O
}	O
return	O
;	O
}	O
else	O
if	O
(	O
_rl_terminal_can_insert	int
&&	O
(	O
(	O
2	int
*	O
col_temp	int
)	O
>=	O
col_lendiff	int
||	O
_rl_term_IC	pointer
)	O
&&	O
(	O
!	O
_rl_term_autowrap	int
||	O
!	O
gl	int
)	O
)	O
{	O
if	O
(	O
*	O
ols	pointer
&&	O
(	O
(	O
_rl_horizontal_scroll_mode	int
&&	O
_rl_last_c_pos	int
==	O
0	int
&&	O
lendiff	int
>	O
prompt_visible_length	int
&&	O
current_invis_chars	int
>	O
0	int
)	O
==	O
0	int
)	O
&&	O
(	O
(	O
(	O
mb_cur_max	int
>	O
1	int
&&	O
rl_byte_oriented	int
==	O
0	int
)	O
&&	O
current_line	int
==	O
0	int
&&	O
wrap_offset	int
&&	O
(	O
(	O
nfd	pointer
-	O
new	pointer
)	O
<=	O
prompt_last_invisible	int
)	O
&&	O
(	O
col_lendiff	int
<	O
prompt_visible_length	int
)	O
)	O
==	O
0	int
)	O
&&	O
(	O
visible_wrap_offset	int
>=	O
current_invis_chars	int
)	O
)	O
{	O
open_some_spaces	function
(	O
col_lendiff	int
)	O
;	O
_rl_output_some_chars	function
(	O
nfd	pointer
,	O
bytes_to_insert	int
)	O
;	O
if	O
(	O
mb_cur_max	int
>	O
1	int
&&	O
rl_byte_oriented	int
==	O
0	int
)	O
_rl_last_c_pos	int
+=	O
_rl_col_width	function
(	O
nfd	pointer
,	O
0	int
,	O
bytes_to_insert	int
,	O
1	int
)	O
;	O
else	O
_rl_last_c_pos	int
+=	O
bytes_to_insert	int
;	O
}	O
else	O
if	O
(	O
(	O
mb_cur_max	int
==	O
1	int
||	O
rl_byte_oriented	int
!=	O
0	int
)	O
&&	O
*	O
ols	pointer
==	O
0	int
&&	O
lendiff	int
>	O
0	int
)	O
{	O
_rl_output_some_chars	function
(	O
nfd	pointer
,	O
temp	int
)	O
;	O
_rl_last_c_pos	int
+=	O
col_temp	int
;	O
return	O
;	O
}	O
else	O
{	O
_rl_output_some_chars	function
(	O
nfd	pointer
,	O
temp	int
)	O
;	O
_rl_last_c_pos	int
+=	O
col_temp	int
;	O
if	O
(	O
(	O
mb_cur_max	int
>	O
1	int
&&	O
rl_byte_oriented	int
==	O
0	int
)	O
&&	O
current_line	int
==	O
0	int
&&	O
displaying_prompt_first_line	int
&&	O
wrap_offset	int
&&	O
(	O
(	O
nfd	pointer
-	O
new	pointer
)	O
<=	O
prompt_last_invisible	int
)	O
)	O
{	O
_rl_last_c_pos	int
-=	O
wrap_offset	int
;	O
cpos_adjusted	int
=	O
1	int
;	O
}	O
return	O
;	O
}	O
if	O
(	O
bytes_to_insert	int
>	O
lendiff	int
)	O
{	O
if	O
(	O
(	O
mb_cur_max	int
>	O
1	int
&&	O
rl_byte_oriented	int
==	O
0	int
)	O
&&	O
current_line	int
==	O
0	int
&&	O
displaying_prompt_first_line	int
&&	O
wrap_offset	int
&&	O
(	O
(	O
nfd	pointer
-	O
new	pointer
)	O
<=	O
prompt_last_invisible	int
)	O
)	O
{	O
_rl_last_c_pos	int
-=	O
wrap_offset	int
;	O
cpos_adjusted	int
=	O
1	int
;	O
}	O
}	O
}	O
else	O
{	O
_rl_output_some_chars	function
(	O
nfd	pointer
,	O
temp	int
)	O
;	O
_rl_last_c_pos	int
+=	O
col_temp	int
;	O
if	O
(	O
(	O
mb_cur_max	int
>	O
1	int
&&	O
rl_byte_oriented	int
==	O
0	int
)	O
&&	O
current_line	int
==	O
prompt_last_screen_line	int
&&	O
wrap_offset	int
&&	O
displaying_prompt_first_line	int
&&	O
wrap_offset	int
!=	O
prompt_invis_chars_first_line	int
&&	O
(	O
(	O
nfd	pointer
-	O
new	pointer
)	O
<	O
(	O
prompt_last_invisible	int
-	O
(	O
current_line	int
*	O
_rl_screenwidth	int
+	O
prompt_invis_chars_first_line	int
)	O
)	O
)	O
)	O
{	O
_rl_last_c_pos	int
-=	O
wrap_offset	int
-	O
prompt_invis_chars_first_line	int
;	O
cpos_adjusted	int
=	O
1	int
;	O
}	O
}	O
}	O
else	O
{	O
if	O
(	O
_rl_term_dc	pointer
&&	O
(	O
2	int
*	O
col_temp	int
)	O
>=	O
-	O
col_lendiff	int
)	O
{	O
if	O
(	O
_rl_horizontal_scroll_mode	int
&&	O
_rl_last_c_pos	int
==	O
0	int
&&	O
displaying_prompt_first_line	int
&&	O
-	O
lendiff	int
==	O
visible_wrap_offset	int
)	O
col_lendiff	int
=	O
0	int
;	O
if	O
(	O
_rl_horizontal_scroll_mode	int
&&	O
displaying_prompt_first_line	int
==	O
0	int
&&	O
col_lendiff	int
&&	O
_rl_last_c_pos	int
<	O
-	O
col_lendiff	int
)	O
col_lendiff	int
=	O
0	int
;	O
if	O
(	O
col_lendiff	int
)	O
delete_chars	function
(	O
-	O
col_lendiff	int
)	O
;	O
if	O
(	O
bytes_to_insert	int
>	O
0	int
)	O
{	O
_rl_output_some_chars	function
(	O
nfd	pointer
,	O
bytes_to_insert	int
)	O
;	O
if	O
(	O
mb_cur_max	int
>	O
1	int
&&	O
rl_byte_oriented	int
==	O
0	int
)	O
{	O
_rl_last_c_pos	int
+=	O
_rl_col_width	function
(	O
nfd	pointer
,	O
0	int
,	O
bytes_to_insert	int
,	O
1	int
)	O
;	O
if	O
(	O
current_line	int
==	O
0	int
&&	O
wrap_offset	int
&&	O
displaying_prompt_first_line	int
&&	O
_rl_last_c_pos	int
>	O
wrap_offset	int
&&	O
(	O
(	O
nfd	pointer
-	O
new	pointer
)	O
<=	O
prompt_last_invisible	int
)	O
)	O
{	O
_rl_last_c_pos	int
-=	O
wrap_offset	int
;	O
cpos_adjusted	int
=	O
1	int
;	O
}	O
}	O
else	O
_rl_last_c_pos	int
+=	O
bytes_to_insert	int
;	O
if	O
(	O
_rl_horizontal_scroll_mode	int
&&	O
(	O
(	O
oe	pointer
-	O
old	pointer
)	O
>	O
(	O
ne	pointer
-	O
new	pointer
)	O
)	O
)	O
{	O
_rl_move_cursor_relative	function
(	O
ne	pointer
-	O
new	pointer
,	O
new	pointer
)	O
;	O
goto	O
clear_rest_of_line	O
;	O
}	O
}	O
}	O
else	O
{	O
if	O
(	O
temp	int
>	O
0	int
)	O
{	O
_rl_output_some_chars	function
(	O
nfd	pointer
,	O
temp	int
)	O
;	O
_rl_last_c_pos	int
+=	O
col_temp	int
;	O
if	O
(	O
mb_cur_max	int
>	O
1	int
&&	O
rl_byte_oriented	int
==	O
0	int
)	O
{	O
if	O
(	O
current_line	int
==	O
0	int
&&	O
wrap_offset	int
&&	O
displaying_prompt_first_line	int
&&	O
_rl_last_c_pos	int
>	O
wrap_offset	int
&&	O
(	O
(	O
nfd	pointer
-	O
new	pointer
)	O
<=	O
prompt_last_invisible	int
)	O
)	O
{	O
_rl_last_c_pos	int
-=	O
wrap_offset	int
;	O
cpos_adjusted	int
=	O
1	int
;	O
}	O
}	O
}	O
clear_rest_of_line	O
:	O
lendiff	int
=	O
(	O
oe	pointer
-	O
old	pointer
)	O
-	O
(	O
ne	pointer
-	O
new	pointer
)	O
;	O
if	O
(	O
mb_cur_max	int
>	O
1	int
&&	O
rl_byte_oriented	int
==	O
0	int
)	O
col_lendiff	int
=	O
_rl_col_width	function
(	O
old	pointer
,	O
0	int
,	O
oe	pointer
-	O
old	pointer
,	O
1	int
)	O
-	O
_rl_col_width	function
(	O
new	pointer
,	O
0	int
,	O
ne	pointer
-	O
new	pointer
,	O
1	int
)	O
;	O
else	O
col_lendiff	int
=	O
lendiff	int
;	O
if	O
(	O
col_lendiff	int
&&	O
(	O
(	O
mb_cur_max	int
==	O
1	int
||	O
rl_byte_oriented	int
)	O
||	O
(	O
_rl_last_c_pos	int
<	O
_rl_screenwidth	int
)	O
)	O
)	O
{	O
if	O
(	O
_rl_term_autowrap	int
&&	O
current_line	int
<	O
inv_botlin	int
)	O
space_to_eol	function
(	O
col_lendiff	int
)	O
;	O
else	O
_rl_clear_to_eol	function
(	O
col_lendiff	int
)	O
;	O
}	O
}	O
}	O
}	O
int	O
rl_on_new_line	function
(	O
)	O
{	O
if	O
(	O
visible_line	O
)	O
visible_line	O
[	O
0	int
]	O
=	O
'\0'	O
;	O
_rl_last_c_pos	int
=	O
_rl_last_v_pos	int
=	O
0	int
;	O
_rl_vis_botlin	int
=	O
last_lmargin	int
=	O
0	int
;	O
if	O
(	O
vis_lbreaks	O
)	O
vis_lbreaks	O
[	O
0	int
]	O
=	O
vis_lbreaks	O
[	O
1	int
]	O
=	O
0	int
;	O
visible_wrap_offset	int
=	O
0	int
;	O
return	O
0	int
;	O
}	O
int	O
rl_clear_visible_line	function
(	O
)	O
{	O
int	O
curr_line	int
;	O
tputs	function
(	O
_rl_term_cr	pointer
,	O
1	int
,	O
_rl_output_character_function	function
)	O
;	O
_rl_last_c_pos	int
=	O
0	int
;	O
_rl_move_vert	function
(	O
_rl_vis_botlin	int
)	O
;	O
for	O
(	O
curr_line	int
=	O
_rl_last_v_pos	int
;	O
curr_line	int
>=	O
0	int
;	O
curr_line	int
--	O
)	O
{	O
_rl_move_vert	function
(	O
curr_line	int
)	O
;	O
_rl_clear_to_eol	function
(	O
0	int
)	O
;	O
}	O
return	O
0	int
;	O
}	O
int	O
rl_on_new_line_with_prompt	function
(	O
)	O
{	O
int	O
prompt_size	int
,	O
i	int
,	O
l	int
,	O
real_screenwidth	int
,	O
newlines	int
;	O
char	O
*	O
prompt_last_line	pointer
,	O
*	O
lprompt	pointer
;	O
prompt_size	int
=	O
strlen	function
(	O
rl_prompt	pointer
)	O
+	O
1	int
;	O
init_line_structures	function
(	O
prompt_size	int
)	O
;	O
lprompt	pointer
=	O
local_prompt	pointer
?	O
local_prompt	pointer
:	O
rl_prompt	pointer
;	O
strcpy	function
(	O
visible_line	O
,	O
lprompt	pointer
)	O
;	O
strcpy	function
(	O
invisible_line	O
,	O
lprompt	pointer
)	O
;	O
prompt_last_line	pointer
=	O
strrchr	function
(	O
rl_prompt	pointer
,	O
'\n'	O
)	O
;	O
if	O
(	O
!	O
prompt_last_line	pointer
)	O
prompt_last_line	pointer
=	O
rl_prompt	pointer
;	O
l	int
=	O
strlen	function
(	O
prompt_last_line	pointer
)	O
;	O
if	O
(	O
MB_CUR_MAX	O
>	O
1	int
&&	O
rl_byte_oriented	int
==	O
0	int
)	O
_rl_last_c_pos	int
=	O
_rl_col_width	function
(	O
prompt_last_line	pointer
,	O
0	int
,	O
l	int
,	O
1	int
)	O
;	O
else	O
_rl_last_c_pos	int
=	O
l	int
;	O
real_screenwidth	int
=	O
_rl_screenwidth	int
+	O
(	O
_rl_term_autowrap	int
?	O
0	int
:	O
1	int
)	O
;	O
_rl_last_v_pos	int
=	O
l	int
/	O
real_screenwidth	int
;	O
if	O
(	O
l	int
>	O
0	int
&&	O
(	O
l	int
%	O
real_screenwidth	int
)	O
==	O
0	int
)	O
_rl_output_some_chars	function
(	O
"\n"	pointer
,	O
1	int
)	O
;	O
last_lmargin	int
=	O
0	int
;	O
newlines	int
=	O
0	int
;	O
i	int
=	O
0	int
;	O
while	O
(	O
i	int
<=	O
l	int
)	O
{	O
_rl_vis_botlin	int
=	O
newlines	int
;	O
vis_lbreaks	O
[	O
newlines	int
++	O
]	O
=	O
i	int
;	O
i	int
+=	O
real_screenwidth	int
;	O
}	O
vis_lbreaks	O
[	O
newlines	int
]	O
=	O
l	int
;	O
visible_wrap_offset	int
=	O
0	int
;	O
rl_display_prompt	pointer
=	O
rl_prompt	pointer
;	O
return	O
0	int
;	O
}	O
int	O
rl_forced_update_display	function
(	O
)	O
{	O
register	O
char	O
*	O
temp	int
;	O
if	O
(	O
visible_line	O
)	O
{	O
temp	int
=	O
visible_line	O
;	O
while	O
(	O
*	O
temp	int
)	O
*	O
temp	int
++	O
=	O
'\0'	O
;	O
}	O
rl_on_new_line	function
(	O
)	O
;	O
forced_display	int
++	O
;	O
(	O
*	O
rl_redisplay_function	pointer
)	O
(	O
)	O
;	O
return	O
0	int
;	O
}	O
void	O
rl_redraw_prompt_last_line	function
(	O
)	O
{	O
char	O
*	O
t	pointer
;	O
t	pointer
=	O
strrchr	function
(	O
rl_display_prompt	pointer
,	O
'\n'	O
)	O
;	O
if	O
(	O
t	pointer
)	O
redraw_prompt	function
(	O
++	O
t	pointer
)	O
;	O
else	O
rl_forced_update_display	function
(	O
)	O
;	O
}	O
void	O
_rl_move_cursor_relative	function
(	O
new	pointer
,	O
data	pointer
)	O
int	O
new	pointer
;	O
const	O
char	O
*	O
data	pointer
;	O
{	O
register	O
int	O
i	int
;	O
int	O
woff	int
;	O
int	O
cpos	int
,	O
dpos	int
;	O
int	O
adjust	int
;	O
int	O
in_invisline	int
;	O
int	O
mb_cur_max	int
=	O
MB_CUR_MAX	O
;	O
woff	int
=	O
WRAP_OFFSET	O
(	O
_rl_last_v_pos	int
,	O
wrap_offset	int
)	O
;	O
cpos	int
=	O
_rl_last_c_pos	int
;	O
if	O
(	O
cpos	int
==	O
0	int
&&	O
cpos	int
==	O
new	pointer
)	O
return	O
;	O
if	O
(	O
mb_cur_max	int
>	O
1	int
&&	O
rl_byte_oriented	int
==	O
0	int
)	O
{	O
adjust	int
=	O
1	int
;	O
if	O
(	O
new	pointer
==	O
local_prompt_len	int
&&	O
memcmp	function
(	O
data	pointer
,	O
local_prompt	pointer
,	O
new	pointer
)	O
==	O
0	int
)	O
{	O
dpos	int
=	O
prompt_physical_chars	int
;	O
cpos_adjusted	int
=	O
1	int
;	O
adjust	int
=	O
0	int
;	O
}	O
else	O
if	O
(	O
new	pointer
>	O
local_prompt_len	int
&&	O
local_prompt	pointer
&&	O
memcmp	function
(	O
data	pointer
,	O
local_prompt	pointer
,	O
local_prompt_len	int
)	O
==	O
0	int
)	O
{	O
dpos	int
=	O
prompt_physical_chars	int
+	O
_rl_col_width	function
(	O
data	pointer
,	O
local_prompt_len	int
,	O
new	pointer
,	O
1	int
)	O
;	O
cpos_adjusted	int
=	O
1	int
;	O
adjust	int
=	O
0	int
;	O
}	O
else	O
dpos	int
=	O
_rl_col_width	function
(	O
data	pointer
,	O
0	int
,	O
new	pointer
,	O
1	int
)	O
;	O
if	O
(	O
displaying_prompt_first_line	int
==	O
0	int
)	O
adjust	int
=	O
0	int
;	O
in_invisline	int
=	O
0	int
;	O
if	O
(	O
data	pointer
>	O
invisible_line	O
&&	O
data	pointer
<	O
invisible_line	O
+	O
inv_lbreaks	O
[	O
_rl_inv_botlin	int
+	O
1	int
]	O
)	O
in_invisline	int
=	O
data	pointer
-	O
invisible_line	O
;	O
if	O
(	O
adjust	int
&&	O
(	O
(	O
new	pointer
>	O
prompt_last_invisible	int
)	O
||	O
(	O
new	pointer
+	O
in_invisline	int
>	O
prompt_last_invisible	int
)	O
||	O
(	O
prompt_physical_chars	int
>=	O
_rl_screenwidth	int
&&	O
_rl_last_v_pos	int
==	O
prompt_last_screen_line	int
&&	O
wrap_offset	int
>=	O
woff	int
&&	O
dpos	int
>=	O
woff	int
&&	O
new	pointer
>	O
(	O
prompt_last_invisible	int
-	O
(	O
vis_lbreaks	O
[	O
_rl_last_v_pos	int
]	O
)	O
-	O
wrap_offset	int
)	O
)	O
)	O
)	O
{	O
dpos	int
-=	O
woff	int
;	O
cpos_adjusted	int
=	O
1	int
;	O
}	O
}	O
else	O
dpos	int
=	O
new	pointer
;	O
if	O
(	O
cpos	int
==	O
dpos	int
)	O
return	O
;	O
if	O
(	O
mb_cur_max	int
>	O
1	int
&&	O
rl_byte_oriented	int
==	O
0	int
)	O
i	int
=	O
_rl_last_c_pos	int
;	O
else	O
i	int
=	O
_rl_last_c_pos	int
-	O
woff	int
;	O
if	O
(	O
dpos	int
==	O
0	int
||	O
CR_FASTER	O
(	O
dpos	int
,	O
_rl_last_c_pos	int
)	O
||	O
(	O
_rl_term_autowrap	int
&&	O
i	int
==	O
_rl_screenwidth	int
)	O
)	O
{	O
tputs	function
(	O
_rl_term_cr	pointer
,	O
1	int
,	O
_rl_output_character_function	function
)	O
;	O
cpos	int
=	O
_rl_last_c_pos	int
=	O
0	int
;	O
}	O
if	O
(	O
cpos	int
<	O
dpos	int
)	O
{	O
if	O
(	O
mb_cur_max	int
>	O
1	int
&&	O
rl_byte_oriented	int
==	O
0	int
)	O
{	O
if	O
(	O
_rl_term_forward_char	pointer
)	O
{	O
for	O
(	O
i	int
=	O
cpos	int
;	O
i	int
<	O
dpos	int
;	O
i	int
++	O
)	O
tputs	function
(	O
_rl_term_forward_char	pointer
,	O
1	int
,	O
_rl_output_character_function	function
)	O
;	O
}	O
else	O
{	O
tputs	function
(	O
_rl_term_cr	pointer
,	O
1	int
,	O
_rl_output_character_function	function
)	O
;	O
for	O
(	O
i	int
=	O
0	int
;	O
i	int
<	O
new	pointer
;	O
i	int
++	O
)	O
putc	function
(	O
data	pointer
[	O
i	int
]	O
,	O
rl_outstream	pointer
)	O
;	O
}	O
}	O
else	O
for	O
(	O
i	int
=	O
cpos	int
;	O
i	int
<	O
new	pointer
;	O
i	int
++	O
)	O
putc	function
(	O
data	pointer
[	O
i	int
]	O
,	O
rl_outstream	pointer
)	O
;	O
}	O
else	O
if	O
(	O
cpos	int
>	O
dpos	int
)	O
_rl_backspace	function
(	O
cpos	int
-	O
dpos	int
)	O
;	O
_rl_last_c_pos	int
=	O
dpos	int
;	O
}	O
void	O
_rl_move_vert	function
(	O
to	int
)	O
int	O
to	int
;	O
{	O
register	O
int	O
delta	int
,	O
i	int
;	O
if	O
(	O
_rl_last_v_pos	int
==	O
to	int
||	O
to	int
>	O
_rl_screenheight	int
)	O
return	O
;	O
if	O
(	O
(	O
delta	int
=	O
to	int
-	O
_rl_last_v_pos	int
)	O
>	O
0	int
)	O
{	O
for	O
(	O
i	int
=	O
0	int
;	O
i	int
<	O
delta	int
;	O
i	int
++	O
)	O
putc	function
(	O
'\n'	O
,	O
rl_outstream	pointer
)	O
;	O
tputs	function
(	O
_rl_term_cr	pointer
,	O
1	int
,	O
_rl_output_character_function	function
)	O
;	O
_rl_last_c_pos	int
=	O
0	int
;	O
}	O
else	O
{	O
if	O
(	O
_rl_term_up	pointer
&&	O
*	O
_rl_term_up	pointer
)	O
for	O
(	O
i	int
=	O
0	int
;	O
i	int
<	O
-	O
delta	int
;	O
i	int
++	O
)	O
tputs	function
(	O
_rl_term_up	pointer
,	O
1	int
,	O
_rl_output_character_function	function
)	O
;	O
}	O
_rl_last_v_pos	int
=	O
to	int
;	O
}	O
int	O
rl_show_char	function
(	O
c	int
)	O
int	O
c	int
;	O
{	O
int	O
n	int
=	O
1	int
;	O
if	O
(	O
META_CHAR	O
(	O
c	int
)	O
&&	O
(	O
_rl_output_meta_chars	int
==	O
0	int
)	O
)	O
{	O
fprintf	function
(	O
rl_outstream	pointer
,	O
"M-"	pointer
)	O
;	O
n	int
+=	O
2	int
;	O
c	int
=	O
UNMETA	O
(	O
c	int
)	O
;	O
}	O
if	O
(	O
(	O
CTRL_CHAR	O
(	O
c	int
)	O
&&	O
c	int
!=	O
'\t'	O
)	O
||	O
c	int
==	O
RUBOUT	int
)	O
{	O
fprintf	function
(	O
rl_outstream	pointer
,	O
"C-"	pointer
)	O
;	O
n	int
+=	O
2	int
;	O
c	int
=	O
CTRL_CHAR	O
(	O
c	int
)	O
?	O
UNCTRL	O
(	O
c	int
)	O
:	O
'?'	O
;	O
}	O
putc	function
(	O
c	int
,	O
rl_outstream	pointer
)	O
;	O
fflush	function
(	O
rl_outstream	pointer
)	O
;	O
return	O
n	int
;	O
}	O
int	O
rl_character_len	function
(	O
c	int
,	O
pos	int
)	O
register	O
int	O
c	int
,	O
pos	int
;	O
{	O
unsigned	O
char	O
uc	char
;	O
uc	char
=	O
(	O
unsigned	O
char	O
)	O
c	int
;	O
if	O
(	O
META_CHAR	O
(	O
uc	char
)	O
)	O
return	O
(	O
(	O
_rl_output_meta_chars	int
==	O
0	int
)	O
?	O
4	int
:	O
1	int
)	O
;	O
if	O
(	O
uc	char
==	O
'\t'	O
)	O
{	O
return	O
(	O
(	O
(	O
pos	int
|	O
7	int
)	O
+	O
1	int
)	O
-	O
pos	int
)	O
;	O
}	O
if	O
(	O
CTRL_CHAR	O
(	O
c	int
)	O
||	O
c	int
==	O
RUBOUT	int
)	O
return	O
(	O
2	int
)	O
;	O
return	O
(	O
(	O
ISPRINT	O
(	O
uc	char
)	O
)	O
?	O
1	int
:	O
2	int
)	O
;	O
}	O
static	O
int	O
msg_saved_prompt	int
=	O
0	int
;	O
int	O
rl_message	function
(	O
const	O
char	O
*	O
format	pointer
,	O
...	O
)	O
{	O
va_list	array
args	array
;	O
int	O
bneed	int
;	O
va_start	O
(	O
args	array
,	O
format	pointer
)	O
;	O
if	O
(	O
msg_buf	pointer
==	O
0	int
)	O
msg_buf	pointer
=	O
xmalloc	function
(	O
msg_bufsiz	int
=	O
128	int
)	O
;	O
bneed	int
=	O
vsnprintf	function
(	O
msg_buf	pointer
,	O
msg_bufsiz	int
,	O
format	pointer
,	O
args	array
)	O
;	O
if	O
(	O
bneed	int
>=	O
msg_bufsiz	int
-	O
1	int
)	O
{	O
msg_bufsiz	int
=	O
bneed	int
+	O
1	int
;	O
msg_buf	pointer
=	O
xrealloc	function
(	O
msg_buf	pointer
,	O
msg_bufsiz	int
)	O
;	O
va_end	O
(	O
args	array
)	O
;	O
va_start	O
(	O
args	array
,	O
format	pointer
)	O
;	O
vsnprintf	function
(	O
msg_buf	pointer
,	O
msg_bufsiz	int
-	O
1	int
,	O
format	pointer
,	O
args	array
)	O
;	O
}	O
va_end	O
(	O
args	array
)	O
;	O
if	O
(	O
saved_local_prompt	pointer
==	O
0	int
)	O
{	O
rl_save_prompt	function
(	O
)	O
;	O
msg_saved_prompt	int
=	O
1	int
;	O
}	O
else	O
if	O
(	O
local_prompt	pointer
!=	O
saved_local_prompt	pointer
)	O
{	O
FREE	O
(	O
local_prompt	pointer
)	O
;	O
FREE	O
(	O
local_prompt_prefix	pointer
)	O
;	O
local_prompt	pointer
=	O
(	O
char	O
*	O
)	O
NULL	O
;	O
}	O
rl_display_prompt	pointer
=	O
msg_buf	pointer
;	O
local_prompt	pointer
=	O
expand_prompt	function
(	O
msg_buf	pointer
,	O
0	int
,	O
&	O
prompt_visible_length	int
,	O
&	O
prompt_last_invisible	int
,	O
&	O
prompt_invis_chars_first_line	int
,	O
&	O
prompt_physical_chars	int
)	O
;	O
local_prompt_prefix	pointer
=	O
(	O
char	O
*	O
)	O
NULL	O
;	O
local_prompt_len	int
=	O
local_prompt	pointer
?	O
strlen	function
(	O
local_prompt	pointer
)	O
:	O
0	int
;	O
(	O
*	O
rl_redisplay_function	pointer
)	O
(	O
)	O
;	O
return	O
0	int
;	O
}	O
int	O
rl_clear_message	function
(	O
)	O
{	O
rl_display_prompt	pointer
=	O
rl_prompt	pointer
;	O
if	O
(	O
msg_saved_prompt	int
)	O
{	O
rl_restore_prompt	function
(	O
)	O
;	O
msg_saved_prompt	int
=	O
0	int
;	O
}	O
(	O
*	O
rl_redisplay_function	pointer
)	O
(	O
)	O
;	O
return	O
0	int
;	O
}	O
int	O
rl_reset_line_state	function
(	O
)	O
{	O
rl_on_new_line	function
(	O
)	O
;	O
rl_display_prompt	pointer
=	O
rl_prompt	pointer
?	O
rl_prompt	pointer
:	O
""	pointer
;	O
forced_display	int
=	O
1	int
;	O
return	O
0	int
;	O
}	O
void	O
rl_save_prompt	function
(	O
)	O
{	O
saved_local_prompt	pointer
=	O
local_prompt	pointer
;	O
saved_local_prefix	pointer
=	O
local_prompt_prefix	pointer
;	O
saved_prefix_length	int
=	O
prompt_prefix_length	int
;	O
saved_local_length	int
=	O
local_prompt_len	int
;	O
saved_last_invisible	int
=	O
prompt_last_invisible	int
;	O
saved_visible_length	int
=	O
prompt_visible_length	int
;	O
saved_invis_chars_first_line	int
=	O
prompt_invis_chars_first_line	int
;	O
saved_physical_chars	int
=	O
prompt_physical_chars	int
;	O
local_prompt	pointer
=	O
local_prompt_prefix	pointer
=	O
(	O
char	O
*	O
)	O
0	int
;	O
local_prompt_len	int
=	O
0	int
;	O
prompt_last_invisible	int
=	O
prompt_visible_length	int
=	O
prompt_prefix_length	int
=	O
0	int
;	O
prompt_invis_chars_first_line	int
=	O
prompt_physical_chars	int
=	O
0	int
;	O
}	O
void	O
rl_restore_prompt	function
(	O
)	O
{	O
FREE	O
(	O
local_prompt	pointer
)	O
;	O
FREE	O
(	O
local_prompt_prefix	pointer
)	O
;	O
local_prompt	pointer
=	O
saved_local_prompt	pointer
;	O
local_prompt_prefix	pointer
=	O
saved_local_prefix	pointer
;	O
local_prompt_len	int
=	O
saved_local_length	int
;	O
prompt_prefix_length	int
=	O
saved_prefix_length	int
;	O
prompt_last_invisible	int
=	O
saved_last_invisible	int
;	O
prompt_visible_length	int
=	O
saved_visible_length	int
;	O
prompt_invis_chars_first_line	int
=	O
saved_invis_chars_first_line	int
;	O
prompt_physical_chars	int
=	O
saved_physical_chars	int
;	O
saved_local_prompt	pointer
=	O
saved_local_prefix	pointer
=	O
(	O
char	O
*	O
)	O
0	int
;	O
saved_local_length	int
=	O
0	int
;	O
saved_last_invisible	int
=	O
saved_visible_length	int
=	O
saved_prefix_length	int
=	O
0	int
;	O
saved_invis_chars_first_line	int
=	O
saved_physical_chars	int
=	O
0	int
;	O
}	O
char	O
*	O
_rl_make_prompt_for_search	function
(	O
pchar	int
)	O
int	O
pchar	int
;	O
{	O
int	O
len	int
;	O
char	O
*	O
pmt	pointer
,	O
*	O
p	pointer
;	O
rl_save_prompt	function
(	O
)	O
;	O
p	pointer
=	O
rl_prompt	pointer
?	O
strrchr	function
(	O
rl_prompt	pointer
,	O
'\n'	O
)	O
:	O
0	int
;	O
if	O
(	O
p	pointer
==	O
0	int
)	O
{	O
len	int
=	O
(	O
rl_prompt	pointer
&&	O
*	O
rl_prompt	pointer
)	O
?	O
strlen	function
(	O
rl_prompt	pointer
)	O
:	O
0	int
;	O
pmt	pointer
=	O
(	O
char	O
*	O
)	O
xmalloc	function
(	O
len	int
+	O
2	int
)	O
;	O
if	O
(	O
len	int
)	O
strcpy	function
(	O
pmt	pointer
,	O
rl_prompt	pointer
)	O
;	O
pmt	pointer
[	O
len	int
]	O
=	O
pchar	int
;	O
pmt	pointer
[	O
len	int
+	O
1	int
]	O
=	O
'\0'	O
;	O
}	O
else	O
{	O
p	pointer
++	O
;	O
len	int
=	O
strlen	function
(	O
p	pointer
)	O
;	O
pmt	pointer
=	O
(	O
char	O
*	O
)	O
xmalloc	function
(	O
len	int
+	O
2	int
)	O
;	O
if	O
(	O
len	int
)	O
strcpy	function
(	O
pmt	pointer
,	O
p	pointer
)	O
;	O
pmt	pointer
[	O
len	int
]	O
=	O
pchar	int
;	O
pmt	pointer
[	O
len	int
+	O
1	int
]	O
=	O
'\0'	O
;	O
}	O
prompt_physical_chars	int
=	O
saved_physical_chars	int
+	O
1	int
;	O
return	O
pmt	pointer
;	O
}	O
void	O
_rl_erase_at_end_of_line	function
(	O
l	int
)	O
int	O
l	int
;	O
{	O
register	O
int	O
i	int
;	O
_rl_backspace	function
(	O
l	int
)	O
;	O
for	O
(	O
i	int
=	O
0	int
;	O
i	int
<	O
l	int
;	O
i	int
++	O
)	O
putc	function
(	O
' '	O
,	O
rl_outstream	pointer
)	O
;	O
_rl_backspace	function
(	O
l	int
)	O
;	O
for	O
(	O
i	int
=	O
0	int
;	O
i	int
<	O
l	int
;	O
i	int
++	O
)	O
visible_line	O
[	O
--	O
_rl_last_c_pos	int
]	O
=	O
'\0'	O
;	O
rl_display_fixed	int
++	O
;	O
}	O
void	O
_rl_clear_to_eol	function
(	O
count	int
)	O
int	O
count	int
;	O
{	O
if	O
(	O
_rl_term_clreol	pointer
)	O
tputs	function
(	O
_rl_term_clreol	pointer
,	O
1	int
,	O
_rl_output_character_function	function
)	O
;	O
else	O
if	O
(	O
count	int
)	O
space_to_eol	function
(	O
count	int
)	O
;	O
}	O
static	O
void	O
space_to_eol	function
(	O
count	int
)	O
int	O
count	int
;	O
{	O
register	O
int	O
i	int
;	O
for	O
(	O
i	int
=	O
0	int
;	O
i	int
<	O
count	int
;	O
i	int
++	O
)	O
putc	function
(	O
' '	O
,	O
rl_outstream	pointer
)	O
;	O
_rl_last_c_pos	int
+=	O
count	int
;	O
}	O
void	O
_rl_clear_screen	function
(	O
)	O
{	O
if	O
(	O
_rl_term_clrpag	pointer
)	O
tputs	function
(	O
_rl_term_clrpag	pointer
,	O
1	int
,	O
_rl_output_character_function	function
)	O
;	O
else	O
rl_crlf	function
(	O
)	O
;	O
}	O
static	O
void	O
insert_some_chars	function
(	O
string	pointer
,	O
count	int
,	O
col	int
)	O
char	O
*	O
string	pointer
;	O
int	O
count	int
,	O
col	int
;	O
{	O
open_some_spaces	function
(	O
col	int
)	O
;	O
_rl_output_some_chars	function
(	O
string	pointer
,	O
count	int
)	O
;	O
}	O
static	O
void	O
open_some_spaces	function
(	O
col	int
)	O
int	O
col	int
;	O
{	O
char	O
*	O
buffer	pointer
;	O
register	O
int	O
i	int
;	O
if	O
(	O
_rl_term_IC	pointer
)	O
{	O
buffer	pointer
=	O
tgoto	function
(	O
_rl_term_IC	pointer
,	O
0	int
,	O
col	int
)	O
;	O
tputs	function
(	O
buffer	pointer
,	O
1	int
,	O
_rl_output_character_function	function
)	O
;	O
}	O
else	O
if	O
(	O
_rl_term_im	pointer
&&	O
*	O
_rl_term_im	pointer
)	O
{	O
tputs	function
(	O
_rl_term_im	pointer
,	O
1	int
,	O
_rl_output_character_function	function
)	O
;	O
for	O
(	O
i	int
=	O
col	int
;	O
i	int
--	O
;	O
)	O
_rl_output_character_function	function
(	O
' '	O
)	O
;	O
if	O
(	O
_rl_term_ei	pointer
&&	O
*	O
_rl_term_ei	pointer
)	O
tputs	function
(	O
_rl_term_ei	pointer
,	O
1	int
,	O
_rl_output_character_function	function
)	O
;	O
_rl_backspace	function
(	O
col	int
)	O
;	O
}	O
else	O
if	O
(	O
_rl_term_ic	pointer
&&	O
*	O
_rl_term_ic	pointer
)	O
{	O
for	O
(	O
i	int
=	O
col	int
;	O
i	int
--	O
;	O
)	O
tputs	function
(	O
_rl_term_ic	pointer
,	O
1	int
,	O
_rl_output_character_function	function
)	O
;	O
}	O
}	O
static	O
void	O
delete_chars	function
(	O
count	int
)	O
int	O
count	int
;	O
{	O
if	O
(	O
count	int
>	O
_rl_screenwidth	int
)	O
return	O
;	O
if	O
(	O
_rl_term_DC	pointer
&&	O
*	O
_rl_term_DC	pointer
)	O
{	O
char	O
*	O
buffer	pointer
;	O
buffer	pointer
=	O
tgoto	function
(	O
_rl_term_DC	pointer
,	O
count	int
,	O
count	int
)	O
;	O
tputs	function
(	O
buffer	pointer
,	O
count	int
,	O
_rl_output_character_function	function
)	O
;	O
}	O
else	O
{	O
if	O
(	O
_rl_term_dc	pointer
&&	O
*	O
_rl_term_dc	pointer
)	O
while	O
(	O
count	int
--	O
)	O
tputs	function
(	O
_rl_term_dc	pointer
,	O
1	int
,	O
_rl_output_character_function	function
)	O
;	O
}	O
}	O
void	O
_rl_update_final	function
(	O
)	O
{	O
int	O
full_lines	int
;	O
full_lines	int
=	O
0	int
;	O
if	O
(	O
_rl_vis_botlin	int
&&	O
_rl_last_c_pos	int
==	O
0	int
&&	O
visible_line	O
[	O
vis_lbreaks	O
[	O
_rl_vis_botlin	int
]	O
]	O
==	O
0	int
)	O
{	O
_rl_vis_botlin	int
--	O
;	O
full_lines	int
=	O
1	int
;	O
}	O
_rl_move_vert	function
(	O
_rl_vis_botlin	int
)	O
;	O
if	O
(	O
full_lines	int
&&	O
_rl_term_autowrap	int
&&	O
(	O
VIS_LLEN	O
(	O
_rl_vis_botlin	int
)	O
==	O
_rl_screenwidth	int
)	O
)	O
{	O
char	O
*	O
last_line	pointer
;	O
last_line	pointer
=	O
&	O
visible_line	O
[	O
vis_lbreaks	O
[	O
_rl_vis_botlin	int
]	O
]	O
;	O
cpos_buffer_position	int
=	O
-	O
1	int
;	O
_rl_move_cursor_relative	function
(	O
_rl_screenwidth	int
-	O
1	int
,	O
last_line	pointer
)	O
;	O
_rl_clear_to_eol	function
(	O
0	int
)	O
;	O
putc	function
(	O
last_line	pointer
[	O
_rl_screenwidth	int
-	O
1	int
]	O
,	O
rl_outstream	pointer
)	O
;	O
}	O
_rl_vis_botlin	int
=	O
0	int
;	O
rl_crlf	function
(	O
)	O
;	O
fflush	function
(	O
rl_outstream	pointer
)	O
;	O
rl_display_fixed	int
++	O
;	O
}	O
static	O
void	O
cr	function
(	O
)	O
{	O
if	O
(	O
_rl_term_cr	pointer
)	O
{	O
tputs	function
(	O
_rl_term_cr	pointer
,	O
1	int
,	O
_rl_output_character_function	function
)	O
;	O
_rl_last_c_pos	int
=	O
0	int
;	O
}	O
}	O
static	O
void	O
redraw_prompt	function
(	O
t	pointer
)	O
char	O
*	O
t	pointer
;	O
{	O
char	O
*	O
oldp	pointer
;	O
oldp	pointer
=	O
rl_display_prompt	pointer
;	O
rl_save_prompt	function
(	O
)	O
;	O
rl_display_prompt	pointer
=	O
t	pointer
;	O
local_prompt	pointer
=	O
expand_prompt	function
(	O
t	pointer
,	O
PMT_MULTILINE	int
,	O
&	O
prompt_visible_length	int
,	O
&	O
prompt_last_invisible	int
,	O
&	O
prompt_invis_chars_first_line	int
,	O
&	O
prompt_physical_chars	int
)	O
;	O
local_prompt_prefix	pointer
=	O
(	O
char	O
*	O
)	O
NULL	O
;	O
local_prompt_len	int
=	O
local_prompt	pointer
?	O
strlen	function
(	O
local_prompt	pointer
)	O
:	O
0	int
;	O
rl_forced_update_display	function
(	O
)	O
;	O
rl_display_prompt	pointer
=	O
oldp	pointer
;	O
rl_restore_prompt	function
(	O
)	O
;	O
}	O
void	O
_rl_redisplay_after_sigwinch	function
(	O
)	O
{	O
char	O
*	O
t	pointer
;	O
if	O
(	O
_rl_term_cr	pointer
)	O
{	O
_rl_move_vert	function
(	O
_rl_vis_botlin	int
)	O
;	O
tputs	function
(	O
_rl_term_cr	pointer
,	O
1	int
,	O
_rl_output_character_function	function
)	O
;	O
_rl_last_c_pos	int
=	O
0	int
;	O
if	O
(	O
_rl_term_clreol	pointer
)	O
tputs	function
(	O
_rl_term_clreol	pointer
,	O
1	int
,	O
_rl_output_character_function	function
)	O
;	O
else	O
{	O
space_to_eol	function
(	O
_rl_screenwidth	int
)	O
;	O
tputs	function
(	O
_rl_term_cr	pointer
,	O
1	int
,	O
_rl_output_character_function	function
)	O
;	O
}	O
if	O
(	O
_rl_last_v_pos	int
>	O
0	int
)	O
_rl_move_vert	function
(	O
0	int
)	O
;	O
}	O
else	O
rl_crlf	function
(	O
)	O
;	O
t	pointer
=	O
strrchr	function
(	O
rl_display_prompt	pointer
,	O
'\n'	O
)	O
;	O
if	O
(	O
t	pointer
)	O
redraw_prompt	function
(	O
++	O
t	pointer
)	O
;	O
else	O
rl_forced_update_display	function
(	O
)	O
;	O
}	O
void	O
_rl_clean_up_for_exit	function
(	O
)	O
{	O
if	O
(	O
_rl_echoing_p	int
)	O
{	O
if	O
(	O
_rl_vis_botlin	int
>	O
0	int
)	O
_rl_move_vert	function
(	O
_rl_vis_botlin	int
)	O
;	O
_rl_vis_botlin	int
=	O
0	int
;	O
fflush	function
(	O
rl_outstream	pointer
)	O
;	O
rl_restart_output	function
(	O
1	int
,	O
0	int
)	O
;	O
}	O
}	O
void	O
_rl_erase_entire_line	function
(	O
)	O
{	O
cr	function
(	O
)	O
;	O
_rl_clear_to_eol	function
(	O
0	int
)	O
;	O
cr	function
(	O
)	O
;	O
fflush	function
(	O
rl_outstream	pointer
)	O
;	O
}	O
void	O
_rl_ttyflush	function
(	O
)	O
{	O
fflush	function
(	O
rl_outstream	pointer
)	O
;	O
}	O
int	O
_rl_current_display_line	function
(	O
)	O
{	O
int	O
ret	pointer
,	O
nleft	int
;	O
if	O
(	O
rl_display_prompt	pointer
==	O
rl_prompt	pointer
)	O
nleft	int
=	O
_rl_last_c_pos	int
-	O
_rl_screenwidth	int
-	O
rl_visible_prompt_length	int
;	O
else	O
nleft	int
=	O
_rl_last_c_pos	int
-	O
_rl_screenwidth	int
;	O
if	O
(	O
nleft	int
>	O
0	int
)	O
ret	pointer
=	O
1	int
+	O
nleft	int
/	O
_rl_screenwidth	int
;	O
else	O
ret	pointer
=	O
0	int
;	O
return	O
ret	pointer
;	O
}	O
static	O
int	O
_rl_col_width	function
(	O
str	pointer
,	O
start	int
,	O
end	int
,	O
flags	int
)	O
const	O
char	O
*	O
str	pointer
;	O
int	O
start	int
,	O
end	int
,	O
flags	int
;	O
{	O
wchar_t	int
wc	int
;	O
mbstate_t	struct
ps	struct
;	O
int	O
tmp	int
,	O
point	int
,	O
width	int
,	O
max	int
;	O
if	O
(	O
end	int
<=	O
start	int
)	O
return	O
0	int
;	O
if	O
(	O
MB_CUR_MAX	O
==	O
1	int
||	O
rl_byte_oriented	int
)	O
return	O
(	O
end	int
-	O
start	int
)	O
;	O
memset	function
(	O
&	O
ps	struct
,	O
0	int
,	O
sizeof	O
(	O
mbstate_t	struct
)	O
)	O
;	O
point	int
=	O
0	int
;	O
max	int
=	O
end	int
;	O
if	O
(	O
flags	int
&&	O
start	int
==	O
0	int
&&	O
end	int
==	O
local_prompt_len	int
&&	O
memcmp	function
(	O
str	pointer
,	O
local_prompt	pointer
,	O
local_prompt_len	int
)	O
==	O
0	int
)	O
return	O
(	O
prompt_physical_chars	int
+	O
wrap_offset	int
)	O
;	O
else	O
if	O
(	O
flags	int
&&	O
start	int
==	O
0	int
&&	O
local_prompt_len	int
>	O
0	int
&&	O
end	int
>	O
local_prompt_len	int
&&	O
local_prompt	pointer
&&	O
memcmp	function
(	O
str	pointer
,	O
local_prompt	pointer
,	O
local_prompt_len	int
)	O
==	O
0	int
)	O
{	O
tmp	int
=	O
prompt_physical_chars	int
+	O
wrap_offset	int
;	O
tmp	int
+=	O
_rl_col_width	function
(	O
str	pointer
,	O
local_prompt_len	int
,	O
end	int
,	O
flags	int
)	O
;	O
return	O
(	O
tmp	int
)	O
;	O
}	O
while	O
(	O
point	int
<	O
start	int
)	O
{	O
tmp	int
=	O
mbrlen	function
(	O
str	pointer
+	O
point	int
,	O
max	int
,	O
&	O
ps	struct
)	O
;	O
if	O
(	O
MB_INVALIDCH	O
(	O
(	O
size_t	long
)	O
tmp	int
)	O
)	O
{	O
point	int
++	O
;	O
max	int
--	O
;	O
memset	function
(	O
&	O
ps	struct
,	O
0	int
,	O
sizeof	O
(	O
mbstate_t	struct
)	O
)	O
;	O
}	O
else	O
if	O
(	O
MB_NULLWCH	O
(	O
tmp	int
)	O
)	O
break	O
;	O
else	O
{	O
point	int
+=	O
tmp	int
;	O
max	int
-=	O
tmp	int
;	O
}	O
}	O
width	int
=	O
point	int
-	O
start	int
;	O
while	O
(	O
point	int
<	O
end	int
)	O
{	O
tmp	int
=	O
mbrtowc	function
(	O
&	O
wc	int
,	O
str	pointer
+	O
point	int
,	O
max	int
,	O
&	O
ps	struct
)	O
;	O
if	O
(	O
MB_INVALIDCH	O
(	O
(	O
size_t	long
)	O
tmp	int
)	O
)	O
{	O
point	int
++	O
;	O
max	int
--	O
;	O
width	int
++	O
;	O
memset	function
(	O
&	O
ps	struct
,	O
0	int
,	O
sizeof	O
(	O
mbstate_t	struct
)	O
)	O
;	O
}	O
else	O
if	O
(	O
MB_NULLWCH	O
(	O
tmp	int
)	O
)	O
break	O
;	O
else	O
{	O
point	int
+=	O
tmp	int
;	O
max	int
-=	O
tmp	int
;	O
tmp	int
=	O
WCWIDTH	O
(	O
wc	int
)	O
;	O
width	int
+=	O
(	O
tmp	int
>=	O
0	int
)	O
?	O
tmp	int
:	O
1	int
;	O
}	O
}	O
width	int
+=	O
point	int
-	O
end	int
;	O
return	O
width	int
;	O
}	O