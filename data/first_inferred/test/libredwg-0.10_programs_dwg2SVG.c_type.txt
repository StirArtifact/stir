static	O
int	O
opts	int
=	O
0	int
;	O
Dwg_Data	struct
g_dwg	struct
;	O
double	O
model_xmin	double
,	O
model_ymin	double
;	O
double	O
page_width	double
,	O
page_height	double
,	O
scale	struct
;	O
static	O
void	O
output_SVG	function
(	O
Dwg_Data	struct
*	O
dwg	pointer
)	O
;	O
static	O
int	O
usage	function
(	O
void	O
)	O
{	O
printf	function
(	O
"\nUsage: dwg2SVG [-v[0-9]] DWGFILE >SVGFILE\n"	pointer
)	O
;	O
return	O
1	int
;	O
}	O
static	O
int	O
opt_version	function
(	O
void	O
)	O
{	O
printf	function
(	O
"dwg2SVG %s\n"	pointer
,	O
PACKAGE_VERSION	pointer
)	O
;	O
return	O
0	int
;	O
}	O
static	O
int	O
help	function
(	O
void	O
)	O
{	O
printf	function
(	O
"\nUsage: dwg2SVG [OPTION]... DWGFILE >SVGFILE\n"	pointer
)	O
;	O
printf	function
(	O
"Converts some 2D elements of the DWG to a SVG.\n"	pointer
"\n"	pointer
)	O
;	O
printf	function
(	O
"  -v[0-9], --verbose [0-9]  verbosity\n"	pointer
)	O
;	O
printf	function
(	O
"           --help           display this help and exit\n"	pointer
)	O
;	O
printf	function
(	O
"           --version        output version information and exit\n"	pointer
"\n"	pointer
)	O
;	O
printf	function
(	O
"GNU LibreDWG online manual: "	pointer
"<https://www.gnu.org/software/libredwg/>\n"	pointer
)	O
;	O
return	O
0	int
;	O
}	O
static	O
double	O
transform_X	function
(	O
double	O
x	double
)	O
{	O
return	O
x	double
-	O
model_xmin	double
;	O
}	O
static	O
double	O
transform_Y	function
(	O
double	O
y	double
)	O
{	O
return	O
page_height	double
-	O
(	O
y	double
-	O
model_ymin	double
)	O
;	O
}	O
static	O
void	O
output_TEXT	function
(	O
Dwg_Object	struct
*	O
obj	pointer
)	O
{	O
Dwg_Data	struct
*	O
dwg	pointer
=	O
obj	pointer
->	O
parent	pointer
;	O
Dwg_Entity_TEXT	struct
*	O
text	pointer
=	O
obj	pointer
->	O
tio	union
.	O
entity	long
->	O
tio	union
.	O
TEXT	pointer
;	O
char	O
*	O
escaped	pointer
;	O
const	O
char	O
*	O
fontfamily	pointer
;	O
BITCODE_H	pointer
style_ref	pointer
=	O
text	pointer
->	O
style	pointer
;	O
Dwg_Object	struct
*	O
o	pointer
=	O
style_ref	pointer
?	O
dwg_ref_object_silent	function
(	O
dwg	pointer
,	O
style_ref	pointer
)	O
:	O
NULL	O
;	O
Dwg_Object_STYLE	struct
*	O
style	pointer
=	O
o	pointer
?	O
o	pointer
->	O
tio	union
.	O
object	pointer
->	O
tio	union
.	O
STYLE	pointer
:	O
NULL	O
;	O
BITCODE_2DPOINT	struct
pt	array
;	O
if	O
(	O
dwg	pointer
->	O
header	struct
.	O
version	short
>=	O
R_2007	int
)	O
escaped	pointer
=	O
htmlwescape	function
(	O
(	O
BITCODE_TU	pointer
)	O
text	pointer
->	O
text_value	pointer
)	O
;	O
else	O
escaped	pointer
=	O
htmlescape	function
(	O
text	pointer
->	O
text_value	pointer
,	O
(	O
int	O
)	O
dwg	pointer
->	O
header	struct
.	O
codepage	int
)	O
;	O
if	O
(	O
style	pointer
&&	O
style	pointer
->	O
font_name	pointer
&&	O
*	O
style	pointer
->	O
font_name	pointer
&&	O
strcasestr	function
(	O
style	pointer
->	O
font_name	pointer
,	O
".ttf"	pointer
)	O
)	O
{	O
if	O
(	O
strcasestr	function
(	O
style	pointer
->	O
font_name	pointer
,	O
"Arial"	pointer
)	O
)	O
{	O
fontfamily	pointer
=	O
"Arial"	pointer
;	O
}	O
else	O
fontfamily	pointer
=	O
"Verdana"	pointer
;	O
}	O
else	O
fontfamily	pointer
=	O
"Courier"	pointer
;	O
transform_OCS_2d	function
(	O
&	O
pt	array
,	O
text	pointer
->	O
insertion_pt	struct
,	O
text	pointer
->	O
extrusion	struct
)	O
;	O
printf	function
(	O
"\t<text id=\"dwg-object-%d\" x=\"%f\" y=\"%f\" "	pointer
"font-family=\"%s\" font-size=\"%f\" fill=\"blue\">%s</text>\n"	pointer
,	O
obj	pointer
->	O
index	short
,	O
transform_X	function
(	O
pt	array
.	O
x	double
)	O
,	O
transform_Y	function
(	O
pt	array
.	O
y	double
)	O
,	O
fontfamily	pointer
,	O
text	pointer
->	O
height	double
,	O
escaped	pointer
?	O
escaped	pointer
:	O
""	pointer
)	O
;	O
free	function
(	O
escaped	pointer
)	O
;	O
}	O
static	O
void	O
output_LINE	function
(	O
Dwg_Object	struct
*	O
obj	pointer
)	O
{	O
Dwg_Entity_LINE	struct
*	O
line	pointer
=	O
obj	pointer
->	O
tio	union
.	O
entity	long
->	O
tio	union
.	O
LINE	pointer
;	O
BITCODE_3DPOINT	struct
start	struct
,	O
end	struct
;	O
transform_OCS	function
(	O
&	O
start	struct
,	O
line	pointer
->	O
start	struct
,	O
line	pointer
->	O
extrusion	struct
)	O
;	O
transform_OCS	function
(	O
&	O
end	struct
,	O
line	pointer
->	O
end	struct
,	O
line	pointer
->	O
extrusion	struct
)	O
;	O
printf	function
(	O
"\t<path id=\"dwg-object-%d\" d=\"M %f,%f %f,%f\" "	pointer
"style=\"fill:none;stroke:blue;stroke-width:0.1px\" />\n"	pointer
,	O
obj	pointer
->	O
index	short
,	O
transform_X	function
(	O
start	struct
.	O
x	double
)	O
,	O
transform_Y	function
(	O
start	struct
.	O
y	double
)	O
,	O
transform_X	function
(	O
end	struct
.	O
x	double
)	O
,	O
transform_Y	function
(	O
end	struct
.	O
y	double
)	O
)	O
;	O
}	O
static	O
void	O
output_CIRCLE	function
(	O
Dwg_Object	struct
*	O
obj	pointer
)	O
{	O
Dwg_Entity_CIRCLE	struct
*	O
circle	pointer
=	O
obj	pointer
->	O
tio	union
.	O
entity	long
->	O
tio	union
.	O
CIRCLE	pointer
;	O
BITCODE_3DPOINT	struct
center	struct
;	O
transform_OCS	function
(	O
&	O
center	struct
,	O
circle	pointer
->	O
center	struct
,	O
circle	pointer
->	O
extrusion	struct
)	O
;	O
printf	function
(	O
"\t<circle id=\"dwg-object-%d\" cx=\"%f\" cy=\"%f\" r=\"%f\" "	pointer
"fill=\"none\" stroke=\"blue\" stroke-width=\"0.1px\" />\n"	pointer
,	O
obj	pointer
->	O
index	short
,	O
transform_X	function
(	O
center	struct
.	O
x	double
)	O
,	O
transform_Y	function
(	O
center	struct
.	O
y	double
)	O
,	O
circle	pointer
->	O
radius	double
)	O
;	O
}	O
static	O
void	O
output_ARC	function
(	O
Dwg_Object	struct
*	O
obj	pointer
)	O
{	O
Dwg_Entity_ARC	struct
*	O
arc	pointer
=	O
obj	pointer
->	O
tio	union
.	O
entity	long
->	O
tio	union
.	O
ARC	pointer
;	O
BITCODE_3DPOINT	struct
center	struct
;	O
double	O
x_start	double
,	O
y_start	double
,	O
x_end	double
,	O
y_end	double
;	O
int	O
large_arc	int
;	O
transform_OCS	function
(	O
&	O
center	struct
,	O
arc	pointer
->	O
center	struct
,	O
arc	pointer
->	O
extrusion	struct
)	O
;	O
x_start	double
=	O
center	struct
.	O
x	double
+	O
arc	pointer
->	O
radius	double
*	O
cos	function
(	O
arc	pointer
->	O
start_angle	double
)	O
;	O
y_start	double
=	O
center	struct
.	O
y	double
+	O
arc	pointer
->	O
radius	double
*	O
sin	function
(	O
arc	pointer
->	O
start_angle	double
)	O
;	O
x_end	double
=	O
center	struct
.	O
x	double
+	O
arc	pointer
->	O
radius	double
*	O
cos	function
(	O
arc	pointer
->	O
end_angle	double
)	O
;	O
y_end	double
=	O
center	struct
.	O
y	double
+	O
arc	pointer
->	O
radius	double
*	O
sin	function
(	O
arc	pointer
->	O
end_angle	double
)	O
;	O
large_arc	int
=	O
(	O
arc	pointer
->	O
end_angle	double
-	O
arc	pointer
->	O
start_angle	double
<	O
M_PI	int
)	O
?	O
0	int
:	O
1	int
;	O
printf	function
(	O
"\t<path id=\"dwg-object-%d\" d=\"M %f,%f A %f,%f 0 %d 0 %f,%f\" "	pointer
"fill=\"none\" stroke=\"blue\" stroke-width=\"%f\" />\n"	pointer
,	O
obj	pointer
->	O
index	short
,	O
transform_X	function
(	O
x_start	double
)	O
,	O
transform_Y	function
(	O
y_start	double
)	O
,	O
arc	pointer
->	O
radius	double
,	O
arc	pointer
->	O
radius	double
,	O
large_arc	int
,	O
transform_X	function
(	O
x_end	double
)	O
,	O
transform_Y	function
(	O
y_end	double
)	O
,	O
0.1	int
)	O
;	O
}	O
static	O
void	O
output_POLYLINE_2D	function
(	O
Dwg_Object	struct
*	O
obj	pointer
)	O
{	O
int	O
error	pointer
;	O
Dwg_Entity_POLYLINE_2D	struct
*	O
pline	pointer
=	O
obj	pointer
->	O
tio	union
.	O
entity	long
->	O
tio	union
.	O
POLYLINE_2D	pointer
;	O
BITCODE_RL	int
numpts	int
=	O
dwg_object_polyline_2d_get_numpoints	function
(	O
obj	pointer
,	O
&	O
error	pointer
)	O
;	O
if	O
(	O
numpts	int
&&	O
!	O
error	pointer
)	O
{	O
BITCODE_2DPOINT	struct
pt	array
,	O
ptin	struct
;	O
dwg_point_2d	struct
*	O
pts	pointer
=	O
dwg_object_polyline_2d_get_points	function
(	O
obj	pointer
,	O
&	O
error	pointer
)	O
;	O
BITCODE_RL	int
j	int
;	O
if	O
(	O
error	pointer
)	O
return	O
;	O
ptin	struct
.	O
x	double
=	O
pts	pointer
[	O
0	int
]	O
.	O
x	double
;	O
ptin	struct
.	O
y	double
=	O
pts	pointer
[	O
0	int
]	O
.	O
y	double
;	O
transform_OCS_2d	function
(	O
&	O
pt	array
,	O
ptin	struct
,	O
pline	pointer
->	O
extrusion	struct
)	O
;	O
printf	function
(	O
"\t<path id=\"dwg-object-%d\" d=\"M %f,%f"	pointer
,	O
obj	pointer
->	O
index	short
,	O
transform_X	function
(	O
pt	array
.	O
x	double
)	O
,	O
transform_Y	function
(	O
pt	array
.	O
y	double
)	O
)	O
;	O
for	O
(	O
j	int
=	O
1	int
;	O
j	int
<	O
numpts	int
;	O
j	int
++	O
)	O
{	O
ptin	struct
.	O
x	double
=	O
pts	pointer
[	O
j	int
]	O
.	O
x	double
;	O
ptin	struct
.	O
y	double
=	O
pts	pointer
[	O
j	int
]	O
.	O
y	double
;	O
transform_OCS_2d	function
(	O
&	O
pt	array
,	O
ptin	struct
,	O
pline	pointer
->	O
extrusion	struct
)	O
;	O
printf	function
(	O
" L %f,%f"	pointer
,	O
transform_X	function
(	O
pt	array
.	O
x	double
)	O
,	O
transform_Y	function
(	O
pt	array
.	O
y	double
)	O
)	O
;	O
}	O
if	O
(	O
pline	pointer
->	O
flag	pointer
&	O
1	int
)	O
printf	function
(	O
" Z"	pointer
)	O
;	O
printf	function
(	O
"\" style=\"fill:none;stroke:blue;stroke-width:0.1px\" />\n"	pointer
)	O
;	O
free	function
(	O
pts	pointer
)	O
;	O
}	O
}	O
static	O
void	O
output_LWPOLYLINE	function
(	O
Dwg_Object	struct
*	O
obj	pointer
)	O
{	O
int	O
error	pointer
;	O
Dwg_Entity_LWPOLYLINE	struct
*	O
pline	pointer
=	O
obj	pointer
->	O
tio	union
.	O
entity	long
->	O
tio	union
.	O
LWPOLYLINE	pointer
;	O
BITCODE_RL	int
numpts	int
=	O
dwg_ent_lwpline_get_numpoints	function
(	O
pline	pointer
,	O
&	O
error	pointer
)	O
;	O
if	O
(	O
numpts	int
&&	O
!	O
error	pointer
)	O
{	O
BITCODE_2DPOINT	struct
pt	array
,	O
ptin	struct
;	O
dwg_point_2d	struct
*	O
pts	pointer
=	O
dwg_ent_lwpline_get_points	function
(	O
pline	pointer
,	O
&	O
error	pointer
)	O
;	O
BITCODE_RL	int
j	int
;	O
if	O
(	O
error	pointer
)	O
return	O
;	O
ptin	struct
.	O
x	double
=	O
pts	pointer
[	O
0	int
]	O
.	O
x	double
;	O
ptin	struct
.	O
y	double
=	O
pts	pointer
[	O
0	int
]	O
.	O
y	double
;	O
transform_OCS_2d	function
(	O
&	O
pt	array
,	O
ptin	struct
,	O
pline	pointer
->	O
extrusion	struct
)	O
;	O
printf	function
(	O
"\t<path id=\"dwg-object-%d\" d=\"M %f,%f"	pointer
,	O
obj	pointer
->	O
index	short
,	O
transform_X	function
(	O
pt	array
.	O
x	double
)	O
,	O
transform_Y	function
(	O
pt	array
.	O
y	double
)	O
)	O
;	O
for	O
(	O
j	int
=	O
1	int
;	O
j	int
<	O
numpts	int
;	O
j	int
++	O
)	O
{	O
ptin	struct
.	O
x	double
=	O
pts	pointer
[	O
j	int
]	O
.	O
x	double
;	O
ptin	struct
.	O
y	double
=	O
pts	pointer
[	O
j	int
]	O
.	O
y	double
;	O
transform_OCS_2d	function
(	O
&	O
pt	array
,	O
ptin	struct
,	O
pline	pointer
->	O
extrusion	struct
)	O
;	O
printf	function
(	O
" L %f,%f"	pointer
,	O
transform_X	function
(	O
pt	array
.	O
x	double
)	O
,	O
transform_Y	function
(	O
pt	array
.	O
y	double
)	O
)	O
;	O
}	O
if	O
(	O
pline	pointer
->	O
flag	pointer
&	O
512	int
)	O
printf	function
(	O
" Z"	pointer
)	O
;	O
printf	function
(	O
"\" style=\"fill:none;stroke:blue;stroke-width:0.1px\" />\n"	pointer
)	O
;	O
free	function
(	O
pts	pointer
)	O
;	O
}	O
}	O
static	O
void	O
output_INSERT	function
(	O
Dwg_Object	struct
*	O
obj	pointer
)	O
{	O
Dwg_Entity_INSERT	struct
*	O
insert	pointer
=	O
obj	pointer
->	O
tio	union
.	O
entity	long
->	O
tio	union
.	O
INSERT	pointer
;	O
if	O
(	O
insert	pointer
->	O
block_header	pointer
&&	O
insert	pointer
->	O
block_header	pointer
->	O
handleref	struct
.	O
value	double
)	O
{	O
BITCODE_3DPOINT	struct
ins_pt	struct
;	O
transform_OCS	function
(	O
&	O
ins_pt	struct
,	O
insert	pointer
->	O
ins_pt	struct
,	O
insert	pointer
->	O
extrusion	struct
)	O
;	O
printf	function
(	O
"\t<use id=\"dwg-object-%d\" transform=\"translate(%f %f) "	pointer
"rotate(%f) scale(%f %f)\" xlink:href=\"#symbol-%lX\" />"	pointer
"<!-- block_header->handleref: "	pointer
FORMAT_H	pointer
" -->\n"	pointer
,	O
obj	pointer
->	O
index	short
,	O
transform_X	function
(	O
ins_pt	struct
.	O
x	double
)	O
,	O
transform_Y	function
(	O
ins_pt	struct
.	O
y	double
)	O
,	O
(	O
180.0	int
/	O
M_PI	int
)	O
*	O
insert	pointer
->	O
rotation	double
,	O
insert	pointer
->	O
scale	struct
.	O
x	double
,	O
insert	pointer
->	O
scale	struct
.	O
y	double
,	O
insert	pointer
->	O
block_header	pointer
->	O
absolute_ref	long
,	O
ARGS_H	O
(	O
insert	pointer
->	O
block_header	pointer
->	O
handleref	struct
)	O
)	O
;	O
}	O
else	O
{	O
printf	function
(	O
"\n\n<!-- WRONG INSERT("	pointer
FORMAT_H	pointer
") -->\n"	pointer
,	O
ARGS_H	O
(	O
obj	pointer
->	O
handle	pointer
)	O
)	O
;	O
}	O
}	O
static	O
void	O
output_object	function
(	O
Dwg_Object	struct
*	O
obj	pointer
)	O
{	O
if	O
(	O
!	O
obj	pointer
)	O
{	O
fprintf	function
(	O
stderr	pointer
,	O
"object is NULL\n"	pointer
)	O
;	O
return	O
;	O
}	O
switch	O
(	O
obj	pointer
->	O
type	short
)	O
{	O
case	O
DWG_TYPE_INSERT	int
:	O
output_INSERT	function
(	O
obj	pointer
)	O
;	O
break	O
;	O
case	O
DWG_TYPE_LINE	int
:	O
output_LINE	function
(	O
obj	pointer
)	O
;	O
break	O
;	O
case	O
DWG_TYPE_CIRCLE	int
:	O
output_CIRCLE	function
(	O
obj	pointer
)	O
;	O
break	O
;	O
case	O
DWG_TYPE_TEXT	int
:	O
output_TEXT	function
(	O
obj	pointer
)	O
;	O
break	O
;	O
case	O
DWG_TYPE_ARC	int
:	O
output_ARC	function
(	O
obj	pointer
)	O
;	O
break	O
;	O
case	O
DWG_TYPE_POLYLINE_2D	int
:	O
output_POLYLINE_2D	function
(	O
obj	pointer
)	O
;	O
break	O
;	O
case	O
DWG_TYPE_LWPOLYLINE	int
:	O
output_LWPOLYLINE	function
(	O
obj	pointer
)	O
;	O
break	O
;	O
default	O
:	O
break	O
;	O
}	O
}	O
static	O
void	O
output_BLOCK_HEADER	function
(	O
Dwg_Object_Ref	struct
*	O
ref	pointer
)	O
{	O
Dwg_Object	struct
*	O
obj	pointer
;	O
Dwg_Object_BLOCK_HEADER	struct
*	O
hdr	pointer
;	O
if	O
(	O
!	O
ref	pointer
)	O
return	O
;	O
if	O
(	O
!	O
ref	pointer
->	O
obj	pointer
)	O
return	O
;	O
obj	pointer
=	O
ref	pointer
->	O
obj	pointer
;	O
if	O
(	O
obj	pointer
->	O
type	short
!=	O
DWG_TYPE_BLOCK_HEADER	int
)	O
{	O
fprintf	function
(	O
stderr	pointer
,	O
"Argument not a BLOCK_HEADER reference\n"	pointer
)	O
;	O
return	O
;	O
}	O
if	O
(	O
!	O
obj	pointer
->	O
tio	union
.	O
object	pointer
)	O
{	O
fprintf	function
(	O
stderr	pointer
,	O
"Found null obj->tio.object\n"	pointer
)	O
;	O
return	O
;	O
}	O
hdr	pointer
=	O
obj	pointer
->	O
tio	union
.	O
object	pointer
->	O
tio	union
.	O
BLOCK_HEADER	pointer
;	O
if	O
(	O
hdr	pointer
->	O
name	pointer
)	O
{	O
char	O
*	O
escaped	pointer
;	O
Dwg_Data	struct
*	O
dwg	pointer
=	O
obj	pointer
->	O
parent	pointer
;	O
if	O
(	O
dwg	pointer
->	O
header	struct
.	O
version	short
>=	O
R_2007	int
)	O
escaped	pointer
=	O
htmlwescape	function
(	O
(	O
BITCODE_TU	pointer
)	O
hdr	pointer
->	O
name	pointer
)	O
;	O
else	O
escaped	pointer
=	O
htmlescape	function
(	O
hdr	pointer
->	O
name	pointer
,	O
dwg	pointer
->	O
header	struct
.	O
codepage	int
)	O
;	O
printf	function
(	O
"\t<g id=\"symbol-%lX\" >\n\t\t<!-- %s -->\n"	pointer
,	O
ref	pointer
->	O
absolute_ref	long
,	O
escaped	pointer
?	O
escaped	pointer
:	O
""	pointer
)	O
;	O
if	O
(	O
escaped	pointer
)	O
free	function
(	O
escaped	pointer
)	O
;	O
}	O
obj	pointer
=	O
get_first_owned_entity	function
(	O
ref	pointer
->	O
obj	pointer
)	O
;	O
while	O
(	O
obj	pointer
)	O
{	O
output_object	function
(	O
obj	pointer
)	O
;	O
obj	pointer
=	O
get_next_owned_entity	function
(	O
ref	pointer
->	O
obj	pointer
,	O
obj	pointer
)	O
;	O
}	O
printf	function
(	O
"\t</g>\n"	pointer
)	O
;	O
}	O
static	O
void	O
output_SVG	function
(	O
Dwg_Data	struct
*	O
dwg	pointer
)	O
{	O
BITCODE_BS	short
i	short
;	O
Dwg_Object	struct
*	O
obj	pointer
;	O
Dwg_Object_Ref	struct
*	O
ref	pointer
;	O
Dwg_Object_BLOCK_CONTROL	struct
*	O
block_control	struct
;	O
double	O
dx	double
,	O
dy	double
;	O
model_xmin	double
=	O
dwg_model_x_min	function
(	O
dwg	pointer
)	O
;	O
model_ymin	double
=	O
dwg_model_y_min	function
(	O
dwg	pointer
)	O
;	O
dx	double
=	O
(	O
dwg_model_x_max	function
(	O
dwg	pointer
)	O
-	O
dwg_model_x_min	function
(	O
dwg	pointer
)	O
)	O
;	O
dy	double
=	O
(	O
dwg_model_y_max	function
(	O
dwg	pointer
)	O
-	O
dwg_model_y_min	function
(	O
dwg	pointer
)	O
)	O
;	O
page_width	double
=	O
dx	double
;	O
page_height	double
=	O
dy	double
;	O
printf	function
(	O
"<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?>\n"	pointer
"<svg\n"	pointer
"   xmlns:svg=\"http://www.w3.org/2000/svg\"\n"	pointer
"   xmlns=\"http://www.w3.org/2000/svg\"\n"	pointer
"   xmlns:xlink=\"http://www.w3.org/1999/xlink\"\n"	pointer
"   version=\"1.1\"\n"	pointer
"   width=\"%f\"\n"	pointer
"   height=\"%f\"\n"	pointer
">\n"	pointer
,	O
page_width	double
,	O
page_height	double
)	O
;	O
if	O
(	O
(	O
ref	pointer
=	O
dwg_model_space_ref	function
(	O
dwg	pointer
)	O
)	O
)	O
output_BLOCK_HEADER	function
(	O
ref	pointer
)	O
;	O
if	O
(	O
(	O
ref	pointer
=	O
dwg_paper_space_ref	function
(	O
dwg	pointer
)	O
)	O
)	O
output_BLOCK_HEADER	function
(	O
ref	pointer
)	O
;	O
printf	function
(	O
"\t<defs>\n"	pointer
)	O
;	O
for	O
(	O
i	short
=	O
0	int
;	O
i	short
<	O
dwg	pointer
->	O
block_control	struct
.	O
num_entries	short
;	O
i	short
++	O
)	O
{	O
if	O
(	O
(	O
ref	pointer
=	O
dwg	pointer
->	O
block_control	struct
.	O
entries	pointer
[	O
i	short
]	O
)	O
)	O
output_BLOCK_HEADER	function
(	O
ref	pointer
)	O
;	O
}	O
printf	function
(	O
"\t</defs>\n"	pointer
)	O
;	O
printf	function
(	O
"</svg>\n"	pointer
)	O
;	O
}	O
int	O
main	function
(	O
int	O
argc	int
,	O
char	O
*	O
argv	array
[	O
]	O
)	O
{	O
int	O
error	pointer
;	O
int	O
i	short
=	O
1	int
;	O
int	O
c	int
;	O
int	O
option_index	int
=	O
0	int
;	O
static	O
struct	O
option	struct
long_options	array
[	O
]	O
=	O
{	O
{	O
"verbose"	pointer
,	O
1	int
,	O
&	O
opts	int
,	O
1	int
}	O
,	O
{	O
"help"	pointer
,	O
0	int
,	O
0	int
,	O
0	int
}	O
,	O
{	O
"version"	pointer
,	O
0	int
,	O
0	int
,	O
0	int
}	O
,	O
{	O
NULL	O
,	O
0	int
,	O
NULL	O
,	O
0	int
}	O
}	O
;	O
if	O
(	O
argc	int
<	O
2	int
)	O
return	O
usage	function
(	O
)	O
;	O
while	O
(	O
(	O
c	int
=	O
getopt_long	function
(	O
argc	int
,	O
argv	array
,	O
":v::h"	pointer
,	O
long_options	array
,	O
&	O
option_index	int
)	O
)	O
!=	O
-	O
1	int
)	O
{	O
if	O
(	O
c	int
==	O
-	O
1	int
)	O
break	O
;	O
switch	O
(	O
c	int
)	O
{	O
case	O
':'	O
:	O
if	O
(	O
optarg	pointer
&&	O
!	O
strcmp	function
(	O
optarg	pointer
,	O
"v"	pointer
)	O
)	O
{	O
opts	int
=	O
1	int
;	O
break	O
;	O
}	O
fprintf	function
(	O
stderr	pointer
,	O
"%s: option '-%c' requires an argument\n"	pointer
,	O
argv	array
[	O
0	int
]	O
,	O
optopt	int
)	O
;	O
break	O
;	O
case	O
0	int
:	O
if	O
(	O
!	O
strcmp	function
(	O
long_options	array
[	O
option_index	int
]	O
.	O
name	pointer
,	O
"verbose"	pointer
)	O
)	O
{	O
if	O
(	O
opts	int
<	O
0	int
||	O
opts	int
>	O
9	int
)	O
return	O
usage	function
(	O
)	O
;	O
break	O
;	O
}	O
if	O
(	O
!	O
strcmp	function
(	O
long_options	array
[	O
option_index	int
]	O
.	O
name	pointer
,	O
"version"	pointer
)	O
)	O
return	O
opt_version	function
(	O
)	O
;	O
if	O
(	O
!	O
strcmp	function
(	O
long_options	array
[	O
option_index	int
]	O
.	O
name	pointer
,	O
"help"	pointer
)	O
)	O
return	O
help	function
(	O
)	O
;	O
break	O
;	O
case	O
'v'	O
:	O
i	short
=	O
(	O
optind	int
>	O
0	int
&&	O
optind	int
<	O
argc	int
)	O
?	O
optind	int
-	O
1	int
:	O
1	int
;	O
if	O
(	O
!	O
memcmp	function
(	O
argv	array
[	O
i	short
]	O
,	O
"-v"	pointer
,	O
2	int
)	O
)	O
{	O
opts	int
=	O
argv	array
[	O
i	short
]	O
[	O
2	int
]	O
?	O
argv	array
[	O
i	short
]	O
[	O
2	int
]	O
-	O
'0'	O
:	O
1	int
;	O
}	O
if	O
(	O
opts	int
<	O
0	int
||	O
opts	int
>	O
9	int
)	O
return	O
usage	function
(	O
)	O
;	O
break	O
;	O
case	O
'h'	O
:	O
return	O
help	function
(	O
)	O
;	O
case	O
'?'	O
:	O
fprintf	function
(	O
stderr	pointer
,	O
"%s: invalid option '-%c' ignored\n"	pointer
,	O
argv	array
[	O
0	int
]	O
,	O
optopt	int
)	O
;	O
break	O
;	O
default	O
:	O
return	O
usage	function
(	O
)	O
;	O
}	O
}	O
i	short
=	O
optind	int
;	O
if	O
(	O
i	short
>=	O
argc	int
)	O
return	O
usage	function
(	O
)	O
;	O
memset	function
(	O
&	O
g_dwg	struct
,	O
0	int
,	O
sizeof	O
(	O
Dwg_Data	struct
)	O
)	O
;	O
g_dwg	struct
.	O
opts	int
=	O
opts	int
;	O
error	pointer
=	O
dwg_read_file	function
(	O
argv	array
[	O
i	short
]	O
,	O
&	O
g_dwg	struct
)	O
;	O
if	O
(	O
error	pointer
<	O
DWG_ERR_CRITICAL	O
)	O
output_SVG	function
(	O
&	O
g_dwg	struct
)	O
;	O
dwg_free	function
(	O
&	O
g_dwg	struct
)	O
;	O
return	O
error	pointer
>=	O
DWG_ERR_CRITICAL	O
?	O
1	int
:	O
0	int
;	O
}	O