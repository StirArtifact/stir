int	O
mu_imap_gencom	function
(	O
mu_imap_t	pointer
imap	pointer
,	O
struct	O
imap_command	struct
*	O
cmd	int
)	O
{	O
int	O
status	int
;	O
if	O
(	O
imap	pointer
==	O
NULL	O
||	O
!	O
cmd	int
||	O
cmd	int
->	O
argc	int
<	O
1	int
)	O
return	O
EINVAL	int
;	O
if	O
(	O
!	O
imap	pointer
->	O
io	pointer
)	O
return	O
MU_ERR_NO_TRANSPORT	O
;	O
if	O
(	O
imap	pointer
->	O
session_state	enum
<	O
cmd	int
->	O
session_state	enum
)	O
return	O
MU_ERR_SEQ	O
;	O
if	O
(	O
cmd	int
->	O
capa	pointer
)	O
{	O
status	int
=	O
mu_imap_capability_test	function
(	O
imap	pointer
,	O
cmd	int
->	O
capa	pointer
,	O
NULL	O
)	O
;	O
switch	O
(	O
status	int
)	O
{	O
case	O
0	int
:	O
break	O
;	O
case	O
MU_ERR_NOENT	O
:	O
return	O
ENOSYS	int
;	O
default	O
:	O
return	O
status	int
;	O
}	O
}	O
if	O
(	O
imap	pointer
->	O
client_state	enum
==	O
MU_IMAP_CLIENT_READY	int
)	O
{	O
status	int
=	O
_mu_imap_tag_next	function
(	O
imap	pointer
)	O
;	O
MU_IMAP_CHECK_EAGAIN	O
(	O
imap	pointer
,	O
status	int
)	O
;	O
status	int
=	O
mu_imapio_send_command_v	function
(	O
imap	pointer
->	O
io	pointer
,	O
imap	pointer
->	O
tag_str	pointer
,	O
cmd	int
->	O
msgset	pointer
,	O
cmd	int
->	O
argc	int
,	O
cmd	int
->	O
argv	pointer
,	O
cmd	int
->	O
extra	pointer
)	O
;	O
MU_IMAP_CHECK_ERROR	O
(	O
imap	pointer
,	O
status	int
)	O
;	O
MU_IMAP_FCLR	O
(	O
imap	pointer
,	O
MU_IMAP_RESP	int
)	O
;	O
imap	pointer
->	O
client_state	enum
=	O
cmd	int
->	O
rx_state	int
;	O
}	O
if	O
(	O
imap	pointer
->	O
client_state	enum
==	O
cmd	int
->	O
rx_state	int
)	O
{	O
status	int
=	O
_mu_imap_response	function
(	O
imap	pointer
,	O
cmd	int
->	O
untagged_handler	pointer
,	O
cmd	int
->	O
untagged_handler_data	pointer
)	O
;	O
MU_IMAP_CHECK_EAGAIN	O
(	O
imap	pointer
,	O
status	int
)	O
;	O
if	O
(	O
cmd	int
->	O
tagged_handler	pointer
)	O
cmd	int
->	O
tagged_handler	pointer
(	O
imap	pointer
)	O
;	O
switch	O
(	O
imap	pointer
->	O
response	enum
)	O
{	O
case	O
MU_IMAP_OK	int
:	O
status	int
=	O
0	int
;	O
break	O
;	O
case	O
MU_IMAP_NO	int
:	O
status	int
=	O
MU_ERR_FAILURE	O
;	O
break	O
;	O
case	O
MU_IMAP_BAD	int
:	O
status	int
=	O
MU_ERR_BADREPLY	O
;	O
break	O
;	O
}	O
imap	pointer
->	O
client_state	enum
=	O
MU_IMAP_CLIENT_READY	int
;	O
}	O
else	O
status	int
=	O
EINPROGRESS	int
;	O
return	O
status	int
;	O
}	O
