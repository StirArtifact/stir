int	O
noPrivileges	int
=	O
0	int
;	O
static	O
__inline__	O
void	O
print_privs	(*(char))->(void)
(	O
const	O
char	O
*	O
message	*(char)
UNUSEDP	O
)	O
{	O
}	O
static	O
gid_t	int
rgid	int
,	O
egid	int
;	O
static	O
uid_t	int
ruid	int
,	O
euid	int
;	O
static	O
__inline__	O
void	O
Setuid	(int)->(void)
(	O
uid_t	int
uid	int
)	O
{	O
if	O
(	O
euid	int
==	O
0	int
)	O
{	O
seteuid	(int)->(int)
(	O
uid	int
)	O
;	O
}	O
else	O
setuid	(int)->(int)
(	O
uid	int
)	O
;	O
}	O
void	O
reclaim_privs	()->(void)
(	O
void	O
)	O
{	O
if	O
(	O
noPrivileges	int
)	O
return	O
;	O
setgid	(int)->(int)
(	O
egid	int
)	O
;	O
Setuid	(int)->(void)
(	O
euid	int
)	O
;	O
print_privs	(*(char))->(void)
(	O
"after reclaim privs, both uids should be 0 "	*(char)
)	O
;	O
}	O
void	O
drop_privs	()->(void)
(	O
void	O
)	O
{	O
Setuid	(int)->(void)
(	O
ruid	int
)	O
;	O
setgid	(int)->(int)
(	O
rgid	int
)	O
;	O
print_privs	(*(char))->(void)
(	O
"after drop_privs, real should be 0, effective should not "	*(char)
)	O
;	O
}	O
void	O
destroy_privs	()->(void)
(	O
void	O
)	O
{	O
if	O
(	O
euid	int
==	O
0	int
)	O
{	O
setuid	(int)->(int)
(	O
0	int
)	O
;	O
setuid	(int)->(int)
(	O
ruid	int
)	O
;	O
seteuid	(int)->(int)
(	O
ruid	int
)	O
;	O
}	O
drop_privs	()->(void)
(	O
)	O
;	O
print_privs	(*(char))->(void)
(	O
"destroy_privs, no uid should be zero  "	*(char)
)	O
;	O
}	O
uid_t	int
get_real_uid	()->(int)
(	O
void	O
)	O
{	O
return	O
ruid	int
;	O
}	O
void	O
init_privs	()->(void)
(	O
void	O
)	O
{	O
euid	int
=	O
geteuid	()->(int)
(	O
)	O
;	O
ruid	int
=	O
getuid	()->(int)
(	O
)	O
;	O
egid	int
=	O
getegid	()->(int)
(	O
)	O
;	O
rgid	int
=	O
getgid	()->(int)
(	O
)	O
;	O
if	O
(	O
euid	int
!=	O
ruid	int
)	O
{	O
unsetenv	(*(char))->(int)
(	O
"SOURCE_DATE_EPOCH"	*(char)
)	O
;	O
}	O
if	O
(	O
euid	int
==	O
0	int
&&	O
ruid	int
!=	O
0	int
)	O
{	O
setuid	(int)->(int)
(	O
0	int
)	O
;	O
}	O
drop_privs	()->(void)
(	O
)	O
;	O
print_privs	(*(char))->(void)
(	O
"after init, real should be 0, effective should not "	*(char)
)	O
;	O
}	O
void	O
closeExec	(int)->(void)
(	O
int	O
fd	int
)	O
{	O
fcntl	(int,int)->(int)
(	O
fd	int
,	O
F_SETFD	int
,	O
1	int
)	O
;	O
}	O
