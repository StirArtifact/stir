static	O
void	O
porinode_i_get_next_vinode	(*(struct(int,int,int,int,*(struct(int,int,*`)))),*(long),*(long))->(void)
(	O
PORINODE	struct(int,int,int,int,*(struct(int,int,*(struct(*`,int,int,long,int)))))
*	O
porinode	*(struct(int,int,int,int,*(struct(int,int,*(struct`)))))
,	O
dev_t	long
*	O
p_dev	*(long)
,	O
ino_t	long
*	O
p_ino	*(long)
)	O
{	O
if	O
(	O
porinode	*(struct(int,int,int,int,*(struct(int,int,*(struct`)))))
->	O
current_inodeM	int
>=	O
porinode	*(struct(int,int,int,int,*(struct(int,int,*(struct`)))))
->	O
max_inodeM	int
-	O
1	int
)	O
{	O
if	O
(	O
porinode	*(struct(int,int,int,int,*(struct(int,int,*(struct`)))))
->	O
current_deviceM	int
>=	O
porinode	*(struct(int,int,int,int,*(struct(int,int,*(struct`)))))
->	O
max_deviceM	int
)	O
{	O
fprintf	(*(struct(int,*(char),*(char),*(char),*(char),*(char),*(char),*(char),*(char),*(char),*(char),*(char),*(struct),*(struct(int,*`,*`,*`,*`,*`,*`,*`,*`,*`,*`,*`,*`,*`,int,int,long,short,char,array(char),*`,long,*`,*`,*`,*`,long,int,array(char))),int,int,long,short,char,array(char),*(void),long,*(struct),*(struct),*(struct(int,*`,*`,*`,*`,*`,*`,*`,*`,*`,*`,*`,*`,*`,int,int,long,short,char,array(char),*`,long,*`,*`,*`,*`,long,int,array(char))),*(void),long,int,array(char))),*(char))->(int)
(	O
stderr	*(struct(int,*(char),*(char),*(char),*(char),*(char),*(char),*(char),*(char),*(char),*(char),*(char),*(struct),*(struct(int,*(char),*(char),*(char),*(char),*(char),*(char),*(char),*(char),*(char),*(char),*(char),*(struct`),*(struct`),int,int,long,short,char,array(char),*(void),long,*(struct`),*(struct`),*(struct`),*(void),long,int,array(char))),int,int,long,short,char,array(char),*(void),long,*(struct),*(struct),*(struct(int,*(char),*(char),*(char),*(char),*(char),*(char),*(char),*(char),*(char),*(char),*(char),*(struct`),*(struct`),int,int,long,short,char,array(char),*(void),long,*(struct`),*(struct`),*(struct`),*(void),long,int,array(char))),*(void),long,int,array(char)))
,	O
"porinode: virtual inode space overflow.\n"	*(char)
)	O
;	O
}	O
else	O
{	O
++	O
(	O
porinode	*(struct(int,int,int,int,*(struct(int,int,*(struct`)))))
->	O
current_deviceM	int
)	O
;	O
porinode	*(struct(int,int,int,int,*(struct(int,int,*(struct`)))))
->	O
current_inodeM	int
=	O
0	int
;	O
}	O
}	O
*	O
p_ino	*(long)
=	O
++	O
(	O
porinode	*(struct(int,int,int,int,*(struct(int,int,*(struct`)))))
->	O
current_inodeM	int
)	O
;	O
*	O
p_dev	*(long)
=	O
porinode	*(struct(int,int,int,int,*(struct(int,int,*(struct`)))))
->	O
current_deviceM	int
;	O
}	O
PORINODE	struct(int,int,int,int,*(struct(int,int,*(struct(*`,int,int,long,int)))))
*	O
porinode_open	()->(*(struct(int,int,int,int,*(struct(int,int,*`)))))
(	O
void	O
)	O
{	O
PORINODE	struct(int,int,int,int,*(struct(int,int,*(struct(*`,int,int,long,int)))))
*	O
porinode	*(struct(int,int,int,int,*(struct(int,int,*(struct`)))))
=	O
(	O
PORINODE	struct(int,int,int,int,*(struct(int,int,*(struct(*`,int,int,long,int)))))
*	O
)	O
malloc	(long)->(*(void))
(	O
sizeof	O
(	O
PORINODE	struct(int,int,int,int,*(struct(int,int,*(struct(*`,int,int,long,int)))))
)	O
)	O
;	O
porinode	*(struct(int,int,int,int,*(struct(int,int,*(struct`)))))
->	O
hllistM	*(struct(int,int,*(struct(*(*`),int,int,long,int))))
=	O
hllist_open	()->(*(struct(int,int,*(struct(*`,int,int,long,int)))))
(	O
)	O
;	O
porinode	*(struct(int,int,int,int,*(struct(int,int,*(struct`)))))
->	O
current_inodeM	int
=	O
1	int
;	O
porinode	*(struct(int,int,int,int,*(struct(int,int,*(struct`)))))
->	O
current_deviceM	int
=	O
1	int
;	O
porinode	*(struct(int,int,int,int,*(struct(int,int,*(struct`)))))
->	O
max_inodeM	int
=	O
PORINODE_MAX	O
;	O
porinode	*(struct(int,int,int,int,*(struct(int,int,*(struct`)))))
->	O
max_deviceM	int
=	O
PORINODE_MAX	O
;	O
return	O
porinode	*(struct(int,int,int,int,*(struct(int,int,*(struct`)))))
;	O
}	O
void	O
porinode_close	(*(struct(int,int,int,int,*(struct(int,int,*`)))))->(void)
(	O
PORINODE	struct(int,int,int,int,*(struct(int,int,*(struct(*`,int,int,long,int)))))
*	O
porinode	*(struct(int,int,int,int,*(struct(int,int,*(struct`)))))
)	O
{	O
hllist_close	(*(struct(int,int,*(struct(*`,int,int,long,int)))))->(void)
(	O
porinode	*(struct(int,int,int,int,*(struct(int,int,*(struct`)))))
->	O
hllistM	*(struct(int,int,*(struct(*(*`),int,int,long,int))))
)	O
;	O
swbis_free	O
(	O
porinode	*(struct(int,int,int,int,*(struct(int,int,*(struct`)))))
)	O
;	O
return	O
;	O
}	O
void	O
porinode_add_vrecord	(*(struct(int,int,int,int,*(struct(int,int,*`)))),*(char),long,long,long,long)->(void)
(	O
PORINODE	struct(int,int,int,int,*(struct(int,int,*(struct(*`,int,int,long,int)))))
*	O
porinode	*(struct(int,int,int,int,*(struct(int,int,*(struct`)))))
,	O
char	O
*	O
path	*(char)
,	O
dev_t	long
dev	long
,	O
ino_t	long
ino	long
,	O
dev_t	long
v_dev	long
,	O
ino_t	long
v_ino	long
)	O
{	O
hllist_add_vrecord	(*(struct(int,int,*(struct(*`,int,int,long,int)))),*(char),long,long,long,long)->(void)
(	O
porinode	*(struct(int,int,int,int,*(struct(int,int,*(struct`)))))
->	O
hllistM	*(struct(int,int,*(struct(*(*`),int,int,long,int))))
,	O
path	*(char)
,	O
dev	long
,	O
ino	long
,	O
v_dev	long
,	O
v_ino	long
)	O
;	O
}	O
void	O
porinode_make_next_inode	(*(struct(int,int,int,int,*(struct(int,int,*`)))),int,long,long,*(long),*(long))->(void)
(	O
PORINODE	struct(int,int,int,int,*(struct(int,int,*(struct(*`,int,int,long,int)))))
*	O
porinode	*(struct(int,int,int,int,*(struct(int,int,*(struct`)))))
,	O
int	O
nlinks	int
,	O
dev_t	long
dev	long
,	O
ino_t	long
ino	long
,	O
dev_t	long
*	O
p_dev	*(long)
,	O
ino_t	long
*	O
p_ino	*(long)
)	O
{	O
hllist_entry	struct(*(char),long,long,long,long)
*	O
link_record_buf	*(struct(*(char),long,long,long,long))
=	O
NULL	O
;	O
int	O
nfound	*(int)
=	O
0	int
;	O
if	O
(	O
nlinks	int
<	O
2	int
)	O
{	O
porinode_i_get_next_vinode	(*(struct(int,int,int,int,*(struct(int,int,*`)))),*(long),*(long))->(void)
(	O
porinode	*(struct(int,int,int,int,*(struct(int,int,*(struct`)))))
,	O
p_dev	*(long)
,	O
p_ino	*(long)
)	O
;	O
}	O
else	O
{	O
link_record_buf	*(struct(*(char),long,long,long,long))
=	O
hllist_find_file_entry	(*(struct(int,int,*(struct(*`,int,int,long,int)))),long,long,int,*(int))->(*(struct(*(char),long,long,long,long)))
(	O
porinode	*(struct(int,int,int,int,*(struct(int,int,*(struct`)))))
->	O
hllistM	*(struct(int,int,*(struct(*(*`),int,int,long,int))))
,	O
dev	long
,	O
ino	long
,	O
1	int
,	O
&	O
nfound	*(int)
)	O
;	O
if	O
(	O
nfound	*(int)
==	O
0	int
)	O
{	O
porinode_i_get_next_vinode	(*(struct(int,int,int,int,*(struct(int,int,*`)))),*(long),*(long))->(void)
(	O
porinode	*(struct(int,int,int,int,*(struct(int,int,*(struct`)))))
,	O
p_dev	*(long)
,	O
p_ino	*(long)
)	O
;	O
porinode_add_vrecord	(*(struct(int,int,int,int,*(struct(int,int,*`)))),*(char),long,long,long,long)->(void)
(	O
porinode	*(struct(int,int,int,int,*(struct(int,int,*(struct`)))))
,	O
""	*(char)
,	O
dev	long
,	O
ino	long
,	O
*	O
p_dev	*(long)
,	O
*	O
p_ino	*(long)
)	O
;	O
}	O
else	O
{	O
*	O
p_dev	*(long)
=	O
link_record_buf	*(struct(*(char),long,long,long,long))
->	O
v_dev_	long
;	O
*	O
p_ino	*(long)
=	O
link_record_buf	*(struct(*(char),long,long,long,long))
->	O
v_ino_	long
;	O
}	O
}	O
}	O
