struct	O
file_check_buffer	struct(struct(long,long,long,int,int,int,int,long,long,long,long,struct(long,long),struct(long,long),struct(long,long),array(long)),struct(long,long,long,int,int,int,int,long,long,long,long,struct(long,long),struct(long,long),struct(long,long),array(long)),int)
{	O
struct	O
stat	struct(long,long,long,int,int,int,int,long,long,long,long,struct(long,long),struct(long,long),struct(long,long),array(long))
filst	struct(long,long,long,int,int,int,int,long,long,long,long,struct(long,long),struct(long,long),struct(long,long),array(long))
;	O
struct	O
stat	struct(long,long,long,int,int,int,int,long,long,long,long,struct(long,long),struct(long,long),struct(long,long),array(long))
dirst	struct(long,long,long,int,int,int,int,long,long,long,long,struct(long,long),struct(long,long),struct(long,long),array(long))
;	O
int	O
cdir	int
;	O
}	O
;	O
static	O
int	O
_check_linkwrdir	(*(struct(struct(long,long,long,int,int,int,int,long,long,long,long,struct(long,long),struct(long,long),struct(long,long),array(long)),struct(long,long,long,int,int,int,int,long,long,long,long,struct(long,long),struct(long,long),struct(long,long),array(long)),int)))->(int)
(	O
struct	O
file_check_buffer	struct(struct(long,long,long,int,int,int,int,long,long,long,long,struct(long,long),struct(long,long),struct(long,long),array(long)),struct(long,long,long,int,int,int,int,long,long,long,long,struct(long,long),struct(long,long),struct(long,long),array(long)),int)
*	O
fb	*(struct(struct(long,long,long,int,int,int,int,long,long,long,long,struct(long,long),struct(long,long),struct(long,long),array(long)),struct(long,long,long,int,int,int,int,long,long,long,long,struct(long,long),struct(long,long),struct(long,long),array(long)),int))
)	O
{	O
return	O
(	O
(	O
(	O
(	O
fb	*(struct(struct(long,long,long,int,int,int,int,long,long,long,long,struct(long,long),struct(long,long),struct(long,long),array(long)),struct(long,long,long,int,int,int,int,long,long,long,long,struct(long,long),struct(long,long),struct(long,long),array(long)),int))
->	O
filst	struct(long,long,long,int,int,int,int,long,long,long,long,struct(long,long),struct(long,long),struct(long,long),array(long))
.	O
st_mode	int
&	O
S_IFMT	O
)	O
==	O
S_IFLNK	O
)	O
||	O
fb	*(struct(struct(long,long,long,int,int,int,int,long,long,long,long,struct(long,long),struct(long,long),struct(long,long),array(long)),struct(long,long,long,int,int,int,int,long,long,long,long,struct(long,long),struct(long,long),struct(long,long),array(long)),int))
->	O
filst	struct(long,long,long,int,int,int,int,long,long,long,long,struct(long,long),struct(long,long),struct(long,long),array(long))
.	O
st_nlink	long
>	O
1	int
)	O
&&	O
(	O
fb	*(struct(struct(long,long,long,int,int,int,int,long,long,long,long,struct(long,long),struct(long,long),struct(long,long),array(long)),struct(long,long,long,int,int,int,int,long,long,long,long,struct(long,long),struct(long,long),struct(long,long),array(long)),int))
->	O
dirst	struct(long,long,long,int,int,int,int,long,long,long,long,struct(long,long),struct(long,long),struct(long,long),array(long))
.	O
st_mode	int
&	O
(	O
S_IWGRP	O
|	O
S_IWOTH	O
)	O
)	O
)	O
;	O
}	O
static	O
int	O
_check_gwrdir	(*(struct(struct(long,long,long,int,int,int,int,long,long,long,long,struct(long,long),struct(long,long),struct(long,long),array(long)),struct(long,long,long,int,int,int,int,long,long,long,long,struct(long,long),struct(long,long),struct(long,long),array(long)),int)))->(int)
(	O
struct	O
file_check_buffer	struct(struct(long,long,long,int,int,int,int,long,long,long,long,struct(long,long),struct(long,long),struct(long,long),array(long)),struct(long,long,long,int,int,int,int,long,long,long,long,struct(long,long),struct(long,long),struct(long,long),array(long)),int)
*	O
fb	*(struct(struct(long,long,long,int,int,int,int,long,long,long,long,struct(long,long),struct(long,long),struct(long,long),array(long)),struct(long,long,long,int,int,int,int,long,long,long,long,struct(long,long),struct(long,long),struct(long,long),array(long)),int))
)	O
{	O
return	O
fb	*(struct(struct(long,long,long,int,int,int,int,long,long,long,long,struct(long,long),struct(long,long),struct(long,long),array(long)),struct(long,long,long,int,int,int,int,long,long,long,long,struct(long,long),struct(long,long),struct(long,long),array(long)),int))
->	O
dirst	struct(long,long,long,int,int,int,int,long,long,long,long,struct(long,long),struct(long,long),struct(long,long),array(long))
.	O
st_mode	int
&	O
S_IWGRP	O
;	O
}	O
static	O
int	O
_check_awrdir	(*(struct(struct(long,long,long,int,int,int,int,long,long,long,long,struct(long,long),struct(long,long),struct(long,long),array(long)),struct(long,long,long,int,int,int,int,long,long,long,long,struct(long,long),struct(long,long),struct(long,long),array(long)),int)))->(int)
(	O
struct	O
file_check_buffer	struct(struct(long,long,long,int,int,int,int,long,long,long,long,struct(long,long),struct(long,long),struct(long,long),array(long)),struct(long,long,long,int,int,int,int,long,long,long,long,struct(long,long),struct(long,long),struct(long,long),array(long)),int)
*	O
fb	*(struct(struct(long,long,long,int,int,int,int,long,long,long,long,struct(long,long),struct(long,long),struct(long,long),array(long)),struct(long,long,long,int,int,int,int,long,long,long,long,struct(long,long),struct(long,long),struct(long,long),array(long)),int))
)	O
{	O
return	O
fb	*(struct(struct(long,long,long,int,int,int,int,long,long,long,long,struct(long,long),struct(long,long),struct(long,long),array(long)),struct(long,long,long,int,int,int,int,long,long,long,long,struct(long,long),struct(long,long),struct(long,long),array(long)),int))
->	O
dirst	struct(long,long,long,int,int,int,int,long,long,long,long,struct(long,long),struct(long,long),struct(long,long),array(long))
.	O
st_mode	int
&	O
S_IWOTH	O
;	O
}	O
struct	O
safety_checker	struct(*(char),int,int,int,int,*((*(struct(struct(long,long,long,int,int,int,int,long,long,long,long,struct`,struct`,struct`,array(long)),struct(long,long,long,int,int,int,int,long,long,long,long,struct`,struct`,struct`,array(long)),int)))->(int)))
{	O
char	O
*	O
name	*(char)
;	O
int	O
flag	int
;	O
int	O
err	int
;	O
int	O
mode	int
;	O
int	O
cdir	int
;	O
int	O
(	O
*	O
fun	*((*(char),*(void))->(int))
)	O
(	O
struct	O
file_check_buffer	struct(struct(long,long,long,int,int,int,int,long,long,long,long,struct(long,long),struct(long,long),struct(long,long),array(long)),struct(long,long,long,int,int,int,int,long,long,long,long,struct(long,long),struct(long,long),struct(long,long),array(long)),int)
*	O
fb	*(struct(struct(long,long,long,int,int,int,int,long,long,long,long,struct(long,long),struct(long,long),struct(long,long),array(long)),struct(long,long,long,int,int,int,int,long,long,long,long,struct(long,long),struct(long,long),struct(long,long),array(long)),int))
)	O
;	O
}	O
;	O
static	O
struct	O
safety_checker	struct(*(char),int,int,int,int,*((*(struct(struct(long,long,long,int,int,int,int,long,long,long,long,struct`,struct`,struct`,array(long)),struct(long,long,long,int,int,int,int,long,long,long,long,struct`,struct`,struct`,array(long)),int)))->(int)))
file_safety_check_tab	array(struct(*(char),int,int,int,int,*((*(struct(struct`,struct`,int)))->(int))))
[	O
]	O
=	O
{	O
{	O
"grdfil"	*(char)
,	O
MU_FILE_SAFETY_GROUP_READABLE	int
,	O
MU_ERR_PERM_GROUP_READABLE	O
,	O
S_IRGRP	O
}	O
,	O
{	O
"ardfil"	*(char)
,	O
MU_FILE_SAFETY_WORLD_READABLE	int
,	O
MU_ERR_PERM_WORLD_READABLE	O
,	O
S_IROTH	O
}	O
,	O
{	O
"gwrfil"	*(char)
,	O
MU_FILE_SAFETY_GROUP_WRITABLE	int
,	O
MU_ERR_PERM_GROUP_WRITABLE	O
,	O
S_IWGRP	O
}	O
,	O
{	O
"awrfil"	*(char)
,	O
MU_FILE_SAFETY_WORLD_WRITABLE	int
,	O
MU_ERR_PERM_WORLD_WRITABLE	O
,	O
S_IWOTH	O
}	O
,	O
{	O
"linkwrdir"	*(char)
,	O
MU_FILE_SAFETY_LINKED_WRDIR	int
,	O
MU_ERR_PERM_LINKED_WRDIR	O
,	O
0	int
,	O
1	int
,	O
_check_linkwrdir	(*(struct(struct(long,long,long,int,int,int,int,long,long,long,long,struct(long,long),struct(long,long),struct(long,long),array(long)),struct(long,long,long,int,int,int,int,long,long,long,long,struct(long,long),struct(long,long),struct(long,long),array(long)),int)))->(int)
}	O
,	O
{	O
"gwrdir"	*(char)
,	O
MU_FILE_SAFETY_DIR_IWGRP	int
,	O
MU_ERR_PERM_DIR_IWGRP	O
,	O
0	int
,	O
1	int
,	O
_check_gwrdir	(*(struct(struct(long,long,long,int,int,int,int,long,long,long,long,struct(long,long),struct(long,long),struct(long,long),array(long)),struct(long,long,long,int,int,int,int,long,long,long,long,struct(long,long),struct(long,long),struct(long,long),array(long)),int)))->(int)
}	O
,	O
{	O
"awrdir"	*(char)
,	O
MU_FILE_SAFETY_DIR_IWOTH	int
,	O
MU_ERR_PERM_DIR_IWOTH	O
,	O
0	int
,	O
1	int
,	O
_check_awrdir	(*(struct(struct(long,long,long,int,int,int,int,long,long,long,long,struct(long,long),struct(long,long),struct(long,long),array(long)),struct(long,long,long,int,int,int,int,long,long,long,long,struct(long,long),struct(long,long),struct(long,long),array(long)),int)))->(int)
}	O
,	O
{	O
0	int
}	O
}	O
;	O
struct	O
file_id	struct(long,long)
{	O
dev_t	long
dev	long
;	O
ino_t	long
inode	long
;	O
}	O
;	O
static	O
int	O
file_id_cmp	(*(void),*(void))->(int)
(	O
const	O
void	O
*	O
item	*(void)
,	O
const	O
void	O
*	O
data	*(void)
)	O
{	O
const	O
struct	O
file_id	struct(long,long)
*	O
a	*(struct(*(char),int,int))
=	O
item	*(void)
;	O
const	O
struct	O
file_id	struct(long,long)
*	O
b	*(struct(*(char),int,int))
=	O
data	*(void)
;	O
if	O
(	O
a	*(struct(*(char),int,int))
->	O
dev	long
!=	O
b	*(struct(*(char),int,int))
->	O
dev	long
)	O
return	O
1	int
;	O
if	O
(	O
a	*(struct(*(char),int,int))
->	O
inode	long
!=	O
b	*(struct(*(char),int,int))
->	O
inode	long
)	O
return	O
1	int
;	O
return	O
0	int
;	O
}	O
static	O
int	O
file_id_lookup	(*(struct),long,long)->(int)
(	O
mu_list_t	*(struct)
idlist	*(struct)
,	O
dev_t	long
dev	long
,	O
ino_t	long
ino	long
)	O
{	O
struct	O
file_id	struct(long,long)
id	struct(long,long)
;	O
id	struct(long,long)
.	O
dev	long
=	O
dev	long
;	O
id	struct(long,long)
.	O
inode	long
=	O
ino	long
;	O
return	O
mu_list_locate	(*(struct),*(void),*(*(void)))->(int)
(	O
idlist	*(struct)
,	O
&	O
id	struct(long,long)
,	O
NULL	O
)	O
;	O
}	O
static	O
int	O
file_id_remember	(*(struct),long,long)->(int)
(	O
mu_list_t	*(struct)
idlist	*(struct)
,	O
dev_t	long
dev	long
,	O
ino_t	long
ino	long
)	O
{	O
struct	O
file_id	struct(long,long)
*	O
id	struct(long,long)
=	O
malloc	(long)->(*(void))
(	O
sizeof	O
(	O
*	O
id	struct(long,long)
)	O
)	O
;	O
if	O
(	O
!	O
id	struct(long,long)
)	O
{	O
mu_error	(*(char))->(int)
(	O
"%s"	*(char)
,	O
mu_strerror	(int)->(*(char))
(	O
errno	O
)	O
)	O
;	O
return	O
1	int
;	O
}	O
id	struct(long,long)
->	O
dev	long
=	O
dev	long
;	O
id	struct(long,long)
->	O
inode	long
=	O
ino	long
;	O
return	O
mu_list_append	(*(struct),*(void))->(int)
(	O
idlist	*(struct)
,	O
id	struct(long,long)
)	O
;	O
}	O
static	O
struct	O
safety_checker	struct(*(char),int,int,int,int,*((*(struct(struct(long,long,long,int,int,int,int,long,long,long,long,struct`,struct`,struct`,array(long)),struct(long,long,long,int,int,int,int,long,long,long,long,struct`,struct`,struct`,array(long)),int)))->(int)))
*	O
_find_safety_checker	(*(char))->(*(struct(*(char),int,int,int,int,*((*`)->(int)))))
(	O
const	O
char	O
*	O
name	*(char)
)	O
{	O
struct	O
safety_checker	struct(*(char),int,int,int,int,*((*(struct(struct(long,long,long,int,int,int,int,long,long,long,long,struct`,struct`,struct`,array(long)),struct(long,long,long,int,int,int,int,long,long,long,long,struct`,struct`,struct`,array(long)),int)))->(int)))
*	O
pck	*(struct(*(char),int,int,int,int,*((*(struct`))->(int))))
;	O
for	O
(	O
pck	*(struct(*(char),int,int,int,int,*((*(struct`))->(int))))
=	O
file_safety_check_tab	array(struct(*(char),int,int,int,int,*((*(struct(struct`,struct`,int)))->(int))))
;	O
pck	*(struct(*(char),int,int,int,int,*((*(struct`))->(int))))
->	O
flag	int
;	O
pck	*(struct(*(char),int,int,int,int,*((*(struct`))->(int))))
++	O
)	O
if	O
(	O
strcmp	(*(char),*(char))->(int)
(	O
pck	*(struct(*(char),int,int,int,int,*((*(struct`))->(int))))
->	O
name	*(char)
,	O
name	*(char)
)	O
==	O
0	int
)	O
return	O
pck	*(struct(*(char),int,int,int,int,*((*(struct`))->(int))))
;	O
return	O
NULL	O
;	O
}	O
const	O
char	O
*	O
mu_file_safety_code_to_name	(int)->(*(char))
(	O
int	O
code	int
)	O
{	O
struct	O
safety_checker	struct(*(char),int,int,int,int,*((*(struct(struct(long,long,long,int,int,int,int,long,long,long,long,struct`,struct`,struct`,array(long)),struct(long,long,long,int,int,int,int,long,long,long,long,struct`,struct`,struct`,array(long)),int)))->(int)))
*	O
pck	*(struct(*(char),int,int,int,int,*((*(struct`))->(int))))
;	O
for	O
(	O
pck	*(struct(*(char),int,int,int,int,*((*(struct`))->(int))))
=	O
file_safety_check_tab	array(struct(*(char),int,int,int,int,*((*(struct(struct`,struct`,int)))->(int))))
;	O
pck	*(struct(*(char),int,int,int,int,*((*(struct`))->(int))))
->	O
flag	int
;	O
pck	*(struct(*(char),int,int,int,int,*((*(struct`))->(int))))
++	O
)	O
{	O
if	O
(	O
pck	*(struct(*(char),int,int,int,int,*((*(struct`))->(int))))
->	O
flag	int
==	O
code	int
)	O
return	O
pck	*(struct(*(char),int,int,int,int,*((*(struct`))->(int))))
->	O
name	*(char)
;	O
}	O
return	O
NULL	O
;	O
}	O
int	O
mu_file_safety_name_to_code	(*(char),*(int))->(int)
(	O
const	O
char	O
*	O
name	*(char)
,	O
int	O
*	O
pcode	*(int)
)	O
{	O
struct	O
safety_checker	struct(*(char),int,int,int,int,*((*(struct(struct(long,long,long,int,int,int,int,long,long,long,long,struct`,struct`,struct`,array(long)),struct(long,long,long,int,int,int,int,long,long,long,long,struct`,struct`,struct`,array(long)),int)))->(int)))
*	O
pck	*(struct(*(char),int,int,int,int,*((*(struct`))->(int))))
=	O
_find_safety_checker	(*(char))->(*(struct(*(char),int,int,int,int,*((*`)->(int)))))
(	O
name	*(char)
)	O
;	O
if	O
(	O
pck	*(struct(*(char),int,int,int,int,*((*(struct`))->(int))))
)	O
{	O
*	O
pcode	*(int)
=	O
pck	*(struct(*(char),int,int,int,int,*((*(struct`))->(int))))
->	O
flag	int
;	O
return	O
0	int
;	O
}	O
return	O
MU_ERR_NOENT	O
;	O
}	O
int	O
mu_file_safety_name_to_error	(*(char),*(int))->(int)
(	O
const	O
char	O
*	O
name	*(char)
,	O
int	O
*	O
pcode	*(int)
)	O
{	O
struct	O
safety_checker	struct(*(char),int,int,int,int,*((*(struct(struct(long,long,long,int,int,int,int,long,long,long,long,struct`,struct`,struct`,array(long)),struct(long,long,long,int,int,int,int,long,long,long,long,struct`,struct`,struct`,array(long)),int)))->(int)))
*	O
pck	*(struct(*(char),int,int,int,int,*((*(struct`))->(int))))
=	O
_find_safety_checker	(*(char))->(*(struct(*(char),int,int,int,int,*((*`)->(int)))))
(	O
name	*(char)
)	O
;	O
if	O
(	O
pck	*(struct(*(char),int,int,int,int,*((*(struct`))->(int))))
)	O
{	O
*	O
pcode	*(int)
=	O
pck	*(struct(*(char),int,int,int,int,*((*(struct`))->(int))))
->	O
err	int
;	O
return	O
0	int
;	O
}	O
return	O
MU_ERR_NOENT	O
;	O
}	O
int	O
mu_file_safety_check	(*(char),int,int,*(struct))->(int)
(	O
const	O
char	O
*	O
filename	*(char)
,	O
int	O
mode	int
,	O
uid_t	int
uid	int
,	O
mu_list_t	*(struct)
idlist	*(struct)
)	O
{	O
struct	O
file_check_buffer	struct(struct(long,long,long,int,int,int,int,long,long,long,long,struct(long,long),struct(long,long),struct(long,long),array(long)),struct(long,long,long,int,int,int,int,long,long,long,long,struct(long,long),struct(long,long),struct(long,long),array(long)),int)
buf	array(struct(array(long),int,struct(array(long))))
;	O
if	O
(	O
!	O
filename	*(char)
)	O
return	O
EFAULT	int
;	O
memset	(*(void),int,long)->(*(void))
(	O
&	O
buf	array(struct(array(long),int,struct(array(long))))
,	O
0	int
,	O
sizeof	O
(	O
buf	array(struct(array(long),int,struct(array(long))))
)	O
)	O
;	O
if	O
(	O
lstat	(*(char),*(struct(long,long,long,int,int,int,int,long,long,long,long,struct(long,long),struct(long,long),struct(long,long),array(long))))->(int)
(	O
filename	*(char)
,	O
&	O
buf	array(struct(array(long),int,struct(array(long))))
.	O
filst	struct(long,long,long,int,int,int,int,long,long,long,long,struct(long,long),struct(long,long),struct(long,long),array(long))
)	O
==	O
0	int
)	O
{	O
struct	O
safety_checker	struct(*(char),int,int,int,int,*((*(struct(struct(long,long,long,int,int,int,int,long,long,long,long,struct`,struct`,struct`,array(long)),struct(long,long,long,int,int,int,int,long,long,long,long,struct`,struct`,struct`,array(long)),int)))->(int)))
*	O
pck	*(struct(*(char),int,int,int,int,*((*(struct`))->(int))))
;	O
if	O
(	O
idlist	*(struct)
)	O
{	O
mu_list_set_destroy_item	(*(struct),*((*(void))->(void)))->(*((*(void))->(void)))
(	O
idlist	*(struct)
,	O
mu_list_free_item	(*(void))->(void)
)	O
;	O
mu_list_set_comparator	(*(struct),*((*(void),*(void))->(int)))->(*((*(void),*(void))->(int)))
(	O
idlist	*(struct)
,	O
file_id_cmp	(*(void),*(void))->(int)
)	O
;	O
if	O
(	O
file_id_lookup	(*(struct),long,long)->(int)
(	O
idlist	*(struct)
,	O
buf	array(struct(array(long),int,struct(array(long))))
.	O
filst	struct(long,long,long,int,int,int,int,long,long,long,long,struct(long,long),struct(long,long),struct(long,long),array(long))
.	O
st_dev	long
,	O
buf	array(struct(array(long),int,struct(array(long))))
.	O
filst	struct(long,long,long,int,int,int,int,long,long,long,long,struct(long,long),struct(long,long),struct(long,long),array(long))
.	O
st_ino	long
)	O
==	O
0	int
)	O
return	O
MU_ERR_EXISTS	O
;	O
}	O
if	O
(	O
(	O
mode	int
&	O
MU_FILE_SAFETY_OWNER_MISMATCH	int
)	O
&&	O
uid	int
!=	O
buf	array(struct(array(long),int,struct(array(long))))
.	O
filst	struct(long,long,long,int,int,int,int,long,long,long,long,struct(long,long),struct(long,long),struct(long,long),array(long))
.	O
st_uid	int
)	O
return	O
MU_ERR_PERM_OWNER_MISMATCH	O
;	O
for	O
(	O
pck	*(struct(*(char),int,int,int,int,*((*(struct`))->(int))))
=	O
file_safety_check_tab	array(struct(*(char),int,int,int,int,*((*(struct(struct`,struct`,int)))->(int))))
;	O
pck	*(struct(*(char),int,int,int,int,*((*(struct`))->(int))))
->	O
flag	int
;	O
pck	*(struct(*(char),int,int,int,int,*((*(struct`))->(int))))
++	O
)	O
if	O
(	O
mode	int
&	O
pck	*(struct(*(char),int,int,int,int,*((*(struct`))->(int))))
->	O
flag	int
)	O
{	O
if	O
(	O
pck	*(struct(*(char),int,int,int,int,*((*(struct`))->(int))))
->	O
cdir	int
&&	O
!	O
buf	array(struct(array(long),int,struct(array(long))))
.	O
cdir	int
)	O
{	O
char	O
*	O
dirname	*(char)
,	O
*	O
p	*(char)
;	O
p	*(char)
=	O
strrchr	(*(char),int)->(*(char))
(	O
filename	*(char)
,	O
'/'	O
)	O
;	O
if	O
(	O
!	O
p	*(char)
)	O
dirname	*(char)
=	O
strdup	(*(char))->(*(char))
(	O
"."	*(char)
)	O
;	O
else	O
if	O
(	O
p	*(char)
==	O
filename	*(char)
)	O
dirname	*(char)
=	O
strdup	(*(char))->(*(char))
(	O
"/"	*(char)
)	O
;	O
else	O
{	O
size_t	long
len	int
=	O
p	*(char)
-	O
filename	*(char)
;	O
dirname	*(char)
=	O
malloc	(long)->(*(void))
(	O
len	int
+	O
1	int
)	O
;	O
if	O
(	O
dirname	*(char)
)	O
{	O
memcpy	(*(void),*(void),long)->(*(void))
(	O
dirname	*(char)
,	O
filename	*(char)
,	O
len	int
)	O
;	O
dirname	*(char)
[	O
len	int
]	O
=	O
0	int
;	O
}	O
}	O
if	O
(	O
!	O
dirname	*(char)
)	O
return	O
ENOMEM	int
;	O
if	O
(	O
stat	struct(long,long,long,int,int,int,int,long,long,long,long,struct(long,long),struct(long,long),struct(long,long),array(long))
(	O
dirname	*(char)
,	O
&	O
buf	array(struct(array(long),int,struct(array(long))))
.	O
dirst	struct(long,long,long,int,int,int,int,long,long,long,long,struct(long,long),struct(long,long),struct(long,long),array(long))
)	O
)	O
return	O
errno	O
;	O
buf	array(struct(array(long),int,struct(array(long))))
.	O
cdir	int
=	O
1	int
;	O
}	O
if	O
(	O
(	O
pck	*(struct(*(char),int,int,int,int,*((*(struct`))->(int))))
->	O
fun	*((*(char),*(void))->(int))
&&	O
pck	*(struct(*(char),int,int,int,int,*((*(struct`))->(int))))
->	O
fun	*((*(char),*(void))->(int))
(	O
&	O
buf	array(struct(array(long),int,struct(array(long))))
)	O
)	O
||	O
(	O
buf	array(struct(array(long),int,struct(array(long))))
.	O
filst	struct(long,long,long,int,int,int,int,long,long,long,long,struct(long,long),struct(long,long),struct(long,long),array(long))
.	O
st_mode	int
&	O
pck	*(struct(*(char),int,int,int,int,*((*(struct`))->(int))))
->	O
mode	int
)	O
)	O
return	O
pck	*(struct(*(char),int,int,int,int,*((*(struct`))->(int))))
->	O
err	int
;	O
}	O
if	O
(	O
idlist	*(struct)
)	O
file_id_remember	(*(struct),long,long)->(int)
(	O
idlist	*(struct)
,	O
buf	array(struct(array(long),int,struct(array(long))))
.	O
filst	struct(long,long,long,int,int,int,int,long,long,long,long,struct(long,long),struct(long,long),struct(long,long),array(long))
.	O
st_dev	long
,	O
buf	array(struct(array(long),int,struct(array(long))))
.	O
filst	struct(long,long,long,int,int,int,int,long,long,long,long,struct(long,long),struct(long,long),struct(long,long),array(long))
.	O
st_ino	long
)	O
;	O
return	O
0	int
;	O
}	O
return	O
errno	O
;	O
}	O
int	O
mu_file_mode_to_safety_criteria	(int)->(int)
(	O
int	O
mode	int
)	O
{	O
int	O
fl	int
=	O
0	int
;	O
struct	O
safety_checker	struct(*(char),int,int,int,int,*((*(struct(struct(long,long,long,int,int,int,int,long,long,long,long,struct`,struct`,struct`,array(long)),struct(long,long,long,int,int,int,int,long,long,long,long,struct`,struct`,struct`,array(long)),int)))->(int)))
*	O
pck	*(struct(*(char),int,int,int,int,*((*(struct`))->(int))))
;	O
for	O
(	O
pck	*(struct(*(char),int,int,int,int,*((*(struct`))->(int))))
=	O
file_safety_check_tab	array(struct(*(char),int,int,int,int,*((*(struct(struct`,struct`,int)))->(int))))
;	O
pck	*(struct(*(char),int,int,int,int,*((*(struct`))->(int))))
->	O
name	*(char)
;	O
pck	*(struct(*(char),int,int,int,int,*((*(struct`))->(int))))
++	O
)	O
if	O
(	O
!	O
(	O
mode	int
&	O
pck	*(struct(*(char),int,int,int,int,*((*(struct`))->(int))))
->	O
mode	int
)	O
)	O
fl	int
|=	O
pck	*(struct(*(char),int,int,int,int,*((*(struct`))->(int))))
->	O
flag	int
;	O
return	O
fl	int
;	O
}	O
int	O
mu_safety_criteria_to_file_mode	(int)->(int)
(	O
int	O
crit	int
)	O
{	O
int	O
mode	int
=	O
0666	int
;	O
struct	O
safety_checker	struct(*(char),int,int,int,int,*((*(struct(struct(long,long,long,int,int,int,int,long,long,long,long,struct`,struct`,struct`,array(long)),struct(long,long,long,int,int,int,int,long,long,long,long,struct`,struct`,struct`,array(long)),int)))->(int)))
*	O
pck	*(struct(*(char),int,int,int,int,*((*(struct`))->(int))))
;	O
for	O
(	O
pck	*(struct(*(char),int,int,int,int,*((*(struct`))->(int))))
=	O
file_safety_check_tab	array(struct(*(char),int,int,int,int,*((*(struct(struct`,struct`,int)))->(int))))
;	O
pck	*(struct(*(char),int,int,int,int,*((*(struct`))->(int))))
->	O
name	*(char)
;	O
pck	*(struct(*(char),int,int,int,int,*((*(struct`))->(int))))
++	O
)	O
if	O
(	O
pck	*(struct(*(char),int,int,int,int,*((*(struct`))->(int))))
->	O
flag	int
&&	O
(	O
crit	int
&	O
pck	*(struct(*(char),int,int,int,int,*((*(struct`))->(int))))
->	O
flag	int
)	O
)	O
mode	int
&=	O
~	O
pck	*(struct(*(char),int,int,int,int,*((*(struct`))->(int))))
->	O
mode	int
;	O
return	O
mode	int
;	O
}	O
