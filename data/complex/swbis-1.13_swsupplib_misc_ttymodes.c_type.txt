static	O
struct	O
termios	struct(int,int,int,int,char,array(char),int,int)
save_termios	struct(int,int,int,int,char,array(char),int,int)
;	O
static	O
int	O
ttysavefd	int
=	O
-	O
1	int
;	O
static	O
enum	O
{	O
RESET	int
,	O
RAW	int
,	O
CBREAK	int
}	O
ttystate	enum(int,int,int)
=	O
RESET	int
;	O
int	O
swlib_tty_cbreak	(int)->(int)
(	O
int	O
fd	int
)	O
{	O
struct	O
termios	struct(int,int,int,int,char,array(char),int,int)
buf	struct(int,int,int,int,char,array(char),int,int)
;	O
if	O
(	O
tcgetattr	(int,*(struct(int,int,int,int,char,array(char),int,int)))->(int)
(	O
fd	int
,	O
&	O
save_termios	struct(int,int,int,int,char,array(char),int,int)
)	O
<	O
0	int
)	O
return	O
(	O
-	O
1	int
)	O
;	O
buf	struct(int,int,int,int,char,array(char),int,int)
=	O
save_termios	struct(int,int,int,int,char,array(char),int,int)
;	O
buf	struct(int,int,int,int,char,array(char),int,int)
.	O
c_lflag	int
&=	O
~	O
(	O
ECHO	int
|	O
ICANON	int
)	O
;	O
buf	struct(int,int,int,int,char,array(char),int,int)
.	O
c_cc	array(char)
[	O
VMIN	int
]	O
=	O
1	int
;	O
buf	struct(int,int,int,int,char,array(char),int,int)
.	O
c_cc	array(char)
[	O
VTIME	int
]	O
=	O
0	int
;	O
if	O
(	O
tcsetattr	(int,int,*(struct(int,int,int,int,char,array(char),int,int)))->(int)
(	O
fd	int
,	O
TCSAFLUSH	int
,	O
&	O
buf	struct(int,int,int,int,char,array(char),int,int)
)	O
<	O
0	int
)	O
return	O
(	O
-	O
1	int
)	O
;	O
ttystate	enum(int,int,int)
=	O
CBREAK	int
;	O
ttysavefd	int
=	O
fd	int
;	O
return	O
(	O
0	int
)	O
;	O
}	O
int	O
swlib_tty_raw	(int)->(int)
(	O
int	O
fd	int
)	O
{	O
struct	O
termios	struct(int,int,int,int,char,array(char),int,int)
buf	struct(int,int,int,int,char,array(char),int,int)
;	O
if	O
(	O
tcgetattr	(int,*(struct(int,int,int,int,char,array(char),int,int)))->(int)
(	O
fd	int
,	O
&	O
save_termios	struct(int,int,int,int,char,array(char),int,int)
)	O
<	O
0	int
)	O
return	O
(	O
-	O
1	int
)	O
;	O
buf	struct(int,int,int,int,char,array(char),int,int)
=	O
save_termios	struct(int,int,int,int,char,array(char),int,int)
;	O
buf	struct(int,int,int,int,char,array(char),int,int)
.	O
c_lflag	int
&=	O
~	O
(	O
ECHO	int
|	O
ICANON	int
|	O
IEXTEN	int
|	O
ISIG	int
)	O
;	O
buf	struct(int,int,int,int,char,array(char),int,int)
.	O
c_iflag	int
&=	O
~	O
(	O
BRKINT	int
|	O
ICRNL	int
|	O
INPCK	int
|	O
ISTRIP	int
|	O
IXON	int
)	O
;	O
buf	struct(int,int,int,int,char,array(char),int,int)
.	O
c_cflag	int
&=	O
~	O
(	O
CSIZE	int
|	O
PARENB	int
)	O
;	O
buf	struct(int,int,int,int,char,array(char),int,int)
.	O
c_cflag	int
|=	O
CS8	int
;	O
buf	struct(int,int,int,int,char,array(char),int,int)
.	O
c_oflag	int
&=	O
~	O
(	O
OPOST	int
)	O
;	O
buf	struct(int,int,int,int,char,array(char),int,int)
.	O
c_cc	array(char)
[	O
VMIN	int
]	O
=	O
1	int
;	O
buf	struct(int,int,int,int,char,array(char),int,int)
.	O
c_cc	array(char)
[	O
VTIME	int
]	O
=	O
0	int
;	O
if	O
(	O
tcsetattr	(int,int,*(struct(int,int,int,int,char,array(char),int,int)))->(int)
(	O
fd	int
,	O
TCSAFLUSH	int
,	O
&	O
buf	struct(int,int,int,int,char,array(char),int,int)
)	O
<	O
0	int
)	O
return	O
(	O
-	O
1	int
)	O
;	O
ttystate	enum(int,int,int)
=	O
RAW	int
;	O
ttysavefd	int
=	O
fd	int
;	O
return	O
(	O
0	int
)	O
;	O
}	O
int	O
swlib_tty_reset	(int)->(int)
(	O
int	O
fd	int
)	O
{	O
if	O
(	O
ttystate	enum(int,int,int)
!=	O
CBREAK	int
&&	O
ttystate	enum(int,int,int)
!=	O
RAW	int
)	O
return	O
(	O
0	int
)	O
;	O
if	O
(	O
tcsetattr	(int,int,*(struct(int,int,int,int,char,array(char),int,int)))->(int)
(	O
fd	int
,	O
TCSAFLUSH	int
,	O
&	O
save_termios	struct(int,int,int,int,char,array(char),int,int)
)	O
<	O
0	int
)	O
return	O
(	O
-	O
1	int
)	O
;	O
ttystate	enum(int,int,int)
=	O
RESET	int
;	O
return	O
(	O
0	int
)	O
;	O
}	O
void	O
swlib_tty_atexit	()->(void)
(	O
void	O
)	O
{	O
if	O
(	O
ttysavefd	int
>=	O
0	int
)	O
swlib_tty_reset	(int)->(int)
(	O
ttysavefd	int
)	O
;	O
}	O
struct	O
termios	struct(int,int,int,int,char,array(char),int,int)
*	O
swlib_tty_termios	()->(*(struct(int,int,int,int,char,array(char),int,int)))
(	O
void	O
)	O
{	O
return	O
(	O
&	O
save_termios	struct(int,int,int,int,char,array(char),int,int)
)	O
;	O
}	O
