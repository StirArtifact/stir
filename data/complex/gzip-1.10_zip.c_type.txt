local	O
ulg	long
crc	long
;	O
off_t	long
header_bytes	long
;	O
int	O
zip	(int,int)->(int)
(	O
in	int
,	O
out	int
)	O
int	O
in	int
,	O
out	int
;	O
{	O
uch	char
flags	*(short)
=	O
0	int
;	O
ush	short
attr	*(short)
=	O
0	int
;	O
ush	short
deflate_flags	short
=	O
0	int
;	O
ulg	long
stamp	long
;	O
ifd	int
=	O
in	int
;	O
ofd	int
=	O
out	int
;	O
outcnt	int
=	O
0	int
;	O
method	int
=	O
DEFLATED	int
;	O
put_byte	O
(	O
GZIP_MAGIC	*(char)
[	O
0	int
]	O
)	O
;	O
put_byte	O
(	O
GZIP_MAGIC	*(char)
[	O
1	int
]	O
)	O
;	O
put_byte	O
(	O
DEFLATED	int
)	O
;	O
if	O
(	O
save_orig_name	int
)	O
{	O
flags	*(short)
|=	O
ORIG_NAME	int
;	O
}	O
put_byte	O
(	O
flags	*(short)
)	O
;	O
if	O
(	O
time_stamp	struct(long,long)
.	O
tv_nsec	long
<	O
0	int
)	O
stamp	long
=	O
0	int
;	O
else	O
if	O
(	O
0	int
<	O
time_stamp	struct(long,long)
.	O
tv_sec	long
&&	O
time_stamp	struct(long,long)
.	O
tv_sec	long
<=	O
0xffffffff	int
)	O
stamp	long
=	O
time_stamp	struct(long,long)
.	O
tv_sec	long
;	O
else	O
{	O
warning	(*(char))->(void)
(	O
"file timestamp out of range for gzip format"	*(char)
)	O
;	O
stamp	long
=	O
0	int
;	O
}	O
put_long	O
(	O
stamp	long
)	O
;	O
crc	long
=	O
updcrc	(*(char),int)->(long)
(	O
0	int
,	O
0	int
)	O
;	O
bi_init	(int)->(void)
(	O
out	int
)	O
;	O
ct_init	(*(short),*(int))->(void)
(	O
&	O
attr	*(short)
,	O
&	O
method	int
)	O
;	O
lm_init	(int,*(short))->(void)
(	O
level	int
,	O
&	O
deflate_flags	short
)	O
;	O
put_byte	O
(	O
(	O
uch	char
)	O
deflate_flags	short
)	O
;	O
put_byte	O
(	O
OS_CODE	int
)	O
;	O
if	O
(	O
save_orig_name	int
)	O
{	O
char	O
*	O
p	*(char)
=	O
gzip_base_name	(*(char))->(*(char))
(	O
ifname	array(char)
)	O
;	O
do	O
{	O
put_byte	O
(	O
*	O
p	*(char)
)	O
;	O
}	O
while	O
(	O
*	O
p	*(char)
++	O
)	O
;	O
}	O
header_bytes	long
=	O
(	O
off_t	long
)	O
outcnt	int
;	O
(	O
void	O
)	O
deflate	()->(long)
(	O
)	O
;	O
if	O
(	O
ifile_size	long
!=	O
-	O
1L	int
&&	O
bytes_in	long
!=	O
ifile_size	long
)	O
{	O
fprintf	(*(struct(int,*(char),*(char),*(char),*(char),*(char),*(char),*(char),*(char),*(char),*(char),*(char),*(struct),*(struct(int,*`,*`,*`,*`,*`,*`,*`,*`,*`,*`,*`,*`,*`,int,int,long,short,char,array(char),*`,long,*`,*`,*`,*`,long,int,array(char))),int,int,long,short,char,array(char),*(void),long,*(struct),*(struct),*(struct(int,*`,*`,*`,*`,*`,*`,*`,*`,*`,*`,*`,*`,*`,int,int,long,short,char,array(char),*`,long,*`,*`,*`,*`,long,int,array(char))),*(void),long,int,array(char))),*(char))->(int)
(	O
stderr	*(struct(int,*(char),*(char),*(char),*(char),*(char),*(char),*(char),*(char),*(char),*(char),*(char),*(struct),*(struct(int,*(char),*(char),*(char),*(char),*(char),*(char),*(char),*(char),*(char),*(char),*(char),*(struct`),*(struct`),int,int,long,short,char,array(char),*(void),long,*(struct`),*(struct`),*(struct`),*(void),long,int,array(char))),int,int,long,short,char,array(char),*(void),long,*(struct),*(struct),*(struct(int,*(char),*(char),*(char),*(char),*(char),*(char),*(char),*(char),*(char),*(char),*(char),*(struct`),*(struct`),int,int,long,short,char,array(char),*(void),long,*(struct`),*(struct`),*(struct`),*(void),long,int,array(char))),*(void),long,int,array(char)))
,	O
"%s: %s: file size changed while zipping\n"	*(char)
,	O
program_name	*(char)
,	O
ifname	array(char)
)	O
;	O
}	O
put_long	O
(	O
crc	long
)	O
;	O
put_long	O
(	O
(	O
ulg	long
)	O
bytes_in	long
)	O
;	O
header_bytes	long
+=	O
2	int
*	O
4	int
;	O
flush_outbuf	()->(void)
(	O
)	O
;	O
return	O
OK	int
;	O
}	O
int	O
file_read	(*(char),int)->(int)
(	O
buf	*(char)
,	O
size	int
)	O
char	O
*	O
buf	*(char)
;	O
unsigned	O
size	int
;	O
{	O
unsigned	O
len	int
;	O
Assert	O
(	O
insize	int
==	O
0	int
,	O
"inbuf not empty"	*(char)
)	O
;	O
len	int
=	O
read_buffer	(int,*(void),int)->(int)
(	O
ifd	int
,	O
buf	*(char)
,	O
size	int
)	O
;	O
if	O
(	O
len	int
==	O
0	int
)	O
return	O
(	O
int	O
)	O
len	int
;	O
if	O
(	O
len	int
==	O
(	O
unsigned	O
)	O
-	O
1	int
)	O
{	O
read_error	()->(void)
(	O
)	O
;	O
}	O
crc	long
=	O
updcrc	(*(char),int)->(long)
(	O
(	O
uch	char
*	O
)	O
buf	*(char)
,	O
len	int
)	O
;	O
bytes_in	long
+=	O
(	O
off_t	long
)	O
len	int
;	O
return	O
(	O
int	O
)	O
len	int
;	O
}	O
