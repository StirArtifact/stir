int	O
run_in_dir	(*(struct(int,*(char))),*((*(void))->(int)),*(void))->(int)
(	O
const	O
struct	O
saved_cwd	struct(int,*(char))
*	O
there	*(struct(int,*(char)))
,	O
int	O
(	O
*	O
callback	*((*(void))->(int))
)	O
(	O
void	O
*	O
)	O
,	O
void	O
*	O
usercontext	*(void)
)	O
{	O
int	O
err	int
=	O
-	O
1	int
;	O
int	O
saved_errno	int
=	O
0	int
;	O
struct	O
saved_cwd	struct(int,*(char))
here	struct(int,*(char))
;	O
if	O
(	O
0	int
==	O
save_cwd	(*(struct(int,*(char))))->(int)
(	O
&	O
here	struct(int,*(char))
)	O
)	O
{	O
if	O
(	O
0	int
==	O
restore_cwd	(*(struct(int,*(char))))->(int)
(	O
there	*(struct(int,*(char)))
)	O
)	O
{	O
err	int
=	O
callback	*((*(void))->(int))
(	O
usercontext	*(void)
)	O
;	O
saved_errno	int
=	O
(	O
err	int
<	O
0	int
?	O
errno	O
:	O
0	int
)	O
;	O
}	O
else	O
{	O
openat_restore_fail	(int)->(void)
(	O
errno	O
)	O
;	O
}	O
if	O
(	O
restore_cwd	(*(struct(int,*(char))))->(int)
(	O
&	O
here	struct(int,*(char))
)	O
!=	O
0	int
)	O
openat_restore_fail	(int)->(void)
(	O
errno	O
)	O
;	O
free_cwd	(*(struct(int,*(char))))->(void)
(	O
&	O
here	struct(int,*(char))
)	O
;	O
}	O
else	O
{	O
openat_save_fail	(int)->(void)
(	O
errno	O
)	O
;	O
}	O
if	O
(	O
saved_errno	int
)	O
errno	O
=	O
saved_errno	int
;	O
return	O
err	int
;	O
}	O
int	O
run_in_dirfd	(int,*((*(void))->(int)),*(void))->(int)
(	O
int	O
dir_fd	int
,	O
int	O
(	O
*	O
callback	*((*(void))->(int))
)	O
(	O
void	O
*	O
)	O
,	O
void	O
*	O
usercontext	*(void)
)	O
{	O
if	O
(	O
dir_fd	int
==	O
AT_FDCWD	O
)	O
{	O
return	O
(	O
*	O
callback	*((*(void))->(int))
)	O
(	O
usercontext	*(void)
)	O
;	O
}	O
else	O
{	O
struct	O
saved_cwd	struct(int,*(char))
saved_cwd	struct(int,*(char))
;	O
int	O
saved_errno	int
;	O
int	O
err	int
;	O
if	O
(	O
save_cwd	(*(struct(int,*(char))))->(int)
(	O
&	O
saved_cwd	struct(int,*(char))
)	O
!=	O
0	int
)	O
openat_save_fail	(int)->(void)
(	O
errno	O
)	O
;	O
if	O
(	O
fchdir	(int)->(int)
(	O
dir_fd	int
)	O
!=	O
0	int
)	O
{	O
saved_errno	int
=	O
errno	O
;	O
free_cwd	(*(struct(int,*(char))))->(void)
(	O
&	O
saved_cwd	struct(int,*(char))
)	O
;	O
errno	O
=	O
saved_errno	int
;	O
return	O
-	O
1	int
;	O
}	O
err	int
=	O
(	O
*	O
callback	*((*(void))->(int))
)	O
(	O
usercontext	*(void)
)	O
;	O
saved_errno	int
=	O
(	O
err	int
<	O
0	int
?	O
errno	O
:	O
0	int
)	O
;	O
if	O
(	O
restore_cwd	(*(struct(int,*(char))))->(int)
(	O
&	O
saved_cwd	struct(int,*(char))
)	O
!=	O
0	int
)	O
openat_restore_fail	(int)->(void)
(	O
errno	O
)	O
;	O
free_cwd	(*(struct(int,*(char))))->(void)
(	O
&	O
saved_cwd	struct(int,*(char))
)	O
;	O
if	O
(	O
saved_errno	int
)	O
errno	O
=	O
saved_errno	int
;	O
return	O
err	int
;	O
}	O
}	O
