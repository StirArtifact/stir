error_t	(*(int))->(int)
ps_context_create	(int,*(*(struct)))->(int)
(	O
process_t	O
server	int
,	O
struct	O
ps_context	O
*	O
*	O
pc	*(*(struct))
)	O
{	O
*	O
pc	*(*(struct))
=	O
NEW	()->(int)
(	O
struct	O
ps_context	O
)	O
;	O
if	O
(	O
*	O
pc	*(*(struct))
==	O
NULL	O
)	O
return	O
ENOMEM	O
;	O
(	O
*	O
pc	*(*(struct))
)	O
->	O
server	int
=	O
server	int
;	O
(	O
*	O
pc	*(*(struct))
)	O
->	O
user_hooks	O
=	O
0	int
;	O
hurd_ihash_init	()->(int)
(	O
&	O
(	O
*	O
pc	*(*(struct))
)	O
->	O
procs	O
,	O
HURD_IHASH_NO_LOCP	O
)	O
;	O
hurd_ihash_init	()->(int)
(	O
&	O
(	O
*	O
pc	*(*(struct))
)	O
->	O
ttys	O
,	O
HURD_IHASH_NO_LOCP	O
)	O
;	O
hurd_ihash_init	()->(int)
(	O
&	O
(	O
*	O
pc	*(*(struct))
)	O
->	O
ttys_by_cttyid	O
,	O
HURD_IHASH_NO_LOCP	O
)	O
;	O
hurd_ihash_init	()->(int)
(	O
&	O
(	O
*	O
pc	*(*(struct))
)	O
->	O
users	O
,	O
HURD_IHASH_NO_LOCP	O
)	O
;	O
hurd_ihash_set_cleanup	()->(int)
(	O
&	O
(	O
*	O
pc	*(*(struct))
)	O
->	O
procs	O
,	O
(	O
hurd_ihash_cleanup_t	O
)	O
_proc_stat_free	O
,	O
NULL	O
)	O
;	O
hurd_ihash_set_cleanup	()->(int)
(	O
&	O
(	O
*	O
pc	*(*(struct))
)	O
->	O
ttys	O
,	O
(	O
hurd_ihash_cleanup_t	O
)	O
ps_tty_free	O
,	O
NULL	O
)	O
;	O
hurd_ihash_set_cleanup	()->(int)
(	O
&	O
(	O
*	O
pc	*(*(struct))
)	O
->	O
users	O
,	O
(	O
hurd_ihash_cleanup_t	O
)	O
ps_user_free	O
,	O
NULL	O
)	O
;	O
return	O
0	int
;	O
}	O
void	O
ps_context_free	(*(struct))->(void)
(	O
struct	O
ps_context	O
*	O
pc	*(*(struct))
)	O
{	O
hurd_ihash_destroy	()->(int)
(	O
&	O
pc	*(*(struct))
->	O
procs	O
)	O
;	O
hurd_ihash_destroy	()->(int)
(	O
&	O
pc	*(*(struct))
->	O
ttys	O
)	O
;	O
hurd_ihash_destroy	()->(int)
(	O
&	O
pc	*(*(struct))
->	O
ttys_by_cttyid	O
)	O
;	O
hurd_ihash_destroy	()->(int)
(	O
&	O
pc	*(*(struct))
->	O
users	O
)	O
;	O
free	()->(int)
(	O
pc	*(*(struct))
)	O
;	O
}	O
static	O
error_t	(*(int))->(int)
lookup	(int,int,(*(int))->(int),*(*(void)))->(int)
(	O
int	O
id	int
,	O
hurd_ihash_t	O
ht	int
,	O
error_t	(*(int))->(int)
(	O
*	O
create	*(int)
)	O
(	O
int	O
id	int
,	O
void	O
*	O
*	O
)	O
,	O
void	O
*	O
*	O
value	*(*(void))
)	O
{	O
*	O
value	*(*(void))
=	O
hurd_ihash_find	()->(int)
(	O
ht	int
,	O
id	int
)	O
;	O
if	O
(	O
*	O
value	*(*(void))
==	O
NULL	O
)	O
{	O
error_t	(*(int))->(int)
err	O
=	O
create	*(int)
(	O
id	int
,	O
value	*(*(void))
)	O
;	O
if	O
(	O
err	O
)	O
return	O
err	O
;	O
hurd_ihash_add	()->(int)
(	O
ht	int
,	O
id	int
,	O
*	O
value	*(*(void))
)	O
;	O
}	O
return	O
0	int
;	O
}	O
error_t	(*(int))->(int)
ps_context_find_proc_stat	(*(struct),int,*(*(struct)))->(int)
(	O
struct	O
ps_context	O
*	O
pc	*(*(struct))
,	O
pid_t	O
pid	int
,	O
struct	O
proc_stat	O
*	O
*	O
ps	*(*(struct))
)	O
{	O
error_t	(*(int))->(int)
create	*(int)
(	O
int	O
pid	int
,	O
void	O
*	O
*	O
value	*(*(void))
)	O
{	O
return	O
_proc_stat_create	O
(	O
pid	int
,	O
pc	*(*(struct))
,	O
(	O
struct	O
proc_stat	O
*	O
*	O
)	O
value	*(*(void))
)	O
;	O
}	O
return	O
lookup	(int,int,(*(int))->(int),*(*(void)))->(int)
(	O
pid	int
,	O
&	O
pc	*(*(struct))
->	O
procs	O
,	O
create	*(int)
,	O
(	O
void	O
*	O
*	O
)	O
ps	*(*(struct))
)	O
;	O
}	O
error_t	(*(int))->(int)
ps_context_find_tty	(*(struct),int,*(*(struct)))->(int)
(	O
struct	O
ps_context	O
*	O
pc	*(*(struct))
,	O
mach_port_t	O
tty_port	int
,	O
struct	O
ps_tty	O
*	O
*	O
tty	*(*(struct))
)	O
{	O
return	O
lookup	(int,int,(*(int))->(int),*(*(void)))->(int)
(	O
tty_port	int
,	O
&	O
pc	*(*(struct))
->	O
ttys	O
,	O
(	O
error_t	(*(int))->(int)
(	O
*	O
)	O
(	O
int	O
id	int
,	O
void	O
*	O
*	O
result	O
)	O
)	O
ps_tty_create	O
,	O
(	O
void	O
*	O
*	O
)	O
tty	*(*(struct))
)	O
;	O
}	O
error_t	(*(int))->(int)
ps_context_find_tty_by_cttyid	(*(struct),int,*(*(struct)))->(int)
(	O
struct	O
ps_context	O
*	O
pc	*(*(struct))
,	O
mach_port_t	O
cttyid_port	int
,	O
struct	O
ps_tty	O
*	O
*	O
tty	*(*(struct))
)	O
{	O
error_t	(*(int))->(int)
create	*(int)
(	O
int	O
cttyid_port	int
,	O
void	O
*	O
*	O
value	*(*(void))
)	O
{	O
if	O
(	O
cttyid_port	int
==	O
MACH_PORT_NULL	O
)	O
{	O
*	O
value	*(*(void))
=	O
0	int
;	O
return	O
0	int
;	O
}	O
else	O
{	O
mach_port_t	O
tty_port	int
;	O
error_t	(*(int))->(int)
err	O
=	O
termctty_open_terminal	O
(	O
cttyid_port	int
,	O
0	int
,	O
&	O
tty_port	int
)	O
;	O
if	O
(	O
err	O
)	O
return	O
err	O
;	O
else	O
return	O
ps_context_find_tty	(*(struct),int,*(*(struct)))->(int)
(	O
pc	*(*(struct))
,	O
tty_port	int
,	O
(	O
struct	O
ps_tty	O
*	O
*	O
)	O
value	*(*(void))
)	O
;	O
}	O
}	O
return	O
lookup	(int,int,(*(int))->(int),*(*(void)))->(int)
(	O
cttyid_port	int
,	O
&	O
pc	*(*(struct))
->	O
ttys_by_cttyid	O
,	O
create	*(int)
,	O
(	O
void	O
*	O
*	O
)	O
tty	*(*(struct))
)	O
;	O
}	O
error_t	(*(int))->(int)
ps_context_find_user	(*(struct),int,*(*(struct)))->(int)
(	O
struct	O
ps_context	O
*	O
pc	*(*(struct))
,	O
uid_t	O
uid	int
,	O
struct	O
ps_user	O
*	O
*	O
u	*(*(struct))
)	O
{	O
return	O
lookup	(int,int,(*(int))->(int),*(*(void)))->(int)
(	O
uid	int
,	O
&	O
pc	*(*(struct))
->	O
users	O
,	O
(	O
error_t	(*(int))->(int)
(	O
*	O
)	O
(	O
int	O
id	int
,	O
void	O
*	O
*	O
result	O
)	O
)	O
ps_user_create	O
,	O
(	O
void	O
*	O
*	O
)	O
u	*(*(struct))
)	O
;	O
}	O
