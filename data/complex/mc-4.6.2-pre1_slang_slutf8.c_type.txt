static	O
unsigned	O
char	O
Len_Map	array(char)
[	O
256	int
]	O
=	O
{	O
0	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
1	int
,	O
0	int
,	O
0	int
,	O
0	int
,	O
0	int
,	O
0	int
,	O
0	int
,	O
0	int
,	O
0	int
,	O
0	int
,	O
0	int
,	O
0	int
,	O
0	int
,	O
0	int
,	O
0	int
,	O
0	int
,	O
0	int
,	O
0	int
,	O
0	int
,	O
0	int
,	O
0	int
,	O
0	int
,	O
0	int
,	O
0	int
,	O
0	int
,	O
0	int
,	O
0	int
,	O
0	int
,	O
0	int
,	O
0	int
,	O
0	int
,	O
0	int
,	O
0	int
,	O
0	int
,	O
0	int
,	O
0	int
,	O
0	int
,	O
0	int
,	O
0	int
,	O
0	int
,	O
0	int
,	O
0	int
,	O
0	int
,	O
0	int
,	O
0	int
,	O
0	int
,	O
0	int
,	O
0	int
,	O
0	int
,	O
0	int
,	O
0	int
,	O
0	int
,	O
0	int
,	O
0	int
,	O
0	int
,	O
0	int
,	O
0	int
,	O
0	int
,	O
0	int
,	O
0	int
,	O
0	int
,	O
0	int
,	O
0	int
,	O
0	int
,	O
0	int
,	O
2	int
,	O
2	int
,	O
2	int
,	O
2	int
,	O
2	int
,	O
2	int
,	O
2	int
,	O
2	int
,	O
2	int
,	O
2	int
,	O
2	int
,	O
2	int
,	O
2	int
,	O
2	int
,	O
2	int
,	O
2	int
,	O
2	int
,	O
2	int
,	O
2	int
,	O
2	int
,	O
2	int
,	O
2	int
,	O
2	int
,	O
2	int
,	O
2	int
,	O
2	int
,	O
2	int
,	O
2	int
,	O
2	int
,	O
2	int
,	O
2	int
,	O
2	int
,	O
3	int
,	O
3	int
,	O
3	int
,	O
3	int
,	O
3	int
,	O
3	int
,	O
3	int
,	O
3	int
,	O
3	int
,	O
3	int
,	O
3	int
,	O
3	int
,	O
3	int
,	O
3	int
,	O
3	int
,	O
3	int
,	O
4	int
,	O
4	int
,	O
4	int
,	O
4	int
,	O
4	int
,	O
4	int
,	O
4	int
,	O
4	int
,	O
5	int
,	O
5	int
,	O
5	int
,	O
5	int
,	O
6	int
,	O
6	int
,	O
1	int
,	O
1	int
}	O
;	O
_INLINE_	O
static	O
int	O
is_invalid_or_overlong_utf8	(*(char),int)->(int)
(	O
SLuchar_Type	char
*	O
u	*(char)
,	O
unsigned	O
int	O
len	int
)	O
{	O
unsigned	O
int	O
i	array(int)
;	O
unsigned	O
char	O
ch	int
,	O
ch1	char
;	O
for	O
(	O
i	array(int)
=	O
1	int
;	O
i	array(int)
<	O
len	int
;	O
i	array(int)
++	O
)	O
{	O
if	O
(	O
(	O
u	*(char)
[	O
i	array(int)
]	O
&	O
0xC0	int
)	O
!=	O
0x80	int
)	O
return	O
1	int
;	O
}	O
ch	int
=	O
*	O
u	*(char)
;	O
if	O
(	O
(	O
ch	int
==	O
0xC0	int
)	O
||	O
(	O
ch	int
==	O
0xC1	int
)	O
)	O
return	O
1	int
;	O
ch1	char
=	O
u	*(char)
[	O
1	int
]	O
;	O
if	O
(	O
(	O
(	O
ch1	char
&	O
ch	int
)	O
==	O
0x80	int
)	O
&&	O
(	O
(	O
ch	int
==	O
0xE0	int
)	O
||	O
(	O
ch	int
==	O
0xF0	int
)	O
||	O
(	O
ch	int
==	O
0xF8	int
)	O
||	O
(	O
ch	int
==	O
0xFC	int
)	O
)	O
)	O
return	O
1	int
;	O
if	O
(	O
len	int
==	O
3	int
)	O
{	O
if	O
(	O
(	O
ch	int
==	O
0xED	int
)	O
&&	O
(	O
(	O
ch1	char
>=	O
0xA0	int
)	O
&&	O
(	O
ch1	char
<=	O
0xBF	int
)	O
)	O
&&	O
(	O
u	*(char)
[	O
2	int
]	O
>=	O
0x80	int
)	O
&&	O
(	O
u	*(char)
[	O
2	int
]	O
<=	O
0xBF	int
)	O
)	O
return	O
1	int
;	O
if	O
(	O
(	O
ch	int
==	O
0xEF	int
)	O
&&	O
(	O
ch1	char
==	O
0xBF	int
)	O
&&	O
(	O
(	O
u	*(char)
[	O
2	int
]	O
==	O
0xBE	int
)	O
||	O
(	O
u	*(char)
[	O
2	int
]	O
==	O
0xBF	int
)	O
)	O
)	O
return	O
1	int
;	O
}	O
return	O
0	int
;	O
}	O
_INLINE_	O
static	O
SLwchar_Type	int
fast_utf8_decode	(*(char),int)->(int)
(	O
SLuchar_Type	char
*	O
u	*(char)
,	O
unsigned	O
int	O
len	int
)	O
{	O
static	O
unsigned	O
char	O
masks	array(char)
[	O
7	int
]	O
=	O
{	O
0	int
,	O
0	int
,	O
0x1F	int
,	O
0xF	int
,	O
0x7	int
,	O
0x3	int
,	O
0x1	int
}	O
;	O
SLuchar_Type	char
*	O
umax	*(char)
;	O
SLwchar_Type	int
w	*(int)
;	O
w	*(int)
=	O
(	O
*	O
u	*(char)
&	O
masks	array(char)
[	O
len	int
]	O
)	O
;	O
umax	*(char)
=	O
u	*(char)
+	O
len	int
;	O
u	*(char)
++	O
;	O
while	O
(	O
u	*(char)
<	O
umax	*(char)
)	O
{	O
w	*(int)
=	O
(	O
w	*(int)
<<	O
6	int
)	O
|	O
(	O
u	*(char)
[	O
0	int
]	O
&	O
0x3F	int
)	O
;	O
u	*(char)
++	O
;	O
}	O
return	O
w	*(int)
;	O
}	O
unsigned	O
char	O
*	O
SLutf8_skip_char	(*(char),*(char))->(*(char))
(	O
unsigned	O
char	O
*	O
s	*(char)
,	O
unsigned	O
char	O
*	O
smax	*(char)
)	O
{	O
unsigned	O
int	O
len	int
;	O
if	O
(	O
s	*(char)
>=	O
smax	*(char)
)	O
return	O
s	*(char)
;	O
len	int
=	O
Len_Map	array(char)
[	O
*	O
s	*(char)
]	O
;	O
if	O
(	O
len	int
<=	O
1	int
)	O
return	O
s	*(char)
+	O
1	int
;	O
if	O
(	O
s	*(char)
+	O
len	int
>	O
smax	*(char)
)	O
return	O
s	*(char)
+	O
1	int
;	O
if	O
(	O
is_invalid_or_overlong_utf8	(*(char),int)->(int)
(	O
s	*(char)
,	O
len	int
)	O
)	O
return	O
s	*(char)
+	O
1	int
;	O
return	O
s	*(char)
+	O
len	int
;	O
}	O
SLuchar_Type	char
*	O
SLutf8_skip_chars	(*(char),*(char),int,*(int),int)->(*(char))
(	O
SLuchar_Type	char
*	O
s	*(char)
,	O
SLuchar_Type	char
*	O
smax	*(char)
,	O
unsigned	O
int	O
num	int
,	O
unsigned	O
int	O
*	O
dnum	*(int)
,	O
int	O
ignore_combining	int
)	O
{	O
unsigned	O
int	O
n	int
;	O
n	int
=	O
0	int
;	O
while	O
(	O
(	O
n	int
<	O
num	int
)	O
&&	O
(	O
s	*(char)
<	O
smax	*(char)
)	O
)	O
{	O
unsigned	O
int	O
len	int
=	O
Len_Map	array(char)
[	O
*	O
s	*(char)
]	O
;	O
if	O
(	O
len	int
<=	O
1	int
)	O
{	O
n	int
++	O
;	O
s	*(char)
++	O
;	O
continue	O
;	O
}	O
if	O
(	O
s	*(char)
+	O
len	int
>	O
smax	*(char)
)	O
{	O
s	*(char)
++	O
;	O
n	int
++	O
;	O
continue	O
;	O
}	O
if	O
(	O
is_invalid_or_overlong_utf8	(*(char),int)->(int)
(	O
s	*(char)
,	O
len	int
)	O
)	O
{	O
s	*(char)
++	O
;	O
n	int
++	O
;	O
continue	O
;	O
}	O
if	O
(	O
ignore_combining	int
)	O
{	O
SLwchar_Type	int
w	*(int)
=	O
fast_utf8_decode	(*(char),int)->(int)
(	O
s	*(char)
,	O
len	int
)	O
;	O
if	O
(	O
0	int
!=	O
SLwchar_wcwidth	(int)->(int)
(	O
w	*(int)
)	O
)	O
n	int
++	O
;	O
s	*(char)
+=	O
len	int
;	O
continue	O
;	O
}	O
n	int
++	O
;	O
s	*(char)
+=	O
len	int
;	O
}	O
if	O
(	O
ignore_combining	int
)	O
{	O
while	O
(	O
s	*(char)
<	O
smax	*(char)
)	O
{	O
SLwchar_Type	int
w	*(int)
;	O
unsigned	O
int	O
nconsumed	int
;	O
if	O
(	O
NULL	O
==	O
SLutf8_decode	(*(char),*(char),*(int),*(int))->(*(char))
(	O
s	*(char)
,	O
smax	*(char)
,	O
&	O
w	*(int)
,	O
&	O
nconsumed	int
)	O
)	O
break	O
;	O
if	O
(	O
0	int
!=	O
SLwchar_wcwidth	(int)->(int)
(	O
w	*(int)
)	O
)	O
break	O
;	O
s	*(char)
+=	O
nconsumed	int
;	O
}	O
}	O
if	O
(	O
dnum	*(int)
!=	O
NULL	O
)	O
*	O
dnum	*(int)
=	O
n	int
;	O
return	O
s	*(char)
;	O
}	O
SLuchar_Type	char
*	O
SLutf8_bskip_chars	(*(char),*(char),int,*(int),int)->(*(char))
(	O
SLuchar_Type	char
*	O
smin	*(char)
,	O
SLuchar_Type	char
*	O
s	*(char)
,	O
unsigned	O
int	O
num	int
,	O
unsigned	O
int	O
*	O
dnum	*(int)
,	O
int	O
ignore_combining	int
)	O
{	O
unsigned	O
int	O
n	int
;	O
SLuchar_Type	char
*	O
smax	*(char)
=	O
s	*(char)
;	O
n	int
=	O
0	int
;	O
while	O
(	O
(	O
n	int
<	O
num	int
)	O
&&	O
(	O
s	*(char)
>	O
smin	*(char)
)	O
)	O
{	O
unsigned	O
char	O
ch	int
;	O
unsigned	O
int	O
dn	int
;	O
s	*(char)
--	O
;	O
ch	int
=	O
*	O
s	*(char)
;	O
if	O
(	O
ch	int
<	O
0x80	int
)	O
{	O
n	int
++	O
;	O
smax	*(char)
=	O
s	*(char)
;	O
continue	O
;	O
}	O
dn	int
=	O
0	int
;	O
while	O
(	O
(	O
s	*(char)
!=	O
smin	*(char)
)	O
&&	O
(	O
Len_Map	array(char)
[	O
ch	int
]	O
==	O
0	int
)	O
&&	O
(	O
dn	int
<	O
SLUTF8_MAX_MBLEN	int
)	O
)	O
{	O
s	*(char)
--	O
;	O
ch	int
=	O
*	O
s	*(char)
;	O
dn	int
++	O
;	O
}	O
if	O
(	O
ch	int
<=	O
0xBF	int
)	O
{	O
n	int
++	O
;	O
smax	*(char)
--	O
;	O
s	*(char)
=	O
smax	*(char)
;	O
continue	O
;	O
}	O
if	O
(	O
ch	int
>	O
0xBF	int
)	O
{	O
SLwchar_Type	int
w	*(int)
;	O
SLuchar_Type	char
*	O
s1	*(char)
;	O
if	O
(	O
(	O
NULL	O
==	O
(	O
s1	*(char)
=	O
SLutf8_decode	(*(char),*(char),*(int),*(int))->(*(char))
(	O
s	*(char)
,	O
smax	*(char)
,	O
&	O
w	*(int)
,	O
NULL	O
)	O
)	O
)	O
||	O
(	O
s1	*(char)
!=	O
smax	*(char)
)	O
)	O
{	O
dn	int
=	O
(	O
unsigned	O
int	O
)	O
(	O
smax	*(char)
-	O
s	*(char)
)	O
;	O
n	int
++	O
;	O
smax	*(char)
--	O
;	O
s	*(char)
=	O
smax	*(char)
;	O
continue	O
;	O
}	O
if	O
(	O
(	O
ignore_combining	int
==	O
0	int
)	O
||	O
(	O
0	int
!=	O
SLwchar_wcwidth	(int)->(int)
(	O
w	*(int)
)	O
)	O
)	O
n	int
++	O
;	O
smax	*(char)
=	O
s	*(char)
;	O
}	O
}	O
if	O
(	O
dnum	*(int)
!=	O
NULL	O
)	O
*	O
dnum	*(int)
=	O
n	int
;	O
return	O
s	*(char)
;	O
}	O
SLuchar_Type	char
*	O
SLutf8_bskip_char	(*(char),*(char))->(*(char))
(	O
SLuchar_Type	char
*	O
smin	*(char)
,	O
SLuchar_Type	char
*	O
s	*(char)
)	O
{	O
if	O
(	O
s	*(char)
>	O
smin	*(char)
)	O
{	O
unsigned	O
int	O
dn	int
;	O
s	*(char)
--	O
;	O
if	O
(	O
*	O
s	*(char)
>=	O
0x80	int
)	O
s	*(char)
=	O
SLutf8_bskip_chars	(*(char),*(char),int,*(int),int)->(*(char))
(	O
smin	*(char)
,	O
s	*(char)
+	O
1	int
,	O
1	int
,	O
&	O
dn	int
,	O
0	int
)	O
;	O
}	O
return	O
s	*(char)
;	O
}	O
unsigned	O
int	O
SLutf8_strlen	(*(char),int)->(int)
(	O
SLuchar_Type	char
*	O
s	*(char)
,	O
int	O
ignore_combining	int
)	O
{	O
unsigned	O
int	O
count	int
,	O
len	int
;	O
if	O
(	O
s	*(char)
==	O
NULL	O
)	O
return	O
0	int
;	O
len	int
=	O
strlen	(*(char))->(long)
(	O
(	O
char	O
*	O
)	O
s	*(char)
)	O
;	O
(	O
void	O
)	O
SLutf8_skip_chars	(*(char),*(char),int,*(int),int)->(*(char))
(	O
s	*(char)
,	O
s	*(char)
+	O
len	int
,	O
len	int
,	O
&	O
count	int
,	O
ignore_combining	int
)	O
;	O
return	O
count	int
;	O
}	O
unsigned	O
char	O
*	O
SLutf8_decode	(*(char),*(char),*(int),*(int))->(*(char))
(	O
unsigned	O
char	O
*	O
u	*(char)
,	O
unsigned	O
char	O
*	O
umax	*(char)
,	O
SLwchar_Type	int
*	O
wp	*(int)
,	O
unsigned	O
int	O
*	O
nconsumedp	*(int)
)	O
{	O
unsigned	O
int	O
len	int
;	O
unsigned	O
char	O
ch	int
;	O
SLwchar_Type	int
w	*(int)
;	O
if	O
(	O
u	*(char)
>=	O
umax	*(char)
)	O
{	O
*	O
wp	*(int)
=	O
0	int
;	O
if	O
(	O
nconsumedp	*(int)
!=	O
NULL	O
)	O
*	O
nconsumedp	*(int)
=	O
0	int
;	O
return	O
NULL	O
;	O
}	O
*	O
wp	*(int)
=	O
ch	int
=	O
*	O
u	*(char)
;	O
if	O
(	O
ch	int
<	O
0x80	int
)	O
{	O
if	O
(	O
nconsumedp	*(int)
!=	O
NULL	O
)	O
*	O
nconsumedp	*(int)
=	O
1	int
;	O
return	O
u	*(char)
+	O
1	int
;	O
}	O
len	int
=	O
Len_Map	array(char)
[	O
ch	int
]	O
;	O
if	O
(	O
len	int
<	O
2	int
)	O
{	O
if	O
(	O
nconsumedp	*(int)
!=	O
NULL	O
)	O
*	O
nconsumedp	*(int)
=	O
1	int
;	O
return	O
NULL	O
;	O
}	O
if	O
(	O
u	*(char)
+	O
len	int
>	O
umax	*(char)
)	O
{	O
if	O
(	O
nconsumedp	*(int)
!=	O
NULL	O
)	O
*	O
nconsumedp	*(int)
=	O
1	int
;	O
return	O
NULL	O
;	O
}	O
if	O
(	O
is_invalid_or_overlong_utf8	(*(char),int)->(int)
(	O
u	*(char)
,	O
len	int
)	O
)	O
{	O
if	O
(	O
nconsumedp	*(int)
!=	O
NULL	O
)	O
*	O
nconsumedp	*(int)
=	O
1	int
;	O
return	O
NULL	O
;	O
}	O
if	O
(	O
nconsumedp	*(int)
!=	O
NULL	O
)	O
*	O
nconsumedp	*(int)
=	O
len	int
;	O
*	O
wp	*(int)
=	O
w	*(int)
=	O
fast_utf8_decode	(*(char),int)->(int)
(	O
u	*(char)
,	O
len	int
)	O
;	O
if	O
(	O
IS_ILLEGAL_UNICODE	O
(	O
w	*(int)
)	O
)	O
return	O
NULL	O
;	O
return	O
u	*(char)
+	O
len	int
;	O
}	O
SLuchar_Type	char
*	O
SLutf8_encode	(int,*(char),int)->(*(char))
(	O
SLwchar_Type	int
w	*(int)
,	O
SLuchar_Type	char
*	O
u	*(char)
,	O
unsigned	O
int	O
ulen	int
)	O
{	O
SLuchar_Type	char
*	O
umax	*(char)
=	O
u	*(char)
+	O
ulen	int
;	O
if	O
(	O
w	*(int)
<=	O
0x7F	int
)	O
{	O
if	O
(	O
u	*(char)
>=	O
umax	*(char)
)	O
return	O
NULL	O
;	O
*	O
u	*(char)
++	O
=	O
(	O
unsigned	O
char	O
)	O
w	*(int)
;	O
return	O
u	*(char)
;	O
}	O
if	O
(	O
w	*(int)
<=	O
0x7FF	int
)	O
{	O
if	O
(	O
(	O
u	*(char)
+	O
1	int
)	O
>=	O
umax	*(char)
)	O
return	O
NULL	O
;	O
*	O
u	*(char)
++	O
=	O
(	O
w	*(int)
>>	O
6	int
)	O
|	O
0xC0	int
;	O
*	O
u	*(char)
++	O
=	O
(	O
w	*(int)
&	O
0x3F	int
)	O
|	O
0x80	int
;	O
return	O
u	*(char)
;	O
}	O
if	O
(	O
w	*(int)
<=	O
0xFFFF	int
)	O
{	O
if	O
(	O
u	*(char)
+	O
2	int
>=	O
umax	*(char)
)	O
return	O
NULL	O
;	O
*	O
u	*(char)
++	O
=	O
(	O
w	*(int)
>>	O
12	int
)	O
|	O
0xE0	int
;	O
goto	O
finish_2	O
;	O
}	O
if	O
(	O
w	*(int)
<=	O
0x1FFFFF	int
)	O
{	O
if	O
(	O
u	*(char)
+	O
3	int
>=	O
umax	*(char)
)	O
return	O
NULL	O
;	O
*	O
u	*(char)
++	O
=	O
(	O
w	*(int)
>>	O
18	int
)	O
|	O
0xF0	int
;	O
goto	O
finish_3	O
;	O
}	O
if	O
(	O
w	*(int)
<=	O
0x3FFFFFF	int
)	O
{	O
if	O
(	O
u	*(char)
+	O
4	int
>=	O
umax	*(char)
)	O
return	O
NULL	O
;	O
*	O
u	*(char)
++	O
=	O
(	O
w	*(int)
>>	O
24	int
)	O
|	O
0xF8	int
;	O
goto	O
finish_4	O
;	O
}	O
if	O
(	O
w	*(int)
<=	O
0x7FFFFFFF	int
)	O
{	O
if	O
(	O
u	*(char)
+	O
5	int
>=	O
umax	*(char)
)	O
return	O
NULL	O
;	O
*	O
u	*(char)
++	O
=	O
(	O
w	*(int)
>>	O
30	int
)	O
|	O
0xFC	int
;	O
goto	O
finish_5	O
;	O
}	O
return	O
NULL	O
;	O
finish_5	O
:	O
*	O
u	*(char)
++	O
=	O
(	O
(	O
w	*(int)
>>	O
24	int
)	O
&	O
0x3F	int
)	O
|	O
0x80	int
;	O
finish_4	O
:	O
*	O
u	*(char)
++	O
=	O
(	O
(	O
w	*(int)
>>	O
18	int
)	O
&	O
0x3F	int
)	O
|	O
0x80	int
;	O
finish_3	O
:	O
*	O
u	*(char)
++	O
=	O
(	O
(	O
w	*(int)
>>	O
12	int
)	O
&	O
0x3F	int
)	O
|	O
0x80	int
;	O
finish_2	O
:	O
*	O
u	*(char)
++	O
=	O
(	O
(	O
w	*(int)
>>	O
6	int
)	O
&	O
0x3F	int
)	O
|	O
0x80	int
;	O
*	O
u	*(char)
++	O
=	O
(	O
w	*(int)
&	O
0x3F	int
)	O
|	O
0x80	int
;	O
return	O
u	*(char)
;	O
}	O
SLuchar_Type	char
*	O
SLutf8_encode_null_terminate	(int,*(char))->(*(char))
(	O
SLwchar_Type	int
w	*(int)
,	O
SLuchar_Type	char
*	O
u	*(char)
)	O
{	O
SLuchar_Type	char
*	O
p	*(char)
;	O
p	*(char)
=	O
SLutf8_encode	(int,*(char),int)->(*(char))
(	O
w	*(int)
,	O
u	*(char)
,	O
SLUTF8_MAX_MBLEN	int
)	O
;	O
if	O
(	O
p	*(char)
!=	O
NULL	O
)	O
*	O
p	*(char)
=	O
0	int
;	O
return	O
p	*(char)
;	O
}	O
static	O
SLuchar_Type	char
*	O
xform_utf8	(*(char),*(char),*((int)->(int)))->(*(char))
(	O
SLuchar_Type	char
*	O
u	*(char)
,	O
SLuchar_Type	char
*	O
umax	*(char)
,	O
SLwchar_Type	int
(	O
*	O
fun	*((int)->(int))
)	O
(	O
SLwchar_Type	int
)	O
)	O
{	O
SLuchar_Type	char
*	O
buf	*(char)
,	O
*	O
p	*(char)
;	O
unsigned	O
int	O
malloced_len	int
,	O
len	int
;	O
if	O
(	O
umax	*(char)
<	O
u	*(char)
)	O
return	O
NULL	O
;	O
len	int
=	O
0	int
;	O
p	*(char)
=	O
buf	*(char)
=	O
NULL	O
;	O
malloced_len	int
=	O
0	int
;	O
while	O
(	O
1	int
)	O
{	O
SLwchar_Type	int
w	*(int)
;	O
SLuchar_Type	char
*	O
u1	*(char)
;	O
unsigned	O
int	O
nconsumed	int
;	O
if	O
(	O
malloced_len	int
<=	O
len	int
+	O
SLUTF8_MAX_MBLEN	int
)	O
{	O
SLuchar_Type	char
*	O
newbuf	*(char)
;	O
malloced_len	int
+=	O
1	int
+	O
(	O
umax	*(char)
-	O
u	*(char)
)	O
+	O
SLUTF8_MAX_MBLEN	int
;	O
newbuf	*(char)
=	O
(	O
SLuchar_Type	char
*	O
)	O
SLrealloc	O
(	O
(	O
char	O
*	O
)	O
buf	*(char)
,	O
malloced_len	int
)	O
;	O
if	O
(	O
newbuf	*(char)
==	O
NULL	O
)	O
{	O
SLfree	O
(	O
(	O
char	O
*	O
)	O
buf	*(char)
)	O
;	O
return	O
NULL	O
;	O
}	O
buf	*(char)
=	O
newbuf	*(char)
;	O
p	*(char)
=	O
buf	*(char)
+	O
len	int
;	O
}	O
if	O
(	O
u	*(char)
>=	O
umax	*(char)
)	O
{	O
*	O
p	*(char)
=	O
0	int
;	O
p	*(char)
=	O
(	O
SLuchar_Type	char
*	O
)	O
SLang_create_nslstring	(*(char),int)->(*(char))
(	O
(	O
char	O
*	O
)	O
buf	*(char)
,	O
len	int
)	O
;	O
SLfree	O
(	O
(	O
char	O
*	O
)	O
buf	*(char)
)	O
;	O
return	O
p	*(char)
;	O
}	O
if	O
(	O
NULL	O
==	O
(	O
u1	*(char)
=	O
SLutf8_decode	(*(char),*(char),*(int),*(int))->(*(char))
(	O
u	*(char)
,	O
umax	*(char)
,	O
&	O
w	*(int)
,	O
&	O
nconsumed	int
)	O
)	O
)	O
{	O
memcpy	(*(void),*(void),long)->(*(void))
(	O
(	O
char	O
*	O
)	O
p	*(char)
,	O
u	*(char)
,	O
nconsumed	int
)	O
;	O
p	*(char)
+=	O
nconsumed	int
;	O
len	int
+=	O
nconsumed	int
;	O
u1	*(char)
=	O
u	*(char)
+	O
nconsumed	int
;	O
}	O
else	O
{	O
SLuchar_Type	char
*	O
p1	*(char)
;	O
p1	*(char)
=	O
SLutf8_encode	(int,*(char),int)->(*(char))
(	O
(	O
*	O
fun	*((int)->(int))
)	O
(	O
w	*(int)
)	O
,	O
p	*(char)
,	O
malloced_len	int
)	O
;	O
if	O
(	O
p1	*(char)
==	O
NULL	O
)	O
{	O
SLfree	O
(	O
(	O
char	O
*	O
)	O
buf	*(char)
)	O
;	O
SLang_verror	(int,*(char))->(void)
(	O
SL_INTERNAL_ERROR	O
,	O
"SLutf8_encode returned NULL"	*(char)
)	O
;	O
return	O
NULL	O
;	O
}	O
len	int
+=	O
p1	*(char)
-	O
p	*(char)
;	O
p	*(char)
=	O
p1	*(char)
;	O
}	O
u	*(char)
=	O
u1	*(char)
;	O
}	O
}	O
SLuchar_Type	char
*	O
SLutf8_strup	(*(char),*(char))->(*(char))
(	O
SLuchar_Type	char
*	O
u	*(char)
,	O
SLuchar_Type	char
*	O
umax	*(char)
)	O
{	O
return	O
xform_utf8	(*(char),*(char),*((int)->(int)))->(*(char))
(	O
u	*(char)
,	O
umax	*(char)
,	O
SLwchar_toupper	(int)->(int)
)	O
;	O
}	O
SLuchar_Type	char
*	O
SLutf8_strlo	(*(char),*(char))->(*(char))
(	O
SLuchar_Type	char
*	O
u	*(char)
,	O
SLuchar_Type	char
*	O
umax	*(char)
)	O
{	O
return	O
xform_utf8	(*(char),*(char),*((int)->(int)))->(*(char))
(	O
u	*(char)
,	O
umax	*(char)
,	O
SLwchar_tolower	(int)->(int)
)	O
;	O
}	O
int	O
SLutf8_compare	(*(char),*(char),*(char),*(char),int,int)->(int)
(	O
SLuchar_Type	char
*	O
a	*(char)
,	O
SLuchar_Type	char
*	O
amax	*(char)
,	O
SLuchar_Type	char
*	O
b	*(char)
,	O
SLuchar_Type	char
*	O
bmax	*(char)
,	O
unsigned	O
int	O
nchars	int
,	O
int	O
cs	short
)	O
{	O
while	O
(	O
nchars	int
&&	O
(	O
a	*(char)
<	O
amax	*(char)
)	O
&&	O
(	O
b	*(char)
<	O
bmax	*(char)
)	O
)	O
{	O
SLwchar_Type	int
cha	int
,	O
chb	int
;	O
unsigned	O
int	O
na	int
,	O
nb	int
;	O
int	O
aok	int
,	O
bok	int
;	O
if	O
(	O
*	O
a	*(char)
<	O
0x80	int
)	O
{	O
cha	int
=	O
(	O
SLwchar_Type	int
)	O
*	O
a	*(char)
++	O
;	O
aok	int
=	O
1	int
;	O
}	O
else	O
{	O
aok	int
=	O
(	O
NULL	O
!=	O
SLutf8_decode	(*(char),*(char),*(int),*(int))->(*(char))
(	O
a	*(char)
,	O
amax	*(char)
,	O
&	O
cha	int
,	O
&	O
na	int
)	O
)	O
;	O
a	*(char)
+=	O
na	int
;	O
}	O
if	O
(	O
*	O
b	*(char)
<	O
0x80	int
)	O
{	O
chb	int
=	O
(	O
SLwchar_Type	int
)	O
*	O
b	*(char)
++	O
;	O
bok	int
=	O
1	int
;	O
}	O
else	O
{	O
bok	int
=	O
(	O
NULL	O
!=	O
SLutf8_decode	(*(char),*(char),*(int),*(int))->(*(char))
(	O
b	*(char)
,	O
bmax	*(char)
,	O
&	O
chb	int
,	O
&	O
nb	int
)	O
)	O
;	O
b	*(char)
+=	O
nb	int
;	O
}	O
nchars	int
--	O
;	O
if	O
(	O
aok	int
&&	O
bok	int
)	O
{	O
if	O
(	O
cs	short
==	O
0	int
)	O
{	O
cha	int
=	O
SLwchar_toupper	(int)->(int)
(	O
cha	int
)	O
;	O
chb	int
=	O
SLwchar_toupper	(int)->(int)
(	O
chb	int
)	O
;	O
}	O
}	O
else	O
if	O
(	O
aok	int
)	O
return	O
1	int
;	O
else	O
if	O
(	O
bok	int
)	O
return	O
-	O
1	int
;	O
if	O
(	O
cha	int
==	O
chb	int
)	O
continue	O
;	O
if	O
(	O
cha	int
>	O
chb	int
)	O
return	O
1	int
;	O
return	O
-	O
1	int
;	O
}	O
if	O
(	O
nchars	int
==	O
0	int
)	O
return	O
0	int
;	O
if	O
(	O
(	O
a	*(char)
>=	O
amax	*(char)
)	O
&&	O
(	O
b	*(char)
>=	O
bmax	*(char)
)	O
)	O
return	O
0	int
;	O
if	O
(	O
b	*(char)
>=	O
bmax	*(char)
)	O
return	O
1	int
;	O
return	O
-	O
1	int
;	O
}	O
SLstr_Type	char
*	O
SLutf8_subst_wchar	(*(char),*(char),int,int,int)->(*(char))
(	O
SLuchar_Type	char
*	O
u	*(char)
,	O
SLuchar_Type	char
*	O
umax	*(char)
,	O
SLwchar_Type	int
wch	int
,	O
unsigned	O
int	O
pos	int
,	O
int	O
ignore_combining	int
)	O
{	O
SLuchar_Type	char
*	O
a	*(char)
,	O
*	O
a1	*(char)
,	O
*	O
b	*(char)
;	O
unsigned	O
int	O
dpos	int
;	O
SLuchar_Type	char
buf	*(char)
[	O
SLUTF8_MAX_MBLEN	int
+	O
1	int
]	O
;	O
SLstr_Type	char
*	O
c	int
;	O
unsigned	O
int	O
n1	int
,	O
n2	int
,	O
n3	int
,	O
len	int
;	O
a	*(char)
=	O
SLutf8_skip_chars	(*(char),*(char),int,*(int),int)->(*(char))
(	O
u	*(char)
,	O
umax	*(char)
,	O
pos	int
,	O
&	O
dpos	int
,	O
ignore_combining	int
)	O
;	O
if	O
(	O
(	O
dpos	int
!=	O
pos	int
)	O
||	O
(	O
a	*(char)
==	O
umax	*(char)
)	O
)	O
{	O
SLang_verror	(int,*(char))->(void)
(	O
SL_INDEX_ERROR	O
,	O
"Specified character position is invalid for string"	*(char)
)	O
;	O
return	O
NULL	O
;	O
}	O
a1	*(char)
=	O
SLutf8_skip_chars	(*(char),*(char),int,*(int),int)->(*(char))
(	O
a	*(char)
,	O
umax	*(char)
,	O
1	int
,	O
NULL	O
,	O
ignore_combining	int
)	O
;	O
b	*(char)
=	O
SLutf8_encode	(int,*(char),int)->(*(char))
(	O
wch	int
,	O
buf	*(char)
,	O
SLUTF8_MAX_MBLEN	int
)	O
;	O
if	O
(	O
b	*(char)
==	O
NULL	O
)	O
{	O
SLang_verror	(int,*(char))->(void)
(	O
SL_UNICODE_ERROR	O
,	O
"Unable to encode wchar 0x%lX"	*(char)
,	O
(	O
unsigned	O
long	O
)	O
wch	int
)	O
;	O
return	O
NULL	O
;	O
}	O
n1	int
=	O
(	O
a	*(char)
-	O
u	*(char)
)	O
;	O
n2	int
=	O
(	O
b	*(char)
-	O
buf	*(char)
)	O
;	O
n3	int
=	O
(	O
umax	*(char)
-	O
a1	*(char)
)	O
;	O
len	int
=	O
n1	int
+	O
n2	int
+	O
n3	int
;	O
c	int
=	O
_pSLallocate_slstring	(int)->(*(char))
(	O
len	int
)	O
;	O
if	O
(	O
c	int
==	O
NULL	O
)	O
return	O
NULL	O
;	O
memcpy	(*(void),*(void),long)->(*(void))
(	O
c	int
,	O
(	O
char	O
*	O
)	O
u	*(char)
,	O
n1	int
)	O
;	O
memcpy	(*(void),*(void),long)->(*(void))
(	O
c	int
+	O
n1	int
,	O
(	O
char	O
*	O
)	O
buf	*(char)
,	O
n2	int
)	O
;	O
memcpy	(*(void),*(void),long)->(*(void))
(	O
c	int
+	O
n1	int
+	O
n2	int
,	O
(	O
char	O
*	O
)	O
a1	*(char)
,	O
n3	int
)	O
;	O
c	int
[	O
len	int
]	O
=	O
0	int
;	O
return	O
_pSLcreate_via_alloced_slstring	(*(char),int)->(*(char))
(	O
c	int
,	O
len	int
)	O
;	O
}	O
SLuchar_Type	char
*	O
SLutf8_extract_utf8_char	(*(char),*(char),*(char))->(*(char))
(	O
SLuchar_Type	char
*	O
u	*(char)
,	O
SLuchar_Type	char
*	O
umax	*(char)
,	O
SLuchar_Type	char
*	O
utf8	*(char)
)	O
{	O
SLuchar_Type	char
*	O
u1	*(char)
;	O
u1	*(char)
=	O
SLutf8_skip_char	(*(char),*(char))->(*(char))
(	O
u	*(char)
,	O
umax	*(char)
)	O
;	O
memcpy	(*(void),*(void),long)->(*(void))
(	O
(	O
char	O
*	O
)	O
utf8	*(char)
,	O
u	*(char)
,	O
u1	*(char)
-	O
u	*(char)
)	O
;	O
utf8	*(char)
[	O
u1	*(char)
-	O
u	*(char)
]	O
=	O
0	int
;	O
return	O
u1	*(char)
;	O
}	O
SLuchar_Type	char
*	O
_pSLinterp_decode_wchar	(*(char),*(char),*(int))->(*(char))
(	O
SLuchar_Type	char
*	O
u	*(char)
,	O
SLuchar_Type	char
*	O
umax	*(char)
,	O
SLwchar_Type	int
*	O
chp	*(int)
)	O
{	O
if	O
(	O
_pSLinterp_UTF8_Mode	int
==	O
0	int
)	O
{	O
if	O
(	O
u	*(char)
<	O
umax	*(char)
)	O
*	O
chp	*(int)
=	O
(	O
SLwchar_Type	int
)	O
*	O
u	*(char)
++	O
;	O
return	O
u	*(char)
;	O
}	O
if	O
(	O
NULL	O
==	O
(	O
u	*(char)
=	O
SLutf8_decode	(*(char),*(char),*(int),*(int))->(*(char))
(	O
u	*(char)
,	O
umax	*(char)
,	O
chp	*(int)
,	O
NULL	O
)	O
)	O
)	O
SLang_verror	(int,*(char))->(void)
(	O
SL_INVALID_UTF8	O
,	O
"Invalid UTF-8 encoded string"	*(char)
)	O
;	O
return	O
u	*(char)
;	O
}	O
SLuchar_Type	char
*	O
_pSLinterp_encode_wchar	(int,*(char),*(int))->(*(char))
(	O
SLwchar_Type	int
wch	int
,	O
SLuchar_Type	char
*	O
u	*(char)
,	O
unsigned	O
int	O
*	O
encoded_len	*(int)
)	O
{	O
SLuchar_Type	char
*	O
u1	*(char)
;	O
if	O
(	O
_pSLinterp_UTF8_Mode	int
==	O
0	int
)	O
{	O
*	O
encoded_len	*(int)
=	O
1	int
;	O
*	O
u	*(char)
++	O
=	O
(	O
SLuchar_Type	char
)	O
wch	int
;	O
*	O
u	*(char)
++	O
=	O
0	int
;	O
return	O
u	*(char)
;	O
}	O
if	O
(	O
NULL	O
==	O
(	O
u1	*(char)
=	O
SLutf8_encode_null_terminate	(int,*(char))->(*(char))
(	O
wch	int
,	O
u	*(char)
)	O
)	O
)	O
{	O
SLang_verror	(int,*(char))->(void)
(	O
SL_UNICODE_ERROR	O
,	O
"Unable to encode character 0x%lX"	*(char)
,	O
(	O
unsigned	O
long	O
)	O
wch	int
)	O
;	O
return	O
NULL	O
;	O
}	O
*	O
encoded_len	*(int)
=	O
(	O
unsigned	O
int	O
)	O
(	O
u1	*(char)
-	O
u	*(char)
)	O
;	O
return	O
u1	*(char)
;	O
}	O
