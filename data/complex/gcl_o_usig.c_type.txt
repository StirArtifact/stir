extern	O
char	O
signals_handled	array(char)
[	O
]	O
;	O
void	O
gcl_signal	(int,*(()->(void)))->(void)
(	O
int	O
signo	int
,	O
void	O
(	O
*	O
handler	*(()->(void))
)	O
(	O
)	O
)	O
{	O
char	O
*	O
p	*(char)
=	O
signals_handled	array(char)
;	O
while	O
(	O
*	O
p	*(char)
)	O
{	O
if	O
(	O
*	O
p	*(char)
==	O
signo	int
)	O
{	O
our_signal_handler	O
[	O
signo	int
]	O
=	O
handler	*(()->(void))
;	O
handler	*(()->(void))
=	O
main_signal_handler	O
;	O
break	O
;	O
}	O
p	*(char)
++	O
;	O
}	O
{	O
signal	()->(int)
(	O
signo	int
,	O
handler	*(()->(void))
)	O
;	O
}	O
}	O
int	O
unblock_signals	(int,int)->(int)
(	O
int	O
n	int
,	O
int	O
m	int
)	O
{	O
int	O
result	int
=	O
0	int
;	O
int	O
current_mask	int
;	O
current_mask	int
=	O
sigblock	()->(int)
(	O
0	int
)	O
;	O
sigsetmask	()->(int)
(	O
~	O
(	O
sigmask	()->(int)
(	O
m	int
)	O
)	O
&	O
~	O
(	O
sigmask	()->(int)
(	O
n	int
)	O
)	O
&	O
current_mask	int
)	O
;	O
result	int
=	O
(	O
current_mask	int
&	O
sigmask	()->(int)
(	O
m	int
)	O
?	O
signal_mask	()->(int)
(	O
m	int
)	O
:	O
0	int
)	O
|	O
(	O
current_mask	int
&	O
sigmask	()->(int)
(	O
n	int
)	O
?	O
signal_mask	()->(int)
(	O
n	int
)	O
:	O
0	int
)	O
;	O
return	O
result	int
;	O
}	O
void	O
unblock_sigusr_sigio	()->(void)
(	O
void	O
)	O
{	O
int	O
current_mask	int
=	O
sigblock	()->(int)
(	O
0	int
)	O
;	O
return	O
sigsetmask	()->(int)
(	O
~	O
(	O
sigmask	()->(int)
(	O
SIGIO	O
)	O
)	O
&	O
~	O
(	O
sigmask	()->(int)
(	O
SIGUSR1	O
)	O
)	O
&	O
current_mask	int
)	O
;	O
}	O
DEFCONST	()->(int)
(	O
"+MC-CONTEXT-OFFSETS+"	*(char)
,	O
sSPmc_context_offsetsP	O
,	O
SI	O
,	O
FPE_INIT	O
,	O
""	*(char)
)	O
;	O
DEFUN_NEW	()->(int)
(	O
"FLD"	*(char)
,	O
object	O
,	O
fSfld	O
,	O
SI	O
,	O
1	int
,	O
1	int
,	O
NONE	O
,	O
OI	O
,	O
OO	O
,	O
OO	O
,	O
OO	O
,	O
(	O
fixnum	O
val	O
)	O
,	O
""	*(char)
)	O
{	O
volatile	O
double	O
d	double
;	O
ASM	O
(	O
"fldt %1;fstpl %0"	*(char)
:	O
"=m"	*(char)
(	O
d	double
)	O
:	O
"m"	*(char)
(	O
*	O
(	O
char	O
*	O
)	O
val	O
)	O
)	O
;	O
RETURN1	()->(int)
(	O
make_longfloat	()->(int)
(	O
d	double
)	O
)	O
;	O
}	O
DEFUN_NEW	()->(int)
(	O
"*FIXNUM"	*(char)
,	O
fixnum	O
,	O
fSAfixnum	O
,	O
SI	O
,	O
1	int
,	O
1	int
,	O
NONE	O
,	O
II	O
,	O
OO	O
,	O
OO	O
,	O
OO	O
,	O
(	O
fixnum	O
addr	O
)	O
,	O
""	*(char)
)	O
{	O
RETURN1	()->(int)
(	O
*	O
(	O
fixnum	O
*	O
)	O
addr	O
)	O
;	O
}	O
DEFUN_NEW	()->(int)
(	O
"*FLOAT"	*(char)
,	O
object	O
,	O
fSAfloat	O
,	O
SI	O
,	O
1	int
,	O
1	int
,	O
NONE	O
,	O
OI	O
,	O
OO	O
,	O
OO	O
,	O
OO	O
,	O
(	O
fixnum	O
addr	O
)	O
,	O
""	*(char)
)	O
{	O
RETURN1	()->(int)
(	O
make_shortfloat	()->(int)
(	O
*	O
(	O
float	O
*	O
)	O
addr	O
)	O
)	O
;	O
}	O
DEFUN_NEW	()->(int)
(	O
"*DOUBLE"	*(char)
,	O
object	O
,	O
fSAdouble	O
,	O
SI	O
,	O
1	int
,	O
1	int
,	O
NONE	O
,	O
OI	O
,	O
OO	O
,	O
OO	O
,	O
OO	O
,	O
(	O
fixnum	O
addr	O
)	O
,	O
""	*(char)
)	O
{	O
RETURN1	()->(int)
(	O
make_longfloat	()->(int)
(	O
*	O
(	O
double	O
*	O
)	O
addr	O
)	O
)	O
;	O
}	O
DEFUN_NEW	()->(int)
(	O
"FEENABLEEXCEPT"	*(char)
,	O
fixnum	O
,	O
fSfeenableexcept	O
,	O
SI	O
,	O
1	int
,	O
1	int
,	O
NONE	O
,	O
II	O
,	O
OO	O
,	O
OO	O
,	O
OO	O
,	O
(	O
fixnum	O
x	O
)	O
,	O
""	*(char)
)	O
{	O
{	O
volatile	O
unsigned	O
short	O
s	short
=	O
0	int
;	O
volatile	O
unsigned	O
int	O
i	int
;	O
ASM	O
(	O
"fnstcw %0"	*(char)
:	O
:	O
"m"	*(char)
(	O
s	short
)	O
)	O
;	O
s	short
=	O
(	O
s	short
|	O
FE_ALL_EXCEPT	O
)	O
&	O
(	O
~	O
x	O
)	O
;	O
ASM	O
(	O
"fldcw %0"	*(char)
:	O
"=m"	*(char)
(	O
s	short
)	O
)	O
;	O
ASM	O
(	O
"stmxcsr %0"	*(char)
:	O
:	O
"m"	*(char)
(	O
i	int
)	O
)	O
;	O
i	int
=	O
(	O
i	int
|	O
(	O
FE_ALL_EXCEPT	O
<<	O
7	int
)	O
)	O
&	O
(	O
~	O
(	O
x	O
<<	O
7	int
)	O
)	O
;	O
ASM	O
(	O
"ldmxcsr %0"	*(char)
:	O
"=m"	*(char)
(	O
i	int
)	O
)	O
;	O
}	O
RETURN1	()->(int)
(	O
x	O
)	O
;	O
}	O
DEFUN_NEW	()->(int)
(	O
"FEDISABLEEXCEPT"	*(char)
,	O
fixnum	O
,	O
fSfedisableexcept	O
,	O
SI	O
,	O
0	int
,	O
0	int
,	O
NONE	O
,	O
IO	O
,	O
OO	O
,	O
OO	O
,	O
OO	O
,	O
(	O
void	O
)	O
,	O
""	*(char)
)	O
{	O
fixnum	O
x	O
;	O
{	O
volatile	O
unsigned	O
int	O
i	int
=	O
0	int
;	O
ASM	O
(	O
"fnclex"	*(char)
)	O
;	O
ASM	O
(	O
"stmxcsr %0"	*(char)
:	O
:	O
"m"	*(char)
(	O
i	int
)	O
)	O
;	O
i	int
=	O
(	O
i	int
|	O
(	O
FE_ALL_EXCEPT	O
<<	O
7	int
)	O
)	O
;	O
ASM	O
(	O
"ldmxcsr %0"	*(char)
:	O
"=m"	*(char)
(	O
i	int
)	O
)	O
;	O
x	O
=	O
0	int
;	O
}	O
RETURN1	()->(int)
(	O
x	O
)	O
;	O
}	O
DEFUN_NEW	()->(int)
(	O
"FPE_CODE"	*(char)
,	O
fixnum	O
,	O
fSfpe_code	O
,	O
SI	O
,	O
2	int
,	O
2	int
,	O
NONE	O
,	O
II	O
,	O
OO	O
,	O
OO	O
,	O
OO	O
,	O
(	O
fixnum	O
x87sw	O
,	O
fixnum	O
mxcsr	O
)	O
,	O
""	*(char)
)	O
{	O
RETURN1	()->(int)
(	O
FE_TEST	O
(	O
x87sw	O
,	O
mxcsr	O
,	O
FE_INVALID	int
)	O
?	O
FPE_FLTINV	O
:	O
(	O
FE_TEST	O
(	O
x87sw	O
,	O
mxcsr	O
,	O
FE_DIVBYZERO	int
)	O
?	O
FPE_FLTDIV	O
:	O
(	O
FE_TEST	O
(	O
x87sw	O
,	O
mxcsr	O
,	O
FE_OVERFLOW	int
)	O
?	O
FPE_FLTOVF	O
:	O
(	O
FE_TEST	O
(	O
x87sw	O
,	O
mxcsr	O
,	O
FE_UNDERFLOW	int
)	O
?	O
FPE_FLTUND	O
:	O
(	O
FE_TEST	O
(	O
x87sw	O
,	O
mxcsr	O
,	O
FE_INEXACT	int
)	O
?	O
FPE_FLTRES	O
:	O
0	int
)	O
)	O
)	O
)	O
)	O
;	O
}	O
static	O
void	O
sigfpe3	(int,*(void),*(void))->(void)
(	O
int	O
sig	int
,	O
void	O
*	O
i	int
,	O
void	O
*	O
v	*(void)
)	O
{	O
unblock_signals	(int,int)->(int)
(	O
SIGFPE	O
,	O
SIGFPE	O
)	O
;	O
ifuncall3	()->(int)
(	O
sSfloating_point_error	O
,	O
FPE_CODE	()->(int)
(	O
i	int
,	O
v	*(void)
)	O
,	O
FPE_ADDR	()->(int)
(	O
i	int
,	O
v	*(void)
)	O
,	O
FPE_CTXT	()->(int)
(	O
v	*(void)
)	O
)	O
;	O
}	O
DEFCONST	()->(int)
(	O
"+FE-LIST+"	*(char)
,	O
sSPfe_listP	O
,	O
SI	O
,	O
list	O
(	O
5	int
,	O
list	O
(	O
3	int
,	O
sLdivision_by_zero	O
,	O
make_fixnum	O
(	O
FPE_FLTDIV	O
)	O
,	O
make_fixnum	O
(	O
FE_DIVBYZERO	int
)	O
)	O
,	O
list	O
(	O
3	int
,	O
sLfloating_point_overflow	O
,	O
make_fixnum	O
(	O
FPE_FLTOVF	O
)	O
,	O
make_fixnum	O
(	O
FE_OVERFLOW	int
)	O
)	O
,	O
list	O
(	O
3	int
,	O
sLfloating_point_underflow	O
,	O
make_fixnum	O
(	O
FPE_FLTUND	O
)	O
,	O
make_fixnum	O
(	O
FE_UNDERFLOW	int
)	O
)	O
,	O
list	O
(	O
3	int
,	O
sLfloating_point_inexact	O
,	O
make_fixnum	O
(	O
FPE_FLTRES	O
)	O
,	O
make_fixnum	O
(	O
FE_INEXACT	int
)	O
)	O
,	O
list	O
(	O
3	int
,	O
sLfloating_point_invalid_operation	O
,	O
make_fixnum	O
(	O
FPE_FLTINV	O
)	O
,	O
make_fixnum	O
(	O
FE_INVALID	int
)	O
)	O
)	O
,	O
""	*(char)
)	O
;	O
DEF_ORDINARY	()->(int)
(	O
"FLOATING-POINT-ERROR"	*(char)
,	O
sSfloating_point_error	O
,	O
SI	O
,	O
""	*(char)
)	O
;	O
static	O
void	O
sigpipe	()->(void)
(	O
void	O
)	O
{	O
gcl_signal	(int,*(()->(void)))->(void)
(	O
SIGPIPE	O
,	O
sigpipe	()->(void)
)	O
;	O
perror	()->(int)
(	O
""	*(char)
)	O
;	O
FEerror	()->(int)
(	O
"Broken pipe"	*(char)
,	O
0	int
)	O
;	O
}	O
void	O
sigint	()->(void)
(	O
void	O
)	O
{	O
unblock_signals	(int,int)->(int)
(	O
SIGINT	O
,	O
SIGINT	O
)	O
;	O
terminal_interrupt	()->(int)
(	O
1	int
)	O
;	O
}	O
static	O
void	O
sigalrm	()->(void)
(	O
void	O
)	O
{	O
unblock_signals	(int,int)->(int)
(	O
SIGALRM	O
,	O
SIGALRM	O
)	O
;	O
raise_pending_signals	()->(int)
(	O
sig_try_to_delay	O
)	O
;	O
}	O
DEFVAR	()->(int)
(	O
"*INTERRUPT-ENABLE*"	*(char)
,	O
sSAinterrupt_enableA	O
,	O
SI	O
,	O
sLt	O
,	O
""	*(char)
)	O
;	O
DEF_ORDINARY	()->(int)
(	O
"SIGUSR1-INTERRUPT"	*(char)
,	O
sSsigusr1_interrupt	O
,	O
SI	O
,	O
""	*(char)
)	O
;	O
DEF_ORDINARY	()->(int)
(	O
"SIGIO-INTERRUPT"	*(char)
,	O
sSsigio_interrupt	O
,	O
SI	O
,	O
""	*(char)
)	O
;	O
static	O
void	O
sigusr1	()->(void)
(	O
void	O
)	O
{	O
ifuncall1	()->(int)
(	O
sSsigusr1_interrupt	O
,	O
Cnil	O
)	O
;	O
}	O
static	O
void	O
sigio	()->(void)
(	O
void	O
)	O
{	O
ifuncall1	()->(int)
(	O
sSsigio_interrupt	O
,	O
Cnil	O
)	O
;	O
}	O
void	O
install_default_signals	()->(void)
(	O
void	O
)	O
{	O
gcl_signal	(int,*(()->(void)))->(void)
(	O
SIGFPE	O
,	O
sigfpe3	(int,*(void),*(void))->(void)
)	O
;	O
gcl_signal	(int,*(()->(void)))->(void)
(	O
SIGPIPE	O
,	O
sigpipe	()->(void)
)	O
;	O
gcl_signal	(int,*(()->(void)))->(void)
(	O
SIGINT	O
,	O
sigint	()->(void)
)	O
;	O
gcl_signal	(int,*(()->(void)))->(void)
(	O
SIGUSR1	O
,	O
sigusr1	()->(void)
)	O
;	O
gcl_signal	(int,*(()->(void)))->(void)
(	O
SIGIO	O
,	O
sigio	()->(void)
)	O
;	O
gcl_signal	(int,*(()->(void)))->(void)
(	O
SIGALRM	O
,	O
sigalrm	()->(void)
)	O
;	O
signals_allowed	O
=	O
sig_normal	O
;	O
}	O
