static	O
const	O
char	O
*	O
default_page	pointer
=	O
"index.html"	pointer
;	O
static	O
size_t	long
default_page_length	long
=	O
10	int
;	O
static	O
struct	O
iri_scheme	struct
{	O
uint16_t	short
port	short
;	O
const	O
char	O
name	pointer
[	O
6	int
]	O
;	O
}	O
schemes	array
[	O
]	O
=	O
{	O
[	O
WGET_IRI_SCHEME_HTTP	int
]	O
=	O
{	O
80	int
,	O
"http"	pointer
}	O
,	O
[	O
WGET_IRI_SCHEME_HTTPS	int
]	O
=	O
{	O
443	int
,	O
"https"	pointer
}	O
,	O
}	O
;	O
const	O
char	O
*	O
wget_iri_scheme_get_name	function
(	O
wget_iri_scheme	enum
scheme	enum
)	O
{	O
if	O
(	O
(	O
unsigned	O
)	O
scheme	enum
<	O
countof	O
(	O
schemes	array
)	O
)	O
return	O
schemes	array
[	O
scheme	enum
]	O
.	O
name	pointer
;	O
return	O
NULL	O
;	O
}	O
bool	bool
wget_iri_supported	function
(	O
const	O
wget_iri	struct
*	O
iri	pointer
)	O
{	O
return	O
(	O
unsigned	O
)	O
iri	pointer
->	O
scheme	enum
<	O
countof	O
(	O
schemes	array
)	O
;	O
}	O
static	O
const	O
unsigned	O
char	O
iri_ctype	array
[	O
256	int
]	O
=	O
{	O
[	O
':'	O
]	O
=	O
IRI_CTYPE_GENDELIM	O
,	O
[	O
'/'	O
]	O
=	O
IRI_CTYPE_GENDELIM	O
,	O
[	O
'?'	O
]	O
=	O
IRI_CTYPE_GENDELIM	O
,	O
[	O
'#'	O
]	O
=	O
IRI_CTYPE_GENDELIM	O
,	O
[	O
'['	O
]	O
=	O
IRI_CTYPE_GENDELIM	O
,	O
[	O
']'	O
]	O
=	O
IRI_CTYPE_GENDELIM	O
,	O
[	O
'@'	O
]	O
=	O
IRI_CTYPE_GENDELIM	O
,	O
[	O
'!'	O
]	O
=	O
IRI_CTYPE_SUBDELIM	O
,	O
[	O
'$'	O
]	O
=	O
IRI_CTYPE_SUBDELIM	O
,	O
[	O
'&'	O
]	O
=	O
IRI_CTYPE_SUBDELIM	O
,	O
[	O
'\''	O
]	O
=	O
IRI_CTYPE_SUBDELIM	O
,	O
[	O
'('	O
]	O
=	O
IRI_CTYPE_SUBDELIM	O
,	O
[	O
')'	O
]	O
=	O
IRI_CTYPE_SUBDELIM	O
,	O
[	O
'*'	O
]	O
=	O
IRI_CTYPE_SUBDELIM	O
,	O
[	O
'+'	O
]	O
=	O
IRI_CTYPE_SUBDELIM	O
,	O
[	O
','	O
]	O
=	O
IRI_CTYPE_SUBDELIM	O
,	O
[	O
';'	O
]	O
=	O
IRI_CTYPE_SUBDELIM	O
,	O
[	O
'='	O
]	O
=	O
IRI_CTYPE_SUBDELIM	O
,	O
[	O
'-'	O
]	O
=	O
IRI_CTYPE_UNRESERVED	O
,	O
[	O
'.'	O
]	O
=	O
IRI_CTYPE_UNRESERVED	O
,	O
[	O
'_'	O
]	O
=	O
IRI_CTYPE_UNRESERVED	O
,	O
[	O
'~'	O
]	O
=	O
IRI_CTYPE_UNRESERVED	O
}	O
;	O
bool	bool
wget_iri_isgendelim	function
(	O
char	O
c	int
)	O
{	O
return	O
_iri_isgendelim	O
(	O
c	int
)	O
;	O
}	O
bool	bool
wget_iri_issubdelim	function
(	O
char	O
c	int
)	O
{	O
return	O
_iri_issubdelim	O
(	O
c	int
)	O
;	O
}	O
bool	bool
wget_iri_isreserved	function
(	O
char	O
c	int
)	O
{	O
return	O
wget_iri_isgendelim	function
(	O
c	int
)	O
||	O
wget_iri_issubdelim	function
(	O
c	int
)	O
;	O
}	O
bool	bool
wget_iri_isunreserved	function
(	O
char	O
c	int
)	O
{	O
return	O
c	int
>	O
32	int
&&	O
c	int
<	O
127	int
&&	O
(	O
c_isalnum	function
(	O
c	int
)	O
||	O
_iri_isunreserved	O
(	O
c	int
)	O
)	O
;	O
}	O
bool	bool
wget_iri_isunreserved_path	function
(	O
char	O
c	int
)	O
{	O
return	O
c	int
>	O
32	int
&&	O
c	int
<	O
127	int
&&	O
(	O
c_isalnum	function
(	O
c	int
)	O
||	O
_iri_isunreserved	O
(	O
c	int
)	O
||	O
c	int
==	O
'/'	O
)	O
;	O
}	O
static	O
unsigned	O
char	O
WGET_GCC_CONST	O
_unhex	function
(	O
unsigned	O
char	O
c	int
)	O
{	O
return	O
c	int
<=	O
'9'	O
?	O
c	int
-	O
'0'	O
:	O
(	O
c	int
<=	O
'F'	O
?	O
c	int
-	O
'A'	O
+	O
10	int
:	O
c	int
-	O
'a'	O
+	O
10	int
)	O
;	O
}	O
static	O
char	O
*	O
_iri_unescape_inline	function
(	O
char	O
*	O
src	pointer
,	O
int	O
ctype	int
)	O
{	O
char	O
*	O
ret	pointer
=	O
NULL	O
;	O
unsigned	O
char	O
*	O
s	pointer
=	O
(	O
unsigned	O
char	O
*	O
)	O
src	pointer
;	O
unsigned	O
char	O
*	O
d	pointer
=	O
s	pointer
;	O
while	O
(	O
*	O
s	pointer
)	O
{	O
if	O
(	O
*	O
s	pointer
==	O
'%'	O
)	O
{	O
if	O
(	O
c_isxdigit	function
(	O
s	pointer
[	O
1	int
]	O
)	O
&&	O
c_isxdigit	function
(	O
s	pointer
[	O
2	int
]	O
)	O
)	O
{	O
unsigned	O
char	O
c	int
=	O
(	O
unsigned	O
char	O
)	O
(	O
_unhex	function
(	O
s	pointer
[	O
1	int
]	O
)	O
<<	O
4	int
)	O
|	O
_unhex	function
(	O
s	pointer
[	O
2	int
]	O
)	O
;	O
if	O
(	O
!	O
ctype	int
||	O
(	O
!	O
(	O
iri_ctype	array
[	O
(	O
unsigned	O
char	O
)	O
(	O
c	int
)	O
]	O
&	O
ctype	int
)	O
&&	O
c	int
!=	O
'%'	O
)	O
)	O
{	O
*	O
d	pointer
++	O
=	O
c	int
;	O
s	pointer
+=	O
3	int
;	O
ret	pointer
=	O
src	pointer
;	O
continue	O
;	O
}	O
}	O
}	O
else	O
if	O
(	O
*	O
s	pointer
==	O
'&'	O
)	O
{	O
if	O
(	O
!	O
strncmp	function
(	O
(	O
char	O
*	O
)	O
s	pointer
+	O
1	int
,	O
"amp;"	pointer
,	O
4	int
)	O
)	O
{	O
*	O
d	pointer
++	O
=	O
'&'	O
;	O
s	pointer
+=	O
5	int
;	O
ret	pointer
=	O
src	pointer
;	O
continue	O
;	O
}	O
else	O
if	O
(	O
!	O
strncmp	function
(	O
(	O
char	O
*	O
)	O
s	pointer
+	O
1	int
,	O
"gt;"	pointer
,	O
3	int
)	O
)	O
{	O
*	O
d	pointer
++	O
=	O
'>'	O
;	O
s	pointer
+=	O
4	int
;	O
ret	pointer
=	O
src	pointer
;	O
continue	O
;	O
}	O
else	O
if	O
(	O
!	O
strncmp	function
(	O
(	O
char	O
*	O
)	O
s	pointer
+	O
1	int
,	O
"lt;"	pointer
,	O
3	int
)	O
)	O
{	O
*	O
d	pointer
++	O
=	O
'<'	O
;	O
s	pointer
+=	O
4	int
;	O
ret	pointer
=	O
src	pointer
;	O
continue	O
;	O
}	O
else	O
if	O
(	O
!	O
strncmp	function
(	O
(	O
char	O
*	O
)	O
s	pointer
+	O
1	int
,	O
"quot;"	pointer
,	O
5	int
)	O
)	O
{	O
*	O
d	pointer
++	O
=	O
'\"'	O
;	O
s	pointer
+=	O
6	int
;	O
ret	pointer
=	O
src	pointer
;	O
continue	O
;	O
}	O
else	O
if	O
(	O
!	O
strncmp	function
(	O
(	O
char	O
*	O
)	O
s	pointer
+	O
1	int
,	O
"apos;"	pointer
,	O
5	int
)	O
)	O
{	O
*	O
d	pointer
++	O
=	O
'\''	O
;	O
s	pointer
+=	O
6	int
;	O
ret	pointer
=	O
src	pointer
;	O
continue	O
;	O
}	O
}	O
else	O
if	O
(	O
*	O
s	pointer
==	O
'#'	O
)	O
{	O
uint32_t	int
value	pointer
=	O
0	int
;	O
if	O
(	O
s	pointer
[	O
1	int
]	O
==	O
'x'	O
)	O
{	O
unsigned	O
char	O
*	O
p	pointer
=	O
s	pointer
+	O
2	int
;	O
while	O
(	O
c_isxdigit	function
(	O
*	O
p	pointer
)	O
)	O
{	O
value	pointer
=	O
(	O
value	pointer
<<	O
4	int
)	O
|	O
_unhex	function
(	O
*	O
p	pointer
)	O
;	O
p	pointer
++	O
;	O
}	O
if	O
(	O
*	O
p	pointer
==	O
';'	O
)	O
{	O
if	O
(	O
value	pointer
>	O
0	int
&&	O
value	pointer
<	O
128	int
)	O
{	O
*	O
d	pointer
++	O
=	O
(	O
unsigned	O
char	O
)	O
value	pointer
;	O
s	pointer
=	O
p	pointer
+	O
1	int
;	O
continue	O
;	O
}	O
}	O
}	O
else	O
{	O
unsigned	O
char	O
*	O
p	pointer
=	O
s	pointer
+	O
1	int
;	O
while	O
(	O
c_isdigit	function
(	O
*	O
p	pointer
)	O
&&	O
value	pointer
<=	O
0x10FFFF	int
)	O
{	O
value	pointer
=	O
value	pointer
*	O
10	int
+	O
(	O
*	O
p	pointer
-	O
'0'	O
)	O
;	O
p	pointer
++	O
;	O
}	O
if	O
(	O
*	O
p	pointer
==	O
';'	O
)	O
{	O
if	O
(	O
value	pointer
>	O
0	int
&&	O
value	pointer
<	O
128	int
)	O
{	O
*	O
d	pointer
++	O
=	O
(	O
unsigned	O
char	O
)	O
value	pointer
;	O
s	pointer
=	O
p	pointer
+	O
1	int
;	O
continue	O
;	O
}	O
}	O
}	O
}	O
*	O
d	pointer
++	O
=	O
*	O
s	pointer
++	O
;	O
}	O
*	O
d	pointer
=	O
0	int
;	O
return	O
ret	pointer
;	O
}	O
char	O
*	O
wget_iri_unescape_inline	function
(	O
char	O
*	O
src	pointer
)	O
{	O
return	O
_iri_unescape_inline	function
(	O
src	pointer
,	O
0	int
)	O
;	O
}	O
char	O
*	O
wget_iri_unescape_url_inline	function
(	O
char	O
*	O
src	pointer
)	O
{	O
return	O
_iri_unescape_inline	function
(	O
src	pointer
,	O
IRI_CTYPE_GENDELIM	O
)	O
;	O
}	O
void	O
wget_iri_free_content	function
(	O
wget_iri	struct
*	O
iri	pointer
)	O
{	O
if	O
(	O
iri	pointer
)	O
{	O
if	O
(	O
iri	pointer
->	O
uri_allocated	bool
)	O
xfree	O
(	O
iri	pointer
->	O
uri	pointer
)	O
;	O
if	O
(	O
iri	pointer
->	O
host_allocated	bool
)	O
xfree	O
(	O
iri	pointer
->	O
host	pointer
)	O
;	O
if	O
(	O
iri	pointer
->	O
path_allocated	bool
)	O
xfree	O
(	O
iri	pointer
->	O
path	pointer
)	O
;	O
if	O
(	O
iri	pointer
->	O
query_allocated	bool
)	O
xfree	O
(	O
iri	pointer
->	O
query	pointer
)	O
;	O
if	O
(	O
iri	pointer
->	O
fragment_allocated	bool
)	O
xfree	O
(	O
iri	pointer
->	O
fragment	pointer
)	O
;	O
xfree	O
(	O
iri	pointer
->	O
connection_part	pointer
)	O
;	O
}	O
}	O
void	O
wget_iri_free	function
(	O
wget_iri	struct
*	O
*	O
iri	pointer
)	O
{	O
if	O
(	O
iri	pointer
&&	O
*	O
iri	pointer
)	O
{	O
wget_iri_free_content	function
(	O
*	O
iri	pointer
)	O
;	O
xfree	O
(	O
*	O
iri	pointer
)	O
;	O
}	O
}	O
wget_iri	struct
*	O
wget_iri_parse	function
(	O
const	O
char	O
*	O
url	pointer
,	O
const	O
char	O
*	O
encoding	pointer
)	O
{	O
wget_iri	struct
*	O
iri	pointer
;	O
char	O
*	O
p	pointer
,	O
*	O
s	pointer
,	O
*	O
authority	pointer
,	O
c	int
;	O
size_t	long
slen	long
,	O
extra	long
;	O
int	O
have_scheme	int
;	O
if	O
(	O
!	O
url	pointer
)	O
return	O
NULL	O
;	O
while	O
(	O
c_isspace	function
(	O
*	O
url	pointer
)	O
)	O
url	pointer
++	O
;	O
if	O
(	O
!	O
*	O
url	pointer
)	O
return	O
NULL	O
;	O
if	O
(	O
c_isalpha	function
(	O
*	O
url	pointer
)	O
)	O
{	O
const	O
char	O
*	O
x	pointer
;	O
have_scheme	int
=	O
1	int
;	O
for	O
(	O
x	pointer
=	O
url	pointer
;	O
*	O
x	pointer
&&	O
_iri_isscheme	O
(	O
*	O
x	pointer
)	O
;	O
x	pointer
++	O
)	O
;	O
if	O
(	O
*	O
x	pointer
!=	O
':'	O
||	O
c_isdigit	function
(	O
x	pointer
[	O
1	int
]	O
)	O
)	O
have_scheme	int
=	O
0	int
;	O
}	O
else	O
have_scheme	int
=	O
0	int
;	O
slen	long
=	O
strlen	function
(	O
url	pointer
)	O
;	O
extra	long
=	O
have_scheme	int
?	O
0	int
:	O
sizeof	O
(	O
"http://"	pointer
)	O
-	O
1	int
;	O
iri	pointer
=	O
wget_malloc	function
(	O
sizeof	O
(	O
wget_iri	struct
)	O
+	O
(	O
slen	long
+	O
extra	long
+	O
1	int
)	O
*	O
2	int
)	O
;	O
if	O
(	O
!	O
iri	pointer
)	O
return	O
NULL	O
;	O
memset	function
(	O
iri	pointer
,	O
0	int
,	O
sizeof	O
(	O
wget_iri	struct
)	O
)	O
;	O
if	O
(	O
have_scheme	int
)	O
{	O
iri	pointer
->	O
msize	long
=	O
slen	long
+	O
1	int
;	O
iri	pointer
->	O
uri	pointer
=	O
memcpy	function
(	O
(	O
(	O
char	O
*	O
)	O
iri	pointer
)	O
+	O
sizeof	O
(	O
wget_iri	struct
)	O
,	O
url	pointer
,	O
iri	pointer
->	O
msize	long
)	O
;	O
p	pointer
=	O
s	pointer
=	O
memcpy	function
(	O
(	O
char	O
*	O
)	O
iri	pointer
->	O
uri	pointer
+	O
iri	pointer
->	O
msize	long
,	O
url	pointer
,	O
iri	pointer
->	O
msize	long
)	O
;	O
s	pointer
=	O
strchr	function
(	O
s	pointer
,	O
':'	O
)	O
;	O
*	O
s	pointer
++	O
=	O
0	int
;	O
wget_iri_unescape_inline	function
(	O
p	pointer
)	O
;	O
wget_strtolower	function
(	O
p	pointer
)	O
;	O
bool	bool
found	bool
=	O
false	int
;	O
for	O
(	O
unsigned	O
it	int
=	O
0	int
;	O
it	int
<	O
countof	O
(	O
schemes	array
)	O
;	O
it	int
++	O
)	O
{	O
if	O
(	O
!	O
strcmp	function
(	O
schemes	array
[	O
it	int
]	O
.	O
name	pointer
,	O
p	pointer
)	O
)	O
{	O
iri	pointer
->	O
scheme	enum
=	O
it	int
;	O
iri	pointer
->	O
port	short
=	O
schemes	array
[	O
it	int
]	O
.	O
port	short
;	O
found	bool
=	O
true	int
;	O
break	O
;	O
}	O
}	O
if	O
(	O
!	O
found	bool
)	O
{	O
debug_printf	O
(	O
"Unsupported scheme in '%s'\n"	pointer
,	O
url	pointer
)	O
;	O
wget_iri_free	function
(	O
&	O
iri	pointer
)	O
;	O
return	O
NULL	O
;	O
}	O
}	O
else	O
{	O
iri	pointer
->	O
uri	pointer
=	O
memcpy	function
(	O
(	O
(	O
char	O
*	O
)	O
iri	pointer
)	O
+	O
sizeof	O
(	O
wget_iri	struct
)	O
,	O
"http://"	pointer
,	O
extra	long
)	O
;	O
memcpy	function
(	O
(	O
(	O
char	O
*	O
)	O
iri	pointer
)	O
+	O
sizeof	O
(	O
wget_iri	struct
)	O
+	O
extra	long
,	O
url	pointer
,	O
slen	long
+	O
1	int
)	O
;	O
iri	pointer
->	O
msize	long
=	O
slen	long
+	O
1	int
+	O
extra	long
;	O
s	pointer
=	O
memcpy	function
(	O
(	O
char	O
*	O
)	O
iri	pointer
->	O
uri	pointer
+	O
iri	pointer
->	O
msize	long
,	O
"http://"	pointer
,	O
extra	long
)	O
;	O
memcpy	function
(	O
(	O
char	O
*	O
)	O
iri	pointer
->	O
uri	pointer
+	O
iri	pointer
->	O
msize	long
+	O
extra	long
,	O
url	pointer
,	O
slen	long
+	O
1	int
)	O
;	O
s	pointer
[	O
extra	long
-	O
3	int
]	O
=	O
0	int
;	O
s	pointer
+=	O
extra	long
;	O
iri	pointer
->	O
scheme	enum
=	O
WGET_IRI_SCHEME_HTTP	int
;	O
iri	pointer
->	O
port	short
=	O
schemes	array
[	O
WGET_IRI_SCHEME_HTTP	int
]	O
.	O
port	short
;	O
}	O
while	O
(	O
*	O
s	pointer
==	O
'/'	O
)	O
s	pointer
++	O
;	O
authority	pointer
=	O
s	pointer
;	O
while	O
(	O
*	O
s	pointer
&&	O
*	O
s	pointer
!=	O
'/'	O
&&	O
*	O
s	pointer
!=	O
'?'	O
&&	O
*	O
s	pointer
!=	O
'#'	O
)	O
s	pointer
++	O
;	O
c	int
=	O
*	O
s	pointer
;	O
if	O
(	O
c	int
)	O
*	O
s	pointer
++	O
=	O
0	int
;	O
wget_iri_unescape_inline	function
(	O
authority	pointer
)	O
;	O
if	O
(	O
c	int
==	O
'/'	O
)	O
{	O
iri	pointer
->	O
path	pointer
=	O
s	pointer
;	O
while	O
(	O
*	O
s	pointer
&&	O
*	O
s	pointer
!=	O
'?'	O
&&	O
*	O
s	pointer
!=	O
'#'	O
)	O
s	pointer
++	O
;	O
c	int
=	O
*	O
s	pointer
;	O
if	O
(	O
c	int
)	O
*	O
s	pointer
++	O
=	O
0	int
;	O
wget_iri_unescape_inline	function
(	O
(	O
char	O
*	O
)	O
iri	pointer
->	O
path	pointer
)	O
;	O
}	O
if	O
(	O
c	int
==	O
'?'	O
)	O
{	O
iri	pointer
->	O
query	pointer
=	O
s	pointer
;	O
while	O
(	O
*	O
s	pointer
&&	O
*	O
s	pointer
!=	O
'#'	O
)	O
{	O
if	O
(	O
*	O
s	pointer
==	O
'+'	O
)	O
*	O
s	pointer
=	O
' '	O
;	O
s	pointer
++	O
;	O
}	O
c	int
=	O
*	O
s	pointer
;	O
if	O
(	O
c	int
)	O
*	O
s	pointer
++	O
=	O
0	int
;	O
}	O
if	O
(	O
c	int
==	O
'#'	O
)	O
{	O
iri	pointer
->	O
fragment	pointer
=	O
s	pointer
;	O
s	pointer
+=	O
strlen	function
(	O
s	pointer
)	O
;	O
wget_iri_unescape_inline	function
(	O
(	O
char	O
*	O
)	O
iri	pointer
->	O
fragment	pointer
)	O
;	O
}	O
if	O
(	O
*	O
s	pointer
)	O
{	O
debug_printf	O
(	O
"unparsed rest '%s'\n"	pointer
,	O
s	pointer
)	O
;	O
}	O
if	O
(	O
*	O
authority	pointer
)	O
{	O
s	pointer
=	O
authority	pointer
;	O
p	pointer
=	O
strchr	function
(	O
authority	pointer
,	O
'@'	O
)	O
;	O
if	O
(	O
p	pointer
)	O
{	O
iri	pointer
->	O
userinfo	pointer
=	O
s	pointer
;	O
*	O
p	pointer
=	O
0	int
;	O
if	O
(	O
(	O
s	pointer
=	O
strchr	function
(	O
s	pointer
,	O
':'	O
)	O
)	O
)	O
{	O
*	O
s	pointer
=	O
0	int
;	O
iri	pointer
->	O
password	pointer
=	O
s	pointer
+	O
1	int
;	O
}	O
s	pointer
=	O
p	pointer
+	O
1	int
;	O
}	O
if	O
(	O
*	O
s	pointer
==	O
'['	O
)	O
{	O
p	pointer
=	O
strrchr	function
(	O
s	pointer
,	O
']'	O
)	O
;	O
if	O
(	O
p	pointer
)	O
{	O
iri	pointer
->	O
host	pointer
=	O
s	pointer
+	O
1	int
;	O
*	O
p	pointer
=	O
0	int
;	O
s	pointer
=	O
p	pointer
+	O
1	int
;	O
}	O
else	O
{	O
iri	pointer
->	O
host	pointer
=	O
s	pointer
+	O
1	int
;	O
s	pointer
+=	O
strlen	function
(	O
s	pointer
)	O
;	O
}	O
}	O
else	O
{	O
iri	pointer
->	O
host	pointer
=	O
s	pointer
;	O
while	O
(	O
*	O
s	pointer
&&	O
*	O
s	pointer
!=	O
':'	O
)	O
s	pointer
++	O
;	O
}	O
if	O
(	O
*	O
s	pointer
==	O
':'	O
)	O
{	O
if	O
(	O
c_isdigit	function
(	O
s	pointer
[	O
1	int
]	O
)	O
)	O
{	O
int	O
port	short
=	O
atoi	function
(	O
s	pointer
+	O
1	int
)	O
;	O
if	O
(	O
port	short
>	O
0	int
&&	O
port	short
<	O
65536	int
)	O
{	O
iri	pointer
->	O
port	short
=	O
(	O
uint16_t	short
)	O
port	short
;	O
iri	pointer
->	O
port_given	bool
=	O
true	int
;	O
}	O
}	O
}	O
*	O
s	pointer
=	O
0	int
;	O
}	O
if	O
(	O
iri	pointer
->	O
host	pointer
)	O
{	O
wget_strtolower	function
(	O
(	O
char	O
*	O
)	O
iri	pointer
->	O
host	pointer
)	O
;	O
if	O
(	O
wget_str_needs_encoding	function
(	O
iri	pointer
->	O
host	pointer
)	O
)	O
{	O
if	O
(	O
(	O
s	pointer
=	O
wget_str_to_utf8	function
(	O
iri	pointer
->	O
host	pointer
,	O
encoding	pointer
)	O
)	O
)	O
{	O
iri	pointer
->	O
host	pointer
=	O
s	pointer
;	O
iri	pointer
->	O
host_allocated	bool
=	O
true	int
;	O
}	O
}	O
if	O
(	O
(	O
p	pointer
=	O
(	O
char	O
*	O
)	O
wget_str_to_ascii	function
(	O
iri	pointer
->	O
host	pointer
)	O
)	O
!=	O
iri	pointer
->	O
host	pointer
)	O
{	O
if	O
(	O
iri	pointer
->	O
host_allocated	bool
)	O
xfree	O
(	O
iri	pointer
->	O
host	pointer
)	O
;	O
iri	pointer
->	O
host	pointer
=	O
p	pointer
;	O
iri	pointer
->	O
host_allocated	bool
=	O
true	int
;	O
}	O
if	O
(	O
wget_ip_is_family	function
(	O
iri	pointer
->	O
host	pointer
,	O
WGET_NET_FAMILY_IPV4	int
)	O
||	O
wget_ip_is_family	function
(	O
iri	pointer
->	O
host	pointer
,	O
WGET_NET_FAMILY_IPV6	int
)	O
)	O
iri	pointer
->	O
is_ip_address	bool
=	O
true	int
;	O
}	O
if	O
(	O
!	O
iri	pointer
->	O
host	pointer
)	O
{	O
error_printf	O
(	O
_	O
(	O
"Missing host/domain in URI '%s'\n"	pointer
)	O
,	O
iri	pointer
->	O
uri	pointer
)	O
;	O
wget_iri_free	function
(	O
&	O
iri	pointer
)	O
;	O
return	O
NULL	O
;	O
}	O
if	O
(	O
iri	pointer
->	O
path	pointer
&&	O
wget_str_needs_encoding	function
(	O
iri	pointer
->	O
path	pointer
)	O
)	O
{	O
if	O
(	O
(	O
s	pointer
=	O
wget_str_to_utf8	function
(	O
iri	pointer
->	O
path	pointer
,	O
encoding	pointer
)	O
)	O
)	O
{	O
iri	pointer
->	O
path	pointer
=	O
s	pointer
;	O
iri	pointer
->	O
path_allocated	bool
=	O
true	int
;	O
}	O
}	O
if	O
(	O
iri	pointer
->	O
query	pointer
&&	O
wget_str_needs_encoding	function
(	O
iri	pointer
->	O
query	pointer
)	O
)	O
{	O
if	O
(	O
(	O
s	pointer
=	O
wget_str_to_utf8	function
(	O
iri	pointer
->	O
query	pointer
,	O
encoding	pointer
)	O
)	O
)	O
{	O
iri	pointer
->	O
query	pointer
=	O
s	pointer
;	O
iri	pointer
->	O
query_allocated	bool
=	O
true	int
;	O
}	O
}	O
if	O
(	O
iri	pointer
->	O
fragment	pointer
&&	O
wget_str_needs_encoding	function
(	O
iri	pointer
->	O
fragment	pointer
)	O
)	O
{	O
if	O
(	O
(	O
s	pointer
=	O
wget_str_to_utf8	function
(	O
iri	pointer
->	O
fragment	pointer
,	O
encoding	pointer
)	O
)	O
)	O
{	O
iri	pointer
->	O
fragment	pointer
=	O
s	pointer
;	O
iri	pointer
->	O
fragment_allocated	bool
=	O
true	int
;	O
}	O
}	O
return	O
iri	pointer
;	O
}	O
wget_iri	struct
*	O
wget_iri_clone	function
(	O
const	O
wget_iri	struct
*	O
iri	pointer
)	O
{	O
if	O
(	O
!	O
iri	pointer
||	O
!	O
iri	pointer
->	O
uri	pointer
)	O
return	O
NULL	O
;	O
size_t	long
slen	long
=	O
strlen	function
(	O
iri	pointer
->	O
uri	pointer
)	O
;	O
wget_iri	struct
*	O
clone	pointer
=	O
wget_malloc	function
(	O
sizeof	O
(	O
wget_iri	struct
)	O
+	O
(	O
slen	long
+	O
1	int
)	O
+	O
iri	pointer
->	O
msize	long
)	O
;	O
if	O
(	O
!	O
clone	pointer
)	O
return	O
NULL	O
;	O
memcpy	function
(	O
clone	pointer
,	O
iri	pointer
,	O
sizeof	O
(	O
wget_iri	struct
)	O
)	O
;	O
clone	pointer
->	O
uri	pointer
=	O
memcpy	function
(	O
(	O
(	O
char	O
*	O
)	O
clone	pointer
)	O
+	O
sizeof	O
(	O
wget_iri	struct
)	O
,	O
iri	pointer
->	O
uri	pointer
,	O
slen	long
+	O
1	int
)	O
;	O
memcpy	function
(	O
(	O
char	O
*	O
)	O
clone	pointer
->	O
uri	pointer
+	O
slen	long
+	O
1	int
,	O
(	O
char	O
*	O
)	O
iri	pointer
->	O
uri	pointer
+	O
slen	long
+	O
1	int
,	O
iri	pointer
->	O
msize	long
)	O
;	O
clone	pointer
->	O
uri_allocated	bool
=	O
0	int
;	O
clone	pointer
->	O
connection_part	pointer
=	O
wget_strdup	function
(	O
iri	pointer
->	O
connection_part	pointer
)	O
;	O
if	O
(	O
iri	pointer
->	O
host_allocated	bool
)	O
clone	pointer
->	O
host	pointer
=	O
wget_strdup	function
(	O
iri	pointer
->	O
host	pointer
)	O
;	O
else	O
clone	pointer
->	O
host	pointer
=	O
iri	pointer
->	O
host	pointer
?	O
(	O
char	O
*	O
)	O
clone	pointer
+	O
(	O
size_t	long
)	O
(	O
iri	pointer
->	O
host	pointer
-	O
(	O
const	O
char	O
*	O
)	O
iri	pointer
)	O
:	O
NULL	O
;	O
clone	pointer
->	O
display	pointer
=	O
iri	pointer
->	O
display	pointer
?	O
(	O
char	O
*	O
)	O
clone	pointer
+	O
(	O
size_t	long
)	O
(	O
iri	pointer
->	O
display	pointer
-	O
(	O
const	O
char	O
*	O
)	O
iri	pointer
)	O
:	O
NULL	O
;	O
clone	pointer
->	O
userinfo	pointer
=	O
iri	pointer
->	O
userinfo	pointer
?	O
(	O
char	O
*	O
)	O
clone	pointer
+	O
(	O
size_t	long
)	O
(	O
iri	pointer
->	O
userinfo	pointer
-	O
(	O
const	O
char	O
*	O
)	O
iri	pointer
)	O
:	O
NULL	O
;	O
clone	pointer
->	O
password	pointer
=	O
iri	pointer
->	O
password	pointer
?	O
(	O
char	O
*	O
)	O
clone	pointer
+	O
(	O
size_t	long
)	O
(	O
iri	pointer
->	O
password	pointer
-	O
(	O
const	O
char	O
*	O
)	O
iri	pointer
)	O
:	O
NULL	O
;	O
if	O
(	O
iri	pointer
->	O
path_allocated	bool
)	O
clone	pointer
->	O
path	pointer
=	O
wget_strdup	function
(	O
iri	pointer
->	O
path	pointer
)	O
;	O
else	O
clone	pointer
->	O
path	pointer
=	O
iri	pointer
->	O
path	pointer
?	O
(	O
char	O
*	O
)	O
clone	pointer
+	O
(	O
size_t	long
)	O
(	O
iri	pointer
->	O
path	pointer
-	O
(	O
const	O
char	O
*	O
)	O
iri	pointer
)	O
:	O
NULL	O
;	O
if	O
(	O
iri	pointer
->	O
query_allocated	bool
)	O
clone	pointer
->	O
query	pointer
=	O
wget_strdup	function
(	O
iri	pointer
->	O
query	pointer
)	O
;	O
else	O
clone	pointer
->	O
query	pointer
=	O
iri	pointer
->	O
query	pointer
?	O
(	O
char	O
*	O
)	O
clone	pointer
+	O
(	O
size_t	long
)	O
(	O
iri	pointer
->	O
query	pointer
-	O
(	O
const	O
char	O
*	O
)	O
iri	pointer
)	O
:	O
NULL	O
;	O
if	O
(	O
iri	pointer
->	O
fragment_allocated	bool
)	O
clone	pointer
->	O
fragment	pointer
=	O
wget_strdup	function
(	O
iri	pointer
->	O
fragment	pointer
)	O
;	O
else	O
clone	pointer
->	O
fragment	pointer
=	O
iri	pointer
->	O
fragment	pointer
?	O
(	O
char	O
*	O
)	O
clone	pointer
+	O
(	O
size_t	long
)	O
(	O
iri	pointer
->	O
fragment	pointer
-	O
(	O
const	O
char	O
*	O
)	O
iri	pointer
)	O
:	O
NULL	O
;	O
return	O
clone	pointer
;	O
}	O
const	O
char	O
*	O
wget_iri_get_connection_part	function
(	O
wget_iri	struct
*	O
iri	pointer
)	O
{	O
if	O
(	O
iri	pointer
)	O
{	O
if	O
(	O
!	O
iri	pointer
->	O
connection_part	pointer
)	O
{	O
if	O
(	O
iri	pointer
->	O
port_given	bool
)	O
{	O
iri	pointer
->	O
connection_part	pointer
=	O
wget_aprintf	function
(	O
"%s://%s:%hu"	pointer
,	O
schemes	array
[	O
iri	pointer
->	O
scheme	enum
]	O
.	O
name	pointer
,	O
iri	pointer
->	O
host	pointer
,	O
iri	pointer
->	O
port	short
)	O
;	O
}	O
else	O
{	O
iri	pointer
->	O
connection_part	pointer
=	O
wget_aprintf	function
(	O
"%s://%s"	pointer
,	O
schemes	array
[	O
iri	pointer
->	O
scheme	enum
]	O
.	O
name	pointer
,	O
iri	pointer
->	O
host	pointer
)	O
;	O
}	O
}	O
return	O
iri	pointer
->	O
connection_part	pointer
;	O
}	O
return	O
NULL	O
;	O
}	O
static	O
size_t	long
WGET_GCC_NONNULL_ALL	O
_normalize_path	function
(	O
char	O
*	O
path	pointer
)	O
{	O
char	O
*	O
p1	pointer
=	O
path	pointer
,	O
*	O
p2	pointer
=	O
path	pointer
;	O
debug_printf	O
(	O
"path %s ->\n"	pointer
,	O
path	pointer
)	O
;	O
for	O
(	O
;	O
;	O
)	O
{	O
if	O
(	O
*	O
p2	pointer
==	O
'/'	O
)	O
p2	pointer
++	O
;	O
else	O
if	O
(	O
*	O
p2	pointer
==	O
'.'	O
)	O
{	O
if	O
(	O
p2	pointer
[	O
1	int
]	O
==	O
'/'	O
)	O
p2	pointer
+=	O
2	int
;	O
else	O
if	O
(	O
p2	pointer
[	O
1	int
]	O
==	O
'.'	O
)	O
{	O
if	O
(	O
p2	pointer
[	O
2	int
]	O
==	O
'/'	O
)	O
p2	pointer
+=	O
3	int
;	O
else	O
if	O
(	O
!	O
p2	pointer
[	O
2	int
]	O
)	O
p2	pointer
+=	O
2	int
;	O
else	O
break	O
;	O
}	O
else	O
if	O
(	O
!	O
p2	pointer
[	O
1	int
]	O
)	O
p2	pointer
++	O
;	O
else	O
break	O
;	O
}	O
else	O
break	O
;	O
}	O
while	O
(	O
*	O
p2	pointer
&&	O
*	O
p2	pointer
!=	O
'?'	O
&&	O
*	O
p2	pointer
!=	O
'#'	O
)	O
{	O
if	O
(	O
*	O
p2	pointer
==	O
'/'	O
)	O
{	O
if	O
(	O
p2	pointer
[	O
1	int
]	O
==	O
'.'	O
)	O
{	O
if	O
(	O
!	O
strncmp	function
(	O
p2	pointer
,	O
"/../"	pointer
,	O
4	int
)	O
)	O
{	O
p2	pointer
+=	O
3	int
;	O
while	O
(	O
p1	pointer
>	O
path	pointer
&&	O
*	O
--	O
p1	pointer
!=	O
'/'	O
)	O
;	O
}	O
else	O
if	O
(	O
!	O
strcmp	function
(	O
p2	pointer
,	O
"/.."	pointer
)	O
)	O
{	O
p2	pointer
+=	O
3	int
;	O
while	O
(	O
p1	pointer
>	O
path	pointer
&&	O
*	O
--	O
p1	pointer
!=	O
'/'	O
)	O
;	O
if	O
(	O
p1	pointer
>	O
path	pointer
)	O
*	O
p1	pointer
++	O
=	O
'/'	O
;	O
}	O
else	O
if	O
(	O
!	O
strncmp	function
(	O
p2	pointer
,	O
"/./"	pointer
,	O
3	int
)	O
)	O
{	O
p2	pointer
+=	O
2	int
;	O
}	O
else	O
if	O
(	O
!	O
strcmp	function
(	O
p2	pointer
,	O
"/."	pointer
)	O
)	O
{	O
p2	pointer
+=	O
2	int
;	O
if	O
(	O
p1	pointer
>	O
path	pointer
)	O
*	O
p1	pointer
++	O
=	O
'/'	O
;	O
}	O
else	O
*	O
p1	pointer
++	O
=	O
*	O
p2	pointer
++	O
;	O
}	O
else	O
if	O
(	O
p1	pointer
==	O
path	pointer
)	O
p2	pointer
++	O
;	O
else	O
if	O
(	O
p2	pointer
[	O
1	int
]	O
==	O
'/'	O
)	O
p2	pointer
++	O
;	O
else	O
*	O
p1	pointer
++	O
=	O
*	O
p2	pointer
++	O
;	O
}	O
else	O
*	O
p1	pointer
++	O
=	O
*	O
p2	pointer
++	O
;	O
}	O
if	O
(	O
p1	pointer
!=	O
p2	pointer
)	O
{	O
while	O
(	O
*	O
p2	pointer
)	O
*	O
p1	pointer
++	O
=	O
*	O
p2	pointer
++	O
;	O
*	O
p1	pointer
=	O
0	int
;	O
}	O
else	O
{	O
p1	pointer
+=	O
strlen	function
(	O
p1	pointer
)	O
;	O
}	O
debug_printf	O
(	O
"     %s\n"	pointer
,	O
path	pointer
)	O
;	O
return	O
p1	pointer
-	O
path	pointer
;	O
}	O
const	O
char	O
*	O
wget_iri_relative_to_abs	function
(	O
wget_iri	struct
*	O
base	pointer
,	O
const	O
char	O
*	O
val	pointer
,	O
size_t	long
len	long
,	O
wget_buffer	struct
*	O
buf	pointer
)	O
{	O
debug_printf	O
(	O
"*url = %.*s\n"	pointer
,	O
(	O
int	O
)	O
len	long
,	O
val	pointer
)	O
;	O
if	O
(	O
len	long
==	O
(	O
size_t	long
)	O
-	O
1	int
)	O
len	long
=	O
strlen	function
(	O
val	pointer
)	O
;	O
if	O
(	O
*	O
val	pointer
==	O
'/'	O
)	O
{	O
if	O
(	O
base	pointer
)	O
{	O
char	O
path	pointer
[	O
len	long
+	O
1	int
]	O
;	O
wget_strscpy	function
(	O
path	pointer
,	O
val	pointer
,	O
len	long
+	O
1	int
)	O
;	O
if	O
(	O
len	long
>=	O
2	int
&&	O
val	pointer
[	O
1	int
]	O
==	O
'/'	O
)	O
{	O
char	O
*	O
p	pointer
;	O
if	O
(	O
(	O
p	pointer
=	O
strchr	function
(	O
path	pointer
+	O
2	int
,	O
'/'	O
)	O
)	O
)	O
_normalize_path	function
(	O
p	pointer
+	O
1	int
)	O
;	O
wget_buffer_strcpy	function
(	O
buf	pointer
,	O
schemes	array
[	O
base	pointer
->	O
scheme	enum
]	O
.	O
name	pointer
)	O
;	O
wget_buffer_strcat	function
(	O
buf	pointer
,	O
":"	pointer
)	O
;	O
wget_buffer_strcat	function
(	O
buf	pointer
,	O
path	pointer
)	O
;	O
debug_printf	O
(	O
"*1 %s\n"	pointer
,	O
buf	pointer
->	O
data	pointer
)	O
;	O
}	O
else	O
{	O
_normalize_path	function
(	O
path	pointer
)	O
;	O
wget_buffer_strcpy	function
(	O
buf	pointer
,	O
wget_iri_get_connection_part	function
(	O
base	pointer
)	O
)	O
;	O
wget_buffer_strcat	function
(	O
buf	pointer
,	O
"/"	pointer
)	O
;	O
wget_buffer_strcat	function
(	O
buf	pointer
,	O
path	pointer
)	O
;	O
debug_printf	O
(	O
"*2 %s\n"	pointer
,	O
buf	pointer
->	O
data	pointer
)	O
;	O
}	O
}	O
else	O
{	O
return	O
NULL	O
;	O
}	O
}	O
else	O
{	O
if	O
(	O
memchr	function
(	O
val	pointer
,	O
':'	O
,	O
len	long
)	O
)	O
{	O
if	O
(	O
buf	pointer
)	O
{	O
wget_buffer_memcpy	function
(	O
buf	pointer
,	O
val	pointer
,	O
len	long
)	O
;	O
debug_printf	O
(	O
"*3 %s\n"	pointer
,	O
buf	pointer
->	O
data	pointer
)	O
;	O
}	O
else	O
{	O
debug_printf	O
(	O
"*3 %s\n"	pointer
,	O
val	pointer
)	O
;	O
return	O
val	pointer
;	O
}	O
}	O
else	O
if	O
(	O
base	pointer
)	O
{	O
const	O
char	O
*	O
lastsep	pointer
=	O
base	pointer
->	O
path	pointer
?	O
strrchr	function
(	O
base	pointer
->	O
path	pointer
,	O
'/'	O
)	O
:	O
NULL	O
;	O
wget_buffer_strcpy	function
(	O
buf	pointer
,	O
wget_iri_get_connection_part	function
(	O
base	pointer
)	O
)	O
;	O
wget_buffer_strcat	function
(	O
buf	pointer
,	O
"/"	pointer
)	O
;	O
size_t	long
tmp_len	long
=	O
buf	pointer
->	O
length	long
;	O
if	O
(	O
lastsep	pointer
)	O
wget_buffer_memcat	function
(	O
buf	pointer
,	O
base	pointer
->	O
path	pointer
,	O
lastsep	pointer
-	O
base	pointer
->	O
path	pointer
+	O
1	int
)	O
;	O
if	O
(	O
len	long
)	O
wget_buffer_memcat	function
(	O
buf	pointer
,	O
val	pointer
,	O
len	long
)	O
;	O
buf	pointer
->	O
length	long
=	O
_normalize_path	function
(	O
buf	pointer
->	O
data	pointer
+	O
tmp_len	long
)	O
+	O
tmp_len	long
;	O
debug_printf	O
(	O
"*4 %s %zu\n"	pointer
,	O
buf	pointer
->	O
data	pointer
,	O
buf	pointer
->	O
length	long
)	O
;	O
}	O
else	O
if	O
(	O
val	pointer
[	O
len	long
]	O
==	O
0	int
)	O
{	O
return	O
val	pointer
;	O
}	O
else	O
{	O
return	O
NULL	O
;	O
}	O
}	O
return	O
likely	O
(	O
buf	pointer
)	O
?	O
buf	pointer
->	O
data	pointer
:	O
NULL	O
;	O
}	O
wget_iri	struct
*	O
wget_iri_parse_base	function
(	O
wget_iri	struct
*	O
base	pointer
,	O
const	O
char	O
*	O
url	pointer
,	O
const	O
char	O
*	O
encoding	pointer
)	O
{	O
wget_iri	struct
*	O
iri	pointer
;	O
if	O
(	O
base	pointer
)	O
{	O
wget_buffer	struct
buf	pointer
;	O
char	O
sbuf	array
[	O
256	int
]	O
;	O
wget_buffer_init	function
(	O
&	O
buf	pointer
,	O
sbuf	array
,	O
sizeof	O
(	O
sbuf	array
)	O
)	O
;	O
iri	pointer
=	O
wget_iri_parse	function
(	O
wget_iri_relative_to_abs	function
(	O
base	pointer
,	O
url	pointer
,	O
-	O
1	int
,	O
&	O
buf	pointer
)	O
,	O
encoding	pointer
)	O
;	O
wget_buffer_deinit	function
(	O
&	O
buf	pointer
)	O
;	O
}	O
else	O
{	O
iri	pointer
=	O
wget_iri_parse	function
(	O
wget_iri_relative_to_abs	function
(	O
NULL	O
,	O
url	pointer
,	O
-	O
1	int
,	O
NULL	O
)	O
,	O
encoding	pointer
)	O
;	O
}	O
return	O
iri	pointer
;	O
}	O
int	O
wget_iri_compare	function
(	O
wget_iri	struct
*	O
iri1	pointer
,	O
wget_iri	struct
*	O
iri2	pointer
)	O
{	O
int	O
n	long
;	O
if	O
(	O
!	O
iri1	pointer
)	O
{	O
if	O
(	O
!	O
iri2	pointer
)	O
return	O
0	int
;	O
else	O
return	O
-	O
1	int
;	O
}	O
else	O
if	O
(	O
!	O
iri2	pointer
)	O
return	O
1	int
;	O
if	O
(	O
(	O
n	long
=	O
wget_strcasecmp	function
(	O
iri1	pointer
->	O
path	pointer
,	O
iri2	pointer
->	O
path	pointer
)	O
)	O
)	O
return	O
n	long
;	O
if	O
(	O
(	O
n	long
=	O
wget_strcasecmp	function
(	O
iri1	pointer
->	O
query	pointer
,	O
iri2	pointer
->	O
query	pointer
)	O
)	O
)	O
return	O
n	long
;	O
if	O
(	O
iri1	pointer
->	O
scheme	enum
!=	O
iri2	pointer
->	O
scheme	enum
)	O
return	O
iri1	pointer
->	O
scheme	enum
<	O
iri2	pointer
->	O
scheme	enum
?	O
-	O
1	int
:	O
1	int
;	O
if	O
(	O
(	O
n	long
=	O
iri1	pointer
->	O
port	short
-	O
iri2	pointer
->	O
port	short
)	O
)	O
return	O
n	long
;	O
if	O
(	O
(	O
n	long
=	O
strcmp	function
(	O
iri1	pointer
->	O
host	pointer
,	O
iri2	pointer
->	O
host	pointer
)	O
)	O
)	O
return	O
n	long
;	O
return	O
0	int
;	O
}	O
const	O
char	O
*	O
wget_iri_escape	function
(	O
const	O
char	O
*	O
src	pointer
,	O
wget_buffer	struct
*	O
buf	pointer
)	O
{	O
const	O
char	O
*	O
begin	pointer
;	O
if	O
(	O
!	O
src	pointer
)	O
return	O
buf	pointer
->	O
data	pointer
;	O
for	O
(	O
begin	pointer
=	O
src	pointer
;	O
*	O
src	pointer
;	O
src	pointer
++	O
)	O
{	O
if	O
(	O
!	O
wget_iri_isunreserved	function
(	O
*	O
src	pointer
)	O
)	O
{	O
if	O
(	O
begin	pointer
!=	O
src	pointer
)	O
wget_buffer_memcat	function
(	O
buf	pointer
,	O
begin	pointer
,	O
src	pointer
-	O
begin	pointer
)	O
;	O
begin	pointer
=	O
src	pointer
+	O
1	int
;	O
wget_buffer_printf_append	function
(	O
buf	pointer
,	O
"%%%02X"	pointer
,	O
(	O
unsigned	O
char	O
)	O
*	O
src	pointer
)	O
;	O
}	O
}	O
if	O
(	O
begin	pointer
!=	O
src	pointer
)	O
wget_buffer_memcat	function
(	O
buf	pointer
,	O
begin	pointer
,	O
src	pointer
-	O
begin	pointer
)	O
;	O
return	O
buf	pointer
->	O
data	pointer
;	O
}	O
const	O
char	O
*	O
wget_iri_escape_path	function
(	O
const	O
char	O
*	O
src	pointer
,	O
wget_buffer	struct
*	O
buf	pointer
)	O
{	O
const	O
char	O
*	O
begin	pointer
;	O
for	O
(	O
begin	pointer
=	O
src	pointer
;	O
*	O
src	pointer
;	O
src	pointer
++	O
)	O
{	O
if	O
(	O
!	O
wget_iri_isunreserved_path	function
(	O
*	O
src	pointer
)	O
)	O
{	O
if	O
(	O
begin	pointer
!=	O
src	pointer
)	O
wget_buffer_memcat	function
(	O
buf	pointer
,	O
begin	pointer
,	O
src	pointer
-	O
begin	pointer
)	O
;	O
begin	pointer
=	O
src	pointer
+	O
1	int
;	O
wget_buffer_printf_append	function
(	O
buf	pointer
,	O
"%%%02X"	pointer
,	O
(	O
unsigned	O
char	O
)	O
*	O
src	pointer
)	O
;	O
}	O
}	O
if	O
(	O
begin	pointer
!=	O
src	pointer
)	O
wget_buffer_memcat	function
(	O
buf	pointer
,	O
begin	pointer
,	O
src	pointer
-	O
begin	pointer
)	O
;	O
return	O
buf	pointer
->	O
data	pointer
;	O
}	O
const	O
char	O
*	O
wget_iri_escape_query	function
(	O
const	O
char	O
*	O
src	pointer
,	O
wget_buffer	struct
*	O
buf	pointer
)	O
{	O
const	O
char	O
*	O
begin	pointer
;	O
for	O
(	O
begin	pointer
=	O
src	pointer
;	O
*	O
src	pointer
;	O
src	pointer
++	O
)	O
{	O
if	O
(	O
!	O
wget_iri_isunreserved	function
(	O
*	O
src	pointer
)	O
&&	O
*	O
src	pointer
!=	O
'='	O
&&	O
*	O
src	pointer
!=	O
'&'	O
)	O
{	O
if	O
(	O
begin	pointer
!=	O
src	pointer
)	O
wget_buffer_memcat	function
(	O
buf	pointer
,	O
begin	pointer
,	O
src	pointer
-	O
begin	pointer
)	O
;	O
begin	pointer
=	O
src	pointer
+	O
1	int
;	O
if	O
(	O
*	O
src	pointer
==	O
' '	O
)	O
wget_buffer_memcat	function
(	O
buf	pointer
,	O
"+"	pointer
,	O
1	int
)	O
;	O
else	O
wget_buffer_printf_append	function
(	O
buf	pointer
,	O
"%%%02X"	pointer
,	O
(	O
unsigned	O
char	O
)	O
*	O
src	pointer
)	O
;	O
}	O
}	O
if	O
(	O
begin	pointer
!=	O
src	pointer
)	O
wget_buffer_memcat	function
(	O
buf	pointer
,	O
begin	pointer
,	O
src	pointer
-	O
begin	pointer
)	O
;	O
return	O
buf	pointer
->	O
data	pointer
;	O
}	O
const	O
char	O
*	O
wget_iri_get_escaped_host	function
(	O
const	O
wget_iri	struct
*	O
iri	pointer
,	O
wget_buffer	struct
*	O
buf	pointer
)	O
{	O
return	O
wget_iri_escape	function
(	O
iri	pointer
->	O
host	pointer
,	O
buf	pointer
)	O
;	O
}	O
const	O
char	O
*	O
wget_iri_get_escaped_resource	function
(	O
const	O
wget_iri	struct
*	O
iri	pointer
,	O
wget_buffer	struct
*	O
buf	pointer
)	O
{	O
if	O
(	O
iri	pointer
->	O
path	pointer
)	O
wget_iri_escape_path	function
(	O
iri	pointer
->	O
path	pointer
,	O
buf	pointer
)	O
;	O
if	O
(	O
iri	pointer
->	O
query	pointer
)	O
{	O
wget_buffer_memcat	function
(	O
buf	pointer
,	O
"?"	pointer
,	O
1	int
)	O
;	O
for	O
(	O
const	O
char	O
*	O
p	pointer
=	O
iri	pointer
->	O
query	pointer
;	O
*	O
p	pointer
;	O
p	pointer
++	O
)	O
if	O
(	O
*	O
p	pointer
==	O
' '	O
)	O
wget_buffer_memcat	function
(	O
buf	pointer
,	O
"%20"	pointer
,	O
3	int
)	O
;	O
else	O
wget_buffer_memcat	function
(	O
buf	pointer
,	O
p	pointer
,	O
1	int
)	O
;	O
}	O
return	O
buf	pointer
->	O
data	pointer
;	O
}	O
char	O
*	O
wget_iri_get_path	function
(	O
const	O
wget_iri	struct
*	O
iri	pointer
,	O
wget_buffer	struct
*	O
buf	pointer
,	O
const	O
char	O
*	O
encoding	pointer
)	O
{	O
if	O
(	O
buf	pointer
->	O
length	long
!=	O
0	int
&&	O
buf	pointer
->	O
data	pointer
[	O
buf	pointer
->	O
length	long
-	O
1	int
]	O
!=	O
'/'	O
)	O
wget_buffer_memcat	function
(	O
buf	pointer
,	O
"/"	pointer
,	O
1	int
)	O
;	O
if	O
(	O
iri	pointer
->	O
path	pointer
)	O
{	O
if	O
(	O
wget_strcasecmp_ascii	function
(	O
encoding	pointer
,	O
"utf-8"	pointer
)	O
)	O
{	O
char	O
*	O
fname	pointer
;	O
if	O
(	O
(	O
fname	pointer
=	O
wget_utf8_to_str	function
(	O
iri	pointer
->	O
path	pointer
,	O
encoding	pointer
)	O
)	O
)	O
{	O
wget_buffer_strcat	function
(	O
buf	pointer
,	O
fname	pointer
)	O
;	O
xfree	O
(	O
fname	pointer
)	O
;	O
}	O
else	O
{	O
wget_buffer_strcat	function
(	O
buf	pointer
,	O
iri	pointer
->	O
path	pointer
)	O
;	O
}	O
}	O
else	O
{	O
wget_buffer_strcat	function
(	O
buf	pointer
,	O
iri	pointer
->	O
path	pointer
)	O
;	O
}	O
}	O
if	O
(	O
(	O
buf	pointer
->	O
length	long
==	O
0	int
||	O
buf	pointer
->	O
data	pointer
[	O
buf	pointer
->	O
length	long
-	O
1	int
]	O
==	O
'/'	O
)	O
&&	O
default_page	pointer
)	O
wget_buffer_memcat	function
(	O
buf	pointer
,	O
default_page	pointer
,	O
default_page_length	long
)	O
;	O
return	O
buf	pointer
->	O
data	pointer
;	O
}	O
char	O
*	O
wget_iri_get_query_as_filename	function
(	O
const	O
wget_iri	struct
*	O
iri	pointer
,	O
wget_buffer	struct
*	O
buf	pointer
,	O
const	O
char	O
*	O
encoding	pointer
)	O
{	O
if	O
(	O
iri	pointer
->	O
query	pointer
)	O
{	O
const	O
char	O
*	O
query	pointer
;	O
int	O
allocated	int
=	O
0	int
;	O
wget_buffer_memcat	function
(	O
buf	pointer
,	O
"?"	pointer
,	O
1	int
)	O
;	O
if	O
(	O
wget_strcasecmp_ascii	function
(	O
encoding	pointer
,	O
"utf-8"	pointer
)	O
)	O
{	O
if	O
(	O
(	O
query	pointer
=	O
wget_utf8_to_str	function
(	O
iri	pointer
->	O
query	pointer
,	O
encoding	pointer
)	O
)	O
)	O
allocated	int
=	O
1	int
;	O
else	O
query	pointer
=	O
iri	pointer
->	O
query	pointer
;	O
}	O
else	O
{	O
query	pointer
=	O
iri	pointer
->	O
query	pointer
;	O
}	O
int	O
slashes	int
=	O
0	int
;	O
const	O
char	O
*	O
src	pointer
=	O
query	pointer
;	O
while	O
(	O
(	O
src	pointer
=	O
strchr	function
(	O
src	pointer
,	O
'/'	O
)	O
)	O
)	O
{	O
slashes	int
++	O
;	O
src	pointer
++	O
;	O
}	O
if	O
(	O
slashes	int
)	O
{	O
const	O
char	O
*	O
begin	pointer
;	O
for	O
(	O
src	pointer
=	O
begin	pointer
=	O
query	pointer
;	O
*	O
src	pointer
;	O
src	pointer
++	O
)	O
{	O
if	O
(	O
*	O
src	pointer
==	O
'/'	O
)	O
{	O
if	O
(	O
begin	pointer
!=	O
src	pointer
)	O
wget_buffer_memcat	function
(	O
buf	pointer
,	O
begin	pointer
,	O
src	pointer
-	O
begin	pointer
)	O
;	O
begin	pointer
=	O
src	pointer
+	O
1	int
;	O
wget_buffer_memcat	function
(	O
buf	pointer
,	O
"%2F"	pointer
,	O
3	int
)	O
;	O
}	O
}	O
if	O
(	O
begin	pointer
!=	O
src	pointer
)	O
wget_buffer_memcat	function
(	O
buf	pointer
,	O
begin	pointer
,	O
src	pointer
-	O
begin	pointer
)	O
;	O
}	O
else	O
{	O
wget_buffer_strcat	function
(	O
buf	pointer
,	O
query	pointer
)	O
;	O
}	O
if	O
(	O
allocated	int
)	O
xfree	O
(	O
query	pointer
)	O
;	O
}	O
return	O
buf	pointer
->	O
data	pointer
;	O
}	O
char	O
*	O
wget_iri_get_filename	function
(	O
const	O
wget_iri	struct
*	O
iri	pointer
,	O
wget_buffer	struct
*	O
buf	pointer
,	O
const	O
char	O
*	O
encoding	pointer
)	O
{	O
if	O
(	O
iri	pointer
->	O
path	pointer
)	O
{	O
char	O
*	O
fname	pointer
;	O
if	O
(	O
wget_strcasecmp_ascii	function
(	O
encoding	pointer
,	O
"utf-8"	pointer
)	O
)	O
{	O
char	O
*	O
p	pointer
;	O
if	O
(	O
(	O
p	pointer
=	O
strrchr	function
(	O
iri	pointer
->	O
path	pointer
,	O
'/'	O
)	O
)	O
)	O
{	O
if	O
(	O
!	O
(	O
fname	pointer
=	O
wget_utf8_to_str	function
(	O
p	pointer
+	O
1	int
,	O
encoding	pointer
)	O
)	O
)	O
wget_buffer_strcat	function
(	O
buf	pointer
,	O
p	pointer
+	O
1	int
)	O
;	O
}	O
else	O
{	O
if	O
(	O
!	O
(	O
fname	pointer
=	O
wget_utf8_to_str	function
(	O
iri	pointer
->	O
path	pointer
,	O
encoding	pointer
)	O
)	O
)	O
wget_buffer_strcat	function
(	O
buf	pointer
,	O
iri	pointer
->	O
path	pointer
)	O
;	O
}	O
if	O
(	O
fname	pointer
)	O
{	O
wget_buffer_strcat	function
(	O
buf	pointer
,	O
fname	pointer
)	O
;	O
xfree	O
(	O
fname	pointer
)	O
;	O
}	O
}	O
else	O
{	O
if	O
(	O
(	O
fname	pointer
=	O
strrchr	function
(	O
iri	pointer
->	O
path	pointer
,	O
'/'	O
)	O
)	O
)	O
wget_buffer_strcat	function
(	O
buf	pointer
,	O
fname	pointer
+	O
1	int
)	O
;	O
else	O
wget_buffer_strcat	function
(	O
buf	pointer
,	O
iri	pointer
->	O
path	pointer
)	O
;	O
}	O
}	O
if	O
(	O
(	O
buf	pointer
->	O
length	long
==	O
0	int
||	O
buf	pointer
->	O
data	pointer
[	O
buf	pointer
->	O
length	long
-	O
1	int
]	O
==	O
'/'	O
)	O
&&	O
default_page	pointer
)	O
wget_buffer_memcat	function
(	O
buf	pointer
,	O
default_page	pointer
,	O
default_page_length	long
)	O
;	O
return	O
wget_iri_get_query_as_filename	function
(	O
iri	pointer
,	O
buf	pointer
,	O
encoding	pointer
)	O
;	O
}	O
void	O
wget_iri_set_defaultpage	function
(	O
const	O
char	O
*	O
page	pointer
)	O
{	O
default_page	pointer
=	O
page	pointer
;	O
default_page_length	long
=	O
default_page	pointer
?	O
strlen	function
(	O
default_page	pointer
)	O
:	O
0	int
;	O
}	O
int	O
wget_iri_set_defaultport	function
(	O
wget_iri_scheme	enum
scheme	enum
,	O
uint16_t	short
port	short
)	O
{	O
if	O
(	O
(	O
unsigned	O
)	O
scheme	enum
<	O
countof	O
(	O
schemes	array
)	O
)	O
{	O
schemes	array
[	O
scheme	enum
]	O
.	O
port	short
=	O
port	short
;	O
return	O
0	int
;	O
}	O
return	O
-	O
1	int
;	O
}	O
wget_iri_scheme	enum
wget_iri_set_scheme	function
(	O
wget_iri	struct
*	O
iri	pointer
,	O
wget_iri_scheme	enum
scheme	enum
)	O
{	O
wget_iri_scheme	enum
old_scheme	enum
=	O
iri	pointer
->	O
scheme	enum
;	O
if	O
(	O
(	O
unsigned	O
)	O
scheme	enum
<	O
countof	O
(	O
schemes	array
)	O
&&	O
iri	pointer
->	O
scheme	enum
!=	O
scheme	enum
)	O
{	O
iri	pointer
->	O
scheme	enum
=	O
scheme	enum
;	O
if	O
(	O
iri	pointer
->	O
port	short
==	O
schemes	array
[	O
old_scheme	enum
]	O
.	O
port	short
)	O
iri	pointer
->	O
port	short
=	O
schemes	array
[	O
scheme	enum
]	O
.	O
port	short
;	O
size_t	long
old_scheme_len	long
=	O
strlen	function
(	O
schemes	array
[	O
old_scheme	enum
]	O
.	O
name	pointer
)	O
;	O
if	O
(	O
strncmp	function
(	O
iri	pointer
->	O
uri	pointer
,	O
schemes	array
[	O
old_scheme	enum
]	O
.	O
name	pointer
,	O
old_scheme_len	long
)	O
==	O
0	int
&&	O
iri	pointer
->	O
uri	pointer
[	O
old_scheme_len	long
]	O
==	O
':'	O
)	O
{	O
char	O
*	O
new_uri	pointer
=	O
wget_aprintf	function
(	O
"%s%s"	pointer
,	O
schemes	array
[	O
iri	pointer
->	O
scheme	enum
]	O
.	O
name	pointer
,	O
iri	pointer
->	O
uri	pointer
+	O
old_scheme_len	long
)	O
;	O
if	O
(	O
iri	pointer
->	O
uri_allocated	bool
)	O
xfree	O
(	O
iri	pointer
->	O
uri	pointer
)	O
;	O
iri	pointer
->	O
uri	pointer
=	O
new_uri	pointer
;	O
iri	pointer
->	O
uri_allocated	bool
=	O
true	int
;	O
}	O
}	O
return	O
old_scheme	enum
;	O
}	O
