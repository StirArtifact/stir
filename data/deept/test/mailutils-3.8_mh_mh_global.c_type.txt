static	O
const	O
char	O
*	O
current_folder	pointer
=	O
NULL	O
;	O
int	O
rcpt_mask	int
=	O
RCPT_DEFAULT	int
;	O
int	O
mh_auto_install	int
=	O
1	int
;	O
mu_property_t	pointer
mh_read_property_file	O
(	O
char	O
*	O
name	pointer
,	O
int	O
ro	int
)	O
{	O
mu_property_t	pointer
prop	pointer
;	O
struct	O
mu_mh_prop	struct
*	O
mhprop	pointer
;	O
int	O
rc	int
;	O
mhprop	int
=	O
mu_zalloc	function
(	O
sizeof	O
(	O
mhprop	array
[	O
0	int
]	O
)	O
)	O
;	O
mhprop	pointer
->	O
filename	pointer
=	O
name	pointer
;	O
mhprop	pointer
->	O
ro	int
=	O
ro	int
;	O
rc	int
=	O
mu_property_create_init	function
(	O
&	O
prop	pointer
,	O
mu_mh_property_init	pointer
,	O
mhprop	int
)	O
;	O
if	O
(	O
rc	int
)	O
{	O
mu_diag_funcall	function
(	O
MU_DIAG_ERROR	O
,	O
"mu_property_create_init"	pointer
,	O
name	pointer
,	O
rc	int
)	O
;	O
exit	function
(	O
1	int
)	O
;	O
}	O
return	O
prop	pointer
;	O
}	O
static	O
int	O
prop_merger	function
(	O
const	O
char	O
*	O
field	pointer
,	O
const	O
char	O
*	O
value	pointer
,	O
void	O
*	O
data	pointer
)	O
{	O
mu_property_t	pointer
dst	pointer
=	O
data	pointer
;	O
return	O
mu_property_set_value	function
(	O
dst	pointer
,	O
field	pointer
,	O
value	int
,	O
1	int
)	O
;	O
}	O
void	O
mh_property_merge	function
(	O
mu_property_t	pointer
dst	pointer
,	O
mu_property_t	pointer
src	pointer
)	O
{	O
int	O
rc	int
;	O
if	O
(	O
!	O
src	pointer
)	O
return	O
;	O
rc	int
=	O
mu_mhprop_iterate	function
(	O
src	pointer
,	O
prop_merger	pointer
,	O
dst	pointer
)	O
;	O
if	O
(	O
rc	int
)	O
{	O
mu_diag_funcall	function
(	O
MU_DIAG_ERROR	O
,	O
"mu_mhprop_iterate"	pointer
,	O
NULL	O
,	O
rc	int
)	O
;	O
exit	function
(	O
1	int
)	O
;	O
}	O
}	O
void	O
_mh_init_global_context	function
(	O
)	O
{	O
char	O
*	O
p	pointer
,	O
*	O
ctx_name	pointer
;	O
if	O
(	O
mu_mh_context	pointer
)	O
return	O
;	O
p	pointer
=	O
getenv	function
(	O
"CONTEXT"	pointer
)	O
;	O
if	O
(	O
!	O
p	pointer
)	O
p	pointer
=	O
MH_CONTEXT_FILE	pointer
;	O
ctx_name	pointer
=	O
mh_expand_name	function
(	O
NULL	O
,	O
p	pointer
,	O
NAME_ANY	pointer
)	O
;	O
mu_mh_context	int
=	O
mh_read_property_file	function
(	O
ctx_name	int
,	O
0	int
)	O
;	O
if	O
(	O
!	O
current_folder	int
)	O
current_folder	int
=	O
mh_global_context_get	function
(	O
"Current-Folder"	pointer
,	O
mh_global_profile_get	function
(	O
"Inbox"	pointer
,	O
"inbox"	pointer
)	O
)	O
;	O
}	O
void	O
mh_read_profile	function
(	O
)	O
{	O
char	O
*	O
p	pointer
;	O
const	O
char	O
*	O
fallback	pointer
;	O
p	pointer
=	O
getenv	function
(	O
"MH"	pointer
)	O
;	O
if	O
(	O
p	pointer
)	O
p	pointer
=	O
mu_tilde_expansion	function
(	O
p	pointer
,	O
MU_HIERARCHY_DELIMITER	pointer
,	O
NULL	O
)	O
;	O
else	O
{	O
char	O
*	O
home	pointer
=	O
mu_get_homedir	function
(	O
)	O
;	O
if	O
(	O
!	O
home	pointer
)	O
abort	function
(	O
)	O
;	O
p	pointer
=	O
mh_safe_make_file_name	function
(	O
home	pointer
,	O
MH_USER_PROFILE	pointer
)	O
;	O
free	function
(	O
home	pointer
)	O
;	O
}	O
if	O
(	O
mh_auto_install	pointer
&&	O
access	O
(	O
p	pointer
,	O
R_OK	int
)	O
)	O
mh_install	function
(	O
p	pointer
,	O
1	int
)	O
;	O
mu_mh_profile	int
=	O
mh_read_property_file	function
(	O
p	pointer
,	O
0	int
)	O
;	O
mu_set_folder_directory	function
(	O
mh_get_dir	function
(	O
)	O
)	O
;	O
mh_set_reply_regex	function
(	O
mh_global_profile_get	function
(	O
"Reply-Regex"	pointer
,	O
NULL	O
)	O
)	O
;	O
fallback	pointer
=	O
mh_global_profile_get	function
(	O
"Decode-Fallback"	pointer
,	O
NULL	O
)	O
;	O
if	O
(	O
fallback	int
&&	O
mu_set_default_fallback	function
(	O
fallback	pointer
)	O
)	O
mu_error	function
(	O
_	O
(	O
"Incorrect value for decode-fallback"	pointer
)	O
)	O
;	O
_mh_init_global_context	function
(	O
)	O
;	O
}	O
const	O
char	O
*	O
mh_current_folder	function
(	O
)	O
{	O
return	O
mh_global_context_get	function
(	O
"Current-Folder"	pointer
,	O
mh_global_profile_get	function
(	O
"Inbox"	pointer
,	O
"inbox"	pointer
)	O
)	O
;	O
}	O
const	O
char	O
*	O
mh_set_current_folder	function
(	O
const	O
char	O
*	O
val	pointer
)	O
{	O
int	O
rc	int
=	O
mh_global_context_set	function
(	O
"Current-Folder"	int
,	O
val	double
)	O
;	O
if	O
(	O
rc	int
)	O
{	O
mu_diag_funcall	function
(	O
MU_DIAG_ERROR	O
,	O
"mh_global_context_set"	int
,	O
"Current-Folder"	int
,	O
rc	int
)	O
;	O
exit	function
(	O
1	int
)	O
;	O
}	O
current_folder	int
=	O
mh_current_folder	function
(	O
)	O
;	O
return	O
current_folder	int
;	O
}	O
mu_property_t	pointer
mh_mailbox_get_property	O
(	O
mu_mailbox_t	pointer
mbox	pointer
)	O
{	O
mu_property_t	pointer
prop	pointer
;	O
int	O
rc	int
=	O
mu_mailbox_get_property	function
(	O
mbox	pointer
,	O
&	O
prop	pointer
)	O
;	O
if	O
(	O
rc	int
)	O
{	O
mu_diag_funcall	function
(	O
MU_DIAG_ERROR	O
,	O
"mu_mailbox_get_property"	pointer
,	O
NULL	O
,	O
rc	int
)	O
;	O
exit	function
(	O
1	int
)	O
;	O
}	O
return	O
prop	pointer
;	O
}	O
void	O
mh_global_sequences_drop	function
(	O
mu_mailbox_t	pointer
mbox	pointer
)	O
{	O
mu_property_t	pointer
prop	pointer
=	O
mh_mailbox_get_property	function
(	O
mbox	pointer
)	O
;	O
int	O
rc	int
=	O
mu_property_clear	function
(	O
prop	pointer
)	O
;	O
if	O
(	O
rc	int
)	O
{	O
mu_diag_funcall	function
(	O
MU_DIAG_ERROR	O
,	O
"mu_property_clear"	pointer
,	O
NULL	O
,	O
rc	int
)	O
;	O
exit	function
(	O
1	int
)	O
;	O
}	O
}	O
const	O
char	O
*	O
mh_global_sequences_get	function
(	O
mu_mailbox_t	pointer
mbox	pointer
,	O
const	O
char	O
*	O
name	pointer
,	O
const	O
char	O
*	O
defval	int
)	O
{	O
mu_property_t	pointer
prop	pointer
=	O
mh_mailbox_get_property	function
(	O
mbox	pointer
)	O
;	O
const	O
char	O
*	O
s	pointer
;	O
int	O
rc	int
=	O
mu_property_sget_value	function
(	O
prop	pointer
,	O
name	pointer
,	O
&	O
s	pointer
)	O
;	O
if	O
(	O
rc	int
==	O
MU_ERR_NOENT	O
)	O
s	pointer
=	O
defval	int
;	O
else	O
if	O
(	O
rc	int
)	O
{	O
mu_diag_funcall	function
(	O
MU_DIAG_ERROR	O
,	O
"mu_property_sget_value"	pointer
,	O
name	pointer
,	O
rc	int
)	O
;	O
exit	function
(	O
1	int
)	O
;	O
}	O
return	O
s	pointer
;	O
}	O
void	O
mh_global_sequences_set	function
(	O
mu_mailbox_t	pointer
mbox	pointer
,	O
const	O
char	O
*	O
name	pointer
,	O
const	O
char	O
*	O
value	pointer
)	O
{	O
mu_property_t	pointer
prop	pointer
=	O
mh_mailbox_get_property	function
(	O
mbox	pointer
)	O
;	O
int	O
rc	int
=	O
mu_property_set_value	function
(	O
prop	pointer
,	O
name	pointer
,	O
value	int
,	O
1	int
)	O
;	O
if	O
(	O
rc	int
&&	O
!	O
(	O
!	O
value	int
&&	O
rc	int
==	O
MU_ERR_NOENT	O
)	O
)	O
{	O
mu_diag_funcall	function
(	O
MU_DIAG_ERROR	O
,	O
"mu_property_set_value"	pointer
,	O
name	pointer
,	O
rc	int
)	O
;	O
exit	function
(	O
1	int
)	O
;	O
}	O
}	O
void	O
mh_global_sequences_iterate	function
(	O
mu_mailbox_t	pointer
mbox	pointer
,	O
mu_mhprop_iterator_t	pointer
fp	pointer
,	O
void	O
*	O
data	pointer
)	O
{	O
int	O
rc	int
;	O
mu_iterator_t	pointer
itr	pointer
;	O
mu_property_t	pointer
prop	pointer
=	O
mh_mailbox_get_property	function
(	O
mbox	pointer
)	O
;	O
rc	int
=	O
mu_property_get_iterator	function
(	O
prop	pointer
,	O
&	O
itr	pointer
)	O
;	O
if	O
(	O
rc	int
)	O
{	O
mu_diag_funcall	function
(	O
MU_DIAG_ERROR	O
,	O
"mu_property_get_iterator"	pointer
,	O
NULL	O
,	O
rc	int
)	O
;	O
exit	function
(	O
1	int
)	O
;	O
}	O
mu_mhprop_iterate	function
(	O
prop	pointer
,	O
fp	pointer
,	O
data	pointer
)	O
;	O
}	O
void	O
mh_global_save_state	function
(	O
)	O
{	O
int	O
rc	int
;	O
mh_global_context_set	function
(	O
"Current-Folder"	pointer
,	O
current_folder	int
)	O
;	O
rc	int
=	O
mu_property_save	function
(	O
mu_mh_context	pointer
)	O
;	O
if	O
(	O
rc	int
)	O
{	O
mu_diag_funcall	function
(	O
MU_DIAG_ERROR	O
,	O
"mu_property_save"	int
,	O
"context"	int
,	O
rc	int
)	O
;	O
exit	function
(	O
1	int
)	O
;	O
}	O
}	O