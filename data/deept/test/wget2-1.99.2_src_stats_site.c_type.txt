enum	O
{	O
STATS_METHOD_GET	int
=	O
1	int
,	O
STATS_METHOD_HEAD	int
=	O
2	int
,	O
STATS_METHOD_POST	int
=	O
3	int
,	O
}	O
;	O
typedef	O
struct	O
{	O
wget_iri	struct
*	O
iri	pointer
;	O
long	O
long	O
size_downloaded	double
,	O
size_decompressed	int
;	O
long	O
long	O
request_start	bool
;	O
long	O
long	O
response_end	bool
;	O
long	O
long	O
initial_response_duration	bool
;	O
unsigned	O
long	O
long	O
id	double
,	O
parent_id	int
;	O
int	O
status	int
,	O
signature_status	int
;	O
char	O
encoding	pointer
,	O
method	pointer
;	O
const	O
char	O
*	O
mime_type	pointer
;	O
bool	bool
redirect	bool
:	O
1	int
;	O
time_t	long
last_modified	long
;	O
}	O
site_stats_t	pointer
;	O
static	O
wget_vector	struct
*	O
data	pointer
;	O
static	O
wget_thread_mutex	pointer
mutex	pointer
;	O
static	O
wget_hashmap	struct
*	O
docs	pointer
;	O
static	O
FILE	struct
*	O
fp	pointer
;	O
static	O
void	O
free_stats	function
(	O
void	O
*	O
stats	pointer
)	O
{	O
site_stats_t	struct
*	O
s	pointer
=	O
stats	pointer
;	O
if	O
(	O
s	pointer
)	O
{	O
xfree	function
(	O
s	pointer
->	O
mime_type	pointer
)	O
;	O
xfree	function
(	O
s	pointer
)	O
;	O
}	O
}	O
void	O
site_stats_init	function
(	O
FILE	struct
*	O
fpout	pointer
)	O
{	O
wget_thread_mutex_init	function
(	O
&	O
mutex	struct
)	O
;	O
data	pointer
=	O
wget_vector_create	function
(	O
8	int
,	O
NULL	O
)	O
;	O
wget_vector_set_destructor	function
(	O
data	pointer
,	O
free_stats	pointer
)	O
;	O
fp	pointer
=	O
fpout	pointer
;	O
}	O
void	O
site_stats_exit	function
(	O
void	O
)	O
{	O
wget_stringmap_free	function
(	O
&	O
docs	struct
)	O
;	O
wget_vector_free	function
(	O
&	O
data	pointer
)	O
;	O
wget_thread_mutex_destroy	function
(	O
&	O
mutex	struct
)	O
;	O
}	O
void	O
stats_site_add	function
(	O
wget_http_response	struct
*	O
resp	pointer
,	O
wget_gpg_info_t	struct
*	O
gpg_info	pointer
)	O
{	O
JOB	struct
*	O
job	pointer
=	O
resp	pointer
->	O
req	pointer
->	O
user_data	pointer
;	O
wget_iri	struct
*	O
iri	pointer
=	O
job	pointer
->	O
iri	pointer
;	O
if	O
(	O
gpg_info	pointer
)	O
{	O
wget_thread_mutex_lock	function
(	O
mutex	pointer
)	O
;	O
if	O
(	O
!	O
docs	int
)	O
{	O
docs	pointer
=	O
wget_stringmap_create	function
(	O
128	int
)	O
;	O
wget_stringmap_set_key_destructor	function
(	O
docs	pointer
,	O
NULL	O
)	O
;	O
wget_stringmap_set_value_destructor	function
(	O
docs	pointer
,	O
NULL	O
)	O
;	O
for	O
(	O
int	O
it	long
=	O
0	int
;	O
it	long
<	O
wget_vector_size	function
(	O
data	pointer
)	O
;	O
it	long
++	O
)	O
{	O
site_stats_t	struct
*	O
e	pointer
=	O
wget_vector_get	function
(	O
data	pointer
,	O
it	pointer
)	O
;	O
wget_stringmap_put	function
(	O
docs	pointer
,	O
e	pointer
->	O
iri	pointer
->	O
uri	pointer
,	O
e	pointer
)	O
;	O
}	O
}	O
char	O
*	O
p	pointer
,	O
*	O
uri	pointer
=	O
wget_strdup	function
(	O
iri	pointer
->	O
uri	pointer
)	O
;	O
if	O
(	O
(	O
p	pointer
=	O
strrchr	function
(	O
uri	pointer
,	O
'.'	O
)	O
)	O
)	O
*	O
p	pointer
=	O
0	int
;	O
site_stats_t	struct
*	O
doc	pointer
;	O
wget_stringmap_get	function
(	O
docs	pointer
,	O
uri	pointer
,	O
&	O
doc	pointer
)	O
;	O
xfree	function
(	O
uri	pointer
)	O
;	O
if	O
(	O
doc	pointer
)	O
{	O
if	O
(	O
gpg_info	pointer
->	O
valid_sigs	pointer
)	O
doc	pointer
->	O
signature_status	int
=	O
1	int
;	O
else	O
if	O
(	O
gpg_info	pointer
->	O
invalid_sigs	pointer
)	O
doc	pointer
->	O
signature_status	int
=	O
2	int
;	O
else	O
if	O
(	O
gpg_info	pointer
->	O
bad_sigs	pointer
)	O
doc	pointer
->	O
signature_status	int
=	O
3	int
;	O
else	O
if	O
(	O
gpg_info	pointer
->	O
missing_sigs	pointer
)	O
doc	pointer
->	O
signature_status	int
=	O
4	int
;	O
wget_thread_mutex_unlock	function
(	O
mutex	pointer
)	O
;	O
return	O
;	O
}	O
wget_thread_mutex_unlock	function
(	O
mutex	pointer
)	O
;	O
}	O
site_stats_t	struct
*	O
doc	pointer
=	O
wget_calloc	function
(	O
1	int
,	O
sizeof	O
(	O
site_stats_t	pointer
)	O
)	O
;	O
doc	pointer
->	O
id	int
=	O
job	int
->	O
id	int
;	O
doc	pointer
->	O
parent_id	pointer
=	O
job	pointer
->	O
parent_id	pointer
;	O
doc	pointer
->	O
iri	pointer
=	O
iri	pointer
;	O
doc	pointer
->	O
status	int
=	O
resp	pointer
->	O
code	int
;	O
doc	pointer
->	O
encoding	pointer
=	O
resp	pointer
->	O
content_encoding	pointer
;	O
doc	pointer
->	O
redirect	pointer
=	O
!	O
!	O
job	pointer
->	O
redirection_level	pointer
;	O
doc	pointer
->	O
mime_type	pointer
=	O
wget_strdup	function
(	O
resp	pointer
->	O
content_type	pointer
)	O
;	O
doc	pointer
->	O
last_modified	pointer
=	O
resp	pointer
->	O
last_modified	pointer
;	O
doc	pointer
->	O
request_start	pointer
=	O
resp	pointer
->	O
req	pointer
->	O
request_start	pointer
;	O
doc	pointer
->	O
response_end	pointer
=	O
resp	pointer
->	O
response_end	pointer
;	O
doc	pointer
->	O
initial_response_duration	pointer
=	O
resp	pointer
->	O
req	pointer
->	O
first_response_start	pointer
-	O
resp	pointer
->	O
req	pointer
->	O
request_start	pointer
;	O
doc	pointer
->	O
size_downloaded	pointer
=	O
resp	pointer
->	O
cur_downloaded	pointer
;	O
doc	pointer
->	O
size_decompressed	pointer
=	O
resp	pointer
->	O
body	pointer
->	O
length	long
;	O
if	O
(	O
!	O
wget_strcasecmp_ascii	function
(	O
resp	pointer
->	O
req	pointer
->	O
method	pointer
,	O
"GET"	pointer
)	O
)	O
{	O
doc	pointer
->	O
method	pointer
=	O
STATS_METHOD_GET	pointer
;	O
}	O
else	O
if	O
(	O
!	O
wget_strcasecmp_ascii	function
(	O
resp	pointer
->	O
req	pointer
->	O
method	pointer
,	O
"HEAD"	pointer
)	O
)	O
{	O
doc	pointer
->	O
size_downloaded	pointer
=	O
resp	pointer
->	O
content_length	pointer
;	O
doc	pointer
->	O
method	pointer
=	O
STATS_METHOD_HEAD	pointer
;	O
}	O
else	O
if	O
(	O
!	O
wget_strcasecmp_ascii	function
(	O
resp	pointer
->	O
req	pointer
->	O
method	pointer
,	O
"POST"	pointer
)	O
)	O
{	O
doc	pointer
->	O
method	pointer
=	O
STATS_METHOD_POST	pointer
;	O
}	O
wget_thread_mutex_lock	function
(	O
mutex	pointer
)	O
;	O
wget_vector_add	function
(	O
data	pointer
,	O
doc	pointer
)	O
;	O
if	O
(	O
docs	pointer
)	O
wget_stringmap_put	function
(	O
docs	pointer
,	O
doc	pointer
->	O
iri	pointer
->	O
uri	pointer
,	O
doc	pointer
)	O
;	O
wget_thread_mutex_unlock	function
(	O
mutex	pointer
)	O
;	O
}	O
static	O
int	O
print_human_entry	function
(	O
FILE	struct
*	O
_fp	pointer
,	O
site_stats_t	struct
*	O
doc	pointer
)	O
{	O
long	O
long	O
transfer_time	long
=	O
doc	pointer
->	O
response_end	pointer
-	O
doc	pointer
->	O
request_start	pointer
;	O
wget_fprintf	function
(	O
_fp	pointer
,	O
"  %6d %5lld %6lld %s\n"	pointer
,	O
doc	pointer
->	O
status	int
,	O
transfer_time	int
,	O
doc	pointer
->	O
size_downloaded	pointer
,	O
doc	pointer
->	O
iri	pointer
->	O
uri	pointer
)	O
;	O
return	O
0	int
;	O
}	O
static	O
int	O
print_csv_entry	function
(	O
FILE	struct
*	O
_fp	pointer
,	O
site_stats_t	struct
*	O
doc	pointer
)	O
{	O
long	O
long	O
transfer_time	long
=	O
doc	pointer
->	O
response_end	pointer
-	O
doc	pointer
->	O
request_start	pointer
;	O
wget_fprintf	function
(	O
_fp	pointer
,	O
"%llu,%llu,%s,%d,%d,%d,%lld,%lld,%lld,%lld,%d,%d,%ld,%s\n"	pointer
,	O
doc	pointer
->	O
id	int
,	O
doc	pointer
->	O
parent_id	pointer
,	O
doc	pointer
->	O
iri	pointer
->	O
uri	pointer
,	O
doc	pointer
->	O
status	int
,	O
!	O
doc	pointer
->	O
redirect	pointer
,	O
doc	pointer
->	O
method	pointer
,	O
doc	pointer
->	O
size_downloaded	pointer
,	O
doc	pointer
->	O
size_decompressed	pointer
,	O
transfer_time	pointer
,	O
doc	pointer
->	O
initial_response_duration	pointer
,	O
doc	pointer
->	O
encoding	pointer
,	O
doc	pointer
->	O
signature_status	pointer
,	O
doc	pointer
->	O
last_modified	pointer
,	O
doc	pointer
->	O
mime_type	pointer
)	O
;	O
return	O
0	int
;	O
}	O
static	O
void	O
print_human	function
(	O
void	O
)	O
{	O
wget_fprintf	function
(	O
fp	pointer
,	O
"\nSite Statistics:\n"	pointer
)	O
;	O
wget_fprintf	function
(	O
fp	pointer
,	O
"  %6s %5s %6s %s\n"	pointer
,	O
"Status"	int
,	O
"ms"	int
,	O
"Size"	int
,	O
"URL"	pointer
)	O
;	O
wget_vector_browse	function
(	O
data	pointer
,	O
(	O
wget_vector_browse_fn	struct
*	O
)	O
print_human_entry	pointer
,	O
fp	pointer
)	O
;	O
}	O
static	O
void	O
print_csv	function
(	O
void	O
)	O
{	O
wget_fprintf	function
(	O
fp	pointer
,	O
"ID,ParentID,URL,Status,Link,Method,Size,SizeDecompressed,TransferTime,ResponseTime,Encoding,Verification,Last-Modified,Content-Type\n"	pointer
)	O
;	O
wget_vector_browse	function
(	O
data	pointer
,	O
(	O
wget_vector_browse_fn	struct
*	O
)	O
print_csv_entry	pointer
,	O
fp	pointer
)	O
;	O
}	O
void	O
site_stats_print	function
(	O
void	O
)	O
{	O
if	O
(	O
config	struct
.	O
stats_site_args	pointer
->	O
format	pointer
==	O
WGET_STATS_FORMAT_HUMAN	int
)	O
print_human	function
(	O
)	O
;	O
else	O
print_csv	function
(	O
)	O
;	O
}	O