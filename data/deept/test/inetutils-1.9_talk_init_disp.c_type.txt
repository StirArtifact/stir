static	O
void	O
sig_sent	function
(	O
int	O
sig	int
_GL_UNUSED_PARAMETER	O
)	O
{	O
message	function
(	O
"Connection closing. Exiting"	pointer
)	O
;	O
quit	function
(	O
)	O
;	O
}	O
int	O
init_display	function
(	O
void	O
)	O
{	O
struct	O
sigaction	struct
siga	struct
;	O
if	O
(	O
initscr	function
(	O
)	O
==	O
NULL	O
)	O
error	function
(	O
EXIT_FAILURE	int
,	O
0	int
,	O
"Terminal type unset or lacking necessary features."	int
)	O
;	O
sigaction	struct
(	O
SIGTSTP	int
,	O
(	O
struct	O
sigaction	struct
*	O
)	O
0	int
,	O
&	O
siga	struct
)	O
;	O
sigaddset	function
(	O
&	O
siga	struct
.	O
sa_mask	struct
,	O
SIGALRM	int
)	O
;	O
sigaction	struct
(	O
SIGTSTP	int
,	O
&	O
siga	pointer
,	O
(	O
struct	O
sigaction	struct
*	O
)	O
0	int
)	O
;	O
curses_initialized	int
=	O
1	int
;	O
clear	function
(	O
)	O
;	O
refresh	function
(	O
)	O
;	O
noecho	O
(	O
)	O
;	O
crmode	function
(	O
)	O
;	O
signal	function
(	O
SIGINT	int
,	O
sig_sent	int
)	O
;	O
signal	function
(	O
SIGPIPE	int
,	O
sig_sent	int
)	O
;	O
my_win	struct
.	O
x_nlines	int
=	O
LINES	int
/	O
2	int
;	O
my_win	struct
.	O
x_ncols	int
=	O
COLS	O
;	O
my_win	struct
.	O
x_win	pointer
=	O
newwin	function
(	O
my_win	struct
.	O
x_nlines	int
,	O
my_win	struct
.	O
x_ncols	int
,	O
0	int
,	O
0	int
)	O
;	O
scrollok	function
(	O
my_win	struct
.	O
x_win	pointer
,	O
FALSE	O
)	O
;	O
wclear	function
(	O
my_win	struct
.	O
x_win	pointer
)	O
;	O
his_win	struct
.	O
x_nlines	int
=	O
LINES	int
/	O
2	int
-	O
1	int
;	O
his_win	struct
.	O
x_ncols	int
=	O
COLS	O
;	O
his_win	struct
.	O
x_win	pointer
=	O
newwin	function
(	O
his_win	struct
.	O
x_nlines	int
,	O
his_win	struct
.	O
x_ncols	int
,	O
my_win	struct
.	O
x_nlines	int
+	O
1	int
,	O
0	int
)	O
;	O
scrollok	function
(	O
his_win	struct
.	O
x_win	pointer
,	O
FALSE	O
)	O
;	O
wclear	function
(	O
his_win	struct
.	O
x_win	pointer
)	O
;	O
line_win	pointer
=	O
newwin	function
(	O
1	int
,	O
COLS	O
,	O
my_win	struct
.	O
x_nlines	int
,	O
0	int
)	O
;	O
box	function
(	O
line_win	pointer
,	O
'-'	O
,	O
'-'	O
)	O
;	O
wrefresh	function
(	O
line_win	pointer
)	O
;	O
current_state	pointer
=	O
"No connection yet"	pointer
;	O
return	O
0	int
;	O
}	O
int	O
set_edit_chars	function
(	O
void	O
)	O
{	O
int	O
cc	int
;	O
char	O
buf	pointer
[	O
3	int
]	O
;	O
struct	O
termios	struct
tty	pointer
;	O
cc_t	struct
disable	pointer
=	O
(	O
cc_t	pointer
)	O
-	O
1	int
,	O
erase	int
,	O
werase	function
,	O
kill	function
;	O
erase	int
=	O
werase	function
=	O
kill	function
=	O
disable	int
;	O
if	O
(	O
tcgetattr	function
(	O
0	int
,	O
&	O
tty	pointer
)	O
>=	O
0	int
)	O
{	O
erase	int
=	O
tty	struct
.	O
c_cc	array
[	O
VERASE	int
]	O
;	O
werase	function
=	O
tty	struct
.	O
c_cc	array
[	O
VWERASE	int
]	O
;	O
kill	int
=	O
tty	struct
.	O
c_cc	array
[	O
VKILL	int
]	O
;	O
}	O
if	O
(	O
erase	int
==	O
disable	int
)	O
erase	int
=	O
'\177'	int
;	O
if	O
(	O
werase	function
==	O
disable	int
)	O
werase	function
=	O
'\027'	O
;	O
if	O
(	O
kill	function
==	O
disable	int
)	O
kill	int
=	O
'\025'	O
;	O
my_win	struct
.	O
cerase	int
=	O
erase	int
;	O
my_win	struct
.	O
werase	function
=	O
werase	function
;	O
my_win	struct
.	O
kill	int
=	O
kill	function
;	O
buf	pointer
[	O
0	int
]	O
=	O
my_win	struct
.	O
cerase	int
;	O
buf	pointer
[	O
1	int
]	O
=	O
my_win	struct
.	O
kill	int
;	O
buf	pointer
[	O
2	int
]	O
=	O
my_win	struct
.	O
werase	function
;	O
cc	pointer
=	O
write	function
(	O
sockt	int
,	O
buf	pointer
,	O
sizeof	O
(	O
buf	pointer
)	O
)	O
;	O
if	O
(	O
cc	int
!=	O
sizeof	O
(	O
buf	pointer
)	O
)	O
p_error	function
(	O
"Lost the connection"	pointer
)	O
;	O
cc	pointer
=	O
read	function
(	O
sockt	int
,	O
buf	pointer
,	O
sizeof	O
(	O
buf	pointer
)	O
)	O
;	O
if	O
(	O
cc	int
!=	O
sizeof	O
(	O
buf	pointer
)	O
)	O
p_error	function
(	O
"Lost the connection"	pointer
)	O
;	O
his_win	struct
.	O
cerase	int
=	O
buf	pointer
[	O
0	int
]	O
;	O
his_win	struct
.	O
kill	int
=	O
buf	pointer
[	O
1	int
]	O
;	O
his_win	struct
.	O
werase	function
=	O
buf	pointer
[	O
2	int
]	O
;	O
return	O
0	int
;	O
}	O
int	O
quit	function
(	O
void	O
)	O
{	O
if	O
(	O
curses_initialized	int
)	O
{	O
wmove	function
(	O
his_win	struct
.	O
x_win	pointer
,	O
his_win	struct
.	O
x_nlines	int
-	O
1	int
,	O
0	int
)	O
;	O
wclrtoeol	function
(	O
his_win	struct
.	O
x_win	pointer
)	O
;	O
wrefresh	function
(	O
his_win	struct
.	O
x_win	pointer
)	O
;	O
endwin	function
(	O
)	O
;	O
}	O
if	O
(	O
invitation_waiting	int
)	O
send_delete	function
(	O
)	O
;	O
exit	function
(	O
EXIT_SUCCESS	int
)	O
;	O
}	O