static	O
object	O
rando	function
(	O
object	O
x	double
,	O
object	O
rs	int
)	O
{	O
enum	O
type	enum
tx	int
;	O
object	O
base	int
,	O
out	struct
,	O
z	pointer
;	O
fixnum	O
fbase	int
;	O
double	O
d	long
;	O
tx	int
=	O
type_of	function
(	O
x	double
)	O
;	O
if	O
(	O
number_compare	function
(	O
x	double
,	O
small_fixnum	function
(	O
0	int
)	O
)	O
!=	O
1	int
)	O
FEwrong_type_argument	function
(	O
TSpositive_number	pointer
,	O
x	double
)	O
;	O
if	O
(	O
tx	int
==	O
t_bignum	O
)	O
{	O
out	struct
=	O
new_bignum	function
(	O
)	O
;	O
base	int
=	O
x	double
;	O
fbase	int
=	O
-	O
1	int
;	O
}	O
else	O
{	O
out	struct
=	O
big_fixnum1	int
;	O
fbase	int
=	O
tx	int
==	O
t_fixnum	O
?	O
fix	function
(	O
x	double
)	O
:	O
MOST_POSITIVE_FIX	pointer
;	O
mpz_set_si	function
(	O
MP	function
(	O
big_fixnum2	pointer
)	O
,	O
fbase	int
)	O
;	O
base	int
=	O
big_fixnum2	int
;	O
}	O
mpz_urandomm	O
(	O
MP	function
(	O
out	pointer
)	O
,	O
&	O
rs	struct
->	O
rnd	struct
.	O
rnd_state	int
,	O
MP	function
(	O
base	int
)	O
)	O
;	O
switch	O
(	O
tx	int
)	O
{	O
case	O
t_fixnum	O
:	O
return	O
make_fixnum	function
(	O
mpz_get_si	function
(	O
MP	function
(	O
out	pointer
)	O
)	O
)	O
;	O
case	O
t_bignum	O
:	O
return	O
normalize_big	function
(	O
out	pointer
)	O
;	O
case	O
t_shortfloat	O
:	O
case	O
t_longfloat	O
:	O
d	int
=	O
mpz_get_d	function
(	O
MP	function
(	O
out	pointer
)	O
)	O
;	O
d	long
/=	O
(	O
double	O
)	O
fbase	int
;	O
z	double
=	O
alloc_object	O
(	O
tx	int
)	O
;	O
if	O
(	O
tx	int
==	O
t_shortfloat	O
)	O
sf	function
(	O
z	pointer
)	O
=	O
sf	function
(	O
x	double
)	O
*	O
d	pointer
;	O
else	O
lf	function
(	O
z	pointer
)	O
=	O
lf	function
(	O
x	double
)	O
*	O
d	pointer
;	O
return	O
z	double
;	O
default	O
:	O
FEerror	function
(	O
"~S is not an integer nor a floating-point number."	int
,	O
1	int
,	O
x	double
)	O
;	O
return	O
(	O
Cnil	O
)	O
;	O
}	O
}	O
void	O
reinit_gmp	function
(	O
)	O
{	O
}	O
void	O
init_gmp_rnd_state	function
(	O
__gmp_randstate_struct	struct
*	O
x	double
)	O
{	O
static	O
int	O
n	int
;	O
bzero	O
(	O
x	double
,	O
sizeof	O
(	O
*	O
x	double
)	O
)	O
;	O
gmp_randinit_default	O
(	O
x	double
)	O
;	O
}	O
static	O
object	O
make_random_state	function
(	O
object	O
rs	struct
)	O
{	O
object	O
z	double
;	O
if	O
(	O
rs	struct
==	O
Cnil	O
)	O
rs	struct
=	O
symbol_value	function
(	O
Vrandom_state	pointer
)	O
;	O
if	O
(	O
rs	struct
!=	O
Ct	O
&&	O
type_of	function
(	O
rs	struct
)	O
!=	O
t_random	int
)	O
{	O
FEwrong_type_argument	function
(	O
sLrandom_state	pointer
,	O
rs	struct
)	O
;	O
return	O
(	O
Cnil	O
)	O
;	O
}	O
z	double
=	O
alloc_object	O
(	O
t_random	pointer
)	O
;	O
init_gmp_rnd_state	function
(	O
&	O
z	struct
->	O
rnd	struct
.	O
rnd_state	int
)	O
;	O
if	O
(	O
rs	struct
==	O
Ct	O
)	O
gmp_randseed_ui	function
(	O
&	O
z	pointer
->	O
rnd	struct
.	O
rnd_state	int
,	O
RS_DEF_INIT	int
)	O
;	O
else	O
memcpy	function
(	O
z	pointer
->	O
rnd	O
.	O
rnd_state	struct
.	O
_mp_seed	pointer
->	O
_mp_d	int
,	O
rs	struct
->	O
rnd	O
.	O
rnd_state	struct
.	O
_mp_seed	pointer
->	O
_mp_d	int
,	O
rs	struct
->	O
rnd	O
.	O
rnd_state	struct
.	O
_mp_seed	pointer
->	O
_mp_alloc	int
*	O
sizeof	O
(	O
*	O
z	pointer
->	O
rnd	O
.	O
rnd_state	struct
.	O
_mp_seed	pointer
->	O
_mp_d	pointer
)	O
)	O
;	O
return	O
(	O
z	pointer
)	O
;	O
}	O
LFD	function
(	O
Lrandom	pointer
)	O
(	O
void	O
)	O
{	O
int	O
j	int
;	O
object	int
x	double
;	O
j	int
=	O
vs_top	O
-	O
vs_base	O
;	O
if	O
(	O
j	int
==	O
1	int
)	O
vs_push	function
(	O
symbol_value	function
(	O
Vrandom_state	pointer
)	O
)	O
;	O
check_arg	function
(	O
2	int
)	O
;	O
check_type_random_state	function
(	O
&	O
vs_base	O
[	O
1	int
]	O
)	O
;	O
x	double
=	O
rando	function
(	O
vs_base	O
[	O
0	int
]	O
,	O
vs_base	O
[	O
1	int
]	O
)	O
;	O
vs_top	O
=	O
vs_base	O
;	O
vs_push	function
(	O
x	double
)	O
;	O
}	O
LFD	function
(	O
Lmake_random_state	pointer
)	O
(	O
void	O
)	O
{	O
int	O
j	int
;	O
object	int
x	double
;	O
j	int
=	O
vs_top	O
-	O
vs_base	O
;	O
if	O
(	O
j	int
==	O
0	int
)	O
vs_push	function
(	O
Cnil	O
)	O
;	O
check_arg	function
(	O
1	int
)	O
;	O
x	double
=	O
make_random_state	function
(	O
vs_head	pointer
)	O
;	O
vs_top	O
=	O
vs_base	O
;	O
vs_push	function
(	O
x	double
)	O
;	O
}	O
LFD	function
(	O
Lrandom_state_p	pointer
)	O
(	O
void	O
)	O
{	O
check_arg	function
(	O
1	int
)	O
;	O
if	O
(	O
type_of	function
(	O
vs_pop	int
)	O
==	O
t_random	int
)	O
vs_push	function
(	O
Ct	O
)	O
;	O
else	O
vs_push	function
(	O
Cnil	O
)	O
;	O
}	O
void	O
gcl_init_num_rand	function
(	O
void	O
)	O
{	O
Vrandom_state	pointer
=	O
make_special	function
(	O
"*RANDOM-STATE*"	pointer
,	O
make_random_state	function
(	O
Ct	O
)	O
)	O
;	O
make_function	function
(	O
"RANDOM"	pointer
,	O
Lrandom	int
)	O
;	O
make_function	function
(	O
"MAKE-RANDOM-STATE"	pointer
,	O
Lmake_random_state	int
)	O
;	O
make_function	function
(	O
"RANDOM-STATE-P"	pointer
,	O
Lrandom_state_p	int
)	O
;	O
}	O