typedef	O
struct	O
Filter_t	struct
{	O
Class_t	struct
*	O
Class	pointer
;	O
int	O
refs	int
;	O
Stream_t	struct
*	O
Next	pointer
;	O
Stream_t	struct
*	O
Buffer	pointer
;	O
int	O
dospos	int
;	O
int	O
unixpos	int
;	O
int	O
mode	int
;	O
int	O
rw	int
;	O
int	O
lastchar	int
;	O
}	O
Filter_t	int
;	O
static	O
int	O
read_filter	function
(	O
Stream_t	struct
*	O
Stream	pointer
,	O
char	O
*	O
buf	pointer
,	O
mt_off_t	long
iwhere	long
,	O
size_t	long
len	long
)	O
{	O
DeclareThis	O
(	O
Filter_t	pointer
)	O
;	O
int	O
i	long
,	O
j	long
,	O
ret	int
;	O
unsigned	O
char	O
newchar	int
;	O
off_t	long
where	long
=	O
truncBytes32	function
(	O
iwhere	pointer
)	O
;	O
if	O
(	O
where	int
!=	O
This	pointer
->	O
unixpos	pointer
)	O
{	O
fprintf	function
(	O
stderr	pointer
,	O
"Bad offset\n"	pointer
)	O
;	O
exit	function
(	O
1	int
)	O
;	O
}	O
if	O
(	O
This	pointer
->	O
rw	pointer
==	O
F_WRITE	pointer
)	O
{	O
fprintf	function
(	O
stderr	pointer
,	O
"Change of transfer direction!\n"	pointer
)	O
;	O
exit	function
(	O
1	int
)	O
;	O
}	O
This	pointer
->	O
rw	int
=	O
F_READ	int
;	O
ret	long
=	O
READS	O
(	O
This	pointer
->	O
Next	pointer
,	O
buf	pointer
,	O
(	O
mt_off_t	long
)	O
This	pointer
->	O
dospos	pointer
,	O
len	long
)	O
;	O
if	O
(	O
ret	long
<	O
0	int
)	O
return	O
ret	long
;	O
j	long
=	O
0	int
;	O
for	O
(	O
i	long
=	O
0	int
;	O
i	long
<	O
ret	int
;	O
i	long
++	O
)	O
{	O
if	O
(	O
buf	pointer
[	O
i	long
]	O
==	O
'\r'	O
)	O
continue	O
;	O
if	O
(	O
buf	pointer
[	O
i	long
]	O
==	O
0x1a	int
)	O
break	O
;	O
newchar	pointer
=	O
buf	pointer
[	O
i	long
]	O
;	O
This	pointer
->	O
lastchar	pointer
=	O
buf	pointer
[	O
j	long
++	O
]	O
=	O
newchar	int
;	O
}	O
This	pointer
->	O
dospos	int
+=	O
i	long
;	O
This	pointer
->	O
unixpos	int
+=	O
j	long
;	O
return	O
j	long
;	O
}	O
static	O
int	O
write_filter	function
(	O
Stream_t	struct
*	O
Stream	pointer
,	O
char	O
*	O
buf	pointer
,	O
mt_off_t	long
iwhere	long
,	O
size_t	long
len	long
)	O
{	O
DeclareThis	O
(	O
Filter_t	pointer
)	O
;	O
unsigned	O
int	O
i	long
,	O
j	long
;	O
int	O
ret	int
;	O
char	O
buffer	array
[	O
1025	int
]	O
;	O
unsigned	O
char	O
newchar	int
;	O
off_t	long
where	long
=	O
truncBytes32	function
(	O
iwhere	pointer
)	O
;	O
if	O
(	O
This	pointer
->	O
unixpos	pointer
==	O
-	O
1	int
)	O
return	O
-	O
1	int
;	O
if	O
(	O
where	int
!=	O
This	pointer
->	O
unixpos	pointer
)	O
{	O
fprintf	function
(	O
stderr	pointer
,	O
"Bad offset\n"	pointer
)	O
;	O
exit	function
(	O
1	int
)	O
;	O
}	O
if	O
(	O
This	pointer
->	O
rw	pointer
==	O
F_READ	pointer
)	O
{	O
fprintf	function
(	O
stderr	pointer
,	O
"Change of transfer direction!\n"	pointer
)	O
;	O
exit	function
(	O
1	int
)	O
;	O
}	O
This	pointer
->	O
rw	int
=	O
F_WRITE	int
;	O
j	long
=	O
i	long
=	O
0	int
;	O
while	O
(	O
i	long
<	O
1024	int
&&	O
j	long
<	O
len	long
)	O
{	O
if	O
(	O
buf	pointer
[	O
j	long
]	O
==	O
'\n'	O
)	O
{	O
buffer	pointer
[	O
i	long
++	O
]	O
=	O
'\r'	O
;	O
buffer	pointer
[	O
i	long
++	O
]	O
=	O
'\n'	O
;	O
j	long
++	O
;	O
continue	O
;	O
}	O
newchar	pointer
=	O
buf	pointer
[	O
j	long
++	O
]	O
;	O
buffer	pointer
[	O
i	long
++	O
]	O
=	O
newchar	int
;	O
}	O
This	pointer
->	O
unixpos	int
+=	O
j	long
;	O
ret	int
=	O
force_write	function
(	O
This	pointer
->	O
Next	pointer
,	O
buffer	pointer
,	O
(	O
mt_off_t	long
)	O
This	pointer
->	O
dospos	pointer
,	O
i	long
)	O
;	O
if	O
(	O
ret	long
>	O
0	int
)	O
This	pointer
->	O
dospos	int
+=	O
ret	int
;	O
if	O
(	O
ret	long
!=	O
(	O
signed	O
int	O
)	O
i	long
)	O
{	O
This	pointer
->	O
unixpos	pointer
=	O
-	O
1	int
;	O
return	O
-	O
1	int
;	O
}	O
return	O
j	long
;	O
}	O
static	O
int	O
free_filter	function
(	O
Stream_t	struct
*	O
Stream	pointer
)	O
{	O
DeclareThis	O
(	O
Filter_t	pointer
)	O
;	O
char	O
buffer	pointer
=	O
0x1a	pointer
;	O
if	O
(	O
This	pointer
->	O
rw	int
==	O
F_WRITE	int
)	O
return	O
force_write	function
(	O
This	pointer
->	O
Next	pointer
,	O
&	O
buffer	pointer
,	O
(	O
mt_off_t	long
)	O
This	pointer
->	O
dospos	int
,	O
1	int
)	O
;	O
else	O
return	O
0	int
;	O
}	O
static	O
Class_t	struct
FilterClass	int
=	O
{	O
read_filter	pointer
,	O
write_filter	int
,	O
0	int
,	O
free_filter	int
,	O
0	int
,	O
get_data_pass_through	int
,	O
0	int
,	O
0	int
,	O
0	int
}	O
;	O
Stream_t	struct
*	O
open_filter	function
(	O
Stream_t	struct
*	O
Next	pointer
,	O
int	O
convertCharset	int
UNUSEDP	O
)	O
{	O
Filter_t	struct
*	O
This	pointer
;	O
This	pointer
=	O
New	O
(	O
Filter_t	pointer
)	O
;	O
if	O
(	O
!	O
This	pointer
)	O
return	O
NULL	O
;	O
This	pointer
->	O
Class	pointer
=	O
&	O
FilterClass	struct
;	O
This	pointer
->	O
dospos	pointer
=	O
This	pointer
->	O
unixpos	pointer
=	O
This	pointer
->	O
rw	int
=	O
0	int
;	O
This	pointer
->	O
Next	pointer
=	O
Next	pointer
;	O
This	pointer
->	O
refs	pointer
=	O
1	int
;	O
This	pointer
->	O
Buffer	int
=	O
0	int
;	O
return	O
(	O
Stream_t	struct
*	O
)	O
This	pointer
;	O
}	O