static	O
void	O
stdstream_flushall_setup	function
(	O
void	O
)	O
;	O
static	O
void	O
std_bootstrap	function
(	O
struct	O
_mu_stream	struct
*	O
str	pointer
,	O
int	O
code	int
,	O
unsigned	O
long	O
lval	long
,	O
void	O
*	O
pval	pointer
)	O
{	O
struct	O
_mu_file_stream	struct
*	O
fstr	pointer
=	O
(	O
struct	O
_mu_file_stream	struct
*	O
)	O
str	pointer
;	O
_mu_file_stream_setup	function
(	O
fstr	pointer
)	O
;	O
str	pointer
->	O
event_cb	pointer
=	O
NULL	O
;	O
str	pointer
->	O
event_mask	struct
=	O
0	int
;	O
str	pointer
->	O
event_cb_data	int
=	O
0	int
;	O
fstr	pointer
->	O
stream	struct
.	O
flags	int
|=	O
_MU_STR_OPEN	int
;	O
mu_stream_set_buffer	function
(	O
(	O
mu_stream_t	pointer
)	O
fstr	pointer
,	O
mu_buffer_line	int
,	O
0	int
)	O
;	O
stdstream_flushall_setup	function
(	O
)	O
;	O
}	O
static	O
void	O
std_log_bootstrap	function
(	O
struct	O
_mu_stream	struct
*	O
str	pointer
,	O
int	O
code	int
,	O
unsigned	O
long	O
lval	long
,	O
void	O
*	O
pval	pointer
)	O
{	O
struct	O
_mu_log_stream	struct
*	O
logstr	pointer
=	O
(	O
struct	O
_mu_log_stream	struct
*	O
)	O
str	pointer
;	O
int	O
yes	int
=	O
1	int
;	O
mu_stream_t	pointer
errstr	pointer
,	O
transport	pointer
;	O
int	O
rc	int
;	O
rc	int
=	O
mu_stdio_stream_create	function
(	O
&	O
errstr	pointer
,	O
MU_STDERR_FD	int
,	O
0	int
)	O
;	O
if	O
(	O
rc	int
)	O
{	O
fprintf	function
(	O
stderr	pointer
,	O
"%s: cannot open error stream: %s\n"	pointer
,	O
mu_program_name	pointer
?	O
mu_program_name	pointer
:	O
"<unknown>"	pointer
,	O
mu_strerror	function
(	O
rc	int
)	O
)	O
;	O
abort	function
(	O
)	O
;	O
}	O
mu_stream_ioctl	function
(	O
errstr	pointer
,	O
MU_IOCTL_FD	int
,	O
MU_IOCTL_FD_SET_BORROW	int
,	O
&	O
yes	int
)	O
;	O
if	O
(	O
!	O
mu_program_name	pointer
)	O
transport	pointer
=	O
errstr	pointer
;	O
else	O
{	O
char	O
*	O
fltargs	array
[	O
3	int
]	O
=	O
{	O
"INLINE-COMMENT"	pointer
,	O
}	O
;	O
mu_asprintf	function
(	O
&	O
fltargs	array
[	O
1	int
]	O
,	O
"%s: "	pointer
,	O
mu_program_name	pointer
)	O
;	O
fltargs	array
[	O
2	int
]	O
=	O
NULL	O
;	O
rc	int
=	O
mu_filter_create_args	function
(	O
&	O
transport	pointer
,	O
errstr	pointer
,	O
"INLINE-COMMENT"	pointer
,	O
2	int
,	O
(	O
const	O
char	O
*	O
*	O
)	O
fltargs	array
,	O
MU_FILTER_ENCODE	int
,	O
MU_STREAM_WRITE	int
)	O
;	O
mu_stream_unref	function
(	O
errstr	pointer
)	O
;	O
free	function
(	O
fltargs	array
[	O
1	int
]	O
)	O
;	O
if	O
(	O
rc	int
)	O
{	O
fprintf	function
(	O
stderr	pointer
,	O
"%s: cannot open output filter stream: %s"	pointer
,	O
mu_program_name	pointer
?	O
mu_program_name	pointer
:	O
"<unknown>"	pointer
,	O
mu_strerror	function
(	O
rc	int
)	O
)	O
;	O
abort	function
(	O
)	O
;	O
}	O
mu_stream_set_buffer	function
(	O
transport	pointer
,	O
mu_buffer_line	int
,	O
0	int
)	O
;	O
}	O
str	pointer
->	O
event_cb	pointer
=	O
NULL	O
;	O
str	pointer
->	O
event_mask	struct
=	O
0	int
;	O
str	pointer
->	O
event_cb_data	int
=	O
0	int
;	O
_mu_log_stream_setup	function
(	O
logstr	pointer
,	O
transport	pointer
)	O
;	O
stdstream_flushall_setup	function
(	O
)	O
;	O
}	O
static	O
void	O
bootstrap_destroy	function
(	O
struct	O
_mu_stream	struct
*	O
str	pointer
)	O
{	O
}	O
static	O
struct	O
_mu_file_stream	struct
stdstream	array
[	O
2	int
]	O
=	O
{	O
{	O
.	O
stream	int
=	O
{	O
.	O
ref_count	int
=	O
1	int
,	O
.	O
buftype	O
=	O
mu_buffer_none	int
,	O
.	O
flags	int
=	O
MU_STREAM_READ	int
,	O
.	O
destroy	int
=	O
bootstrap_destroy	int
,	O
.	O
event_cb	pointer
=	O
std_bootstrap	int
,	O
.	O
event_mask	struct
=	O
_MU_STR_EVMASK	O
(	O
_MU_STR_EVENT_BOOTSTRAP	pointer
)	O
}	O
,	O
.	O
fd	int
=	O
MU_STDIN_FD	int
,	O
.	O
filename	pointer
=	O
"<stdin>"	pointer
,	O
.	O
flags	int
=	O
_MU_FILE_STREAM_FD_BORROWED	int
|	O
_MU_FILE_STREAM_STATIC_FILENAME	int
}	O
,	O
{	O
.	O
stream	int
=	O
{	O
.	O
ref_count	int
=	O
1	int
,	O
.	O
buftype	O
=	O
mu_buffer_none	int
,	O
.	O
flags	int
=	O
MU_STREAM_WRITE	int
,	O
.	O
destroy	int
=	O
bootstrap_destroy	int
,	O
.	O
event_cb	pointer
=	O
std_bootstrap	int
,	O
.	O
event_mask	struct
=	O
_MU_STR_EVMASK	O
(	O
_MU_STR_EVENT_BOOTSTRAP	pointer
)	O
}	O
,	O
.	O
fd	int
=	O
MU_STDOUT_FD	int
,	O
.	O
filename	pointer
=	O
"<stdout>"	pointer
,	O
.	O
flags	int
=	O
_MU_FILE_STREAM_FD_BORROWED	int
|	O
_MU_FILE_STREAM_STATIC_FILENAME	int
}	O
}	O
;	O
static	O
struct	O
_mu_log_stream	struct
default_strerr	struct
=	O
{	O
.	O
base	int
=	O
{	O
.	O
ref_count	int
=	O
1	int
,	O
.	O
buftype	O
=	O
mu_buffer_none	int
,	O
.	O
flags	int
=	O
MU_STREAM_WRITE	int
,	O
.	O
destroy	int
=	O
bootstrap_destroy	int
,	O
.	O
event_cb	pointer
=	O
std_log_bootstrap	int
,	O
.	O
event_mask	struct
=	O
_MU_STR_EVMASK	O
(	O
_MU_STR_EVENT_BOOTSTRAP	pointer
)	O
}	O
}	O
;	O
mu_stream_t	pointer
mu_strin	pointer
=	O
(	O
mu_stream_t	pointer
)	O
&	O
stdstream	pointer
[	O
MU_STDIN_FD	int
]	O
;	O
mu_stream_t	pointer
mu_strout	pointer
=	O
(	O
mu_stream_t	pointer
)	O
&	O
stdstream	pointer
[	O
MU_STDOUT_FD	int
]	O
;	O
mu_stream_t	pointer
mu_strerr	pointer
=	O
(	O
mu_stream_t	pointer
)	O
&	O
default_strerr	struct
;	O
static	O
void	O
stdstream_flushall	function
(	O
void	O
*	O
data	pointer
MU_ARG_UNUSED	O
)	O
{	O
mu_stream_flush	function
(	O
mu_strin	pointer
)	O
;	O
mu_stream_flush	function
(	O
mu_strout	pointer
)	O
;	O
mu_stream_flush	function
(	O
mu_strerr	pointer
)	O
;	O
}	O
static	O
void	O
stdstream_flushall_setup	function
(	O
void	O
)	O
{	O
static	O
int	O
_setup	int
=	O
0	int
;	O
if	O
(	O
!	O
_setup	int
)	O
{	O
mu_onexit	function
(	O
stdstream_flushall	pointer
,	O
NULL	O
)	O
;	O
_setup	int
=	O
1	int
;	O
}	O
}	O
void	O
mu_stdstream_setup	function
(	O
int	O
flags	int
)	O
{	O
int	O
rc	int
;	O
int	O
fd	int
;	O
int	O
yes	int
=	O
1	int
;	O
if	O
(	O
flags	int
&	O
MU_STDSTREAM_RESET_STRIN	int
)	O
mu_stream_destroy	function
(	O
&	O
mu_strin	struct
)	O
;	O
if	O
(	O
flags	int
&	O
MU_STDSTREAM_RESET_STROUT	int
)	O
mu_stream_destroy	function
(	O
&	O
mu_strout	struct
)	O
;	O
if	O
(	O
flags	int
&	O
MU_STDSTREAM_RESET_STRERR	int
)	O
mu_stream_destroy	function
(	O
&	O
mu_strerr	pointer
)	O
;	O
fd	int
=	O
open	function
(	O
"/dev/null"	pointer
,	O
O_RDWR	int
)	O
;	O
switch	O
(	O
fd	int
)	O
{	O
case	O
0	int
:	O
fd	int
=	O
open	function
(	O
"/dev/null"	pointer
,	O
O_WRONLY	int
)	O
;	O
if	O
(	O
fd	int
!=	O
1	int
)	O
{	O
if	O
(	O
fd	int
>	O
2	int
)	O
close	function
(	O
fd	int
)	O
;	O
break	O
;	O
}	O
case	O
1	int
:	O
fd	int
=	O
open	function
(	O
"/dev/null"	pointer
,	O
O_WRONLY	int
)	O
;	O
if	O
(	O
fd	int
!=	O
2	int
)	O
close	function
(	O
fd	int
)	O
;	O
break	O
;	O
case	O
2	int
:	O
;	O
break	O
;	O
default	O
:	O
close	function
(	O
fd	int
)	O
;	O
break	O
;	O
}	O
if	O
(	O
!	O
mu_strin	pointer
)	O
{	O
rc	int
=	O
mu_stdio_stream_create	function
(	O
&	O
mu_strin	pointer
,	O
MU_STDIN_FD	int
,	O
0	int
)	O
;	O
if	O
(	O
rc	int
)	O
{	O
fprintf	function
(	O
stderr	pointer
,	O
"mu_stdio_stream_create(%d): %s\n"	pointer
,	O
MU_STDIN_FD	int
,	O
mu_strerror	function
(	O
rc	int
)	O
)	O
;	O
abort	function
(	O
)	O
;	O
}	O
mu_stream_ioctl	function
(	O
mu_strin	pointer
,	O
MU_IOCTL_FD	int
,	O
MU_IOCTL_FD_SET_BORROW	int
,	O
&	O
yes	int
)	O
;	O
}	O
if	O
(	O
!	O
mu_strout	pointer
)	O
{	O
rc	int
=	O
mu_stdio_stream_create	function
(	O
&	O
mu_strout	struct
,	O
MU_STDOUT_FD	int
,	O
0	int
)	O
;	O
if	O
(	O
rc	int
)	O
{	O
fprintf	function
(	O
stderr	pointer
,	O
"mu_stdio_stream_create(%d): %s\n"	pointer
,	O
MU_STDOUT_FD	int
,	O
mu_strerror	function
(	O
rc	int
)	O
)	O
;	O
abort	function
(	O
)	O
;	O
}	O
mu_stream_ioctl	function
(	O
mu_strout	pointer
,	O
MU_IOCTL_FD	int
,	O
MU_IOCTL_FD_SET_BORROW	int
,	O
&	O
yes	int
)	O
;	O
}	O
if	O
(	O
!	O
mu_strerr	pointer
)	O
{	O
if	O
(	O
mu_stdstream_strerr_create	function
(	O
&	O
mu_strerr	pointer
,	O
MU_STRERR_STDERR	int
,	O
0	int
,	O
0	int
,	O
mu_program_name	pointer
,	O
NULL	O
)	O
)	O
abort	function
(	O
)	O
;	O
}	O
stdstream_flushall_setup	function
(	O
)	O
;	O
}	O
int	O
mu_printf	function
(	O
const	O
char	O
*	O
fmt	pointer
,	O
...	O
)	O
{	O
int	O
rc	int
;	O
va_list	array
ap	array
;	O
va_start	O
(	O
ap	pointer
,	O
fmt	pointer
)	O
;	O
rc	int
=	O
mu_stream_vprintf	function
(	O
mu_strout	pointer
,	O
fmt	pointer
,	O
ap	pointer
)	O
;	O
va_end	O
(	O
ap	pointer
)	O
;	O
return	O
rc	int
;	O
}	O