void	O
ldelf_map_segments	function
(	O
bfd_boolean	int
need_layout	int
)	O
{	O
int	O
tries	int
=	O
10	int
;	O
do	O
{	O
lang_relax_sections	function
(	O
need_layout	pointer
)	O
;	O
need_layout	int
=	O
FALSE	O
;	O
if	O
(	O
link_info	pointer
.	O
output_bfd	pointer
->	O
xvec	pointer
->	O
flavour	int
==	O
bfd_target_elf_flavour	int
&&	O
!	O
bfd_link_relocatable	function
(	O
&	O
link_info	pointer
)	O
)	O
{	O
bfd_size_type	long
phdr_size	O
;	O
phdr_size	int
=	O
elf_program_header_size	function
(	O
link_info	pointer
.	O
output_bfd	pointer
)	O
;	O
if	O
(	O
lang_phdr_list	pointer
==	O
NULL	O
)	O
elf_seg_map	function
(	O
link_info	pointer
.	O
output_bfd	pointer
)	O
=	O
NULL	O
;	O
if	O
(	O
!	O
_bfd_elf_map_sections_to_segments	function
(	O
link_info	pointer
.	O
output_bfd	pointer
,	O
&	O
link_info	pointer
)	O
)	O
einfo	function
(	O
_	O
(	O
"%F%P: map sections to segments failed: %E\n"	pointer
)	O
)	O
;	O
if	O
(	O
phdr_size	int
!=	O
elf_program_header_size	function
(	O
link_info	pointer
.	O
output_bfd	pointer
)	O
)	O
{	O
if	O
(	O
tries	int
>	O
6	int
)	O
need_layout	int
=	O
TRUE	O
;	O
else	O
if	O
(	O
phdr_size	int
<	O
elf_program_header_size	function
(	O
link_info	pointer
.	O
output_bfd	pointer
)	O
)	O
need_layout	int
=	O
TRUE	O
;	O
else	O
elf_program_header_size	function
(	O
link_info	pointer
.	O
output_bfd	pointer
)	O
=	O
phdr_size	int
;	O
}	O
}	O
}	O
while	O
(	O
need_layout	int
&&	O
--	O
tries	int
)	O
;	O
if	O
(	O
tries	int
==	O
0	int
)	O
einfo	function
(	O
_	O
(	O
"%F%P: looping in map_segments"	pointer
)	O
)	O
;	O
}	O
int	O
ldelf_emit_ctf_early	function
(	O
void	O
)	O
{	O
if	O
(	O
bfd_get_flavour	function
(	O
link_info	pointer
.	O
output_bfd	pointer
)	O
==	O
bfd_target_elf_flavour	int
)	O
return	O
0	int
;	O
return	O
1	int
;	O
}	O
struct	O
ctf_strsym_iter_cb_arg	struct
{	O
struct	O
elf_sym_strtab	struct
*	O
syms	pointer
;	O
bfd_size_type	long
symcount	O
;	O
struct	O
elf_strtab_hash	struct
*	O
symstrtab	pointer
;	O
size_t	long
next_i	long
;	O
size_t	long
next_idx	long
;	O
}	O
;	O
static	O
const	O
char	O
*	O
ldelf_ctf_strtab_iter_cb	function
(	O
uint32_t	int
*	O
offset	long
,	O
void	O
*	O
arg_	pointer
)	O
{	O
bfd_size_type	long
off	long
;	O
const	O
char	O
*	O
ret	pointer
;	O
struct	O
ctf_strsym_iter_cb_arg	struct
*	O
arg	pointer
=	O
(	O
struct	O
ctf_strsym_iter_cb_arg	struct
*	O
)	O
arg_	pointer
;	O
if	O
(	O
arg	pointer
->	O
next_i	int
==	O
0	int
)	O
arg	pointer
->	O
next_i	int
=	O
1	int
;	O
if	O
(	O
arg	pointer
->	O
next_i	int
>=	O
_bfd_elf_strtab_len	function
(	O
arg	pointer
->	O
symstrtab	pointer
)	O
)	O
{	O
arg	pointer
->	O
next_i	pointer
=	O
0	int
;	O
return	O
NULL	O
;	O
}	O
ret	int
=	O
_bfd_elf_strtab_str	function
(	O
arg	pointer
->	O
symstrtab	pointer
,	O
arg	pointer
->	O
next_i	pointer
++	O
,	O
&	O
off	long
)	O
;	O
*	O
offset	long
=	O
off	long
;	O
if	O
(	O
*	O
offset	long
!=	O
off	long
)	O
return	O
NULL	O
;	O
return	O
ret	int
;	O
}	O
static	O
struct	O
ctf_link_sym	struct
*	O
ldelf_ctf_symbols_iter_cb	function
(	O
struct	O
ctf_link_sym	struct
*	O
dest	pointer
,	O
void	O
*	O
arg_	pointer
)	O
{	O
struct	O
ctf_strsym_iter_cb_arg	struct
*	O
arg	pointer
=	O
(	O
struct	O
ctf_strsym_iter_cb_arg	struct
*	O
)	O
arg_	pointer
;	O
if	O
(	O
arg	pointer
->	O
next_i	int
>	O
arg	pointer
->	O
symcount	pointer
)	O
{	O
arg	pointer
->	O
next_i	int
=	O
0	int
;	O
arg	pointer
->	O
next_idx	int
=	O
0	int
;	O
return	O
NULL	O
;	O
}	O
ASSERT	O
(	O
arg	pointer
->	O
syms	pointer
[	O
arg	pointer
->	O
next_i	int
]	O
.	O
dest_index	int
==	O
arg	pointer
->	O
next_idx	pointer
)	O
;	O
dest	pointer
->	O
st_name	pointer
=	O
_bfd_elf_strtab_str	function
(	O
arg	pointer
->	O
symstrtab	pointer
,	O
arg	pointer
->	O
next_i	pointer
,	O
NULL	O
)	O
;	O
dest	pointer
->	O
st_shndx	pointer
=	O
arg	pointer
->	O
syms	pointer
[	O
arg	pointer
->	O
next_i	int
]	O
.	O
sym	struct
.	O
st_shndx	pointer
;	O
dest	pointer
->	O
st_type	pointer
=	O
ELF_ST_TYPE	function
(	O
arg	pointer
->	O
syms	pointer
[	O
arg	pointer
->	O
next_i	int
]	O
.	O
sym	struct
.	O
st_info	int
)	O
;	O
dest	pointer
->	O
st_value	pointer
=	O
arg	pointer
->	O
syms	pointer
[	O
arg	pointer
->	O
next_i	int
]	O
.	O
sym	struct
.	O
st_value	int
;	O
arg	pointer
->	O
next_i	pointer
++	O
;	O
return	O
dest	pointer
;	O
}	O
void	O
ldelf_examine_strtab_for_ctf	function
(	O
struct	O
ctf_file	struct
*	O
ctf_output	pointer
,	O
struct	O
elf_sym_strtab	struct
*	O
syms	pointer
,	O
bfd_size_type	long
symcount	O
,	O
struct	O
elf_strtab_hash	struct
*	O
symstrtab	pointer
)	O
{	O
struct	O
ctf_strsym_iter_cb_arg	struct
args	pointer
=	O
{	O
syms	pointer
,	O
symcount	int
,	O
symstrtab	int
,	O
0	int
,	O
0	int
}	O
;	O
if	O
(	O
!	O
ctf_output	pointer
)	O
return	O
;	O
if	O
(	O
bfd_get_flavour	function
(	O
link_info	pointer
.	O
output_bfd	pointer
)	O
==	O
bfd_target_elf_flavour	int
&&	O
!	O
bfd_link_relocatable	function
(	O
&	O
link_info	pointer
)	O
)	O
{	O
if	O
(	O
ctf_link_add_strtab	function
(	O
ctf_output	pointer
,	O
ldelf_ctf_strtab_iter_cb	int
,	O
&	O
args	pointer
)	O
<	O
0	int
)	O
einfo	function
(	O
_	O
(	O
"%F%P: warning: CTF strtab association failed; strings will "	pointer
"not be shared: %s\n"	pointer
)	O
,	O
ctf_errmsg	function
(	O
ctf_errno	function
(	O
ctf_output	pointer
)	O
)	O
)	O
;	O
if	O
(	O
ctf_link_shuffle_syms	function
(	O
ctf_output	pointer
,	O
ldelf_ctf_symbols_iter_cb	int
,	O
&	O
args	pointer
)	O
<	O
0	int
)	O
einfo	function
(	O
_	O
(	O
"%F%P: warning: CTF symbol shuffling failed; slight space "	pointer
"cost: %s\n"	pointer
)	O
,	O
ctf_errmsg	function
(	O
ctf_errno	function
(	O
ctf_output	pointer
)	O
)	O
)	O
;	O
}	O
}	O