static	O
int	O
rec_parser_getc	function
(	O
rec_parser_t	pointer
parser	pointer
)	O
;	O
static	O
int	O
rec_parser_ungetc	function
(	O
rec_parser_t	pointer
parser	pointer
,	O
int	O
ci	int
)	O
;	O
static	O
bool	bool
rec_expect	function
(	O
rec_parser_t	pointer
parser	pointer
,	O
const	O
char	O
*	O
str	pointer
)	O
;	O
static	O
bool	bool
rec_parse_field_value	function
(	O
rec_parser_t	pointer
parser	pointer
,	O
char	O
*	O
*	O
str	pointer
)	O
;	O
static	O
bool	bool
rec_parse_comment	function
(	O
rec_parser_t	pointer
parser	pointer
,	O
rec_comment_t	pointer
*	O
comment	pointer
)	O
;	O
static	O
bool	bool
rec_parser_digit_p	function
(	O
char	O
c	int
)	O
;	O
static	O
bool	bool
rec_parser_letter_p	function
(	O
char	O
c	int
)	O
;	O
static	O
bool	bool
rec_parser_init_common	function
(	O
rec_parser_t	pointer
parser	pointer
,	O
const	O
char	O
*	O
source	pointer
)	O
;	O
enum	O
rec_parser_error_e	enum
{	O
REC_PARSER_NOERROR	int
,	O
REC_PARSER_ERROR	int
,	O
REC_PARSER_EUNGETC	int
,	O
REC_PARSER_EFNAME	int
,	O
REC_PARSER_ENOMEM	int
,	O
REC_PARSER_ETOOMUCHNAMEPARTS	int
,	O
REC_PARSER_ECOMMENT	int
,	O
REC_PARSER_EFIELD	int
,	O
REC_PARSER_ERECORD	int
}	O
;	O
struct	O
rec_parser_s	struct
{	O
FILE	struct
*	O
in_file	pointer
;	O
const	O
char	O
*	O
in_buffer	pointer
;	O
size_t	long
in_size	long
;	O
const	O
char	O
*	O
p	pointer
;	O
char	O
*	O
source	pointer
;	O
rec_record_t	pointer
prev_descriptor	pointer
;	O
bool	bool
eof	bool
;	O
enum	O
rec_parser_error_e	enum
error	enum
;	O
size_t	long
line	long
;	O
size_t	long
character	long
;	O
}	O
;	O
const	O
char	O
*	O
rec_parser_error_strings	array
[	O
]	O
=	O
{	O
"no error (unused)"	pointer
,	O
"unknown error"	pointer
,	O
"unreading a character"	pointer
,	O
"expected a field name"	pointer
,	O
"out of memory"	pointer
,	O
"too much parts in field name"	pointer
,	O
"expected a comment"	pointer
,	O
"expected a field"	pointer
,	O
"expected a record"	pointer
,	O
NULL	O
}	O
;	O
rec_parser_t	pointer
rec_parser_new	function
(	O
FILE	struct
*	O
in	pointer
,	O
const	O
char	O
*	O
source	pointer
)	O
{	O
rec_parser_t	pointer
parser	pointer
;	O
parser	pointer
=	O
malloc	function
(	O
sizeof	O
(	O
struct	O
rec_parser_s	struct
)	O
)	O
;	O
if	O
(	O
parser	pointer
!=	O
NULL	O
)	O
{	O
parser	pointer
->	O
in_file	pointer
=	O
in	pointer
;	O
parser	pointer
->	O
in_buffer	pointer
=	O
NULL	O
;	O
parser	pointer
->	O
in_size	long
=	O
0	int
;	O
if	O
(	O
!	O
rec_parser_init_common	function
(	O
parser	pointer
,	O
source	pointer
)	O
)	O
{	O
free	function
(	O
parser	pointer
)	O
;	O
parser	pointer
=	O
NULL	O
;	O
}	O
}	O
return	O
parser	pointer
;	O
}	O
rec_parser_t	pointer
rec_parser_new_str	function
(	O
const	O
char	O
*	O
buffer	pointer
,	O
const	O
char	O
*	O
source	pointer
)	O
{	O
return	O
rec_parser_new_mem	function
(	O
buffer	pointer
,	O
strlen	function
(	O
buffer	pointer
)	O
,	O
source	pointer
)	O
;	O
}	O
rec_parser_t	pointer
rec_parser_new_mem	function
(	O
const	O
char	O
*	O
buffer	pointer
,	O
size_t	long
size	pointer
,	O
const	O
char	O
*	O
source	pointer
)	O
{	O
rec_parser_t	pointer
parser	pointer
;	O
parser	pointer
=	O
malloc	function
(	O
sizeof	O
(	O
struct	O
rec_parser_s	struct
)	O
)	O
;	O
if	O
(	O
parser	pointer
!=	O
NULL	O
)	O
{	O
parser	pointer
->	O
in_buffer	pointer
=	O
buffer	pointer
;	O
parser	pointer
->	O
in_size	long
=	O
size	pointer
;	O
parser	pointer
->	O
in_file	pointer
=	O
NULL	O
;	O
if	O
(	O
!	O
rec_parser_init_common	function
(	O
parser	pointer
,	O
source	pointer
)	O
)	O
{	O
free	function
(	O
parser	pointer
)	O
;	O
parser	pointer
=	O
NULL	O
;	O
}	O
}	O
return	O
parser	pointer
;	O
}	O
void	O
rec_parser_destroy	function
(	O
rec_parser_t	pointer
parser	pointer
)	O
{	O
if	O
(	O
parser	pointer
)	O
{	O
free	function
(	O
parser	pointer
->	O
source	pointer
)	O
;	O
free	function
(	O
parser	pointer
)	O
;	O
}	O
}	O
bool	bool
rec_parser_eof	function
(	O
rec_parser_t	pointer
parser	pointer
)	O
{	O
return	O
parser	pointer
->	O
eof	bool
;	O
}	O
bool	bool
rec_parser_error	function
(	O
rec_parser_t	pointer
parser	pointer
)	O
{	O
return	O
(	O
parser	pointer
->	O
error	enum
!=	O
REC_PARSER_NOERROR	int
)	O
;	O
}	O
void	O
rec_parser_perror	function
(	O
rec_parser_t	pointer
parser	pointer
,	O
const	O
char	O
*	O
fmt	pointer
,	O
...	O
)	O
{	O
va_list	array
ap	array
;	O
char	O
*	O
number_str	pointer
;	O
va_start	O
(	O
ap	array
,	O
fmt	pointer
)	O
;	O
vfprintf	function
(	O
stderr	pointer
,	O
fmt	pointer
,	O
ap	array
)	O
;	O
fputs	function
(	O
": "	pointer
,	O
stderr	pointer
)	O
;	O
number_str	pointer
=	O
NULL	O
;	O
if	O
(	O
asprintf	function
(	O
&	O
number_str	pointer
,	O
"%zu"	pointer
,	O
parser	pointer
->	O
line	long
)	O
!=	O
-	O
1	int
)	O
{	O
fputs	function
(	O
number_str	pointer
,	O
stderr	pointer
)	O
;	O
free	function
(	O
number_str	pointer
)	O
;	O
}	O
fputs	function
(	O
": error: "	pointer
,	O
stderr	pointer
)	O
;	O
fputs	function
(	O
gettext	function
(	O
rec_parser_error_strings	array
[	O
parser	pointer
->	O
error	enum
]	O
)	O
,	O
stderr	pointer
)	O
;	O
fputc	function
(	O
'\n'	O
,	O
stderr	pointer
)	O
;	O
va_end	O
(	O
ap	array
)	O
;	O
}	O
bool	bool
rec_parse_field_name	function
(	O
rec_parser_t	pointer
parser	pointer
,	O
char	O
*	O
*	O
fname	pointer
)	O
{	O
bool	bool
ret	bool
=	O
true	int
;	O
int	O
ci	int
;	O
size_t	long
str_size	pointer
;	O
char	O
c	int
;	O
rec_buf_t	pointer
buf	pointer
;	O
if	O
(	O
rec_parser_eof	function
(	O
parser	pointer
)	O
||	O
rec_parser_error	function
(	O
parser	pointer
)	O
)	O
return	O
false	int
;	O
buf	pointer
=	O
rec_buf_new	function
(	O
fname	pointer
,	O
&	O
str_size	pointer
)	O
;	O
if	O
(	O
!	O
buf	pointer
)	O
{	O
parser	pointer
->	O
error	enum
=	O
REC_PARSER_ENOMEM	int
;	O
return	O
false	int
;	O
}	O
ci	int
=	O
rec_parser_getc	function
(	O
parser	pointer
)	O
;	O
if	O
(	O
ci	int
==	O
EOF	O
)	O
ret	bool
=	O
false	int
;	O
else	O
{	O
c	int
=	O
(	O
char	O
)	O
ci	int
;	O
if	O
(	O
(	O
rec_parser_letter_p	function
(	O
c	int
)	O
)	O
||	O
(	O
c	int
==	O
'%'	O
)	O
)	O
{	O
if	O
(	O
rec_buf_putc	function
(	O
c	int
,	O
buf	pointer
)	O
==	O
EOF	O
)	O
{	O
parser	pointer
->	O
error	enum
=	O
REC_PARSER_ENOMEM	int
;	O
return	O
false	int
;	O
}	O
}	O
else	O
{	O
parser	pointer
->	O
error	enum
=	O
REC_PARSER_EFNAME	int
;	O
ret	bool
=	O
false	int
;	O
}	O
}	O
if	O
(	O
ret	bool
)	O
{	O
while	O
(	O
(	O
ci	int
=	O
rec_parser_getc	function
(	O
parser	pointer
)	O
)	O
!=	O
EOF	O
)	O
{	O
c	int
=	O
(	O
char	O
)	O
ci	int
;	O
if	O
(	O
rec_parser_letter_p	function
(	O
c	int
)	O
||	O
rec_parser_digit_p	function
(	O
c	int
)	O
||	O
(	O
c	int
==	O
'_'	O
)	O
)	O
{	O
if	O
(	O
rec_buf_putc	function
(	O
c	int
,	O
buf	pointer
)	O
==	O
EOF	O
)	O
{	O
parser	pointer
->	O
error	enum
=	O
REC_PARSER_ENOMEM	int
;	O
return	O
false	int
;	O
}	O
if	O
(	O
parser	pointer
->	O
error	enum
>	O
0	int
)	O
break	O
;	O
}	O
else	O
if	O
(	O
c	int
==	O
':'	O
)	O
break	O
;	O
else	O
{	O
parser	pointer
->	O
error	enum
=	O
REC_PARSER_EFNAME	int
;	O
ret	bool
=	O
false	int
;	O
break	O
;	O
}	O
}	O
if	O
(	O
parser	pointer
->	O
eof	bool
)	O
{	O
parser	pointer
->	O
error	enum
=	O
REC_PARSER_EFNAME	int
;	O
ret	bool
=	O
false	int
;	O
}	O
}	O
rec_buf_close	function
(	O
buf	pointer
)	O
;	O
if	O
(	O
!	O
ret	bool
)	O
free	function
(	O
*	O
fname	pointer
)	O
;	O
else	O
{	O
ci	int
=	O
rec_parser_getc	function
(	O
parser	pointer
)	O
;	O
if	O
(	O
ci	int
!=	O
EOF	O
)	O
{	O
c	int
=	O
(	O
char	O
)	O
ci	int
;	O
if	O
(	O
(	O
c	int
==	O
' '	O
)	O
||	O
(	O
c	int
==	O
'\t'	O
)	O
)	O
parser	pointer
->	O
error	enum
=	O
REC_PARSER_NOERROR	int
;	O
else	O
if	O
(	O
c	int
==	O
'\n'	O
)	O
{	O
parser	pointer
->	O
error	enum
=	O
REC_PARSER_NOERROR	int
;	O
rec_parser_ungetc	function
(	O
parser	pointer
,	O
c	int
)	O
;	O
}	O
else	O
rec_parser_ungetc	function
(	O
parser	pointer
,	O
c	int
)	O
;	O
}	O
}	O
return	O
ret	bool
;	O
}	O
void	O
rec_parser_reset	function
(	O
rec_parser_t	pointer
parser	pointer
)	O
{	O
parser	pointer
->	O
eof	bool
=	O
false	int
;	O
parser	pointer
->	O
error	enum
=	O
REC_PARSER_NOERROR	int
;	O
parser	pointer
->	O
p	pointer
=	O
parser	pointer
->	O
in_buffer	pointer
;	O
}	O
bool	bool
rec_parse_field	function
(	O
rec_parser_t	pointer
parser	pointer
,	O
rec_field_t	pointer
*	O
field	pointer
)	O
{	O
bool	bool
ret	bool
;	O
rec_field_t	pointer
new	pointer
;	O
char	O
*	O
field_name	pointer
;	O
char	O
*	O
field_value	pointer
;	O
size_t	long
location	long
;	O
size_t	long
char_location	long
;	O
if	O
(	O
rec_parser_eof	function
(	O
parser	pointer
)	O
||	O
rec_parser_error	function
(	O
parser	pointer
)	O
)	O
return	O
false	int
;	O
location	long
=	O
parser	pointer
->	O
line	long
;	O
char_location	long
=	O
parser	pointer
->	O
character	long
;	O
if	O
(	O
char_location	long
!=	O
0	int
)	O
char_location	long
++	O
;	O
ret	bool
=	O
rec_parse_field_name	function
(	O
parser	pointer
,	O
&	O
field_name	pointer
)	O
;	O
if	O
(	O
ret	bool
)	O
{	O
ret	bool
=	O
rec_parse_field_value	function
(	O
parser	pointer
,	O
&	O
field_value	pointer
)	O
;	O
if	O
(	O
ret	bool
)	O
{	O
new	pointer
=	O
rec_field_new	function
(	O
field_name	pointer
,	O
field_value	pointer
)	O
;	O
if	O
(	O
new	pointer
==	O
NULL	O
)	O
return	O
false	int
;	O
rec_field_set_source	function
(	O
new	pointer
,	O
parser	pointer
->	O
source	pointer
)	O
;	O
rec_field_set_location	function
(	O
new	pointer
,	O
location	long
)	O
;	O
rec_field_set_char_location	function
(	O
new	pointer
,	O
char_location	long
)	O
;	O
*	O
field	pointer
=	O
new	pointer
;	O
free	function
(	O
field_value	pointer
)	O
;	O
}	O
free	function
(	O
field_name	pointer
)	O
;	O
}	O
return	O
ret	bool
;	O
}	O
bool	bool
rec_parse_record	function
(	O
rec_parser_t	pointer
parser	pointer
,	O
rec_record_t	pointer
*	O
record	pointer
)	O
{	O
rec_record_t	pointer
new	pointer
;	O
rec_field_t	pointer
field	pointer
;	O
bool	bool
ret	bool
;	O
int	O
ci	int
;	O
char	O
c	int
;	O
rec_comment_t	pointer
comment	pointer
;	O
size_t	long
char_location	long
;	O
if	O
(	O
rec_parser_eof	function
(	O
parser	pointer
)	O
||	O
rec_parser_error	function
(	O
parser	pointer
)	O
)	O
return	O
false	int
;	O
new	pointer
=	O
rec_record_new	function
(	O
)	O
;	O
if	O
(	O
!	O
new	pointer
)	O
{	O
parser	pointer
->	O
error	enum
=	O
REC_PARSER_ENOMEM	int
;	O
return	O
false	int
;	O
}	O
rec_record_set_source	function
(	O
new	pointer
,	O
parser	pointer
->	O
source	pointer
)	O
;	O
rec_record_set_location	function
(	O
new	pointer
,	O
parser	pointer
->	O
line	long
)	O
;	O
char_location	long
=	O
parser	pointer
->	O
character	long
;	O
if	O
(	O
char_location	long
!=	O
0	int
)	O
char_location	long
++	O
;	O
rec_record_set_char_location	function
(	O
new	pointer
,	O
char_location	long
)	O
;	O
if	O
(	O
rec_parse_field	function
(	O
parser	pointer
,	O
&	O
field	pointer
)	O
)	O
rec_mset_append	function
(	O
rec_record_mset	function
(	O
new	pointer
)	O
,	O
MSET_FIELD	int
,	O
(	O
void	O
*	O
)	O
field	pointer
,	O
MSET_ANY	int
)	O
;	O
else	O
{	O
parser	pointer
->	O
error	enum
=	O
REC_PARSER_EFIELD	int
;	O
rec_record_destroy	function
(	O
new	pointer
)	O
;	O
*	O
record	pointer
=	O
NULL	O
;	O
return	O
false	int
;	O
}	O
ret	bool
=	O
true	int
;	O
while	O
(	O
(	O
ci	int
=	O
rec_parser_getc	function
(	O
parser	pointer
)	O
)	O
!=	O
EOF	O
)	O
{	O
c	int
=	O
(	O
char	O
)	O
ci	int
;	O
if	O
(	O
c	int
==	O
'#'	O
)	O
{	O
rec_parser_ungetc	function
(	O
parser	pointer
,	O
ci	int
)	O
;	O
if	O
(	O
rec_parse_comment	function
(	O
parser	pointer
,	O
&	O
comment	pointer
)	O
)	O
rec_mset_append	function
(	O
rec_record_mset	function
(	O
new	pointer
)	O
,	O
MSET_COMMENT	int
,	O
(	O
void	O
*	O
)	O
comment	pointer
,	O
MSET_ANY	int
)	O
;	O
}	O
else	O
if	O
(	O
(	O
c	int
==	O
' '	O
)	O
||	O
(	O
c	int
==	O
'\t'	O
)	O
)	O
{	O
while	O
(	O
(	O
ci	int
!=	O
EOF	O
)	O
&&	O
(	O
(	O
c	int
==	O
' '	O
)	O
||	O
(	O
c	int
==	O
'\t'	O
)	O
)	O
)	O
{	O
ci	int
=	O
rec_parser_getc	function
(	O
parser	pointer
)	O
;	O
c	int
=	O
(	O
char	O
)	O
ci	int
;	O
}	O
if	O
(	O
(	O
ci	int
==	O
EOF	O
)	O
||	O
(	O
c	int
==	O
'\n'	O
)	O
)	O
break	O
;	O
else	O
{	O
parser	pointer
->	O
error	enum
=	O
REC_PARSER_EFIELD	int
;	O
ret	bool
=	O
false	int
;	O
break	O
;	O
}	O
}	O
else	O
if	O
(	O
c	int
==	O
'\n'	O
)	O
break	O
;	O
else	O
{	O
rec_parser_ungetc	function
(	O
parser	pointer
,	O
ci	int
)	O
;	O
if	O
(	O
rec_parse_field	function
(	O
parser	pointer
,	O
&	O
field	pointer
)	O
)	O
rec_mset_append	function
(	O
rec_record_mset	function
(	O
new	pointer
)	O
,	O
MSET_FIELD	int
,	O
(	O
void	O
*	O
)	O
field	pointer
,	O
MSET_ANY	int
)	O
;	O
else	O
{	O
parser	pointer
->	O
error	enum
=	O
REC_PARSER_EFIELD	int
;	O
ret	bool
=	O
false	int
;	O
break	O
;	O
}	O
}	O
}	O
if	O
(	O
ret	bool
)	O
*	O
record	pointer
=	O
new	pointer
;	O
else	O
{	O
rec_record_destroy	function
(	O
new	pointer
)	O
;	O
*	O
record	pointer
=	O
NULL	O
;	O
}	O
return	O
ret	bool
;	O
}	O
bool	bool
rec_parse_rset	function
(	O
rec_parser_t	pointer
parser	pointer
,	O
rec_rset_t	pointer
*	O
rset	pointer
)	O
{	O
bool	bool
ret	bool
;	O
int	O
ci	int
;	O
char	O
c	int
;	O
rec_rset_t	pointer
new	pointer
;	O
rec_record_t	pointer
record	pointer
;	O
rec_comment_t	pointer
comment	pointer
;	O
size_t	long
comments_added	long
=	O
0	int
;	O
ret	bool
=	O
false	int
;	O
if	O
(	O
(	O
new	pointer
=	O
rec_rset_new	function
(	O
)	O
)	O
==	O
NULL	O
)	O
{	O
parser	pointer
->	O
error	enum
=	O
REC_PARSER_ENOMEM	int
;	O
return	O
false	int
;	O
}	O
rec_rset_set_descriptor	function
(	O
new	pointer
,	O
parser	pointer
->	O
prev_descriptor	pointer
)	O
;	O
parser	pointer
->	O
prev_descriptor	pointer
=	O
NULL	O
;	O
while	O
(	O
(	O
ci	int
=	O
rec_parser_getc	function
(	O
parser	pointer
)	O
)	O
!=	O
EOF	O
)	O
{	O
c	int
=	O
(	O
char	O
)	O
ci	int
;	O
if	O
(	O
(	O
c	int
==	O
'\n'	O
)	O
||	O
(	O
c	int
==	O
' '	O
)	O
||	O
(	O
c	int
==	O
'\t'	O
)	O
)	O
continue	O
;	O
else	O
if	O
(	O
c	int
==	O
'#'	O
)	O
{	O
rec_parser_ungetc	function
(	O
parser	pointer
,	O
c	int
)	O
;	O
rec_parse_comment	function
(	O
parser	pointer
,	O
&	O
comment	pointer
)	O
;	O
rec_mset_append	function
(	O
rec_rset_mset	function
(	O
new	pointer
)	O
,	O
MSET_COMMENT	int
,	O
(	O
void	O
*	O
)	O
comment	pointer
,	O
MSET_ANY	int
)	O
;	O
comments_added	long
++	O
;	O
}	O
else	O
{	O
rec_parser_ungetc	function
(	O
parser	pointer
,	O
c	int
)	O
;	O
if	O
(	O
rec_parse_record	function
(	O
parser	pointer
,	O
&	O
record	pointer
)	O
)	O
{	O
if	O
(	O
rec_record_field_p	function
(	O
record	pointer
,	O
FNAME	O
(	O
REC_FIELD_REC	int
)	O
)	O
)	O
{	O
if	O
(	O
(	O
rec_rset_num_records	function
(	O
new	pointer
)	O
==	O
0	int
)	O
&&	O
(	O
!	O
rec_rset_descriptor	function
(	O
new	pointer
)	O
)	O
)	O
{	O
rec_rset_set_descriptor	function
(	O
new	pointer
,	O
record	pointer
)	O
;	O
rec_rset_set_descriptor_pos	function
(	O
new	pointer
,	O
comments_added	long
)	O
;	O
}	O
else	O
{	O
parser	pointer
->	O
prev_descriptor	pointer
=	O
record	pointer
;	O
ret	bool
=	O
true	int
;	O
break	O
;	O
}	O
}	O
else	O
{	O
rec_record_set_container	function
(	O
record	pointer
,	O
new	pointer
)	O
;	O
rec_mset_append	function
(	O
rec_rset_mset	function
(	O
new	pointer
)	O
,	O
MSET_RECORD	int
,	O
(	O
void	O
*	O
)	O
record	pointer
,	O
MSET_ANY	int
)	O
;	O
}	O
}	O
else	O
{	O
parser	pointer
->	O
error	enum
=	O
REC_PARSER_ERECORD	int
;	O
break	O
;	O
}	O
}	O
}	O
if	O
(	O
(	O
parser	pointer
->	O
error	enum
==	O
REC_PARSER_NOERROR	int
)	O
&&	O
(	O
rec_rset_descriptor	function
(	O
new	pointer
)	O
||	O
(	O
rec_rset_num_records	function
(	O
new	pointer
)	O
>	O
0	int
)	O
)	O
)	O
ret	bool
=	O
true	int
;	O
if	O
(	O
ret	bool
)	O
*	O
rset	pointer
=	O
new	pointer
;	O
else	O
{	O
rec_rset_destroy	function
(	O
new	pointer
)	O
;	O
*	O
rset	pointer
=	O
NULL	O
;	O
}	O
return	O
ret	bool
;	O
}	O
bool	bool
rec_parse_db	function
(	O
rec_parser_t	pointer
parser	pointer
,	O
rec_db_t	pointer
*	O
db	pointer
)	O
{	O
bool	bool
ret	bool
;	O
rec_rset_t	pointer
rset	pointer
;	O
rec_db_t	pointer
new	pointer
;	O
ret	bool
=	O
true	int
;	O
new	pointer
=	O
rec_db_new	function
(	O
)	O
;	O
if	O
(	O
!	O
new	pointer
)	O
return	O
false	int
;	O
while	O
(	O
rec_parse_rset	function
(	O
parser	pointer
,	O
&	O
rset	pointer
)	O
)	O
{	O
if	O
(	O
!	O
rec_db_insert_rset	function
(	O
new	pointer
,	O
rset	pointer
,	O
rec_db_size	function
(	O
new	pointer
)	O
)	O
)	O
{	O
parser	pointer
->	O
error	enum
=	O
REC_PARSER_ENOMEM	int
;	O
ret	bool
=	O
false	int
;	O
break	O
;	O
}	O
}	O
if	O
(	O
!	O
rec_parser_eof	function
(	O
parser	pointer
)	O
)	O
ret	bool
=	O
false	int
;	O
if	O
(	O
ret	bool
)	O
*	O
db	pointer
=	O
new	pointer
;	O
return	O
ret	bool
;	O
}	O
char	O
*	O
rec_parse_field_name_str	function
(	O
const	O
char	O
*	O
str	pointer
)	O
{	O
rec_parser_t	pointer
parser	pointer
;	O
char	O
*	O
field_name	pointer
=	O
NULL	O
;	O
char	O
*	O
str2	pointer
;	O
size_t	long
str_size	pointer
;	O
str_size	pointer
=	O
strlen	function
(	O
str	pointer
)	O
;	O
str2	pointer
=	O
malloc	function
(	O
str_size	pointer
+	O
2	int
)	O
;	O
if	O
(	O
!	O
str2	pointer
)	O
return	O
NULL	O
;	O
memcpy	function
(	O
str2	pointer
,	O
str	pointer
,	O
str_size	pointer
)	O
;	O
if	O
(	O
str_size	pointer
>	O
0	int
&&	O
str2	pointer
[	O
str_size	pointer
-	O
1	int
]	O
==	O
':'	O
)	O
str2	pointer
[	O
str_size	pointer
]	O
=	O
'\0'	O
;	O
else	O
{	O
str2	pointer
[	O
str_size	pointer
]	O
=	O
':'	O
;	O
str2	pointer
[	O
str_size	pointer
+	O
1	int
]	O
=	O
'\0'	O
;	O
}	O
parser	pointer
=	O
rec_parser_new_str	function
(	O
str2	pointer
,	O
"dummy"	pointer
)	O
;	O
if	O
(	O
!	O
rec_parse_field_name	function
(	O
parser	pointer
,	O
&	O
field_name	pointer
)	O
)	O
field_name	pointer
=	O
NULL	O
;	O
if	O
(	O
!	O
rec_parser_eof	function
(	O
parser	pointer
)	O
)	O
{	O
free	function
(	O
field_name	pointer
)	O
;	O
field_name	pointer
=	O
NULL	O
;	O
}	O
rec_parser_destroy	function
(	O
parser	pointer
)	O
;	O
free	function
(	O
str2	pointer
)	O
;	O
return	O
field_name	pointer
;	O
}	O
rec_record_t	pointer
rec_parse_record_str	function
(	O
const	O
char	O
*	O
str	pointer
)	O
{	O
rec_parser_t	pointer
parser	pointer
;	O
rec_record_t	pointer
record	pointer
;	O
record	pointer
=	O
NULL	O
;	O
parser	pointer
=	O
rec_parser_new_str	function
(	O
str	pointer
,	O
"dummy"	pointer
)	O
;	O
if	O
(	O
parser	pointer
)	O
{	O
if	O
(	O
!	O
rec_parse_record	function
(	O
parser	pointer
,	O
&	O
record	pointer
)	O
)	O
record	pointer
=	O
NULL	O
;	O
rec_parser_destroy	function
(	O
parser	pointer
)	O
;	O
}	O
return	O
record	pointer
;	O
}	O
bool	bool
rec_parser_seek	function
(	O
rec_parser_t	pointer
parser	pointer
,	O
size_t	long
line_number	long
,	O
size_t	long
position	long
)	O
{	O
if	O
(	O
parser	pointer
->	O
in_file	pointer
)	O
{	O
if	O
(	O
fseek	function
(	O
parser	pointer
->	O
in_file	pointer
,	O
position	long
,	O
SEEK_SET	int
)	O
)	O
return	O
false	int
;	O
}	O
else	O
if	O
(	O
parser	pointer
->	O
in_buffer	pointer
)	O
{	O
if	O
(	O
position	long
>	O
parser	pointer
->	O
in_size	long
)	O
return	O
false	int
;	O
parser	pointer
->	O
p	pointer
=	O
parser	pointer
->	O
in_buffer	pointer
+	O
position	long
;	O
}	O
else	O
{	O
fprintf	function
(	O
stderr	pointer
,	O
"rec_parser_seek: no backend in parser. This is a bug.  Please report it."	pointer
)	O
;	O
return	O
false	int
;	O
}	O
parser	pointer
->	O
line	long
=	O
line_number	long
;	O
parser	pointer
->	O
character	long
=	O
position	long
;	O
return	O
true	int
;	O
}	O
long	O
rec_parser_tell	function
(	O
rec_parser_t	pointer
parser	pointer
)	O
{	O
if	O
(	O
parser	pointer
->	O
in_file	pointer
)	O
return	O
ftell	function
(	O
parser	pointer
->	O
in_file	pointer
)	O
;	O
else	O
if	O
(	O
parser	pointer
->	O
in_buffer	pointer
)	O
return	O
parser	pointer
->	O
p	pointer
-	O
parser	pointer
->	O
in_buffer	pointer
;	O
else	O
{	O
fprintf	function
(	O
stderr	pointer
,	O
"rec_parser_seek: no backend in parser. This is a bug.  Please report it."	pointer
)	O
;	O
return	O
-	O
1	int
;	O
}	O
}	O
static	O
int	O
rec_parser_getc	function
(	O
rec_parser_t	pointer
parser	pointer
)	O
{	O
int	O
ci	int
;	O
if	O
(	O
parser	pointer
->	O
in_file	pointer
)	O
ci	int
=	O
getc	function
(	O
parser	pointer
->	O
in_file	pointer
)	O
;	O
else	O
if	O
(	O
parser	pointer
->	O
in_buffer	pointer
)	O
{	O
if	O
(	O
parser	pointer
->	O
p	pointer
==	O
parser	pointer
->	O
in_buffer	pointer
+	O
parser	pointer
->	O
in_size	long
)	O
ci	int
=	O
EOF	O
;	O
else	O
{	O
ci	int
=	O
*	O
(	O
parser	pointer
->	O
p	pointer
)	O
;	O
parser	pointer
->	O
p	pointer
++	O
;	O
}	O
}	O
else	O
{	O
fprintf	function
(	O
stderr	pointer
,	O
"rec_parser_getc: no backend in parser. This is a bug.  Please report it."	pointer
)	O
;	O
return	O
EOF	O
;	O
}	O
if	O
(	O
ci	int
==	O
EOF	O
)	O
parser	pointer
->	O
eof	bool
=	O
true	int
;	O
else	O
{	O
parser	pointer
->	O
character	long
++	O
;	O
if	O
(	O
(	O
(	O
char	O
)	O
ci	int
)	O
==	O
'\n'	O
)	O
parser	pointer
->	O
line	long
++	O
;	O
}	O
return	O
ci	int
;	O
}	O
int	O
rec_parser_ungetc	function
(	O
rec_parser_t	pointer
parser	pointer
,	O
int	O
ci	int
)	O
{	O
int	O
res	int
;	O
parser	pointer
->	O
character	long
--	O
;	O
if	O
(	O
(	O
(	O
char	O
)	O
ci	int
)	O
==	O
'\n'	O
)	O
parser	pointer
->	O
line	long
--	O
;	O
if	O
(	O
parser	pointer
->	O
in_file	pointer
)	O
{	O
res	int
=	O
ungetc	function
(	O
ci	int
,	O
parser	pointer
->	O
in_file	pointer
)	O
;	O
if	O
(	O
res	int
!=	O
ci	int
)	O
parser	pointer
->	O
error	enum
=	O
REC_PARSER_EUNGETC	int
;	O
}	O
else	O
if	O
(	O
parser	pointer
->	O
in_buffer	pointer
)	O
{	O
if	O
(	O
parser	pointer
->	O
p	pointer
>	O
parser	pointer
->	O
in_buffer	pointer
)	O
{	O
res	int
=	O
ci	int
;	O
parser	pointer
->	O
p	pointer
--	O
;	O
}	O
else	O
{	O
res	int
=	O
EOF	O
;	O
parser	pointer
->	O
error	enum
=	O
REC_PARSER_EUNGETC	int
;	O
}	O
}	O
else	O
{	O
fprintf	function
(	O
stderr	pointer
,	O
"rec_parser_ungetc: no backend in parser. This is a bug.  Please report it."	pointer
)	O
;	O
return	O
EOF	O
;	O
}	O
return	O
res	int
;	O
}	O
static	O
bool	bool
rec_parser_digit_p	function
(	O
char	O
c	int
)	O
{	O
return	O
(	O
(	O
c	int
>=	O
'0'	O
)	O
&&	O
(	O
c	int
<=	O
'9'	O
)	O
)	O
;	O
}	O
static	O
bool	bool
rec_parser_letter_p	function
(	O
char	O
c	int
)	O
{	O
return	O
(	O
(	O
(	O
c	int
>=	O
'A'	O
)	O
&&	O
(	O
c	int
<=	O
'Z'	O
)	O
)	O
||	O
(	O
(	O
c	int
>=	O
'a'	O
)	O
&&	O
(	O
c	int
<=	O
'z'	O
)	O
)	O
)	O
;	O
}	O
static	O
bool	bool
rec_expect	function
(	O
rec_parser_t	pointer
parser	pointer
,	O
const	O
char	O
*	O
str	pointer
)	O
{	O
size_t	long
str_size	pointer
;	O
size_t	long
counter	long
;	O
bool	bool
found	bool
;	O
int	O
ci	int
;	O
char	O
c	int
;	O
found	bool
=	O
true	int
;	O
str_size	pointer
=	O
strlen	function
(	O
str	pointer
)	O
;	O
for	O
(	O
counter	long
=	O
0	int
;	O
counter	long
<	O
str_size	pointer
;	O
counter	long
++	O
)	O
{	O
ci	int
=	O
rec_parser_getc	function
(	O
parser	pointer
)	O
;	O
if	O
(	O
ci	int
==	O
EOF	O
)	O
{	O
found	bool
=	O
false	int
;	O
parser	pointer
->	O
eof	bool
=	O
true	int
;	O
break	O
;	O
}	O
else	O
{	O
c	int
=	O
(	O
char	O
)	O
ci	int
;	O
if	O
(	O
c	int
!=	O
str	pointer
[	O
counter	long
]	O
)	O
{	O
rec_parser_ungetc	function
(	O
parser	pointer
,	O
ci	int
)	O
;	O
found	bool
=	O
false	int
;	O
break	O
;	O
}	O
}	O
}	O
return	O
found	bool
;	O
}	O
static	O
bool	bool
rec_parse_field_value	function
(	O
rec_parser_t	pointer
parser	pointer
,	O
char	O
*	O
*	O
str	pointer
)	O
{	O
bool	bool
ret	bool
;	O
int	O
ci	int
,	O
ci2	int
;	O
char	O
c	int
,	O
c2	char
;	O
size_t	long
str_size	pointer
;	O
bool	bool
prev_newline	bool
;	O
rec_buf_t	pointer
buf	pointer
;	O
if	O
(	O
rec_parser_eof	function
(	O
parser	pointer
)	O
||	O
rec_parser_error	function
(	O
parser	pointer
)	O
)	O
return	O
false	int
;	O
c	int
=	O
'\0'	O
;	O
prev_newline	bool
=	O
false	int
;	O
ret	bool
=	O
true	int
;	O
buf	pointer
=	O
rec_buf_new	function
(	O
str	pointer
,	O
&	O
str_size	pointer
)	O
;	O
if	O
(	O
!	O
buf	pointer
)	O
{	O
parser	pointer
->	O
error	enum
=	O
REC_PARSER_ENOMEM	int
;	O
return	O
false	int
;	O
}	O
while	O
(	O
(	O
ci	int
=	O
rec_parser_getc	function
(	O
parser	pointer
)	O
)	O
!=	O
EOF	O
)	O
{	O
c	int
=	O
(	O
char	O
)	O
ci	int
;	O
if	O
(	O
(	O
prev_newline	bool
)	O
&&	O
(	O
c	int
!=	O
'+'	O
)	O
)	O
{	O
rec_parser_ungetc	function
(	O
parser	pointer
,	O
ci	int
)	O
;	O
rec_buf_rewind	function
(	O
buf	pointer
,	O
1	int
)	O
;	O
break	O
;	O
}	O
if	O
(	O
c	int
==	O
'\\'	O
)	O
{	O
ci2	int
=	O
rec_parser_getc	function
(	O
parser	pointer
)	O
;	O
if	O
(	O
ci2	int
==	O
EOF	O
)	O
{	O
parser	pointer
->	O
eof	bool
=	O
true	int
;	O
ret	bool
=	O
false	int
;	O
break	O
;	O
}	O
else	O
{	O
c2	char
=	O
(	O
char	O
)	O
ci2	int
;	O
if	O
(	O
c2	char
==	O
'\n'	O
)	O
{	O
}	O
else	O
{	O
if	O
(	O
rec_buf_putc	function
(	O
c	int
,	O
buf	pointer
)	O
==	O
EOF	O
)	O
{	O
parser	pointer
->	O
error	enum
=	O
REC_PARSER_ENOMEM	int
;	O
return	O
false	int
;	O
}	O
if	O
(	O
parser	pointer
->	O
error	enum
>	O
0	int
)	O
{	O
break	O
;	O
}	O
if	O
(	O
rec_parser_ungetc	function
(	O
parser	pointer
,	O
ci2	int
)	O
!=	O
ci2	int
)	O
{	O
ret	bool
=	O
false	int
;	O
break	O
;	O
}	O
}	O
}	O
prev_newline	bool
=	O
false	int
;	O
}	O
else	O
if	O
(	O
c	int
==	O
'+'	O
)	O
{	O
if	O
(	O
prev_newline	bool
)	O
{	O
ci2	int
=	O
rec_parser_getc	function
(	O
parser	pointer
)	O
;	O
if	O
(	O
ci2	int
==	O
EOF	O
)	O
{	O
parser	pointer
->	O
eof	bool
=	O
true	int
;	O
ret	bool
=	O
false	int
;	O
break	O
;	O
}	O
else	O
{	O
c2	char
=	O
(	O
char	O
)	O
ci2	int
;	O
if	O
(	O
c2	char
!=	O
' '	O
)	O
{	O
if	O
(	O
rec_parser_ungetc	function
(	O
parser	pointer
,	O
ci2	int
)	O
!=	O
ci2	int
)	O
{	O
ret	bool
=	O
false	int
;	O
break	O
;	O
}	O
}	O
}	O
}	O
else	O
{	O
if	O
(	O
rec_buf_putc	function
(	O
c	int
,	O
buf	pointer
)	O
==	O
EOF	O
)	O
{	O
parser	pointer
->	O
error	enum
=	O
REC_PARSER_ENOMEM	int
;	O
return	O
false	int
;	O
}	O
if	O
(	O
parser	pointer
->	O
error	enum
>	O
0	int
)	O
break	O
;	O
}	O
prev_newline	bool
=	O
false	int
;	O
}	O
else	O
if	O
(	O
c	int
==	O
'\n'	O
)	O
{	O
if	O
(	O
rec_buf_putc	function
(	O
c	int
,	O
buf	pointer
)	O
==	O
EOF	O
)	O
{	O
parser	pointer
->	O
error	enum
=	O
REC_PARSER_ENOMEM	int
;	O
return	O
false	int
;	O
}	O
if	O
(	O
parser	pointer
->	O
error	enum
>	O
0	int
)	O
break	O
;	O
prev_newline	bool
=	O
true	int
;	O
}	O
else	O
{	O
if	O
(	O
rec_buf_putc	function
(	O
c	int
,	O
buf	pointer
)	O
==	O
EOF	O
)	O
{	O
parser	pointer
->	O
error	enum
=	O
REC_PARSER_ENOMEM	int
;	O
return	O
false	int
;	O
}	O
if	O
(	O
parser	pointer
->	O
error	enum
>	O
0	int
)	O
break	O
;	O
prev_newline	bool
=	O
false	int
;	O
}	O
}	O
if	O
(	O
ret	bool
)	O
{	O
if	O
(	O
rec_parser_eof	function
(	O
parser	pointer
)	O
&&	O
(	O
c	int
==	O
'\n'	O
)	O
)	O
rec_buf_rewind	function
(	O
buf	pointer
,	O
1	int
)	O
;	O
}	O
rec_buf_close	function
(	O
buf	pointer
)	O
;	O
if	O
(	O
!	O
ret	bool
)	O
free	function
(	O
*	O
str	pointer
)	O
;	O
return	O
ret	bool
;	O
}	O
static	O
bool	bool
rec_parse_comment	function
(	O
rec_parser_t	pointer
parser	pointer
,	O
rec_comment_t	pointer
*	O
comment	pointer
)	O
{	O
bool	bool
ret	bool
;	O
rec_buf_t	pointer
buf	pointer
;	O
char	O
*	O
str	pointer
;	O
size_t	long
str_size	pointer
;	O
int	O
ci	int
;	O
char	O
c	int
;	O
ret	bool
=	O
false	int
;	O
buf	pointer
=	O
rec_buf_new	function
(	O
&	O
str	pointer
,	O
&	O
str_size	pointer
)	O
;	O
if	O
(	O
rec_expect	function
(	O
parser	pointer
,	O
"#"	pointer
)	O
)	O
{	O
while	O
(	O
(	O
ci	int
=	O
rec_parser_getc	function
(	O
parser	pointer
)	O
)	O
!=	O
EOF	O
)	O
{	O
c	int
=	O
(	O
char	O
)	O
ci	int
;	O
if	O
(	O
c	int
==	O
'\n'	O
)	O
{	O
if	O
(	O
(	O
ci	int
=	O
rec_parser_getc	function
(	O
parser	pointer
)	O
)	O
==	O
EOF	O
)	O
break	O
;	O
c	int
=	O
(	O
char	O
)	O
ci	int
;	O
if	O
(	O
c	int
!=	O
'#'	O
)	O
{	O
rec_parser_ungetc	function
(	O
parser	pointer
,	O
ci	int
)	O
;	O
break	O
;	O
}	O
else	O
c	int
=	O
'\n'	O
;	O
}	O
if	O
(	O
rec_buf_putc	function
(	O
c	int
,	O
buf	pointer
)	O
==	O
EOF	O
)	O
{	O
parser	pointer
->	O
error	enum
=	O
REC_PARSER_ENOMEM	int
;	O
return	O
false	int
;	O
}	O
}	O
ret	bool
=	O
true	int
;	O
}	O
rec_buf_close	function
(	O
buf	pointer
)	O
;	O
if	O
(	O
ret	bool
)	O
*	O
comment	pointer
=	O
rec_comment_new	function
(	O
str	pointer
)	O
;	O
else	O
*	O
comment	pointer
=	O
NULL	O
;	O
free	function
(	O
str	pointer
)	O
;	O
return	O
ret	bool
;	O
}	O
static	O
bool	bool
rec_parser_init_common	function
(	O
rec_parser_t	pointer
parser	pointer
,	O
const	O
char	O
*	O
source	pointer
)	O
{	O
if	O
(	O
source	pointer
)	O
{	O
parser	pointer
->	O
source	pointer
=	O
strdup	function
(	O
source	pointer
)	O
;	O
if	O
(	O
!	O
parser	pointer
->	O
source	pointer
)	O
return	O
false	int
;	O
}	O
else	O
parser	pointer
->	O
source	pointer
=	O
NULL	O
;	O
parser	pointer
->	O
eof	bool
=	O
false	int
;	O
parser	pointer
->	O
error	enum
=	O
REC_PARSER_NOERROR	int
;	O
parser	pointer
->	O
line	long
=	O
1	int
;	O
parser	pointer
->	O
character	long
=	O
0	int
;	O
parser	pointer
->	O
prev_descriptor	pointer
=	O
NULL	O
;	O
parser	pointer
->	O
p	pointer
=	O
parser	pointer
->	O
in_buffer	pointer
;	O
return	O
true	int
;	O
}	O
