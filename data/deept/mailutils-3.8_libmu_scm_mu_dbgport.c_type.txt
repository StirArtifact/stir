struct	O
_mu_debug_port	struct
{	O
mu_stream_t	pointer
stream	pointer
;	O
int	O
level	int
;	O
}	O
;	O
static	O
scm_t_port_type	O
*	O
scm_mu_debug_port_type	pointer
;	O
SCM	function
mu_scm_make_debug_port	function
(	O
int	O
level	int
)	O
{	O
struct	O
_mu_debug_port	struct
*	O
dp	pointer
;	O
mu_stream_t	pointer
str	pointer
;	O
if	O
(	O
mu_dbgstream_create	function
(	O
&	O
str	pointer
,	O
level	int
)	O
)	O
return	O
SCM_BOOL_F	O
;	O
dp	pointer
=	O
scm_gc_typed_calloc	function
(	O
struct	O
_mu_debug_port	struct
)	O
;	O
dp	pointer
->	O
level	int
=	O
level	int
;	O
dp	pointer
->	O
stream	pointer
=	O
str	pointer
;	O
return	O
scm_c_make_port	function
(	O
scm_mu_debug_port_type	pointer
,	O
SCM_BUF0	O
|	O
SCM_WRTNG	O
,	O
(	O
scm_t_bits	O
)	O
dp	pointer
)	O
;	O
}	O
static	O
void	O
_mu_debug_port_close	function
(	O
SCM	function
port	int
)	O
{	O
struct	O
_mu_debug_port	struct
*	O
dp	pointer
=	O
MU_DEBUG_PORT	O
(	O
port	int
)	O
;	O
if	O
(	O
dp	pointer
&&	O
dp	pointer
->	O
stream	pointer
)	O
{	O
mu_stream_flush	function
(	O
dp	pointer
->	O
stream	pointer
)	O
;	O
mu_stream_destroy	function
(	O
&	O
dp	pointer
->	O
stream	pointer
)	O
;	O
}	O
}	O
static	O
size_t	long
_mu_debug_port_write	function
(	O
SCM	function
port	int
,	O
SCM	function
src	pointer
,	O
size_t	long
start	long
,	O
size_t	long
count	pointer
)	O
{	O
struct	O
_mu_debug_port	struct
*	O
dp	pointer
=	O
MU_DEBUG_PORT	O
(	O
port	int
)	O
;	O
mu_stream_write	function
(	O
dp	pointer
->	O
stream	pointer
,	O
SCM_BYTEVECTOR_CONTENTS	function
(	O
src	pointer
)	O
+	O
start	long
,	O
count	pointer
,	O
NULL	O
)	O
;	O
return	O
count	pointer
;	O
}	O
static	O
int	O
_mu_debug_port_print	function
(	O
SCM	function
exp	int
,	O
SCM	function
port	int
,	O
scm_print_state	O
*	O
pstate	pointer
)	O
{	O
scm_puts	function
(	O
"#<Mailutis debug port>"	pointer
,	O
port	int
)	O
;	O
return	O
1	int
;	O
}	O
void	O
mu_scm_debug_port_init	function
(	O
void	O
)	O
{	O
scm_mu_debug_port_type	pointer
=	O
scm_make_port_type	function
(	O
"mu-debug-port"	pointer
,	O
NULL	O
,	O
_mu_debug_port_write	function
)	O
;	O
scm_set_port_print	function
(	O
scm_mu_debug_port_type	pointer
,	O
_mu_debug_port_print	function
)	O
;	O
scm_set_port_close	function
(	O
scm_mu_debug_port_type	pointer
,	O
_mu_debug_port_close	function
)	O
;	O
scm_set_port_needs_close_on_gc	function
(	O
scm_mu_debug_port_type	pointer
,	O
1	int
)	O
;	O
}	O
