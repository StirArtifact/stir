static	O
void	O
_write_out	function
(	O
FILE	struct
*	O
default_fp	pointer
,	O
const	O
char	O
*	O
data	pointer
,	O
size_t	long
len	long
,	O
int	O
with_timestamp	int
,	O
const	O
char	O
_U_WIN32	O
*	O
colorstring	pointer
,	O
wget_console_color	enum
_U	O
color_id	enum
)	O
{	O
FILE	struct
*	O
fp	pointer
;	O
int	O
fd	int
=	O
-	O
1	int
;	O
if	O
(	O
!	O
data	pointer
||	O
(	O
ssize_t	long
)	O
len	long
<=	O
0	int
)	O
return	O
;	O
if	O
(	O
!	O
config	struct
.	O
logfile	pointer
)	O
{	O
fp	pointer
=	O
default_fp	pointer
;	O
}	O
else	O
if	O
(	O
!	O
strcmp	function
(	O
config	struct
.	O
logfile	pointer
,	O
"-"	pointer
)	O
)	O
{	O
fp	pointer
=	O
stdout	pointer
;	O
}	O
else	O
{	O
fp	pointer
=	O
NULL	O
;	O
if	O
(	O
!	O
config	struct
.	O
dont_write	char
)	O
fd	int
=	O
open	function
(	O
config	struct
.	O
logfile	pointer
,	O
O_WRONLY	int
|	O
O_APPEND	int
|	O
O_CREAT	int
,	O
S_IRUSR	O
|	O
S_IWUSR	O
|	O
S_IRGRP	O
|	O
S_IROTH	O
)	O
;	O
if	O
(	O
fd	int
==	O
-	O
1	int
)	O
fp	pointer
=	O
default_fp	pointer
;	O
}	O
char	O
sbuf	array
[	O
4096	int
]	O
;	O
wget_buffer	struct
buf	pointer
;	O
wget_buffer_init	function
(	O
&	O
buf	pointer
,	O
sbuf	array
,	O
sizeof	O
(	O
sbuf	array
)	O
)	O
;	O
int	O
use_color	int
=	O
0	int
;	O
if	O
(	O
fp	pointer
&&	O
colorstring	pointer
&&	O
isatty	function
(	O
fileno	function
(	O
fp	pointer
)	O
)	O
)	O
use_color	int
=	O
1	int
;	O
if	O
(	O
use_color	int
)	O
wget_buffer_strcpy	function
(	O
&	O
buf	pointer
,	O
colorstring	pointer
)	O
;	O
if	O
(	O
with_timestamp	int
)	O
{	O
struct	O
timespec	struct
ts	struct
;	O
struct	O
tm	struct
*	O
tp	pointer
,	O
tbuf	struct
;	O
gettime	function
(	O
&	O
ts	struct
)	O
;	O
tp	pointer
=	O
localtime_r	function
(	O
(	O
const	O
time_t	long
*	O
)	O
&	O
ts	struct
.	O
tv_sec	long
,	O
&	O
tbuf	struct
)	O
;	O
wget_buffer_printf_append	function
(	O
&	O
buf	pointer
,	O
"%02d.%02d%02d%02d.%03d "	pointer
,	O
tp	pointer
->	O
tm_mday	int
,	O
tp	pointer
->	O
tm_hour	int
,	O
tp	pointer
->	O
tm_min	int
,	O
tp	pointer
->	O
tm_sec	int
,	O
(	O
int	O
)	O
(	O
ts	struct
.	O
tv_nsec	long
/	O
1000000	int
)	O
)	O
;	O
}	O
wget_buffer_memcat	function
(	O
&	O
buf	pointer
,	O
data	pointer
,	O
len	long
)	O
;	O
if	O
(	O
data	pointer
[	O
len	long
-	O
1	int
]	O
!=	O
'\n'	O
)	O
wget_buffer_memcat	function
(	O
&	O
buf	pointer
,	O
"\n"	pointer
,	O
1	int
)	O
;	O
if	O
(	O
use_color	int
)	O
wget_buffer_strcat	function
(	O
&	O
buf	pointer
,	O
"\033[m"	pointer
)	O
;	O
if	O
(	O
fp	pointer
)	O
{	O
fwrite	function
(	O
buf	pointer
.	O
data	pointer
,	O
1	int
,	O
buf	pointer
.	O
length	long
,	O
fp	pointer
)	O
;	O
}	O
else	O
if	O
(	O
fd	int
!=	O
-	O
1	int
)	O
{	O
if	O
(	O
write	pointer
(	O
fd	int
,	O
buf	pointer
.	O
data	pointer
,	O
buf	pointer
.	O
length	long
)	O
==	O
-	O
1	int
)	O
fwrite	function
(	O
buf	pointer
.	O
data	pointer
,	O
1	int
,	O
buf	pointer
.	O
length	long
,	O
stderr	pointer
)	O
;	O
close	pointer
(	O
fd	int
)	O
;	O
}	O
wget_buffer_deinit	function
(	O
&	O
buf	pointer
)	O
;	O
}	O
static	O
void	O
_write_debug	function
(	O
FILE	struct
*	O
fp	pointer
,	O
const	O
char	O
*	O
data	pointer
,	O
size_t	long
len	long
)	O
{	O
_write_out	function
(	O
fp	pointer
,	O
data	pointer
,	O
len	long
,	O
1	int
,	O
"\033[35m"	pointer
,	O
WGET_CONSOLE_COLOR_MAGENTA	int
)	O
;	O
}	O
static	O
void	O
_write_error	function
(	O
FILE	struct
*	O
fp	pointer
,	O
const	O
char	O
*	O
data	pointer
,	O
size_t	long
len	long
)	O
{	O
_write_out	function
(	O
fp	pointer
,	O
data	pointer
,	O
len	long
,	O
0	int
,	O
"\033[31m"	pointer
,	O
WGET_CONSOLE_COLOR_RED	int
)	O
;	O
}	O
static	O
void	O
_write_info	function
(	O
FILE	struct
*	O
fp	pointer
,	O
const	O
char	O
*	O
data	pointer
,	O
size_t	long
len	long
)	O
{	O
if	O
(	O
!	O
data	pointer
||	O
(	O
ssize_t	long
)	O
len	long
<=	O
0	int
)	O
return	O
;	O
_write_out	function
(	O
fp	pointer
,	O
data	pointer
,	O
len	long
,	O
0	int
,	O
NULL	O
,	O
WGET_CONSOLE_COLOR_WHITE	int
)	O
;	O
}	O
static	O
void	O
_write_debug_stderr	function
(	O
const	O
char	O
*	O
data	pointer
,	O
size_t	long
len	long
)	O
{	O
_write_debug	function
(	O
stderr	pointer
,	O
data	pointer
,	O
len	long
)	O
;	O
}	O
static	O
void	O
WGET_GCC_UNUSED	O
_write_debug_stdout	function
(	O
const	O
char	O
*	O
data	pointer
,	O
size_t	long
len	long
)	O
{	O
_write_debug	function
(	O
stdout	pointer
,	O
data	pointer
,	O
len	long
)	O
;	O
}	O
static	O
void	O
_write_error_stderr	function
(	O
const	O
char	O
*	O
data	pointer
,	O
size_t	long
len	long
)	O
{	O
_write_error	function
(	O
stderr	pointer
,	O
data	pointer
,	O
len	long
)	O
;	O
}	O
static	O
void	O
_write_error_stdout	function
(	O
const	O
char	O
*	O
data	pointer
,	O
size_t	long
len	long
)	O
{	O
_write_error	function
(	O
stdout	pointer
,	O
data	pointer
,	O
len	long
)	O
;	O
}	O
static	O
void	O
_write_info_stderr	function
(	O
const	O
char	O
*	O
data	pointer
,	O
size_t	long
len	long
)	O
{	O
_write_info	function
(	O
stderr	pointer
,	O
data	pointer
,	O
len	long
)	O
;	O
}	O
static	O
void	O
_write_info_stdout	function
(	O
const	O
char	O
*	O
data	pointer
,	O
size_t	long
len	long
)	O
{	O
_write_info	function
(	O
stdout	pointer
,	O
data	pointer
,	O
len	long
)	O
;	O
}	O
void	O
log_write_error_stdout	function
(	O
const	O
char	O
*	O
data	pointer
,	O
size_t	long
len	long
)	O
{	O
_write_error_stdout	function
(	O
data	pointer
,	O
len	long
)	O
;	O
}	O
void	O
log_init	function
(	O
void	O
)	O
{	O
wget_console_init	function
(	O
)	O
;	O
wget_logger_set_func	function
(	O
wget_get_logger	function
(	O
WGET_LOGGER_DEBUG	int
)	O
,	O
config	struct
.	O
debug	int
?	O
_write_debug_stderr	function
:	O
NULL	O
)	O
;	O
wget_logger_set_func	function
(	O
wget_get_logger	function
(	O
WGET_LOGGER_ERROR	int
)	O
,	O
config	struct
.	O
quiet	char
?	O
NULL	O
:	O
_write_error_stderr	function
)	O
;	O
wget_logger_set_func	function
(	O
wget_get_logger	function
(	O
WGET_LOGGER_INFO	int
)	O
,	O
config	struct
.	O
verbose	char
&&	O
!	O
config	struct
.	O
quiet	char
?	O
(	O
fileno	function
(	O
stdout	pointer
)	O
==	O
fileno	function
(	O
stderr	pointer
)	O
?	O
_write_info_stderr	function
:	O
_write_info_stdout	function
)	O
:	O
NULL	O
)	O
;	O
}	O
