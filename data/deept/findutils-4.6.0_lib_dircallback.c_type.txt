int	O
run_in_dir	function
(	O
const	O
struct	O
saved_cwd	struct
*	O
there	pointer
,	O
int	O
(	O
*	O
callback	pointer
)	O
(	O
void	O
*	O
)	O
,	O
void	O
*	O
usercontext	pointer
)	O
{	O
int	O
err	int
=	O
-	O
1	int
;	O
int	O
saved_errno	int
=	O
0	int
;	O
struct	O
saved_cwd	struct
here	struct
;	O
if	O
(	O
0	int
==	O
save_cwd	function
(	O
&	O
here	struct
)	O
)	O
{	O
if	O
(	O
0	int
==	O
restore_cwd	function
(	O
there	pointer
)	O
)	O
{	O
err	int
=	O
callback	pointer
(	O
usercontext	pointer
)	O
;	O
saved_errno	int
=	O
(	O
err	int
<	O
0	int
?	O
errno	O
:	O
0	int
)	O
;	O
}	O
else	O
{	O
openat_restore_fail	function
(	O
errno	O
)	O
;	O
}	O
if	O
(	O
restore_cwd	function
(	O
&	O
here	struct
)	O
!=	O
0	int
)	O
openat_restore_fail	function
(	O
errno	O
)	O
;	O
free_cwd	function
(	O
&	O
here	struct
)	O
;	O
}	O
else	O
{	O
openat_save_fail	function
(	O
errno	O
)	O
;	O
}	O
if	O
(	O
saved_errno	int
)	O
errno	O
=	O
saved_errno	int
;	O
return	O
err	int
;	O
}	O
int	O
run_in_dirfd	function
(	O
int	O
dir_fd	int
,	O
int	O
(	O
*	O
callback	pointer
)	O
(	O
void	O
*	O
)	O
,	O
void	O
*	O
usercontext	pointer
)	O
{	O
if	O
(	O
dir_fd	int
==	O
AT_FDCWD	O
)	O
{	O
return	O
(	O
*	O
callback	pointer
)	O
(	O
usercontext	pointer
)	O
;	O
}	O
else	O
{	O
struct	O
saved_cwd	struct
saved_cwd	struct
;	O
int	O
saved_errno	int
;	O
int	O
err	int
;	O
if	O
(	O
save_cwd	function
(	O
&	O
saved_cwd	struct
)	O
!=	O
0	int
)	O
openat_save_fail	function
(	O
errno	O
)	O
;	O
if	O
(	O
fchdir	function
(	O
dir_fd	int
)	O
!=	O
0	int
)	O
{	O
saved_errno	int
=	O
errno	O
;	O
free_cwd	function
(	O
&	O
saved_cwd	struct
)	O
;	O
errno	O
=	O
saved_errno	int
;	O
return	O
-	O
1	int
;	O
}	O
err	int
=	O
(	O
*	O
callback	pointer
)	O
(	O
usercontext	pointer
)	O
;	O
saved_errno	int
=	O
(	O
err	int
<	O
0	int
?	O
errno	O
:	O
0	int
)	O
;	O
if	O
(	O
restore_cwd	function
(	O
&	O
saved_cwd	struct
)	O
!=	O
0	int
)	O
openat_restore_fail	function
(	O
errno	O
)	O
;	O
free_cwd	function
(	O
&	O
saved_cwd	struct
)	O
;	O
if	O
(	O
saved_errno	int
)	O
errno	O
=	O
saved_errno	int
;	O
return	O
err	int
;	O
}	O
}	O
