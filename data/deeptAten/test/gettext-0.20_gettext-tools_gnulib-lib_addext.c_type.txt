void	O
addext	O
(	O
char	O
*	O
filename	pointer
,	O
char	O
const	O
*	O
ext	pointer
,	O
char	O
e	O
)	O
{	O
char	O
*	O
s	pointer
=	O
basename	O
(	O
filename	O
)	O
;	O
size_t	O
slen	O
=	O
strlen	pointer
(	O
s	pointer
)	O
,	O
extlen	O
=	O
strlen	pointer
(	O
ext	pointer
)	O
;	O
long	O
slen_max	O
=	O
-	O
1	int
;	O
if	O
(	O
slen	O
+	O
extlen	int
<=	O
_POSIX_NAME_MAX	O
&&	O
!	O
HAVE_DOS_FILE_NAMES	O
)	O
slen_max	O
=	O
_POSIX_NAME_MAX	pointer
;	O
else	O
if	O
(	O
s	O
==	O
filename	O
)	O
slen_max	O
=	O
pathconf	pointer
(	O
"."	pointer
,	O
_PC_NAME_MAX	O
)	O
;	O
else	O
{	O
char	O
c	O
=	O
*	O
s	pointer
;	O
*	O
s	pointer
=	O
0	O
;	O
slen_max	O
=	O
pathconf	O
(	O
filename	O
,	O
_PC_NAME_MAX	O
)	O
;	O
*	O
s	pointer
=	O
c	O
;	O
}	O
if	O
(	O
slen_max	O
<	O
0	O
)	O
slen_max	O
=	O
HAVE_LONG_FILE_NAMES	pointer
?	O
255	O
:	O
14	O
;	O
if	O
(	O
HAVE_DOS_FILE_NAMES	O
&&	O
slen_max	O
<=	O
12	O
)	O
{	O
char	O
*	O
dot	pointer
=	O
strchr	O
(	O
s	O
,	O
'.'	O
)	O
;	O
if	O
(	O
dot	O
)	O
{	O
slen	O
-=	O
dot	O
+	O
1	int
-	O
s	int
;	O
s	O
=	O
dot	O
+	O
1	int
;	O
slen_max	O
=	O
3	O
;	O
}	O
else	O
slen_max	O
=	O
8	O
;	O
extlen	O
=	O
9	O
;	O
}	O
if	O
(	O
slen	O
+	O
extlen	int
<=	O
slen_max	O
)	O
strcpy	O
(	O
s	pointer
+	O
slen	int
,	O
ext	O
)	O
;	O
else	O
{	O
if	O
(	O
slen_max	O
<=	O
slen	O
)	O
slen	O
=	O
slen_max	pointer
-	O
1	int
;	O
s	O
[	O
slen	int
]	O
=	O
e	pointer
;	O
s	O
[	O
slen	int
+	O
1	int
]	O
=	O
0	pointer
;	O
}	O
}	O