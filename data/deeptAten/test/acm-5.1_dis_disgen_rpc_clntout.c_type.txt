static	O
char	O
rcsid	O
[	O
]	O
=	O
"$Id: rpc_clntout.c,v 1.1.1.1 2005/10/28 14:46:46 k0ro Exp $"	O
;	O
static	O
int	O
write_program	function
(	O
)	O
,	O
printbody	O
(	O
)	O
;	O
void	O
write_stubs	function
(	O
)	O
{	O
list	O
*	O
l	pointer
;	O
definition	O
*	O
def	pointer
;	O
f_print	O
(	O
fout	pointer
,	O
"\n/* Default timeout can be changed using clnt_control() */\n"	pointer
)	O
;	O
f_print	O
(	O
fout	pointer
,	O
"static struct timeval TIMEOUT = { %d, 0 };\n"	pointer
,	O
DEFAULT_TIMEOUT	pointer
)	O
;	O
for	O
(	O
l	int
=	O
defined	int
;	O
l	pointer
!=	O
NULL	O
;	O
l	pointer
=	O
l	int
->	O
next	int
)	O
{	O
def	O
=	O
(	O
definition	O
*	O
)	O
l	function
->	O
val	int
;	O
if	O
(	O
def	O
->	O
def_kind	pointer
==	O
DEF_PROGRAM	O
)	O
{	O
write_program	O
(	O
def	pointer
)	O
;	O
}	O
}	O
}	O
static	O
write_program	O
(	O
def	O
)	O
definition	O
*	O
def	pointer
;	O
{	O
version_list	O
*	O
vp	pointer
;	O
proc_list	O
*	O
proc	pointer
;	O
for	O
(	O
vp	int
=	O
def	int
->	O
def	pointer
.	O
pr	pointer
.	O
versions	pointer
;	O
vp	pointer
!=	O
NULL	O
;	O
vp	pointer
=	O
vp	O
->	O
next	pointer
)	O
{	O
for	O
(	O
proc	int
=	O
vp	int
->	O
procs	pointer
;	O
proc	pointer
!=	O
NULL	O
;	O
proc	int
=	O
proc	int
->	O
next	int
)	O
{	O
f_print	O
(	O
fout	pointer
,	O
"\n"	pointer
)	O
;	O
ptype	O
(	O
proc	pointer
->	O
res_prefix	pointer
,	O
proc	O
->	O
res_type	pointer
,	O
1	O
)	O
;	O
f_print	O
(	O
fout	pointer
,	O
"*\n"	O
)	O
;	O
pvname	O
(	O
proc	pointer
->	O
proc_name	pointer
,	O
vp	O
->	O
vers_num	pointer
)	O
;	O
f_print	O
(	O
fout	pointer
,	O
"(argp, clnt)\n"	pointer
)	O
;	O
f_print	O
(	O
fout	pointer
,	O
"\t"	O
)	O
;	O
ptype	O
(	O
proc	pointer
->	O
arg_prefix	pointer
,	O
proc	int
->	O
arg_type	pointer
,	O
1	O
)	O
;	O
f_print	O
(	O
fout	pointer
,	O
"*argp;\n"	O
)	O
;	O
f_print	O
(	O
fout	pointer
,	O
"\tCLIENT *clnt;\n"	O
)	O
;	O
f_print	O
(	O
fout	pointer
,	O
"{\n"	O
)	O
;	O
printbody	O
(	O
proc	pointer
)	O
;	O
f_print	O
(	O
fout	pointer
,	O
"}\n\n"	O
)	O
;	O
}	O
}	O
return	O
0	int
;	O
}	O
static	O
char	O
*	O
ampr	function
(	O
type	O
)	O
char	O
*	O
type	pointer
;	O
{	O
if	O
(	O
isvectordef	O
(	O
type	pointer
,	O
REL_ALIAS	pointer
)	O
)	O
{	O
return	O
(	int
""	O
)	O
;	O
}	O
else	O
{	O
return	O
(	int
"&"	O
)	O
;	O
}	O
}	O
static	O
printbody	O
(	O
proc	O
)	O
proc_list	O
*	O
proc	pointer
;	O
{	O
f_print	O
(	O
fout	pointer
,	O
"\tstatic "	pointer
)	O
;	O
if	O
(	O
streq	O
(	O
proc	pointer
->	O
res_type	pointer
,	O
"void"	pointer
)	O
)	O
{	O
f_print	O
(	O
fout	pointer
,	O
"char "	pointer
)	O
;	O
}	O
else	O
{	O
ptype	O
(	O
proc	pointer
->	O
res_prefix	pointer
,	O
proc	pointer
->	O
res_type	pointer
,	O
0	O
)	O
;	O
}	O
f_print	O
(	O
fout	pointer
,	O
"res;\n"	pointer
)	O
;	O
f_print	O
(	O
fout	pointer
,	O
"\n"	pointer
)	O
;	O
f_print	O
(	O
fout	pointer
,	O
"\tbzero((char *)%sres, sizeof(res));\n"	pointer
,	O
ampr	pointer
(	O
proc	pointer
->	O
res_type	pointer
)	O
)	O
;	O
f_print	O
(	O
fout	pointer
,	O
"\tif (clnt_call(clnt, %s, xdr_%s, argp, xdr_%s, %sres, TIMEOUT) != RPC_SUCCESS) {\n"	pointer
,	O
proc	pointer
->	O
proc_name	pointer
,	O
stringfix	O
(	O
proc	pointer
->	O
arg_type	pointer
)	O
,	O
stringfix	O
(	O
proc	pointer
->	O
res_type	pointer
)	O
,	O
ampr	O
(	O
proc	pointer
->	O
res_type	pointer
)	O
)	O
;	O
f_print	O
(	O
fout	pointer
,	O
"\t\treturn (NULL);\n"	pointer
)	O
;	O
f_print	O
(	O
fout	pointer
,	O
"\t}\n"	pointer
)	O
;	O
if	O
(	O
streq	O
(	O
proc	pointer
->	O
res_type	pointer
,	O
"void"	pointer
)	O
)	O
{	O
f_print	O
(	O
fout	pointer
,	O
"\treturn ((void *)%sres);\n"	pointer
,	O
ampr	pointer
(	O
proc	pointer
->	O
res_type	pointer
)	O
)	O
;	O
}	O
else	O
{	O
f_print	O
(	O
fout	pointer
,	O
"\treturn (%sres);\n"	pointer
,	O
ampr	pointer
(	O
proc	pointer
->	O
res_type	pointer
)	O
)	O
;	O
}	O
return	O
0	O
;	O
}	O