struct	O
sockaddr_in	O
daemon_addr	O
=	O
{	O
AF_INET	O
}	O
;	O
struct	O
sockaddr_in	struct
ctl_addr	O
=	O
{	O
AF_INET	O
}	O
;	O
struct	O
sockaddr_in	struct
my_addr	O
=	O
{	O
AF_INET	O
}	O
;	O
struct	O
in_addr	struct
my_machine_addr	O
;	O
struct	O
in_addr	struct
his_machine_addr	O
;	O
unsigned	O
short	O
daemon_port	O
;	O
int	O
ctl_sockt	int
;	O
int	O
sockt	int
;	O
int	O
invitation_waiting	int
=	O
0	O
;	O
CTL_MSG	O
msg	O
;	O
int	O
open_sockt	int
(	O
void	O
)	O
{	O
socklen_t	O
length	O
;	O
my_addr	O
.	O
sin_addr	pointer
=	O
my_machine_addr	int
;	O
my_addr	O
.	O
sin_port	pointer
=	O
0	O
;	O
sockt	O
=	O
socket	O
(	O
AF_INET	pointer
,	O
SOCK_STREAM	pointer
,	O
0	O
)	O
;	O
if	O
(	O
sockt	O
<=	O
0	O
)	O
p_error	O
(	O
"Bad socket"	pointer
)	O
;	O
if	O
(	O
bind	O
(	O
sockt	pointer
,	O
(	O
struct	O
sockaddr	O
*	O
)	O
&	pointer
my_addr	pointer
,	O
sizeof	O
(	O
my_addr	O
)	O
)	O
!=	O
0	O
)	O
p_error	O
(	O
"Binding local socket"	pointer
)	O
;	O
length	O
=	O
sizeof	O
(	O
my_addr	pointer
)	O
;	O
if	O
(	O
getsockname	O
(	O
sockt	pointer
,	O
(	O
struct	O
sockaddr	O
*	O
)	O
&	pointer
my_addr	pointer
,	O
&	O
length	pointer
)	O
==	O
-	O
1	int
)	O
p_error	O
(	O
"Bad address for socket"	O
)	O
;	O
return	O
0	int
;	O
}	O
int	O
open_ctl	function
(	O
void	O
)	O
{	O
socklen_t	O
length	O
;	O
ctl_addr	O
.	O
sin_port	int
=	O
0	O
;	O
ctl_addr	O
.	O
sin_addr	int
=	O
my_machine_addr	int
;	O
ctl_sockt	O
=	O
socket	O
(	O
AF_INET	pointer
,	O
SOCK_DGRAM	pointer
,	O
0	O
)	O
;	O
if	O
(	O
ctl_sockt	O
<=	O
0	O
)	O
p_error	O
(	O
"Bad socket"	pointer
)	O
;	O
if	O
(	O
bind	O
(	O
ctl_sockt	pointer
,	O
(	pointer
struct	O
sockaddr	O
*	O
)	O
&	pointer
ctl_addr	pointer
,	O
sizeof	O
(	O
ctl_addr	O
)	O
)	O
!=	O
0	O
)	O
p_error	O
(	O
"Couldn't bind to control socket"	pointer
)	O
;	O
length	O
=	O
sizeof	O
(	O
ctl_addr	pointer
)	O
;	O
if	O
(	O
getsockname	O
(	O
ctl_sockt	pointer
,	O
(	O
struct	O
sockaddr	O
*	O
)	O
&	pointer
ctl_addr	struct
,	O
&	O
length	struct
)	O
==	O
-	O
1	int
)	O
p_error	O
(	O
"Bad address for ctl socket"	O
)	O
;	O
return	O
0	int
;	O
}	O