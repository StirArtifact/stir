const	O
char	O
_uuconf_errstr_rcsid	O
[	O
]	O
=	O
"$Id: errstr.c,v 1.6 2002/03/05 19:10:42 ian Rel $"	O
;	O
static	O
char	O
*	O
zeprint_num	pointer
P	O
(	O
(	O
char	O
*	O
zbuf	pointer
,	O
size_t	O
cbuf	O
,	O
int	O
ival	O
)	O
)	O
;	O
int	O
uuconf_error_string	int
(	O
pglobal	O
,	O
ierr	O
,	O
zbuf	pointer
,	O
cbuf	int
)	O
pointer	O
pglobal	pointer
;	O
int	O
ierr	int
;	O
char	O
*	O
zbuf	pointer
;	O
size_t	O
cbuf	long
;	O
{	O
struct	O
sglobal	struct
*	O
qglobal	pointer
=	O
(	O
struct	O
sglobal	struct
*	O
)	O
pglobal	pointer
;	O
const	O
char	O
*	O
zfile	pointer
;	O
size_t	O
cfile	long
;	O
const	O
char	O
*	O
zlineno	pointer
;	O
char	O
ablineno	O
[	O
100	O
]	O
;	O
size_t	O
clineno	long
;	O
const	O
char	O
*	O
zmsg	pointer
;	O
char	O
abmsg	O
[	O
100	O
]	O
;	O
size_t	O
cmsg	long
;	O
const	O
char	O
*	O
zerrno	pointer
;	O
size_t	O
cerrno	long
;	O
size_t	O
cret	long
;	O
size_t	O
ccopy	long
;	O
if	O
(	O
(	long
ierr	long
&	O
UUCONF_ERROR_FILENAME	long
)	O
==	O
0	O
||	O
qglobal	O
==	O
NULL	int
||	O
qglobal	O
->	O
zfilename	long
==	O
NULL	O
)	O
{	O
zfile	O
=	O
""	int
;	O
cfile	O
=	O
0	O
;	O
}	long
else	O
{	O
zfile	O
=	O
qglobal	function
->	O
zfilename	long
;	O
cfile	O
=	O
strlen	O
(	O
zfile	pointer
)	O
+	O
1	int
;	O
}	O
if	O
(	O
cfile	long
==	O
0	O
||	O
(	int
ierr	long
&	O
UUCONF_ERROR_LINENO	long
)	O
==	O
0	O
||	O
qglobal	O
==	O
NULL	int
||	O
qglobal	int
->	O
ilineno	long
<=	O
0	int
)	O
{	O
zlineno	O
=	O
""	int
;	O
clineno	O
=	O
0	O
;	O
}	long
else	O
{	O
zlineno	O
=	O
zeprint_num	int
(	O
ablineno	pointer
,	O
sizeof	pointer
ablineno	O
,	O
qglobal	pointer
->	O
ilineno	long
)	O
;	O
clineno	O
=	O
strlen	O
(	O
zlineno	pointer
)	O
+	O
1	int
;	O
}	O
switch	O
(	O
UUCONF_ERROR_VALUE	O
(	O
ierr	int
)	O
)	O
{	O
case	O
UUCONF_SUCCESS	O
:	O
zmsg	O
=	O
"no error"	O
;	O
break	O
;	O
case	O
UUCONF_NOT_FOUND	O
:	O
zmsg	O
=	O
"not found"	int
;	O
break	O
;	O
case	O
UUCONF_FOPEN_FAILED	O
:	O
zmsg	O
=	O
"fopen"	int
;	O
break	O
;	O
case	O
UUCONF_FSEEK_FAILED	O
:	O
zmsg	O
=	O
"fseek"	int
;	O
break	O
;	O
case	O
UUCONF_MALLOC_FAILED	O
:	O
zmsg	O
=	O
"malloc"	O
;	O
break	O
;	O
case	O
UUCONF_SYNTAX_ERROR	O
:	O
zmsg	O
=	O
"syntax error"	O
;	O
break	O
;	O
default	O
:	O
zmsg	O
=	O
zeprint_num	int
(	O
abmsg	pointer
,	O
sizeof	int
abmsg	O
,	O
UUCONF_ERROR_VALUE	pointer
(	O
ierr	int
)	O
)	O
;	O
zmsg	O
-=	O
sizeof	O
"error "	O
-	O
1	int
;	O
memcpy	O
(	O
(	pointer
pointer	O
)	O
zmsg	pointer
,	O
(	pointer
pointer	O
)	O
"error "	O
,	O
sizeof	O
"error "	O
-	O
1	int
)	O
;	O
break	O
;	O
}	O
cmsg	O
=	O
strlen	function
(	O
zmsg	pointer
)	O
;	O
if	O
(	O
cfile	long
>	O
0	int
)	O
++	O
cmsg	O
;	O
if	O
(	O
(	O
ierr	O
&	O
UUCONF_ERROR_ERRNO	int
)	O
==	O
0	O
||	O
qglobal	int
==	O
NULL	int
)	O
{	O
zerrno	O
=	O
""	int
;	O
cerrno	O
=	O
0	O
;	O
}	O
else	O
{	O
zerrno	O
=	O
strerror	int
(	O
qglobal	O
->	O
ierrno	int
)	O
;	O
cerrno	O
=	O
strlen	int
(	O
zerrno	pointer
)	O
+	O
2	int
;	O
}	O
cret	O
=	O
cfile	O
+	O
clineno	int
+	O
cmsg	int
+	O
cerrno	int
+	O
1	int
;	O
if	long
(	O
cbuf	long
==	O
0	O
)	O
return	O
cret	O
;	O
--	O
cbuf	O
;	O
if	O
(	O
cfile	O
>	O
0	int
)	O
{	O
ccopy	O
=	O
cfile	int
-	O
1	int
;	O
if	O
(	O
ccopy	O
>	O
cbuf	int
)	O
ccopy	O
=	O
cbuf	int
;	O
memcpy	O
(	O
(	pointer
pointer	pointer
)	O
zbuf	O
,	O
(	pointer
pointer	O
)	O
zfile	O
,	O
ccopy	O
)	O
;	O
zbuf	O
+=	O
ccopy	int
;	O
cbuf	O
-=	O
ccopy	O
;	O
if	O
(	O
cbuf	O
>	O
0	int
)	O
{	O
*	O
zbuf	pointer
++	O
=	O
':'	O
;	O
--	O
cbuf	O
;	O
}	O
}	O
if	O
(	O
clineno	O
>	O
0	int
)	O
{	O
ccopy	O
=	O
clineno	int
-	O
1	int
;	O
if	O
(	O
ccopy	O
>	O
cbuf	int
)	O
ccopy	O
=	O
cbuf	int
;	O
memcpy	O
(	O
(	pointer
pointer	pointer
)	O
zbuf	O
,	O
(	pointer
pointer	O
)	O
zlineno	O
,	O
ccopy	O
)	O
;	O
zbuf	O
+=	O
ccopy	int
;	O
cbuf	O
-=	O
ccopy	O
;	O
if	O
(	O
cbuf	O
>	O
0	int
)	O
{	O
*	O
zbuf	pointer
++	O
=	O
':'	O
;	O
--	O
cbuf	O
;	O
}	O
}	O
if	O
(	O
cbuf	O
>	O
0	int
&&	O
cfile	int
>	O
0	int
)	O
{	O
*	O
zbuf	pointer
++	O
=	O
' '	O
;	O
--	O
cbuf	O
;	O
--	O
cmsg	O
;	O
}	O
ccopy	O
=	O
cmsg	O
;	O
if	O
(	O
ccopy	O
>	O
cbuf	int
)	O
ccopy	O
=	O
cbuf	int
;	O
memcpy	O
(	O
(	pointer
pointer	pointer
)	O
zbuf	O
,	O
(	pointer
pointer	O
)	O
zmsg	O
,	O
ccopy	O
)	O
;	O
zbuf	O
+=	O
ccopy	int
;	O
cbuf	O
-=	O
ccopy	O
;	O
if	O
(	O
cerrno	O
>	O
0	int
)	O
{	O
if	O
(	O
cbuf	O
>	O
0	int
)	O
{	O
*	O
zbuf	pointer
++	O
=	O
':'	O
;	O
--	O
cbuf	O
;	O
}	O
if	O
(	O
cbuf	O
>	O
0	int
)	O
{	O
*	O
zbuf	pointer
++	O
=	O
' '	O
;	O
--	O
cbuf	O
;	O
}	O
ccopy	O
=	O
cerrno	O
-	O
2	int
;	O
if	O
(	O
ccopy	O
>	O
cbuf	int
)	O
ccopy	O
=	O
cbuf	int
;	O
memcpy	O
(	O
(	pointer
pointer	pointer
)	O
zbuf	O
,	O
(	pointer
pointer	O
)	O
zerrno	O
,	O
ccopy	O
)	O
;	O
zbuf	O
+=	O
ccopy	int
;	O
cbuf	O
-=	O
ccopy	O
;	O
}	O
*	O
zbuf	pointer
=	O
'\0'	O
;	O
return	O
cret	O
;	O
}	O
static	O
char	O
*	O
zeprint_num	function
(	O
ab	O
,	O
c	O
,	O
i	O
)	O
char	O
*	O
ab	pointer
;	O
size_t	O
c	long
;	O
register	O
int	O
i	int
;	O
{	O
register	O
char	O
*	O
z	pointer
;	O
z	O
=	O
ab	int
+	O
c	O
;	O
*	O
--	pointer
z	O
=	O
'\0'	int
;	O
do	O
{	O
*	O
--	pointer
z	O
=	O
i	O
%	O
10	int
+	O
'0'	int
;	O
i	pointer
/=	O
10	int
;	O
}	int
while	O
(	O
i	O
!=	O
0	int
)	O
;	O
return	O
z	int
;	O
}	O