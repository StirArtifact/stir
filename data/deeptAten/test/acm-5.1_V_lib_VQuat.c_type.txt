void	O
VQuaternionToMatrix	function
(	O
VQuaternion	struct
*	O
q	pointer
,	O
VMatrix	struct
*	O
m	array
)	O
{	O
double	O
s	double
,	O
xs	double
,	O
ys	double
,	O
zs	double
,	O
wx	double
,	O
wy	double
,	O
wz	double
,	O
xx	double
,	O
xy	double
,	O
xz	double
,	O
yy	double
,	O
yz	double
,	O
zz	double
;	O
s	double
=	O
2.0	int
/	O
(	O
q	pointer
->	O
v	struct
.	O
x	double
*	O
q	pointer
->	O
v	struct
.	O
x	double
+	O
q	pointer
->	O
v	struct
.	O
y	double
*	O
q	pointer
->	O
v	struct
.	O
y	double
+	O
q	pointer
->	O
v	struct
.	O
z	double
*	O
q	pointer
->	O
v	struct
.	O
z	double
+	O
q	pointer
->	O
s	double
*	O
q	pointer
->	O
s	double
)	O
;	O
xs	double
=	O
q	pointer
->	O
v	struct
.	O
x	double
*	O
s	double
;	O
ys	double
=	O
q	pointer
->	O
v	struct
.	O
y	double
*	O
s	double
;	O
zs	double
=	O
q	pointer
->	O
v	struct
.	O
z	double
*	O
s	double
;	O
wx	double
=	O
q	pointer
->	O
s	double
*	O
xs	double
;	O
wy	double
=	O
q	pointer
->	O
s	double
*	O
ys	double
;	O
wz	double
=	O
q	pointer
->	O
s	double
*	O
zs	double
;	O
xx	double
=	O
q	pointer
->	O
v	struct
.	O
x	double
*	O
xs	double
;	O
xy	double
=	O
q	pointer
->	O
v	struct
.	O
x	double
*	O
ys	double
;	O
xz	double
=	O
q	pointer
->	O
v	struct
.	O
x	double
*	O
zs	double
;	O
yy	double
=	O
q	pointer
->	O
v	struct
.	O
y	double
*	O
ys	double
;	O
yz	double
=	O
q	pointer
->	O
v	struct
.	O
y	double
*	O
zs	double
;	O
zz	double
=	O
q	pointer
->	O
v	struct
.	O
z	double
*	O
zs	double
;	O
VIdentMatrix	function
(	O
m	array
)	O
;	O
m	array
->	O
m	array
[	O
0	int
]	O
[	O
0	int
]	O
=	O
1.0	int
-	O
(	O
yy	double
+	O
zz	double
)	O
;	O
m	array
->	O
m	array
[	O
0	int
]	O
[	O
1	int
]	O
=	O
xy	double
+	O
wz	double
;	O
m	array
->	O
m	array
[	O
0	int
]	O
[	O
2	int
]	O
=	O
xz	double
-	O
wy	double
;	O
m	array
->	O
m	array
[	O
1	int
]	O
[	O
0	int
]	O
=	O
xy	double
-	O
wz	double
;	O
m	array
->	O
m	array
[	O
1	int
]	O
[	O
1	int
]	O
=	O
1.0	int
-	O
(	O
xx	double
+	O
zz	double
)	O
;	O
m	array
->	O
m	array
[	O
1	int
]	O
[	O
2	int
]	O
=	O
yz	double
+	O
wx	double
;	O
m	array
->	O
m	array
[	O
2	int
]	O
[	O
0	int
]	O
=	O
xz	double
+	O
wy	double
;	O
m	array
->	O
m	array
[	O
2	int
]	O
[	O
1	int
]	O
=	O
yz	double
-	O
wx	double
;	O
m	array
->	O
m	array
[	O
2	int
]	O
[	O
2	int
]	O
=	O
1.0	int
-	O
(	O
xx	double
+	O
yy	double
)	O
;	O
}	O
void	O
VMatrixToQuaternion	function
(	O
VMatrix	struct
*	O
m	array
,	O
VQuaternion	struct
*	O
q	pointer
)	O
{	O
double	O
tr	double
,	O
s	double
,	O
*	O
q1	pointer
=	O
(	O
double	O
*	O
)	O
&	O
q	pointer
->	O
v	struct
;	O
int	O
i	int
,	O
j	int
,	O
k	int
;	O
tr	double
=	O
m	array
->	O
m	array
[	O
0	int
]	O
[	O
0	int
]	O
+	O
m	array
->	O
m	array
[	O
1	int
]	O
[	O
1	int
]	O
+	O
m	array
->	O
m	array
[	O
2	int
]	O
[	O
2	int
]	O
;	O
if	O
(	O
tr	double
>	O
0.0	int
)	O
{	O
s	double
=	O
sqrt	function
(	O
tr	double
+	O
1.0	int
)	O
;	O
q	pointer
->	O
s	double
=	O
s	double
*	O
0.5	int
;	O
s	double
=	O
0.5	int
/	O
s	double
;	O
q	pointer
->	O
v	struct
.	O
x	double
=	O
(	O
m	array
->	O
m	array
[	O
1	int
]	O
[	O
2	int
]	O
-	O
m	array
->	O
m	array
[	O
2	int
]	O
[	O
1	int
]	O
)	O
*	O
s	double
;	O
q	pointer
->	O
v	struct
.	O
y	double
=	O
(	O
m	array
->	O
m	array
[	O
2	int
]	O
[	O
0	int
]	O
-	O
m	array
->	O
m	array
[	O
0	int
]	O
[	O
2	int
]	O
)	O
*	O
s	double
;	O
q	pointer
->	O
v	struct
.	O
z	double
=	O
(	O
m	array
->	O
m	array
[	O
0	int
]	O
[	O
1	int
]	O
-	O
m	array
->	O
m	array
[	O
1	int
]	O
[	O
0	int
]	O
)	O
*	O
s	double
;	O
}	O
else	O
{	O
i	int
=	O
0	int
;	O
if	O
(	O
m	array
->	O
m	array
[	O
1	int
]	O
[	O
1	int
]	O
>	O
m	array
->	O
m	array
[	O
0	int
]	O
[	O
0	int
]	O
)	O
{	O
i	int
=	O
1	int
;	O
}	O
if	O
(	O
m	array
->	O
m	array
[	O
2	int
]	O
[	O
2	int
]	O
>	O
m	array
->	O
m	array
[	O
i	int
]	O
[	O
i	int
]	O
)	O
{	O
i	int
=	O
2	int
;	O
}	O
j	int
=	O
(	O
i	int
+	O
1	int
)	O
%	O
3	int
;	O
k	int
=	O
(	O
j	int
+	O
1	int
)	O
%	O
3	int
;	O
s	double
=	O
sqrt	function
(	O
(	O
m	array
->	O
m	array
[	O
i	int
]	O
[	O
i	int
]	O
-	O
(	O
m	array
->	O
m	array
[	O
j	int
]	O
[	O
j	int
]	O
+	O
m	array
->	O
m	array
[	O
k	int
]	O
[	O
k	int
]	O
)	O
)	O
+	O
1.0	int
)	O
;	O
q1	pointer
[	O
i	int
]	O
=	O
s	double
*	O
0.5	int
;	O
s	double
=	O
0.5	int
/	O
s	double
;	O
q	pointer
->	O
s	double
=	O
(	O
m	array
->	O
m	array
[	O
j	int
]	O
[	O
k	int
]	O
+	O
m	array
->	O
m	array
[	O
k	int
]	O
[	O
j	int
]	O
)	O
*	O
s	double
;	O
q1	pointer
[	O
j	int
]	O
=	O
(	O
m	array
->	O
m	array
[	O
i	int
]	O
[	O
j	int
]	O
+	O
m	array
->	O
m	array
[	O
j	int
]	O
[	O
i	int
]	O
)	O
*	O
s	double
;	O
q1	pointer
[	O
k	int
]	O
=	O
(	O
m	array
->	O
m	array
[	O
i	int
]	O
[	O
k	int
]	O
+	O
m	array
->	O
m	array
[	O
k	int
]	O
[	O
i	int
]	O
)	O
*	O
s	double
;	O
}	O
}	O
void	O
VInterpolateQuaternion	function
(	O
VQuaternion	struct
*	O
p	pointer
,	O
VQuaternion	struct
*	O
q	pointer
,	O
double	O
t	double
,	O
VQuaternion	struct
*	O
qt	pointer
)	O
{	O
double	O
omega	double
,	O
cosom	double
,	O
sinom	double
,	O
sclp	double
,	O
sclq	double
;	O
cosom	double
=	O
p	pointer
->	O
v	struct
.	O
x	double
*	O
p	pointer
->	O
v	struct
.	O
x	double
+	O
p	pointer
->	O
v	struct
.	O
y	double
*	O
p	pointer
->	O
v	struct
.	O
y	double
+	O
p	pointer
->	O
v	struct
.	O
z	double
*	O
p	pointer
->	O
v	struct
.	O
z	double
+	O
p	pointer
->	O
s	double
*	O
p	pointer
->	O
s	double
;	O
if	O
(	O
(	O
1.0	int
+	O
cosom	double
)	O
>	O
EPSILON	int
)	O
{	O
if	O
(	O
(	O
1.0	int
-	O
cosom	double
)	O
>	O
EPSILON	int
)	O
{	O
omega	double
=	O
acos	function
(	O
cosom	double
)	O
;	O
sinom	double
=	O
sin	function
(	O
omega	double
)	O
;	O
sclp	double
=	O
sin	function
(	O
(	O
1.0	int
-	O
t	double
)	O
*	O
omega	double
)	O
/	O
sinom	double
;	O
sclq	double
=	O
sin	function
(	O
t	double
*	O
omega	double
)	O
/	O
sinom	double
;	O
}	O
else	O
{	O
sclp	double
=	O
1.0	int
-	O
t	double
;	O
sclq	double
=	O
t	double
;	O
}	O
qt	pointer
->	O
v	struct
.	O
x	double
=	O
p	pointer
->	O
v	struct
.	O
x	double
*	O
sclp	double
+	O
q	pointer
->	O
v	struct
.	O
x	double
*	O
sclq	double
;	O
qt	pointer
->	O
v	struct
.	O
y	double
=	O
p	pointer
->	O
v	struct
.	O
y	double
*	O
sclp	double
+	O
q	pointer
->	O
v	struct
.	O
y	double
*	O
sclq	double
;	O
qt	pointer
->	O
v	struct
.	O
z	double
=	O
p	pointer
->	O
v	struct
.	O
z	double
*	O
sclp	double
+	O
q	pointer
->	O
v	struct
.	O
z	double
*	O
sclq	double
;	O
qt	pointer
->	O
s	double
=	O
p	pointer
->	O
s	double
*	O
sclp	double
+	O
q	pointer
->	O
s	double
*	O
sclq	double
;	O
}	O
else	O
{	O
qt	pointer
->	O
v	struct
.	O
x	double
=	O
-	O
p	pointer
->	O
v	struct
.	O
y	double
;	O
qt	pointer
->	O
v	struct
.	O
y	double
=	O
p	pointer
->	O
v	struct
.	O
x	double
;	O
qt	pointer
->	O
v	struct
.	O
z	double
=	O
-	O
p	pointer
->	O
s	double
;	O
qt	pointer
->	O
s	double
=	O
p	pointer
->	O
v	struct
.	O
z	double
;	O
sclp	double
=	O
sin	function
(	O
(	O
1.0	int
-	O
t	double
)	O
*	O
M_PI_2	int
)	O
;	O
sclq	double
=	O
sin	function
(	O
t	double
*	O
M_PI_2	int
)	O
;	O
qt	pointer
->	O
v	struct
.	O
x	double
=	O
p	pointer
->	O
v	struct
.	O
x	double
*	O
sclp	double
+	O
qt	pointer
->	O
v	struct
.	O
x	double
*	O
sclq	double
;	O
qt	pointer
->	O
v	struct
.	O
y	double
=	O
p	pointer
->	O
v	struct
.	O
y	double
*	O
sclp	double
+	O
qt	pointer
->	O
v	struct
.	O
y	double
*	O
sclq	double
;	O
qt	pointer
->	O
v	struct
.	O
z	double
=	O
p	pointer
->	O
v	struct
.	O
z	double
*	O
sclp	double
+	O
qt	pointer
->	O
v	struct
.	O
z	double
*	O
sclq	double
;	O
}	O
}	O
VQuaternion	struct
*	O
VQuaternionMult	function
(	O
VQuaternion	struct
*	O
a	pointer
,	O
VQuaternion	struct
*	O
b	pointer
,	O
VQuaternion	struct
*	O
r	pointer
)	O
{	O
VPoint	struct
aa	struct
,	O
bb	struct
,	O
c	pointer
;	O
r	pointer
->	O
s	double
=	O
a	pointer
->	O
s	double
*	O
b	pointer
->	O
s	double
-	O
VDotProd	function
(	O
&	O
a	pointer
->	O
v	struct
,	O
&	O
b	pointer
->	O
v	struct
)	O
;	O
VCrossProd	function
(	O
&	O
a	pointer
->	O
v	struct
,	O
&	O
b	pointer
->	O
v	struct
,	O
&	O
c	pointer
)	O
;	O
c	pointer
.	O
x	double
+=	O
a	pointer
->	O
s	double
*	O
b	pointer
->	O
v	struct
.	O
x	double
+	O
b	pointer
->	O
s	double
*	O
a	pointer
->	O
v	struct
.	O
x	double
;	O
c	pointer
.	O
y	double
+=	O
a	pointer
->	O
s	double
*	O
b	pointer
->	O
v	struct
.	O
y	double
+	O
b	pointer
->	O
s	double
*	O
a	pointer
->	O
v	struct
.	O
y	double
;	O
c	pointer
.	O
z	double
+=	O
a	pointer
->	O
s	double
*	O
b	pointer
->	O
v	struct
.	O
z	double
+	O
b	pointer
->	O
s	double
*	O
a	pointer
->	O
v	struct
.	O
z	double
;	O
r	pointer
->	O
v	struct
=	O
c	pointer
;	O
return	O
r	pointer
;	O
}	O
VQuaternion	struct
*	O
VQuaternionComplement	function
(	O
VQuaternion	struct
*	O
a	pointer
,	O
VQuaternion	struct
*	O
r	pointer
)	O
{	O
r	pointer
->	O
s	double
=	O
a	pointer
->	O
s	double
;	O
r	pointer
->	O
v	struct
.	O
x	double
=	O
-	O
a	pointer
->	O
v	struct
.	O
x	double
;	O
r	pointer
->	O
v	struct
.	O
y	double
=	O
-	O
a	pointer
->	O
v	struct
.	O
y	double
;	O
r	pointer
->	O
v	struct
.	O
z	double
=	O
-	O
a	pointer
->	O
v	struct
.	O
z	double
;	O
return	O
r	pointer
;	O
}	O
