int	O
rpl_fcntl	O
(	O
int	O
fd	int
,	O
int	O
action	int
,	O
...	O
)	O
{	O
va_list	O
arg	O
;	O
int	O
result	int
=	O
-	int
1	int
;	O
va_start	O
(	O
arg	pointer
,	O
action	O
)	O
;	O
switch	O
(	O
action	O
)	O
{	O
case	O
F_DUPFD	O
:	O
{	O
int	O
target	int
=	O
va_arg	O
(	O
arg	O
,	O
int	O
)	int
;	O
if	O
(	O
target	O
<	O
0	int
||	O
getdtablesize	O
(	O
)	pointer
<=	O
target	int
)	O
errno	O
=	O
EINVAL	int
;	O
else	O
{	O
int	O
flags	int
=	O
fcntl	int
(	O
fd	int
,	O
F_GETFD	int
)	O
;	O
if	O
(	O
flags	O
<	O
0	int
)	O
{	O
result	O
=	O
-	int
1	int
;	O
break	O
;	O
}	O
result	O
=	O
fcntl	O
(	O
fd	int
,	O
action	int
,	O
target	int
)	O
;	O
if	O
(	O
0	O
<=	O
result	int
&&	O
fcntl	int
(	O
fd	int
,	O
F_SETFD	int
,	O
flags	int
)	O
==	O
-	O
1	int
)	O
{	O
int	O
saved_errno	int
=	O
errno	O
;	O
close	O
(	O
result	O
)	O
;	O
result	O
=	O
-	int
1	int
;	O
errno	O
=	O
saved_errno	int
;	O
}	O
}	O
break	O
;	O
}	O
case	O
F_DUPFD_CLOEXEC	O
:	O
{	O
int	O
target	int
=	O
va_arg	O
(	O
arg	O
,	O
int	O
)	int
;	O
static	O
int	O
have_dupfd_cloexec	int
=	O
GNULIB_defined_F_DUPFD_CLOEXEC	O
?	O
-	O
1	int
:	O
0	O
;	O
if	O
(	O
0	O
<=	O
have_dupfd_cloexec	int
)	O
{	O
result	O
=	O
fcntl	int
(	O
fd	int
,	O
action	int
,	O
target	int
)	O
;	O
if	O
(	O
0	O
<=	O
result	int
||	O
errno	O
!=	O
EINVAL	O
)	O
{	O
have_dupfd_cloexec	O
=	O
1	int
;	O
}	O
else	O
{	O
result	O
=	O
rpl_fcntl	int
(	O
fd	int
,	O
F_DUPFD	int
,	O
target	int
)	O
;	O
if	O
(	O
result	int
<	O
0	int
)	O
break	O
;	O
have_dupfd_cloexec	O
=	O
-	int
1	int
;	O
}	O
}	O
else	O
result	O
=	O
rpl_fcntl	function
(	O
fd	int
,	O
F_DUPFD	int
,	O
target	int
)	O
;	O
if	O
(	O
0	int
<=	O
result	int
&&	O
have_dupfd_cloexec	int
==	O
-	O
1	int
)	O
{	O
int	O
flags	int
=	O
fcntl	int
(	O
result	int
,	O
F_GETFD	int
)	O
;	O
if	O
(	O
flags	O
<	O
0	int
||	O
fcntl	O
(	O
result	int
,	O
F_SETFD	int
,	O
flags	int
|	O
FD_CLOEXEC	O
)	O
==	O
-	O
1	int
)	O
{	O
int	O
saved_errno	int
=	O
errno	O
;	O
close	O
(	O
result	O
)	O
;	O
errno	O
=	O
saved_errno	int
;	O
result	O
=	O
-	int
1	int
;	O
}	O
}	O
break	O
;	O
}	O
default	O
:	O
{	O
void	O
*	O
p	pointer
=	O
va_arg	O
(	O
arg	O
,	O
void	O
*	O
)	pointer
;	O
result	O
=	O
fcntl	O
(	O
fd	int
,	O
action	int
,	O
p	int
)	O
;	O
break	O
;	O
}	O
}	O
va_end	O
(	O
arg	O
)	O
;	O
return	O
result	int
;	O
}	O