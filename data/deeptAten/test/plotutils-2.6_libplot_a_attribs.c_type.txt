static	O
const	O
int	O
_ai_fill_rule	function
[	O
PL_NUM_FILL_RULES	int
]	O
=	O
{	O
AI_FILL_ODD_WINDING	O
,	O
AI_FILL_NONZERO_WINDING	int
}	O
;	O
static	O
const	O
int	O
_ai_join_style	function
[	O
PL_NUM_JOIN_TYPES	int
]	O
=	O
{	O
AI_LINE_JOIN_MITER	O
,	O
AI_LINE_JOIN_ROUND	pointer
,	O
AI_LINE_JOIN_BEVEL	int
,	O
AI_LINE_JOIN_ROUND	int
}	O
;	O
static	O
const	O
int	O
_ai_cap_style	function
[	O
PL_NUM_CAP_TYPES	int
]	O
=	O
{	O
AI_LINE_CAP_BUTT	O
,	O
AI_LINE_CAP_ROUND	pointer
,	O
AI_LINE_CAP_PROJECT	int
,	O
AI_LINE_CAP_ROUND	int
}	O
;	O
void	O
_pl_a_set_attributes	function
(	O
S___	O
(	O
Plotter	O
*	O
_plotter	pointer
)	O
)	O
{	O
bool	O
changed_width	int
=	O
false	int
;	O
int	O
desired_fill_rule	int
=	O
_ai_fill_rule	int
[	O
_plotter	int
->	O
drawstate	int
->	O
fill_rule_type	pointer
]	O
;	O
double	pointer
desired_ai_line_width	pointer
=	O
_plotter	int
->	O
drawstate	pointer
->	O
device_line_width	pointer
;	O
int	O
desired_ai_cap_style	int
=	O
_ai_cap_style	int
[	O
_plotter	int
->	O
drawstate	int
->	O
cap_type	pointer
]	O
;	O
int	pointer
desired_ai_join_style	int
=	O
_ai_join_style	int
[	O
_plotter	int
->	O
drawstate	int
->	O
join_type	pointer
]	O
;	O
double	pointer
desired_ai_miter_limit	O
=	O
_plotter	int
->	O
drawstate	pointer
->	O
miter_limit	pointer
;	O
int	O
desired_ai_line_type	int
=	O
_plotter	int
->	O
drawstate	int
->	O
line_type	pointer
;	O
int	int
i	int
;	O
double	int
display_size_in_points	O
,	O
min_dash_unit	O
;	O
if	O
(	O
_plotter	O
->	O
ai_version	pointer
>=	O
AI_VERSION_5	int
&&	O
_plotter	int
->	O
drawstate	pointer
->	O
fill_type	pointer
>	O
0	int
&&	O
_plotter	int
->	O
ai_fill_rule_type	pointer
!=	O
desired_fill_rule	int
)	O
{	O
sprintf	pointer
(	O
_plotter	pointer
->	O
data	pointer
->	O
page	pointer
->	O
point	pointer
,	O
"%d XR\n"	pointer
,	O
desired_fill_rule	pointer
)	O
;	O
_update_buffer	O
(	O
_plotter	pointer
->	O
data	pointer
->	O
page	pointer
)	O
;	O
_plotter	O
->	O
ai_fill_rule_type	pointer
=	O
desired_fill_rule	int
;	O
}	pointer
if	O
(	O
_plotter	int
->	O
ai_cap_style	pointer
!=	O
desired_ai_cap_style	int
)	O
{	O
sprintf	pointer
(	O
_plotter	pointer
->	O
data	pointer
->	O
page	pointer
->	O
point	pointer
,	O
"%d J\n"	pointer
,	O
desired_ai_cap_style	pointer
)	O
;	O
_update_buffer	O
(	O
_plotter	pointer
->	O
data	pointer
->	O
page	pointer
)	O
;	O
_plotter	O
->	O
ai_cap_style	pointer
=	O
desired_ai_cap_style	int
;	O
}	pointer
if	O
(	O
_plotter	int
->	O
ai_join_style	pointer
!=	O
desired_ai_join_style	int
)	O
{	O
sprintf	pointer
(	O
_plotter	pointer
->	O
data	pointer
->	O
page	pointer
->	O
point	pointer
,	O
"%d j\n"	pointer
,	O
desired_ai_join_style	pointer
)	O
;	O
_update_buffer	O
(	O
_plotter	pointer
->	O
data	pointer
->	O
page	pointer
)	O
;	O
_plotter	O
->	O
ai_join_style	pointer
=	O
desired_ai_join_style	int
;	O
}	pointer
if	O
(	O
_plotter	int
->	O
drawstate	pointer
->	O
join_type	pointer
==	O
PL_JOIN_MITER	int
&&	O
_plotter	int
->	O
ai_miter_limit	pointer
!=	O
desired_ai_miter_limit	int
)	O
{	O
sprintf	pointer
(	O
_plotter	pointer
->	O
data	pointer
->	O
page	pointer
->	O
point	pointer
,	O
"%.4g M\n"	pointer
,	O
desired_ai_miter_limit	pointer
)	O
;	O
_update_buffer	O
(	O
_plotter	pointer
->	O
data	pointer
->	O
page	pointer
)	O
;	O
_plotter	O
->	O
ai_miter_limit	pointer
=	O
desired_ai_miter_limit	int
;	O
}	pointer
if	O
(	O
_plotter	int
->	O
ai_line_width	pointer
!=	O
desired_ai_line_width	int
)	O
{	O
sprintf	pointer
(	O
_plotter	pointer
->	O
data	pointer
->	O
page	pointer
->	O
point	pointer
,	O
"%.4f w\n"	pointer
,	O
desired_ai_line_width	pointer
)	O
;	O
_update_buffer	O
(	O
_plotter	pointer
->	O
data	pointer
->	O
page	pointer
)	O
;	O
_plotter	O
->	O
ai_line_width	pointer
=	O
desired_ai_line_width	int
;	O
changed_width	pointer
=	O
true	int
;	O
}	int
if	O
(	O
_plotter	int
->	O
drawstate	pointer
->	O
dash_array_in_effect	pointer
||	O
_plotter	int
->	O
ai_line_type	pointer
!=	O
desired_ai_line_type	int
||	O
(	int
changed_width	O
&&	O
desired_ai_line_type	int
!=	O
PL_L_SOLID	int
)	O
)	O
{	O
double	O
*	O
dashbuf	pointer
;	O
int	O
num_dashes	int
;	O
double	O
offset	double
;	O
if	O
(	O
_plotter	O
->	O
drawstate	pointer
->	O
dash_array_in_effect	pointer
)	O
{	O
num_dashes	O
=	O
_plotter	pointer
->	O
drawstate	pointer
->	O
dash_array_len	pointer
;	O
if	int
(	O
num_dashes	pointer
>	O
0	int
)	O
{	O
double	O
min_sing_val	O
,	O
max_sing_val	O
;	O
_matrix_sing_vals	O
(	O
_plotter	pointer
->	O
drawstate	pointer
->	O
transform	pointer
.	O
m	int
,	O
&	pointer
min_sing_val	pointer
,	O
&	O
max_sing_val	struct
)	O
;	O
dashbuf	O
=	O
(	function
double	O
*	O
)	O
_pl_xmalloc	pointer
(	O
num_dashes	int
*	O
sizeof	O
(	O
double	O
)	O
)	O
;	O
for	O
(	O
i	int
=	O
0	int
;	O
i	int
<	O
num_dashes	int
;	O
i	int
++	O
)	O
{	O
double	O
dashlen	double
;	O
dashlen	O
=	O
min_sing_val	int
*	O
_plotter	O
->	O
drawstate	pointer
->	O
dash_array	pointer
[	O
i	int
]	O
;	O
dashbuf	pointer
[	O
i	int
]	O
=	O
dashlen	int
;	O
}	int
offset	O
=	O
min_sing_val	int
*	O
_plotter	O
->	O
drawstate	pointer
->	O
dash_offset	pointer
;	O
}	O
else	O
{	O
dashbuf	O
=	O
NULL	function
;	O
offset	O
=	O
0	int
;	O
}	int
desired_ai_line_type	O
=	O
SPECIAL_AI_LINE_TYPE	function
;	O
}	O
else	O
{	O
if	O
(	O
desired_ai_line_type	O
==	O
PL_L_SOLID	int
)	O
{	O
num_dashes	O
=	O
0	pointer
;	O
dashbuf	int
=	O
NULL	O
;	O
offset	O
=	O
0.0	int
;	O
}	O
else	O
{	O
const	O
int	O
*	int
dash_array	O
;	O
double	O
scale	O
;	O
num_dashes	O
=	O
_pl_g_line_styles	O
[	O
_plotter	int
->	O
drawstate	int
->	O
line_type	pointer
]	O
.	O
dash_array_len	pointer
;	O
dashbuf	pointer
=	O
(	pointer
double	O
*	O
)	O
_pl_xmalloc	pointer
(	O
num_dashes	int
*	O
sizeof	O
(	O
double	O
)	O
)	O
;	O
dash_array	O
=	O
_pl_g_line_styles	O
[	O
_plotter	int
->	O
drawstate	int
->	O
line_type	pointer
]	O
.	O
dash_array	pointer
;	O
display_size_in_points	pointer
=	O
DMIN	int
(	O
_plotter	pointer
->	O
data	pointer
->	O
xmax	int
-	O
_plotter	int
->	O
data	pointer
->	O
xmin	int
,	O
_plotter	int
->	O
data	pointer
->	O
ymax	int
-	O
_plotter	int
->	O
data	pointer
->	O
ymin	pointer
)	O
;	O
min_dash_unit	O
=	O
(	int
PL_MIN_DASH_UNIT_AS_FRACTION_OF_DISPLAY_SIZE	O
*	O
display_size_in_points	O
)	O
;	O
scale	O
=	O
DMAX	int
(	O
min_dash_unit	pointer
,	O
_plotter	pointer
->	O
drawstate	pointer
->	O
device_line_width	pointer
)	O
;	O
for	O
(	O
i	int
=	O
0	int
;	O
i	int
<	O
num_dashes	int
;	O
i	int
++	O
)	O
dashbuf	O
[	O
i	int
]	O
=	O
scale	O
*	O
dash_array	O
[	O
i	int
]	O
;	O
offset	O
=	O
0.0	int
;	O
}	O
}	O
sprintf	O
(	O
_plotter	pointer
->	O
data	pointer
->	O
page	pointer
->	O
point	pointer
,	O
"["	pointer
)	O
;	O
_update_buffer	O
(	O
_plotter	pointer
->	O
data	pointer
->	O
page	pointer
)	O
;	O
for	O
(	O
i	int
=	O
0	int
;	O
i	int
<	O
num_dashes	int
;	O
i	int
++	O
)	O
{	O
if	O
(	O
i	int
==	O
0	int
)	O
sprintf	O
(	O
_plotter	pointer
->	O
data	pointer
->	O
page	pointer
->	O
point	pointer
,	O
"%.4f"	pointer
,	O
dashbuf	pointer
[	O
i	int
]	O
)	O
;	O
else	O
sprintf	O
(	O
_plotter	pointer
->	O
data	pointer
->	O
page	pointer
->	O
point	pointer
,	O
" %.4f"	pointer
,	O
dashbuf	pointer
[	O
i	int
]	O
)	O
;	O
_update_buffer	O
(	O
_plotter	pointer
->	O
data	pointer
->	O
page	pointer
)	O
;	O
}	O
sprintf	O
(	O
_plotter	pointer
->	O
data	pointer
->	O
page	pointer
->	O
point	pointer
,	O
"] %.4f d\n"	pointer
,	O
offset	pointer
)	O
;	O
_update_buffer	O
(	O
_plotter	pointer
->	O
data	pointer
->	O
page	pointer
)	O
;	O
_plotter	O
->	O
ai_line_type	pointer
=	O
desired_ai_line_type	int
;	O
free	pointer
(	O
dashbuf	pointer
)	O
;	O
}	O
return	O
;	O
}	O