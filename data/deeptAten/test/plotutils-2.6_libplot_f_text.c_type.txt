static	O
const	O
int	O
fig_horizontal_alignment_style	function
[	O
PL_NUM_HORIZ_JUST_TYPES	O
]	O
=	O
{	O
FIG_ALIGN_LEFT	O
,	O
FIG_ALIGN_CENTER	O
,	O
FIG_ALIGN_RIGHT	O
}	O
;	O
double	O
_pl_f_paint_text_string	function
(	O
R___	O
(	O
Plotter	pointer
*	O
_plotter	pointer
)	O
const	O
unsigned	O
char	O
*	O
s	pointer
,	O
int	O
h_just	int
,	O
int	O
v_just	int
)	O
{	O
int	O
len	int
,	O
master_font_index	O
;	O
unsigned	O
char	O
*	O
ptr	pointer
,	O
*	O
t	pointer
;	O
double	O
theta	O
,	O
costheta	O
,	O
sintheta	O
;	O
double	O
label_width	array
,	O
label_ascent	O
;	O
double	O
initial_x	double
,	O
initial_y	O
;	O
double	O
horizontal_x	double
,	O
horizontal_y	O
,	O
vertical_x	O
,	O
vertical_y	O
;	O
double	O
horizontal_fig_length	double
,	O
vertical_fig_length	O
;	O
double	O
horizontal_fig_x	double
,	O
vertical_fig_x	O
;	O
double	O
horizontal_fig_y	double
,	O
vertical_fig_y	O
;	O
double	O
angle_device	double
;	O
if	O
(	O
_plotter	O
->	O
drawstate	pointer
->	O
font_type	pointer
!=	O
PL_F_POSTSCRIPT	O
)	O
return	O
0.0	O
;	O
if	O
(	O
v_just	O
!=	O
PL_JUST_BASE	O
)	O
return	O
0.0	int
;	O
if	O
(	O
*	O
s	pointer
==	O
(	O
unsigned	O
char	O
)	O
'\0'	O
)	O
return	O
0.0	O
;	O
if	O
(	O
_plotter	O
->	O
drawstate	pointer
->	O
fig_font_point_size	pointer
==	O
0	int
)	O
return	O
0.0	int
;	O
theta	O
=	O
M_PI	int
*	O
_plotter	O
->	O
drawstate	double
->	O
text_rotation	pointer
/	O
180.0	int
;	O
sintheta	pointer
=	O
sin	double
(	O
theta	O
)	O
;	O
costheta	O
=	O
cos	O
(	O
theta	int
)	O
;	O
master_font_index	O
=	O
(	O
_pl_g_ps_typeface_info	O
[	O
_plotter	int
->	O
drawstate	double
->	O
typeface_index	pointer
]	O
.	O
fonts	pointer
)	O
[	O
_plotter	int
->	O
drawstate	double
->	O
font_index	pointer
]	O
;	O
label_width	O
=	O
_plotter	double
->	O
get_text_width	double
(	O
R___	pointer
(	O
_plotter	pointer
)	O
s	O
)	O
;	O
label_ascent	O
=	O
_plotter	O
->	O
drawstate	pointer
->	O
true_font_size	pointer
*	O
(	double
_pl_g_ps_font_info	O
[	O
master_font_index	int
]	O
)	O
.	O
font_ascent	double
/	O
1000.0	O
;	O
horizontal_x	pointer
=	O
costheta	O
*	O
label_width	double
;	O
horizontal_y	O
=	O
sintheta	O
*	O
label_width	O
;	O
vertical_x	O
=	O
-	O
sintheta	int
*	O
label_ascent	O
;	O
vertical_y	O
=	O
costheta	O
*	O
label_ascent	O
;	O
horizontal_fig_x	O
=	O
XDV	O
(	O
horizontal_x	pointer
,	O
horizontal_y	O
)	O
;	O
horizontal_fig_y	O
=	O
YDV	O
(	O
horizontal_x	pointer
,	O
horizontal_y	O
)	O
;	O
horizontal_fig_length	O
=	O
sqrt	O
(	O
horizontal_fig_x	double
*	O
horizontal_fig_x	O
+	O
horizontal_fig_y	int
*	O
horizontal_fig_y	double
)	O
;	O
angle_device	O
=	O
-	O
_xatan2	int
(	O
horizontal_fig_y	O
,	O
horizontal_fig_x	O
)	O
;	O
if	O
(	O
angle_device	O
==	O
0.0	O
)	O
angle_device	O
=	O
0.0	int
;	O
if	O
(	O
angle_device	O
!=	O
0.0	O
&&	O
strcmp	pointer
(	O
(	pointer
const	O
char	O
*	O
)	O
s	pointer
,	O
" "	O
)	O
==	O
0	int
)	O
return	O
_plotter	int
->	O
get_text_width	pointer
(	O
R___	pointer
(	O
_plotter	pointer
)	O
s	O
)	O
;	O
vertical_fig_x	O
=	O
XDV	O
(	O
vertical_x	pointer
,	O
vertical_y	O
)	O
;	O
vertical_fig_y	O
=	O
YDV	O
(	O
vertical_x	pointer
,	O
vertical_y	O
)	O
;	O
vertical_fig_length	O
=	O
sqrt	O
(	O
vertical_fig_x	double
*	O
vertical_fig_x	O
+	O
vertical_fig_y	int
*	O
vertical_fig_y	double
)	O
;	O
initial_x	O
=	O
XD	O
(	O
(	pointer
_plotter	O
->	O
drawstate	pointer
->	O
pos	pointer
)	O
.	O
x	double
,	O
(	O
_plotter	O
->	O
drawstate	pointer
->	O
pos	pointer
)	O
.	O
y	double
)	O
;	O
initial_y	O
=	O
YD	O
(	O
(	pointer
_plotter	O
->	O
drawstate	pointer
->	O
pos	pointer
)	O
.	O
x	double
,	O
(	O
_plotter	O
->	O
drawstate	pointer
->	O
pos	pointer
)	O
.	O
y	double
)	O
;	O
_pl_f_set_pen_color	O
(	O
S___	pointer
(	O
_plotter	pointer
)	O
)	O
;	O
len	O
=	O
strlen	O
(	O
(	pointer
char	O
*	O
)	O
s	pointer
)	O
;	O
ptr	O
=	O
(	O
unsigned	O
char	O
*	O
)	O
_pl_xmalloc	pointer
(	O
(	int
4	O
*	O
len	O
+	O
1	int
)	O
*	O
sizeof	pointer
(	O
char	O
)	O
)	O
;	O
t	O
=	O
ptr	O
;	O
while	O
(	O
*	O
s	pointer
)	O
{	O
switch	O
(	O
*	int
s	pointer
)	O
{	O
case	O
'\\'	O
:	O
*	O
ptr	pointer
++	O
=	O
(	O
unsigned	O
char	O
)	O
'\\'	O
;	O
*	O
ptr	pointer
++	O
=	O
*	O
s	pointer
++	O
;	O
break	O
;	O
default	O
:	O
if	O
GOOD_PRINTABLE_ASCII	O
(	O
*	O
s	pointer
)	O
*	O
ptr	O
++	O
=	O
*	int
s	pointer
++	O
;	O
else	O
{	O
sprintf	O
(	O
(	pointer
char	O
*	O
)	O
ptr	pointer
,	O
"\\%03o"	O
,	O
(	O
unsigned	O
int	O
)	int
*	O
s	pointer
)	O
;	O
ptr	O
+=	O
4	int
;	O
s	O
++	O
;	O
}	O
break	O
;	O
}	O
}	O
*	O
ptr	function
=	O
(	O
unsigned	O
char	O
)	O
'\0'	O
;	O
if	O
(	O
_plotter	O
->	O
fig_drawing_depth	pointer
>	O
0	int
)	O
(	O
_plotter	O
->	O
fig_drawing_depth	pointer
)	O
--	O
;	O
sprintf	O
(	O
_plotter	pointer
->	O
data	pointer
->	O
page	pointer
->	O
point	pointer
,	O
"#TEXT\n%d %d %d %d %d %d %.3f %.3f %d %.3f %.3f %d %d %s\\001\n"	pointer
,	O
4	pointer
,	O
fig_horizontal_alignment_style	int
[	O
h_just	int
]	O
,	O
_plotter	pointer
->	O
drawstate	pointer
->	O
fig_fgcolor	pointer
,	O
_plotter	pointer
->	O
fig_drawing_depth	pointer
,	O
0	int
,	O
_pl_g_ps_font_info	int
[	O
master_font_index	int
]	O
.	O
fig_id	pointer
,	O
(	pointer
double	O
)	O
_plotter	O
->	O
drawstate	pointer
->	O
fig_font_point_size	pointer
,	O
angle_device	pointer
,	O
FONT_TYPE_PS	pointer
,	O
vertical_fig_length	pointer
,	O
horizontal_fig_length	int
,	O
IROUND	O
(	O
initial_x	pointer
)	O
,	O
IROUND	O
(	O
initial_y	pointer
)	O
,	O
t	O
)	O
;	O
free	O
(	O
t	pointer
)	O
;	O
_update_buffer	O
(	O
_plotter	pointer
->	O
data	pointer
->	O
page	pointer
)	O
;	O
return	O
label_width	int
;	O
}	O