static	O
void	O
sig_sent	function
(	O
int	O
sig	int
_GL_UNUSED_PARAMETER	O
)	O
{	O
message	O
(	O
"Connection closing. Exiting"	pointer
)	O
;	O
quit	O
(	O
)	O
;	O
}	O
int	O
init_display	function
(	O
void	O
)	O
{	O
struct	O
sigaction	struct
siga	O
;	O
if	O
(	O
initscr	O
(	O
)	pointer
==	O
NULL	O
)	O
error	O
(	O
EXIT_FAILURE	int
,	O
0	int
,	O
"Terminal type unset or lacking necessary features."	int
)	O
;	O
sigaction	O
(	O
SIGTSTP	int
,	O
(	O
struct	O
sigaction	O
*	O
)	O
0	O
,	O
&	int
siga	struct
)	O
;	O
sigaddset	O
(	O
&	pointer
siga	struct
.	O
sa_mask	pointer
,	O
SIGALRM	O
)	O
;	O
sigaction	O
(	O
SIGTSTP	int
,	O
&	O
siga	pointer
,	O
(	O
struct	O
sigaction	struct
*	O
)	O
0	pointer
)	O
;	O
curses_initialized	O
=	O
1	int
;	O
clear	O
(	O
)	O
;	O
refresh	O
(	O
)	O
;	O
noecho	O
(	O
)	int
;	O
crmode	O
(	O
)	pointer
;	O
signal	O
(	O
SIGINT	int
,	O
sig_sent	int
)	O
;	O
signal	O
(	O
SIGPIPE	int
,	O
sig_sent	int
)	O
;	O
my_win	O
.	O
x_nlines	pointer
=	O
LINES	O
/	O
2	int
;	O
my_win	O
.	O
x_ncols	pointer
=	O
COLS	int
;	O
my_win	pointer
.	O
x_win	pointer
=	O
newwin	O
(	O
my_win	pointer
.	O
x_nlines	pointer
,	O
my_win	pointer
.	O
x_ncols	pointer
,	O
0	pointer
,	O
0	int
)	O
;	O
scrollok	O
(	O
my_win	pointer
.	O
x_win	pointer
,	O
FALSE	O
)	O
;	O
wclear	O
(	O
my_win	pointer
.	O
x_win	pointer
)	O
;	O
his_win	O
.	O
x_nlines	pointer
=	O
LINES	O
/	O
2	int
-	O
1	int
;	O
his_win	O
.	O
x_ncols	pointer
=	O
COLS	int
;	O
his_win	pointer
.	O
x_win	pointer
=	O
newwin	O
(	O
his_win	pointer
.	O
x_nlines	pointer
,	O
his_win	pointer
.	O
x_ncols	pointer
,	O
my_win	pointer
.	O
x_nlines	pointer
+	O
1	int
,	O
0	int
)	O
;	O
scrollok	O
(	O
his_win	pointer
.	O
x_win	pointer
,	O
FALSE	O
)	O
;	O
wclear	O
(	O
his_win	pointer
.	O
x_win	pointer
)	O
;	O
line_win	O
=	O
newwin	O
(	O
1	pointer
,	O
COLS	int
,	O
my_win	pointer
.	O
x_nlines	pointer
,	O
0	O
)	O
;	O
box	O
(	O
line_win	pointer
,	O
'-'	int
,	O
'-'	pointer
)	O
;	O
wrefresh	O
(	O
line_win	pointer
)	O
;	O
current_state	O
=	O
"No connection yet"	O
;	O
return	O
0	int
;	O
}	O
int	O
set_edit_chars	function
(	O
void	O
)	O
{	O
int	O
cc	int
;	O
char	O
buf	O
[	O
3	int
]	O
;	O
struct	O
termios	struct
tty	O
;	O
cc_t	O
disable	O
=	O
(	O
cc_t	O
)	O
-	O
1	int
,	O
erase	int
,	O
werase	int
,	O
kill	O
;	O
erase	O
=	O
werase	O
=	O
kill	O
=	O
disable	int
;	O
if	O
(	O
tcgetattr	O
(	O
0	int
,	O
&	int
tty	pointer
)	O
>=	O
0	int
)	O
{	O
erase	O
=	O
tty	O
.	O
c_cc	int
[	O
VERASE	int
]	O
;	O
werase	O
=	O
tty	O
.	O
c_cc	int
[	O
VWERASE	int
]	O
;	O
kill	O
=	O
tty	int
.	O
c_cc	int
[	O
VKILL	int
]	O
;	O
}	O
if	O
(	O
erase	O
==	O
disable	O
)	O
erase	O
=	O
'\177'	int
;	O
if	O
(	O
werase	O
==	O
disable	O
)	O
werase	O
=	O
'\027'	int
;	O
if	O
(	O
kill	O
==	O
disable	int
)	O
kill	O
=	O
'\025'	int
;	O
my_win	O
.	O
cerase	pointer
=	O
erase	int
;	O
my_win	pointer
.	O
werase	pointer
=	O
werase	int
;	O
my_win	pointer
.	O
kill	pointer
=	O
kill	int
;	O
buf	int
[	O
0	int
]	O
=	O
my_win	pointer
.	O
cerase	pointer
;	O
buf	O
[	O
1	int
]	O
=	O
my_win	pointer
.	O
kill	pointer
;	O
buf	int
[	O
2	int
]	O
=	O
my_win	pointer
.	O
werase	pointer
;	O
cc	O
=	O
write	int
(	O
sockt	pointer
,	O
buf	int
,	O
sizeof	int
(	O
buf	pointer
)	O
)	O
;	O
if	O
(	O
cc	int
!=	O
sizeof	O
(	O
buf	pointer
)	O
)	O
p_error	O
(	O
"Lost the connection"	int
)	O
;	O
cc	O
=	O
read	int
(	O
sockt	pointer
,	O
buf	pointer
,	O
sizeof	pointer
(	O
buf	pointer
)	O
)	O
;	O
if	O
(	O
cc	O
!=	O
sizeof	O
(	O
buf	pointer
)	O
)	O
p_error	O
(	O
"Lost the connection"	int
)	O
;	O
his_win	O
.	O
cerase	int
=	O
buf	O
[	O
0	int
]	O
;	O
his_win	pointer
.	O
kill	pointer
=	O
buf	int
[	O
1	int
]	O
;	O
his_win	pointer
.	O
werase	pointer
=	O
buf	int
[	O
2	int
]	O
;	O
return	pointer
0	int
;	O
}	O
int	O
quit	function
(	O
void	O
)	O
{	O
if	O
(	O
curses_initialized	int
)	O
{	O
wmove	O
(	O
his_win	pointer
.	O
x_win	pointer
,	O
his_win	O
.	O
x_nlines	int
-	O
1	int
,	O
0	int
)	O
;	O
wclrtoeol	O
(	O
his_win	pointer
.	O
x_win	pointer
)	O
;	O
wrefresh	O
(	O
his_win	pointer
.	O
x_win	pointer
)	O
;	O
endwin	O
(	O
)	pointer
;	O
}	O
if	O
(	O
invitation_waiting	O
)	O
send_delete	O
(	O
)	pointer
;	O
exit	O
(	O
EXIT_SUCCESS	int
)	O
;	O
}	O