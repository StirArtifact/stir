const	O
char	O
uucp_rcsid	array
[	O
]	O
=	O
"$Id: uucp.c,v 1.76 2002/03/05 19:10:42 ian Rel $"	pointer
;	O
static	O
void	O
ucusage	function
P	O
(	O
(	O
void	O
)	O
)	O
;	O
static	O
void	O
uchelp	function
P	O
(	O
(	O
void	O
)	O
)	O
;	O
static	O
void	O
ucdirfile	function
P	O
(	O
(	O
const	O
char	O
*	O
zdir	pointer
,	O
const	O
char	O
*	O
zfile	pointer
,	O
pointer	pointer
pinfo	pointer
)	O
)	O
;	O
static	O
void	O
uccopy	function
P	O
(	O
(	O
const	O
char	O
*	O
zfile	pointer
,	O
const	O
char	O
*	O
zdest	pointer
,	O
boolean	int
fforcelocal	int
)	O
)	O
;	O
static	O
void	O
ucadd_cmd	function
P	O
(	O
(	O
const	O
struct	O
uuconf_system	struct
*	O
qsys	pointer
,	O
const	O
struct	O
scmd	struct
*	O
qcmd	pointer
,	O
const	O
char	O
*	O
zlog	pointer
)	O
)	O
;	O
static	O
void	O
ucspool_cmds	function
P	O
(	O
(	O
boolean	int
fjobid	int
)	O
)	O
;	O
static	O
const	O
char	O
*	O
zcone_system	function
P	O
(	O
(	O
boolean	int
*	O
pfany	pointer
)	O
)	O
;	O
static	O
void	O
ucrecord_file	function
P	O
(	O
(	O
const	O
char	O
*	O
zfile	pointer
)	O
)	O
;	O
static	O
void	O
ucabort	function
P	O
(	O
(	O
void	O
)	O
)	O
;	O
static	O
const	O
struct	O
option	struct
asClongopts	array
[	O
]	O
=	O
{	O
{	O
"copy"	pointer
,	O
no_argument	int
,	O
NULL	O
,	O
'C'	O
}	O
,	O
{	O
"nocopy"	pointer
,	O
no_argument	int
,	O
NULL	O
,	O
'c'	O
}	O
,	O
{	O
"directories"	pointer
,	O
no_argument	int
,	O
NULL	O
,	O
'd'	O
}	O
,	O
{	O
"nodirectories"	pointer
,	O
no_argument	int
,	O
NULL	O
,	O
'f'	O
}	O
,	O
{	O
"grade"	pointer
,	O
required_argument	int
,	O
NULL	O
,	O
'g'	O
}	O
,	O
{	O
"jobid"	pointer
,	O
no_argument	int
,	O
NULL	O
,	O
'j'	O
}	O
,	O
{	O
"mail"	pointer
,	O
no_argument	int
,	O
NULL	O
,	O
'm'	O
}	O
,	O
{	O
"notify"	pointer
,	O
required_argument	int
,	O
NULL	O
,	O
'n'	O
}	O
,	O
{	O
"nouucico"	pointer
,	O
no_argument	int
,	O
NULL	O
,	O
'r'	O
}	O
,	O
{	O
"recursive"	pointer
,	O
no_argument	int
,	O
NULL	O
,	O
'R'	O
}	O
,	O
{	O
"status"	pointer
,	O
required_argument	int
,	O
NULL	O
,	O
's'	O
}	O
,	O
{	O
"uuto"	pointer
,	O
no_argument	int
,	O
NULL	O
,	O
't'	O
}	O
,	O
{	O
"user"	pointer
,	O
required_argument	int
,	O
NULL	O
,	O
'u'	O
}	O
,	O
{	O
"noexpand"	pointer
,	O
no_argument	int
,	O
NULL	O
,	O
'W'	O
}	O
,	O
{	O
"config"	pointer
,	O
required_argument	int
,	O
NULL	O
,	O
'I'	O
}	O
,	O
{	O
"debug"	pointer
,	O
required_argument	int
,	O
NULL	O
,	O
'x'	O
}	O
,	O
{	O
"version"	pointer
,	O
no_argument	int
,	O
NULL	O
,	O
'v'	O
}	O
,	O
{	O
"help"	pointer
,	O
no_argument	int
,	O
NULL	O
,	O
1	int
}	O
,	O
{	O
NULL	O
,	O
0	int
,	O
NULL	O
,	O
0	int
}	O
}	O
;	O
static	O
pointer	pointer
pCuuconf	pointer
;	O
static	O
boolean	int
fCcopy	int
=	O
TRUE	O
;	O
static	O
char	O
bCgrade	char
=	O
BDEFAULT_UUCP_GRADE	O
;	O
static	O
boolean	int
fCmail	int
=	O
FALSE	O
;	O
static	O
const	O
char	O
*	O
zCnotify	pointer
=	O
""	pointer
;	O
static	O
boolean	int
fCexpand	int
=	O
TRUE	O
;	O
static	O
boolean	int
fCmkdirs	int
=	O
TRUE	O
;	O
static	O
const	O
char	O
*	O
zClocalname	pointer
;	O
static	O
const	O
char	O
*	O
zCuser	pointer
=	O
NULL	O
;	O
static	O
boolean	int
fCremote	int
=	O
FALSE	O
;	O
static	O
boolean	int
fClocaldest	int
;	O
static	O
struct	O
uuconf_system	struct
sCdestsys	struct
;	O
static	O
char	O
*	O
zCforward	pointer
;	O
static	O
char	O
abCsend_options	array
[	O
20	int
]	O
;	O
static	O
char	O
abCrec_options	array
[	O
20	int
]	O
;	O
static	O
boolean	int
fCneeds_cwd	int
;	O
int	O
main	function
(	O
argc	int
,	O
argv	pointer
)	O
int	O
argc	int
;	O
char	O
*	O
*	O
argv	pointer
;	O
{	O
const	O
char	O
*	O
zconfig	pointer
=	O
NULL	O
;	O
boolean	int
fjobid	int
=	O
FALSE	O
;	O
boolean	int
fuucico	int
=	O
TRUE	O
;	O
boolean	int
frecursive	int
=	O
FALSE	O
;	O
const	O
char	O
*	O
zstatus_file	pointer
=	O
NULL	O
;	O
boolean	int
fuuto	int
=	O
FALSE	O
;	O
int	O
iopt	int
;	O
pointer	pointer
puuconf	pointer
;	O
int	O
iuuconf	int
;	O
int	O
i	int
;	O
boolean	int
fgetcwd	int
;	O
struct	O
uuconf_system	struct
slocalsys	struct
;	O
char	O
*	O
zexclam	pointer
;	O
char	O
*	O
zdestfile	pointer
;	O
const	O
char	O
*	O
zdestsys	pointer
;	O
char	O
*	O
zoptions	pointer
;	O
boolean	int
fexit	int
;	O
zProgram	pointer
=	O
argv	pointer
[	O
0	int
]	O
;	O
while	O
(	O
(	O
iopt	int
=	O
getopt_long	function
(	O
argc	int
,	O
argv	pointer
,	O
"cCdfg:I:jmn:prRs:tu:Wvx:"	pointer
,	O
asClongopts	array
,	O
(	O
int	O
*	O
)	O
NULL	O
)	O
)	O
!=	O
EOF	O
)	O
{	O
switch	O
(	O
iopt	int
)	O
{	O
case	O
'c'	O
:	O
fCcopy	int
=	O
FALSE	O
;	O
break	O
;	O
case	O
'p'	O
:	O
case	O
'C'	O
:	O
fCcopy	int
=	O
TRUE	O
;	O
break	O
;	O
case	O
'd'	O
:	O
fCmkdirs	int
=	O
TRUE	O
;	O
break	O
;	O
case	O
'f'	O
:	O
fCmkdirs	int
=	O
FALSE	O
;	O
break	O
;	O
case	O
'g'	O
:	O
bCgrade	char
=	O
optarg	O
[	O
0	int
]	O
;	O
break	O
;	O
case	O
'I'	O
:	O
if	O
(	O
fsysdep_other_config	function
(	O
optarg	O
)	O
)	O
zconfig	pointer
=	O
optarg	O
;	O
break	O
;	O
case	O
'j'	O
:	O
fjobid	int
=	O
TRUE	O
;	O
break	O
;	O
case	O
'm'	O
:	O
fCmail	int
=	O
TRUE	O
;	O
break	O
;	O
case	O
'n'	O
:	O
zCnotify	pointer
=	O
optarg	O
;	O
break	O
;	O
case	O
'r'	O
:	O
fuucico	int
=	O
FALSE	O
;	O
break	O
;	O
case	O
'R'	O
:	O
frecursive	int
=	O
TRUE	O
;	O
break	O
;	O
case	O
's'	O
:	O
zstatus_file	pointer
=	O
optarg	O
;	O
break	O
;	O
case	O
't'	O
:	O
fuuto	int
=	O
TRUE	O
;	O
break	O
;	O
case	O
'u'	O
:	O
zCuser	pointer
=	O
optarg	O
;	O
break	O
;	O
case	O
'W'	O
:	O
fCexpand	int
=	O
FALSE	O
;	O
break	O
;	O
case	O
'x'	O
:	O
iDebug	int
|=	O
idebug_parse	function
(	O
optarg	O
)	O
;	O
break	O
;	O
case	O
'v'	O
:	O
printf	function
(	O
"uucp (Taylor UUCP) %s\n"	pointer
,	O
VERSION	pointer
)	O
;	O
printf	function
(	O
"Copyright (C) 1991, 92, 93, 94, 1995, 2002 Ian Lance Taylor\n"	pointer
)	O
;	O
printf	function
(	O
"This program is free software; you may redistribute it under the terms of\n"	pointer
)	O
;	O
printf	function
(	O
"the GNU General Public LIcense.  This program has ABSOLUTELY NO WARRANTY.\n"	pointer
)	O
;	O
exit	function
(	O
EXIT_SUCCESS	int
)	O
;	O
case	O
1	int
:	O
uchelp	function
(	O
)	O
;	O
exit	function
(	O
EXIT_SUCCESS	int
)	O
;	O
case	O
0	int
:	O
break	O
;	O
default	O
:	O
ucusage	function
(	O
)	O
;	O
}	O
}	O
if	O
(	O
!	O
UUCONF_GRADE_LEGAL	O
(	O
bCgrade	char
)	O
||	O
(	O
(	O
bCgrade	char
<	O
'0'	O
||	O
bCgrade	char
>	O
'9'	O
)	O
&&	O
(	O
bCgrade	char
<	O
'a'	O
||	O
bCgrade	char
>	O
'z'	O
)	O
&&	O
(	O
bCgrade	char
<	O
'A'	O
||	O
bCgrade	char
>	O
'Z'	O
)	O
)	O
)	O
{	O
ulog	function
(	O
LOG_ERROR	int
,	O
"Ignoring illegal grade"	pointer
)	O
;	O
bCgrade	char
=	O
BDEFAULT_UUCP_GRADE	O
;	O
}	O
if	O
(	O
zCuser	pointer
!=	O
NULL	O
)	O
{	O
if	O
(	O
strchr	function
(	O
zCuser	pointer
,	O
'!'	O
)	O
!=	O
NULL	O
)	O
fCremote	int
=	O
TRUE	O
;	O
else	O
{	O
ulog	function
(	O
LOG_ERROR	int
,	O
"Ignoring local user name"	pointer
)	O
;	O
zCuser	pointer
=	O
NULL	O
;	O
}	O
}	O
if	O
(	O
argc	int
-	O
optind	O
<	O
2	int
)	O
ucusage	function
(	O
)	O
;	O
iuuconf	int
=	O
uuconf_init	function
(	O
&	O
puuconf	pointer
,	O
(	O
const	O
char	O
*	O
)	O
NULL	O
,	O
zconfig	pointer
)	O
;	O
if	O
(	O
iuuconf	int
!=	O
UUCONF_SUCCESS	O
)	O
ulog_uuconf	function
(	O
LOG_FATAL	int
,	O
puuconf	pointer
,	O
iuuconf	int
)	O
;	O
pCuuconf	pointer
=	O
puuconf	pointer
;	O
{	O
const	O
char	O
*	O
zdebug	pointer
;	O
iuuconf	int
=	O
uuconf_debuglevel	function
(	O
puuconf	pointer
,	O
&	O
zdebug	pointer
)	O
;	O
if	O
(	O
iuuconf	int
!=	O
UUCONF_SUCCESS	O
)	O
ulog_uuconf	function
(	O
LOG_FATAL	int
,	O
puuconf	pointer
,	O
iuuconf	int
)	O
;	O
if	O
(	O
zdebug	pointer
!=	O
NULL	O
)	O
iDebug	int
|=	O
idebug_parse	function
(	O
zdebug	pointer
)	O
;	O
}	O
fgetcwd	int
=	O
FALSE	O
;	O
for	O
(	O
i	int
=	O
optind	O
;	O
i	int
<	O
argc	int
;	O
i	int
++	O
)	O
{	O
zexclam	pointer
=	O
strrchr	function
(	O
argv	pointer
[	O
i	int
]	O
,	O
'!'	O
)	O
;	O
if	O
(	O
zexclam	pointer
==	O
NULL	O
)	O
zexclam	pointer
=	O
argv	pointer
[	O
i	int
]	O
;	O
else	O
++	O
zexclam	pointer
;	O
if	O
(	O
fsysdep_needs_cwd	function
(	O
zexclam	pointer
)	O
)	O
{	O
fgetcwd	int
=	O
TRUE	O
;	O
break	O
;	O
}	O
}	O
usysdep_signal	function
(	O
SIGINT	int
)	O
;	O
usysdep_signal	function
(	O
SIGHUP	int
)	O
;	O
usysdep_signal	function
(	O
SIGQUIT	int
)	O
;	O
usysdep_signal	function
(	O
SIGTERM	int
)	O
;	O
usysdep_signal	function
(	O
SIGPIPE	int
)	O
;	O
usysdep_initialize	function
(	O
puuconf	pointer
,	O
INIT_SUID	O
|	O
(	O
fgetcwd	int
?	O
INIT_GETCWD	O
:	O
0	int
)	O
)	O
;	O
ulog_fatal_fn	function
(	O
ucabort	function
)	O
;	O
if	O
(	O
zCuser	pointer
==	O
NULL	O
)	O
zCuser	pointer
=	O
zsysdep_login_name	function
(	O
)	O
;	O
iuuconf	int
=	O
uuconf_localname	function
(	O
puuconf	pointer
,	O
&	O
zClocalname	pointer
)	O
;	O
if	O
(	O
iuuconf	int
==	O
UUCONF_NOT_FOUND	O
)	O
{	O
zClocalname	pointer
=	O
zsysdep_localname	function
(	O
)	O
;	O
if	O
(	O
zClocalname	pointer
==	O
NULL	O
)	O
exit	function
(	O
EXIT_FAILURE	int
)	O
;	O
}	O
else	O
if	O
(	O
iuuconf	int
!=	O
UUCONF_SUCCESS	O
)	O
ulog_uuconf	function
(	O
LOG_FATAL	int
,	O
puuconf	pointer
,	O
iuuconf	int
)	O
;	O
iuuconf	int
=	O
uuconf_system_info	function
(	O
puuconf	pointer
,	O
zClocalname	pointer
,	O
&	O
slocalsys	struct
)	O
;	O
if	O
(	O
iuuconf	int
!=	O
UUCONF_SUCCESS	O
)	O
{	O
if	O
(	O
iuuconf	int
!=	O
UUCONF_NOT_FOUND	O
)	O
ulog_uuconf	function
(	O
LOG_FATAL	int
,	O
puuconf	pointer
,	O
iuuconf	int
)	O
;	O
iuuconf	int
=	O
uuconf_system_local	function
(	O
puuconf	pointer
,	O
&	O
slocalsys	struct
)	O
;	O
if	O
(	O
iuuconf	int
!=	O
UUCONF_SUCCESS	O
)	O
ulog_uuconf	function
(	O
LOG_FATAL	int
,	O
puuconf	pointer
,	O
iuuconf	int
)	O
;	O
slocalsys	struct
.	O
uuconf_zname	pointer
=	O
(	O
char	O
*	O
)	O
zClocalname	pointer
;	O
}	O
if	O
(	O
fuuto	int
)	O
{	O
if	O
(	O
*	O
zCnotify	pointer
==	O
'\0'	O
)	O
{	O
zexclam	pointer
=	O
strrchr	function
(	O
argv	pointer
[	O
argc	int
-	O
1	int
]	O
,	O
'!'	O
)	O
;	O
if	O
(	O
zexclam	pointer
==	O
NULL	O
)	O
ucusage	function
(	O
)	O
;	O
zCnotify	pointer
=	O
zexclam	pointer
+	O
1	int
;	O
}	O
argv	pointer
[	O
argc	int
-	O
1	int
]	O
=	O
zsysdep_uuto	function
(	O
argv	pointer
[	O
argc	int
-	O
1	int
]	O
,	O
zClocalname	pointer
)	O
;	O
if	O
(	O
argv	pointer
[	O
argc	int
-	O
1	int
]	O
==	O
NULL	O
)	O
ucusage	function
(	O
)	O
;	O
}	O
zoptions	pointer
=	O
abCsend_options	array
;	O
if	O
(	O
fCcopy	int
)	O
*	O
zoptions	pointer
++	O
=	O
'C'	O
;	O
else	O
*	O
zoptions	pointer
++	O
=	O
'c'	O
;	O
if	O
(	O
fCmkdirs	int
)	O
*	O
zoptions	pointer
++	O
=	O
'd'	O
;	O
else	O
*	O
zoptions	pointer
++	O
=	O
'f'	O
;	O
if	O
(	O
fCmail	int
)	O
*	O
zoptions	pointer
++	O
=	O
'm'	O
;	O
if	O
(	O
*	O
zCnotify	pointer
!=	O
'\0'	O
)	O
*	O
zoptions	pointer
++	O
=	O
'n'	O
;	O
*	O
zoptions	pointer
=	O
'\0'	O
;	O
zoptions	pointer
=	O
abCrec_options	array
;	O
if	O
(	O
fCmkdirs	int
)	O
*	O
zoptions	pointer
++	O
=	O
'd'	O
;	O
else	O
*	O
zoptions	pointer
++	O
=	O
'f'	O
;	O
if	O
(	O
fCmail	int
)	O
*	O
zoptions	pointer
++	O
=	O
'm'	O
;	O
*	O
zoptions	pointer
=	O
'\0'	O
;	O
argv	pointer
[	O
argc	int
-	O
1	int
]	O
=	O
zremove_local_sys	function
(	O
&	O
slocalsys	struct
,	O
argv	pointer
[	O
argc	int
-	O
1	int
]	O
)	O
;	O
zexclam	pointer
=	O
strchr	function
(	O
argv	pointer
[	O
argc	int
-	O
1	int
]	O
,	O
'!'	O
)	O
;	O
if	O
(	O
zexclam	pointer
==	O
NULL	O
)	O
{	O
zdestsys	pointer
=	O
zClocalname	pointer
;	O
zdestfile	pointer
=	O
argv	pointer
[	O
argc	int
-	O
1	int
]	O
;	O
fClocaldest	int
=	O
TRUE	O
;	O
}	O
else	O
{	O
size_t	long
clen	long
;	O
char	O
*	O
zcopy	pointer
;	O
clen	long
=	O
zexclam	pointer
-	O
argv	pointer
[	O
argc	int
-	O
1	int
]	O
;	O
zcopy	pointer
=	O
zbufalc	function
(	O
clen	long
+	O
1	int
)	O
;	O
memcpy	function
(	O
zcopy	pointer
,	O
argv	pointer
[	O
argc	int
-	O
1	int
]	O
,	O
clen	long
)	O
;	O
zcopy	pointer
[	O
clen	long
]	O
=	O
'\0'	O
;	O
zdestsys	pointer
=	O
zcopy	pointer
;	O
zdestfile	pointer
=	O
zexclam	pointer
+	O
1	int
;	O
fClocaldest	int
=	O
FALSE	O
;	O
}	O
iuuconf	int
=	O
uuconf_system_info	function
(	O
puuconf	pointer
,	O
zdestsys	pointer
,	O
&	O
sCdestsys	struct
)	O
;	O
if	O
(	O
iuuconf	int
!=	O
UUCONF_SUCCESS	O
)	O
{	O
if	O
(	O
iuuconf	int
!=	O
UUCONF_NOT_FOUND	O
)	O
ulog_uuconf	function
(	O
LOG_FATAL	int
,	O
puuconf	pointer
,	O
iuuconf	int
)	O
;	O
if	O
(	O
fClocaldest	int
)	O
{	O
iuuconf	int
=	O
uuconf_system_local	function
(	O
puuconf	pointer
,	O
&	O
sCdestsys	struct
)	O
;	O
if	O
(	O
iuuconf	int
!=	O
UUCONF_SUCCESS	O
)	O
ulog_uuconf	function
(	O
LOG_FATAL	int
,	O
puuconf	pointer
,	O
iuuconf	int
)	O
;	O
sCdestsys	struct
.	O
uuconf_zname	pointer
=	O
(	O
char	O
*	O
)	O
zClocalname	pointer
;	O
}	O
else	O
{	O
if	O
(	O
!	O
funknown_system	function
(	O
puuconf	pointer
,	O
zdestsys	pointer
,	O
&	O
sCdestsys	struct
)	O
)	O
ulog	function
(	O
LOG_FATAL	int
,	O
"%s: System not found"	pointer
,	O
zdestsys	pointer
)	O
;	O
}	O
}	O
zexclam	pointer
=	O
strrchr	function
(	O
zdestfile	pointer
,	O
'!'	O
)	O
;	O
if	O
(	O
zexclam	pointer
==	O
NULL	O
)	O
zCforward	pointer
=	O
NULL	O
;	O
else	O
{	O
size_t	long
clen	long
;	O
if	O
(	O
fClocaldest	int
)	O
ulog	function
(	O
LOG_FATAL	int
,	O
"Can't happen"	pointer
)	O
;	O
clen	long
=	O
zexclam	pointer
-	O
zdestfile	pointer
;	O
zCforward	pointer
=	O
zbufalc	function
(	O
clen	long
+	O
1	int
)	O
;	O
memcpy	function
(	O
zCforward	pointer
,	O
zdestfile	pointer
,	O
clen	long
)	O
;	O
zCforward	pointer
[	O
clen	long
]	O
=	O
'\0'	O
;	O
zdestfile	pointer
=	O
zexclam	pointer
+	O
1	int
;	O
}	O
if	O
(	O
fClocaldest	int
)	O
zdestfile	pointer
=	O
zsysdep_local_file_cwd	function
(	O
zdestfile	pointer
,	O
sCdestsys	struct
.	O
uuconf_zpubdir	pointer
,	O
(	O
boolean	int
*	O
)	O
NULL	O
)	O
;	O
else	O
if	O
(	O
fCexpand	int
)	O
zdestfile	pointer
=	O
zsysdep_add_cwd	function
(	O
zdestfile	pointer
)	O
;	O
if	O
(	O
zdestfile	pointer
==	O
NULL	O
)	O
{	O
ulog_close	function
(	O
)	O
;	O
usysdep_exit	function
(	O
FALSE	O
)	O
;	O
}	O
for	O
(	O
i	int
=	O
optind	O
;	O
i	int
<	O
argc	int
-	O
1	int
&&	O
!	O
FGOT_SIGNAL	O
(	O
)	O
;	O
i	int
++	O
)	O
{	O
boolean	int
flocal	int
;	O
char	O
*	O
zfrom	pointer
;	O
fCneeds_cwd	int
=	O
FALSE	O
;	O
argv	pointer
[	O
i	int
]	O
=	O
zremove_local_sys	function
(	O
&	O
slocalsys	struct
,	O
argv	pointer
[	O
i	int
]	O
)	O
;	O
if	O
(	O
strchr	function
(	O
argv	pointer
[	O
i	int
]	O
,	O
'!'	O
)	O
!=	O
NULL	O
)	O
{	O
flocal	int
=	O
FALSE	O
;	O
zfrom	pointer
=	O
zbufcpy	function
(	O
argv	pointer
[	O
i	int
]	O
)	O
;	O
}	O
else	O
{	O
flocal	int
=	O
TRUE	O
;	O
if	O
(	O
fsysdep_needs_cwd	function
(	O
argv	pointer
[	O
i	int
]	O
)	O
)	O
fCneeds_cwd	int
=	O
TRUE	O
;	O
zfrom	pointer
=	O
zsysdep_local_file_cwd	function
(	O
argv	pointer
[	O
i	int
]	O
,	O
sCdestsys	struct
.	O
uuconf_zpubdir	pointer
,	O
(	O
boolean	int
*	O
)	O
NULL	O
)	O
;	O
if	O
(	O
zfrom	pointer
==	O
NULL	O
)	O
ucabort	function
(	O
)	O
;	O
}	O
if	O
(	O
!	O
flocal	int
||	O
!	O
fsysdep_directory	function
(	O
zfrom	pointer
)	O
)	O
uccopy	function
(	O
zfrom	pointer
,	O
zdestfile	pointer
,	O
FALSE	O
)	O
;	O
else	O
{	O
char	O
*	O
zbase	pointer
,	O
*	O
zindir	pointer
;	O
if	O
(	O
!	O
frecursive	int
)	O
ulog	function
(	O
LOG_FATAL	int
,	O
"%s: directory without -R"	pointer
,	O
zfrom	pointer
)	O
;	O
zbase	pointer
=	O
zsysdep_base_name	function
(	O
zfrom	pointer
)	O
;	O
if	O
(	O
zbase	pointer
==	O
NULL	O
)	O
ucabort	function
(	O
)	O
;	O
zindir	pointer
=	O
zsysdep_in_dir	function
(	O
zdestfile	pointer
,	O
zbase	pointer
)	O
;	O
ubuffree	function
(	O
zbase	pointer
)	O
;	O
if	O
(	O
zindir	pointer
==	O
NULL	O
)	O
ucabort	function
(	O
)	O
;	O
usysdep_walk_tree	function
(	O
zfrom	pointer
,	O
ucdirfile	function
,	O
zindir	pointer
)	O
;	O
ubuffree	function
(	O
zindir	pointer
)	O
;	O
}	O
ubuffree	function
(	O
zfrom	pointer
)	O
;	O
}	O
if	O
(	O
FGOT_SIGNAL	O
(	O
)	O
)	O
ucabort	function
(	O
)	O
;	O
ulog_to_file	function
(	O
puuconf	pointer
,	O
TRUE	O
)	O
;	O
ulog_user	function
(	O
zCuser	pointer
)	O
;	O
ucspool_cmds	function
(	O
fjobid	int
)	O
;	O
ulog_close	function
(	O
)	O
;	O
if	O
(	O
!	O
fuucico	int
)	O
fexit	int
=	O
TRUE	O
;	O
else	O
{	O
const	O
char	O
*	O
zsys	pointer
;	O
boolean	int
fany	int
;	O
zsys	pointer
=	O
zcone_system	function
(	O
&	O
fany	int
)	O
;	O
if	O
(	O
zsys	pointer
==	O
NULL	O
&&	O
!	O
fany	int
)	O
fexit	int
=	O
TRUE	O
;	O
else	O
{	O
const	O
char	O
*	O
zarg	pointer
;	O
char	O
*	O
zconfigarg	pointer
;	O
if	O
(	O
zsys	pointer
==	O
NULL	O
)	O
zarg	pointer
=	O
"-r1"	pointer
;	O
else	O
{	O
char	O
*	O
z	pointer
;	O
z	pointer
=	O
zbufalc	function
(	O
sizeof	O
"-Cs"	pointer
+	O
strlen	function
(	O
zsys	pointer
)	O
)	O
;	O
sprintf	function
(	O
z	pointer
,	O
"-Cs%s"	pointer
,	O
zsys	pointer
)	O
;	O
zarg	pointer
=	O
z	pointer
;	O
}	O
if	O
(	O
zconfig	pointer
==	O
NULL	O
)	O
zconfigarg	pointer
=	O
NULL	O
;	O
else	O
{	O
zconfigarg	pointer
=	O
zbufalc	function
(	O
sizeof	O
"-I"	pointer
+	O
strlen	function
(	O
zconfig	pointer
)	O
)	O
;	O
sprintf	function
(	O
zconfigarg	pointer
,	O
"-I%s"	pointer
,	O
zconfig	pointer
)	O
;	O
}	O
fexit	int
=	O
fsysdep_run	function
(	O
FALSE	O
,	O
"uucico"	pointer
,	O
zarg	pointer
,	O
zconfigarg	pointer
)	O
;	O
}	O
}	O
usysdep_exit	function
(	O
fexit	int
)	O
;	O
return	O
0	int
;	O
}	O
static	O
void	O
ucusage	function
(	O
)	O
{	O
fprintf	function
(	O
stderr	pointer
,	O
"Usage: %s [options] file1 [file2 ...] dest\n"	pointer
,	O
zProgram	pointer
)	O
;	O
fprintf	function
(	O
stderr	pointer
,	O
"Use %s --help for help\n"	pointer
,	O
zProgram	pointer
)	O
;	O
exit	function
(	O
EXIT_FAILURE	int
)	O
;	O
}	O
static	O
void	O
uchelp	function
(	O
)	O
{	O
printf	function
(	O
"Taylor UUCP %s, copyright (C) 1991, 92, 93, 94, 1995, 2002 Ian Lance Taylor\n"	pointer
,	O
VERSION	pointer
)	O
;	O
printf	function
(	O
"Usage: %s [options] file1 [file2 ...] dest\n"	pointer
,	O
zProgram	pointer
)	O
;	O
printf	function
(	O
" -c,--nocopy: Do not copy local files to spool directory\n"	pointer
)	O
;	O
printf	function
(	O
" -C,-p,--copy: Copy local files to spool directory (default)\n"	pointer
)	O
;	O
printf	function
(	O
" -d,--directories: Create necessary directories (default)\n"	pointer
)	O
;	O
printf	function
(	O
" -f,--nodirectories: Do not create directories (fail if they do not exist)\n"	pointer
)	O
;	O
printf	function
(	O
" -g,--grade grade: Set job grade (must be alphabetic)\n"	pointer
)	O
;	O
printf	function
(	O
" -m,--mail: Report status of copy by mail\n"	pointer
)	O
;	O
printf	function
(	O
" -n,--notify user: Report status of copy by mail to remote user\n"	pointer
)	O
;	O
printf	function
(	O
" -R,--recursive: Copy directories recursively\n"	pointer
)	O
;	O
printf	function
(	O
" -r,--nouucico: Do not start uucico daemon\n"	pointer
)	O
;	O
printf	function
(	O
" -s,--status file: Report completion status to file\n"	pointer
)	O
;	O
printf	function
(	O
" -j,--jobid: Report job id\n"	pointer
)	O
;	O
printf	function
(	O
" -W,--noexpand: Do not add current directory to remote filenames\n"	pointer
)	O
;	O
printf	function
(	O
" -t,--uuto: Emulate uuto\n"	pointer
)	O
;	O
printf	function
(	O
" -u,--user name: Set user name\n"	pointer
)	O
;	O
printf	function
(	O
" -x,--debug debug: Set debugging level\n"	pointer
)	O
;	O
printf	function
(	O
" -I,--config file: Set configuration file to use\n"	pointer
)	O
;	O
printf	function
(	O
" -v,--version: Print version and exit\n"	pointer
)	O
;	O
printf	function
(	O
" --help: Print help and exit\n"	pointer
)	O
;	O
printf	function
(	O
"Report bugs to taylor-uucp@gnu.org\n"	pointer
)	O
;	O
}	O
static	O
void	O
ucdirfile	function
(	O
zfull	pointer
,	O
zrelative	pointer
,	O
pinfo	pointer
)	O
const	O
char	O
*	O
zfull	pointer
;	O
const	O
char	O
*	O
zrelative	pointer
;	O
pointer	pointer
pinfo	pointer
;	O
{	O
const	O
char	O
*	O
zdestfile	pointer
=	O
(	O
const	O
char	O
*	O
)	O
pinfo	pointer
;	O
char	O
*	O
zto	pointer
;	O
zto	pointer
=	O
zsysdep_in_dir	function
(	O
zdestfile	pointer
,	O
zrelative	pointer
)	O
;	O
if	O
(	O
zto	pointer
==	O
NULL	O
)	O
ucabort	function
(	O
)	O
;	O
uccopy	function
(	O
zfull	pointer
,	O
zto	pointer
,	O
TRUE	O
)	O
;	O
ubuffree	function
(	O
zto	pointer
)	O
;	O
}	O
static	O
void	O
uccopy	function
(	O
zfile	pointer
,	O
zdest	pointer
,	O
fforcelocal	int
)	O
const	O
char	O
*	O
zfile	pointer
;	O
const	O
char	O
*	O
zdest	pointer
;	O
boolean	int
fforcelocal	int
;	O
{	O
struct	O
scmd	struct
s	struct
;	O
char	O
*	O
zexclam	pointer
;	O
char	O
*	O
zto	pointer
;	O
zexclam	pointer
=	O
strchr	function
(	O
zfile	pointer
,	O
'!'	O
)	O
;	O
if	O
(	O
zexclam	pointer
==	O
NULL	O
||	O
fforcelocal	int
)	O
{	O
openfile_t	pointer
efrom	pointer
;	O
if	O
(	O
!	O
fsysdep_access	function
(	O
zfile	pointer
)	O
)	O
ucabort	function
(	O
)	O
;	O
if	O
(	O
fCremote	int
&&	O
!	O
fCneeds_cwd	int
&&	O
!	O
fin_directory_list	function
(	O
zfile	pointer
,	O
sCdestsys	struct
.	O
uuconf_pzremote_send	pointer
,	O
sCdestsys	struct
.	O
uuconf_zpubdir	pointer
,	O
TRUE	O
,	O
TRUE	O
,	O
(	O
const	O
char	O
*	O
)	O
NULL	O
)	O
)	O
ulog	function
(	O
LOG_FATAL	int
,	O
"Not permitted to send %s"	pointer
,	O
zfile	pointer
)	O
;	O
if	O
(	O
fClocaldest	int
)	O
{	O
boolean	int
fok	int
;	O
unsigned	O
int	O
imode	int
;	O
if	O
(	O
fCremote	int
)	O
fok	int
=	O
fin_directory_list	function
(	O
zdest	pointer
,	O
sCdestsys	struct
.	O
uuconf_pzremote_receive	pointer
,	O
sCdestsys	struct
.	O
uuconf_zpubdir	pointer
,	O
TRUE	O
,	O
FALSE	O
,	O
(	O
const	O
char	O
*	O
)	O
NULL	O
)	O
;	O
else	O
fok	int
=	O
fin_directory_list	function
(	O
zdest	pointer
,	O
sCdestsys	struct
.	O
uuconf_pzlocal_receive	pointer
,	O
sCdestsys	struct
.	O
uuconf_zpubdir	pointer
,	O
TRUE	O
,	O
FALSE	O
,	O
zCuser	pointer
)	O
;	O
if	O
(	O
!	O
fok	int
)	O
ulog	function
(	O
LOG_FATAL	int
,	O
"Not permitted to receive to %s"	pointer
,	O
zdest	pointer
)	O
;	O
zto	pointer
=	O
zsysdep_add_base	function
(	O
zdest	pointer
,	O
zfile	pointer
)	O
;	O
if	O
(	O
zto	pointer
==	O
NULL	O
)	O
ucabort	function
(	O
)	O
;	O
efrom	pointer
=	O
esysdep_user_fopen	function
(	O
zfile	pointer
,	O
TRUE	O
,	O
TRUE	O
)	O
;	O
if	O
(	O
!	O
ffileisopen	O
(	O
efrom	pointer
)	O
)	O
ucabort	function
(	O
)	O
;	O
if	O
(	O
!	O
fcopy_open_file	function
(	O
efrom	pointer
,	O
zto	pointer
,	O
FALSE	O
,	O
fCmkdirs	int
,	O
TRUE	O
)	O
)	O
ucabort	function
(	O
)	O
;	O
(	O
void	O
)	O
ffileclose	O
(	O
efrom	pointer
)	O
;	O
ubuffree	function
(	O
zto	pointer
)	O
;	O
imode	int
=	O
ixsysdep_user_file_mode	function
(	O
zfile	pointer
)	O
;	O
if	O
(	O
imode	int
!=	O
0	int
)	O
(	O
void	O
)	O
fsysdep_change_mode	function
(	O
zto	pointer
,	O
imode	int
)	O
;	O
}	O
else	O
{	O
const	O
char	O
*	O
zloc	pointer
;	O
char	O
abtname	array
[	O
CFILE_NAME_LEN	O
]	O
;	O
unsigned	O
int	O
imode	int
;	O
char	O
*	O
ztemp	pointer
;	O
imode	int
=	O
ixsysdep_user_file_mode	function
(	O
zfile	pointer
)	O
;	O
if	O
(	O
imode	int
==	O
0	int
)	O
ucabort	function
(	O
)	O
;	O
zloc	pointer
=	O
sCdestsys	struct
.	O
uuconf_zlocalname	pointer
;	O
if	O
(	O
zloc	pointer
==	O
NULL	O
)	O
zloc	pointer
=	O
zClocalname	pointer
;	O
ztemp	pointer
=	O
zsysdep_data_file_name	function
(	O
&	O
sCdestsys	struct
,	O
zloc	pointer
,	O
bCgrade	char
,	O
FALSE	O
,	O
abtname	array
,	O
(	O
char	O
*	O
)	O
NULL	O
,	O
(	O
char	O
*	O
)	O
NULL	O
)	O
;	O
if	O
(	O
ztemp	pointer
==	O
NULL	O
)	O
ucabort	function
(	O
)	O
;	O
if	O
(	O
!	O
fCcopy	int
)	O
{	O
ubuffree	function
(	O
ztemp	pointer
)	O
;	O
if	O
(	O
!	O
fsysdep_daemon_access	function
(	O
zfile	pointer
)	O
)	O
ucabort	function
(	O
)	O
;	O
if	O
(	O
!	O
fin_directory_list	function
(	O
zfile	pointer
,	O
sCdestsys	struct
.	O
uuconf_pzlocal_send	pointer
,	O
sCdestsys	struct
.	O
uuconf_zpubdir	pointer
,	O
TRUE	O
,	O
TRUE	O
,	O
(	O
fCremote	int
?	O
(	O
const	O
char	O
*	O
)	O
NULL	O
:	O
zCuser	pointer
)	O
)	O
)	O
ulog	function
(	O
LOG_FATAL	int
,	O
"Daemon not permitted to send %s (suggest --copy)"	pointer
,	O
zfile	pointer
)	O
;	O
}	O
else	O
{	O
efrom	pointer
=	O
esysdep_user_fopen	function
(	O
zfile	pointer
,	O
TRUE	O
,	O
TRUE	O
)	O
;	O
if	O
(	O
!	O
ffileisopen	O
(	O
efrom	pointer
)	O
)	O
ucabort	function
(	O
)	O
;	O
ucrecord_file	function
(	O
ztemp	pointer
)	O
;	O
if	O
(	O
!	O
fcopy_open_file	function
(	O
efrom	pointer
,	O
ztemp	pointer
,	O
FALSE	O
,	O
TRUE	O
,	O
TRUE	O
)	O
)	O
ucabort	function
(	O
)	O
;	O
(	O
void	O
)	O
ffileclose	O
(	O
efrom	pointer
)	O
;	O
}	O
if	O
(	O
zCforward	pointer
==	O
NULL	O
)	O
{	O
s	struct
.	O
bcmd	char
=	O
'S'	O
;	O
s	struct
.	O
bgrade	char
=	O
bCgrade	char
;	O
s	struct
.	O
pseq	pointer
=	O
NULL	O
;	O
s	struct
.	O
zfrom	pointer
=	O
zbufcpy	function
(	O
zfile	pointer
)	O
;	O
s	struct
.	O
zto	pointer
=	O
zbufcpy	function
(	O
zdest	pointer
)	O
;	O
s	struct
.	O
zuser	pointer
=	O
zCuser	pointer
;	O
s	struct
.	O
zoptions	pointer
=	O
abCsend_options	array
;	O
s	struct
.	O
ztemp	pointer
=	O
zbufcpy	function
(	O
abtname	array
)	O
;	O
s	struct
.	O
imode	int
=	O
imode	int
;	O
s	struct
.	O
znotify	pointer
=	O
zCnotify	pointer
;	O
s	struct
.	O
cbytes	long
=	O
-	O
1	int
;	O
s	struct
.	O
zcmd	pointer
=	O
NULL	O
;	O
s	struct
.	O
ipos	long
=	O
0	int
;	O
ucadd_cmd	function
(	O
&	O
sCdestsys	struct
,	O
&	O
s	struct
,	O
(	O
const	O
char	O
*	O
)	O
NULL	O
)	O
;	O
}	O
else	O
{	O
char	O
*	O
zbase	pointer
;	O
char	O
*	O
zxqt	pointer
;	O
char	O
abxtname	array
[	O
CFILE_NAME_LEN	O
]	O
;	O
char	O
abdname	array
[	O
CFILE_NAME_LEN	O
]	O
;	O
char	O
abxname	array
[	O
CFILE_NAME_LEN	O
]	O
;	O
FILE	struct
*	O
e	pointer
;	O
char	O
*	O
zlog	pointer
;	O
zbase	pointer
=	O
zsysdep_base_name	function
(	O
zfile	pointer
)	O
;	O
if	O
(	O
zbase	pointer
==	O
NULL	O
)	O
ucabort	function
(	O
)	O
;	O
zxqt	pointer
=	O
zsysdep_data_file_name	function
(	O
&	O
sCdestsys	struct
,	O
zloc	pointer
,	O
bCgrade	char
,	O
TRUE	O
,	O
abxtname	array
,	O
abdname	array
,	O
abxname	array
)	O
;	O
if	O
(	O
zxqt	pointer
==	O
NULL	O
)	O
ucabort	function
(	O
)	O
;	O
e	pointer
=	O
esysdep_fopen	function
(	O
zxqt	pointer
,	O
FALSE	O
,	O
FALSE	O
,	O
TRUE	O
)	O
;	O
if	O
(	O
e	pointer
==	O
NULL	O
)	O
ucabort	function
(	O
)	O
;	O
ucrecord_file	function
(	O
zxqt	pointer
)	O
;	O
fprintf	function
(	O
e	pointer
,	O
"U %s %s\n"	pointer
,	O
zCuser	pointer
,	O
zloc	pointer
)	O
;	O
fprintf	function
(	O
e	pointer
,	O
"F %s %s\n"	pointer
,	O
abdname	array
,	O
zbase	pointer
)	O
;	O
fprintf	function
(	O
e	pointer
,	O
"C uucp -C"	pointer
)	O
;	O
if	O
(	O
fCmkdirs	int
)	O
fprintf	function
(	O
e	pointer
,	O
" -d"	pointer
)	O
;	O
else	O
fprintf	function
(	O
e	pointer
,	O
" -f"	pointer
)	O
;	O
fprintf	function
(	O
e	pointer
,	O
" -g %c"	pointer
,	O
bCgrade	char
)	O
;	O
if	O
(	O
fCmail	int
)	O
fprintf	function
(	O
e	pointer
,	O
" -m"	pointer
)	O
;	O
if	O
(	O
*	O
zCnotify	pointer
!=	O
'\0'	O
)	O
fprintf	function
(	O
e	pointer
,	O
" -n %s"	pointer
,	O
zCnotify	pointer
)	O
;	O
if	O
(	O
!	O
fCexpand	int
)	O
fprintf	function
(	O
e	pointer
,	O
" -W"	pointer
)	O
;	O
fprintf	function
(	O
e	pointer
,	O
" %s %s!%s\n"	pointer
,	O
zbase	pointer
,	O
zCforward	pointer
,	O
zdest	pointer
)	O
;	O
ubuffree	function
(	O
zbase	pointer
)	O
;	O
if	O
(	O
!	O
fstdiosync	O
(	O
e	pointer
,	O
zxqt	pointer
)	O
)	O
ulog	function
(	O
LOG_FATAL	int
,	O
"fsync failed"	pointer
)	O
;	O
if	O
(	O
fclose	function
(	O
e	pointer
)	O
!=	O
0	int
)	O
ulog	function
(	O
LOG_FATAL	int
,	O
"fclose: %s"	pointer
,	O
strerror	function
(	O
errno	O
)	O
)	O
;	O
s	struct
.	O
bcmd	char
=	O
'S'	O
;	O
s	struct
.	O
bgrade	char
=	O
bCgrade	char
;	O
s	struct
.	O
pseq	pointer
=	O
NULL	O
;	O
s	struct
.	O
zfrom	pointer
=	O
zbufcpy	function
(	O
abxtname	array
)	O
;	O
s	struct
.	O
zto	pointer
=	O
zbufcpy	function
(	O
abxname	array
)	O
;	O
s	struct
.	O
zuser	pointer
=	O
zCuser	pointer
;	O
s	struct
.	O
zoptions	pointer
=	O
"C"	pointer
;	O
s	struct
.	O
ztemp	pointer
=	O
s	struct
.	O
zfrom	pointer
;	O
s	struct
.	O
imode	int
=	O
0666	int
;	O
s	struct
.	O
znotify	pointer
=	O
NULL	O
;	O
s	struct
.	O
cbytes	long
=	O
-	O
1	int
;	O
s	struct
.	O
zcmd	pointer
=	O
NULL	O
;	O
s	struct
.	O
ipos	long
=	O
0	int
;	O
zlog	pointer
=	O
zbufalc	function
(	O
sizeof	O
"Queuing uucp  !"	pointer
+	O
strlen	function
(	O
zfile	pointer
)	O
+	O
strlen	function
(	O
zCforward	pointer
)	O
+	O
strlen	function
(	O
zdest	pointer
)	O
)	O
;	O
sprintf	function
(	O
zlog	pointer
,	O
"Queuing uucp %s %s!%s"	pointer
,	O
zfile	pointer
,	O
zCforward	pointer
,	O
zdest	pointer
)	O
;	O
ucadd_cmd	function
(	O
&	O
sCdestsys	struct
,	O
&	O
s	struct
,	O
zlog	pointer
)	O
;	O
s	struct
.	O
bcmd	char
=	O
'S'	O
;	O
s	struct
.	O
bgrade	char
=	O
bCgrade	char
;	O
s	struct
.	O
pseq	pointer
=	O
NULL	O
;	O
s	struct
.	O
zfrom	pointer
=	O
zbufcpy	function
(	O
zfile	pointer
)	O
;	O
s	struct
.	O
zto	pointer
=	O
zbufcpy	function
(	O
abdname	array
)	O
;	O
s	struct
.	O
zuser	pointer
=	O
zCuser	pointer
;	O
s	struct
.	O
zoptions	pointer
=	O
fCcopy	int
?	O
"C"	pointer
:	O
"c"	pointer
;	O
s	struct
.	O
ztemp	pointer
=	O
zbufcpy	function
(	O
abtname	array
)	O
;	O
s	struct
.	O
imode	int
=	O
0666	int
;	O
s	struct
.	O
znotify	pointer
=	O
NULL	O
;	O
s	struct
.	O
cbytes	long
=	O
-	O
1	int
;	O
s	struct
.	O
zcmd	pointer
=	O
NULL	O
;	O
s	struct
.	O
ipos	long
=	O
0	int
;	O
ucadd_cmd	function
(	O
&	O
sCdestsys	struct
,	O
&	O
s	struct
,	O
""	pointer
)	O
;	O
}	O
}	O
}	O
else	O
{	O
char	O
*	O
zfrom	pointer
;	O
char	O
*	O
zforward	pointer
;	O
size_t	long
clen	long
;	O
char	O
*	O
zcopy	pointer
;	O
struct	O
uuconf_system	struct
*	O
qfromsys	pointer
;	O
int	O
iuuconf	int
;	O
const	O
char	O
*	O
zloc	pointer
;	O
zfrom	pointer
=	O
strrchr	function
(	O
zfile	pointer
,	O
'!'	O
)	O
;	O
if	O
(	O
zfrom	pointer
==	O
zexclam	pointer
)	O
zforward	pointer
=	O
NULL	O
;	O
else	O
{	O
clen	long
=	O
zfrom	pointer
-	O
zexclam	pointer
-	O
1	int
;	O
zforward	pointer
=	O
zbufalc	function
(	O
clen	long
+	O
1	int
)	O
;	O
memcpy	function
(	O
zforward	pointer
,	O
zexclam	pointer
+	O
1	int
,	O
clen	long
)	O
;	O
zforward	pointer
[	O
clen	long
]	O
=	O
'\0'	O
;	O
}	O
++	O
zfrom	pointer
;	O
if	O
(	O
fCexpand	int
)	O
{	O
zfrom	pointer
=	O
zsysdep_add_cwd	function
(	O
zfrom	pointer
)	O
;	O
if	O
(	O
zfrom	pointer
==	O
NULL	O
)	O
ucabort	function
(	O
)	O
;	O
}	O
clen	long
=	O
zexclam	pointer
-	O
zfile	pointer
;	O
zcopy	pointer
=	O
zbufalc	function
(	O
clen	long
+	O
1	int
)	O
;	O
memcpy	function
(	O
zcopy	pointer
,	O
zfile	pointer
,	O
clen	long
)	O
;	O
zcopy	pointer
[	O
clen	long
]	O
=	O
'\0'	O
;	O
qfromsys	pointer
=	O
(	O
(	O
struct	O
uuconf_system	struct
*	O
)	O
xmalloc	function
(	O
sizeof	O
(	O
struct	O
uuconf_system	struct
)	O
)	O
)	O
;	O
iuuconf	int
=	O
uuconf_system_info	function
(	O
pCuuconf	pointer
,	O
zcopy	pointer
,	O
qfromsys	pointer
)	O
;	O
if	O
(	O
iuuconf	int
==	O
UUCONF_NOT_FOUND	O
)	O
{	O
if	O
(	O
!	O
funknown_system	function
(	O
pCuuconf	pointer
,	O
zcopy	pointer
,	O
qfromsys	pointer
)	O
)	O
ulog	function
(	O
LOG_FATAL	int
,	O
"%s: System not found"	pointer
,	O
zcopy	pointer
)	O
;	O
}	O
else	O
if	O
(	O
iuuconf	int
!=	O
UUCONF_SUCCESS	O
)	O
ulog_uuconf	function
(	O
LOG_FATAL	int
,	O
pCuuconf	pointer
,	O
iuuconf	int
)	O
;	O
ubuffree	function
(	O
zcopy	pointer
)	O
;	O
zloc	pointer
=	O
qfromsys	pointer
->	O
uuconf_zlocalname	pointer
;	O
if	O
(	O
zloc	pointer
==	O
NULL	O
)	O
zloc	pointer
=	O
zClocalname	pointer
;	O
if	O
(	O
zforward	pointer
==	O
NULL	O
&&	O
fClocaldest	int
)	O
{	O
boolean	int
fok	int
;	O
if	O
(	O
fCremote	int
)	O
fok	int
=	O
fin_directory_list	function
(	O
zdest	pointer
,	O
qfromsys	pointer
->	O
uuconf_pzremote_receive	pointer
,	O
qfromsys	pointer
->	O
uuconf_zpubdir	pointer
,	O
TRUE	O
,	O
FALSE	O
,	O
(	O
const	O
char	O
*	O
)	O
NULL	O
)	O
;	O
else	O
fok	int
=	O
fin_directory_list	function
(	O
zdest	pointer
,	O
qfromsys	pointer
->	O
uuconf_pzlocal_receive	pointer
,	O
qfromsys	pointer
->	O
uuconf_zpubdir	pointer
,	O
TRUE	O
,	O
FALSE	O
,	O
zCuser	pointer
)	O
;	O
if	O
(	O
!	O
fok	int
)	O
ulog	function
(	O
LOG_FATAL	int
,	O
"Not permitted to receive to %s"	pointer
,	O
zdest	pointer
)	O
;	O
if	O
(	O
zfrom	pointer
[	O
strcspn	function
(	O
zfrom	pointer
,	O
"*?["	pointer
)	O
]	O
!=	O
'\0'	O
)	O
{	O
s	struct
.	O
bcmd	char
=	O
'X'	O
;	O
zto	pointer
=	O
zbufalc	function
(	O
strlen	function
(	O
zloc	pointer
)	O
+	O
strlen	function
(	O
zdest	pointer
)	O
+	O
sizeof	O
"!"	pointer
)	O
;	O
sprintf	function
(	O
zto	pointer
,	O
"%s!%s"	pointer
,	O
zloc	pointer
,	O
zdest	pointer
)	O
;	O
}	O
else	O
{	O
s	struct
.	O
bcmd	char
=	O
'R'	O
;	O
zto	pointer
=	O
zbufcpy	function
(	O
zdest	pointer
)	O
;	O
}	O
s	struct
.	O
bgrade	char
=	O
bCgrade	char
;	O
s	struct
.	O
pseq	pointer
=	O
NULL	O
;	O
s	struct
.	O
zfrom	pointer
=	O
zfrom	pointer
;	O
s	struct
.	O
zto	pointer
=	O
zto	pointer
;	O
s	struct
.	O
zuser	pointer
=	O
zCuser	pointer
;	O
s	struct
.	O
zoptions	pointer
=	O
abCrec_options	array
;	O
s	struct
.	O
ztemp	pointer
=	O
""	pointer
;	O
s	struct
.	O
imode	int
=	O
0	int
;	O
s	struct
.	O
znotify	pointer
=	O
""	pointer
;	O
s	struct
.	O
cbytes	long
=	O
-	O
1	int
;	O
s	struct
.	O
zcmd	pointer
=	O
NULL	O
;	O
s	struct
.	O
ipos	long
=	O
0	int
;	O
ucadd_cmd	function
(	O
qfromsys	pointer
,	O
&	O
s	struct
,	O
(	O
const	O
char	O
*	O
)	O
NULL	O
)	O
;	O
}	O
else	O
{	O
char	O
*	O
zxqt	pointer
;	O
char	O
abtname	array
[	O
CFILE_NAME_LEN	O
]	O
;	O
char	O
abxname	array
[	O
CFILE_NAME_LEN	O
]	O
;	O
FILE	struct
*	O
e	pointer
;	O
char	O
*	O
zcmd	pointer
;	O
char	O
*	O
zlog	pointer
;	O
zxqt	pointer
=	O
zsysdep_data_file_name	function
(	O
qfromsys	pointer
,	O
zloc	pointer
,	O
bCgrade	char
,	O
TRUE	O
,	O
abtname	array
,	O
(	O
char	O
*	O
)	O
NULL	O
,	O
abxname	array
)	O
;	O
if	O
(	O
zxqt	pointer
==	O
NULL	O
)	O
ucabort	function
(	O
)	O
;	O
e	pointer
=	O
esysdep_fopen	function
(	O
zxqt	pointer
,	O
FALSE	O
,	O
FALSE	O
,	O
TRUE	O
)	O
;	O
if	O
(	O
e	pointer
==	O
NULL	O
)	O
ucabort	function
(	O
)	O
;	O
ucrecord_file	function
(	O
zxqt	pointer
)	O
;	O
fprintf	function
(	O
e	pointer
,	O
"U %s %s\n"	pointer
,	O
zCuser	pointer
,	O
zloc	pointer
)	O
;	O
fprintf	function
(	O
e	pointer
,	O
"C uucp -C"	pointer
)	O
;	O
if	O
(	O
fCmkdirs	int
)	O
fprintf	function
(	O
e	pointer
,	O
" -d"	pointer
)	O
;	O
else	O
fprintf	function
(	O
e	pointer
,	O
" -f"	pointer
)	O
;	O
fprintf	function
(	O
e	pointer
,	O
" -g %c"	pointer
,	O
bCgrade	char
)	O
;	O
if	O
(	O
fCmail	int
)	O
fprintf	function
(	O
e	pointer
,	O
" -m"	pointer
)	O
;	O
if	O
(	O
*	O
zCnotify	pointer
!=	O
'\0'	O
)	O
fprintf	function
(	O
e	pointer
,	O
" -n %s"	pointer
,	O
zCnotify	pointer
)	O
;	O
if	O
(	O
!	O
fCexpand	int
)	O
fprintf	function
(	O
e	pointer
,	O
" -W"	pointer
)	O
;	O
clen	long
=	O
(	O
strlen	function
(	O
zfrom	pointer
)	O
+	O
strlen	function
(	O
zloc	pointer
)	O
+	O
strlen	function
(	O
sCdestsys	struct
.	O
uuconf_zname	pointer
)	O
+	O
strlen	function
(	O
zdest	pointer
)	O
)	O
;	O
if	O
(	O
zforward	pointer
!=	O
NULL	O
)	O
clen	long
+=	O
strlen	function
(	O
zforward	pointer
)	O
;	O
if	O
(	O
zCforward	pointer
!=	O
NULL	O
)	O
clen	long
+=	O
strlen	function
(	O
zCforward	pointer
)	O
;	O
zcmd	pointer
=	O
zbufalc	function
(	O
sizeof	O
"! !!!"	pointer
+	O
clen	long
)	O
;	O
*	O
zcmd	pointer
=	O
'\0'	O
;	O
if	O
(	O
zforward	pointer
!=	O
NULL	O
)	O
sprintf	function
(	O
zcmd	pointer
+	O
strlen	function
(	O
zcmd	pointer
)	O
,	O
"%s!"	pointer
,	O
zforward	pointer
)	O
;	O
sprintf	function
(	O
zcmd	pointer
+	O
strlen	function
(	O
zcmd	pointer
)	O
,	O
"%s %s!"	pointer
,	O
zfrom	pointer
,	O
zloc	pointer
)	O
;	O
if	O
(	O
!	O
fClocaldest	int
)	O
sprintf	function
(	O
zcmd	pointer
+	O
strlen	function
(	O
zcmd	pointer
)	O
,	O
"%s!"	pointer
,	O
sCdestsys	struct
.	O
uuconf_zname	pointer
)	O
;	O
if	O
(	O
zCforward	pointer
!=	O
NULL	O
)	O
sprintf	function
(	O
zcmd	pointer
+	O
strlen	function
(	O
zcmd	pointer
)	O
,	O
"%s!"	pointer
,	O
zCforward	pointer
)	O
;	O
sprintf	function
(	O
zcmd	pointer
+	O
strlen	function
(	O
zcmd	pointer
)	O
,	O
"%s"	pointer
,	O
zdest	pointer
)	O
;	O
fprintf	function
(	O
e	pointer
,	O
" %s\n"	pointer
,	O
zcmd	pointer
)	O
;	O
if	O
(	O
!	O
fstdiosync	O
(	O
e	pointer
,	O
zxqt	pointer
)	O
)	O
ulog	function
(	O
LOG_FATAL	int
,	O
"fsync failed"	pointer
)	O
;	O
if	O
(	O
fclose	function
(	O
e	pointer
)	O
!=	O
0	int
)	O
ulog	function
(	O
LOG_FATAL	int
,	O
"fclose: %s"	pointer
,	O
strerror	function
(	O
errno	O
)	O
)	O
;	O
s	struct
.	O
bcmd	char
=	O
'S'	O
;	O
s	struct
.	O
bgrade	char
=	O
bCgrade	char
;	O
s	struct
.	O
pseq	pointer
=	O
NULL	O
;	O
s	struct
.	O
zfrom	pointer
=	O
zbufcpy	function
(	O
abtname	array
)	O
;	O
s	struct
.	O
zto	pointer
=	O
zbufcpy	function
(	O
abxname	array
)	O
;	O
s	struct
.	O
zuser	pointer
=	O
zCuser	pointer
;	O
s	struct
.	O
zoptions	pointer
=	O
"C"	pointer
;	O
s	struct
.	O
ztemp	pointer
=	O
s	struct
.	O
zfrom	pointer
;	O
s	struct
.	O
imode	int
=	O
0666	int
;	O
s	struct
.	O
znotify	pointer
=	O
NULL	O
;	O
s	struct
.	O
cbytes	long
=	O
-	O
1	int
;	O
s	struct
.	O
zcmd	pointer
=	O
NULL	O
;	O
s	struct
.	O
ipos	long
=	O
0	int
;	O
zlog	pointer
=	O
zbufalc	function
(	O
sizeof	O
"Queueing uucp "	pointer
+	O
strlen	function
(	O
zcmd	pointer
)	O
)	O
;	O
sprintf	function
(	O
zlog	pointer
,	O
"Queueing uucp %s"	pointer
,	O
zcmd	pointer
)	O
;	O
ucadd_cmd	function
(	O
qfromsys	pointer
,	O
&	O
s	struct
,	O
zlog	pointer
)	O
;	O
ubuffree	function
(	O
zcmd	pointer
)	O
;	O
ubuffree	function
(	O
zforward	pointer
)	O
;	O
}	O
}	O
}	O
struct	O
sjob	struct
{	O
struct	O
sjob	struct
*	O
qnext	pointer
;	O
const	O
struct	O
uuconf_system	struct
*	O
qsys	pointer
;	O
int	O
ccmds	int
;	O
struct	O
scmd	struct
*	O
pascmds	pointer
;	O
const	O
char	O
*	O
*	O
pazlogs	pointer
;	O
}	O
;	O
static	O
struct	O
sjob	struct
*	O
qCjobs	pointer
;	O
static	O
void	O
ucadd_cmd	function
(	O
qsys	pointer
,	O
qcmd	pointer
,	O
zlog	pointer
)	O
const	O
struct	O
uuconf_system	struct
*	O
qsys	pointer
;	O
const	O
struct	O
scmd	struct
*	O
qcmd	pointer
;	O
const	O
char	O
*	O
zlog	pointer
;	O
{	O
struct	O
sjob	struct
*	O
qjob	pointer
;	O
if	O
(	O
!	O
qsys	pointer
->	O
uuconf_fcall_transfer	int
&&	O
!	O
qsys	pointer
->	O
uuconf_fcalled_transfer	int
)	O
ulog	function
(	O
LOG_FATAL	int
,	O
"Not permitted to transfer files to or from %s"	pointer
,	O
qsys	pointer
->	O
uuconf_zname	pointer
)	O
;	O
for	O
(	O
qjob	pointer
=	O
qCjobs	pointer
;	O
qjob	pointer
!=	O
NULL	O
;	O
qjob	pointer
=	O
qjob	pointer
->	O
qnext	pointer
)	O
if	O
(	O
strcmp	function
(	O
qjob	pointer
->	O
qsys	pointer
->	O
uuconf_zname	pointer
,	O
qsys	pointer
->	O
uuconf_zname	pointer
)	O
==	O
0	int
)	O
break	O
;	O
if	O
(	O
qjob	pointer
==	O
NULL	O
)	O
{	O
qjob	pointer
=	O
(	O
struct	O
sjob	struct
*	O
)	O
xmalloc	function
(	O
sizeof	O
(	O
struct	O
sjob	struct
)	O
)	O
;	O
qjob	pointer
->	O
qnext	pointer
=	O
qCjobs	pointer
;	O
qjob	pointer
->	O
qsys	pointer
=	O
qsys	pointer
;	O
qjob	pointer
->	O
ccmds	int
=	O
0	int
;	O
qjob	pointer
->	O
pascmds	pointer
=	O
NULL	O
;	O
qjob	pointer
->	O
pazlogs	pointer
=	O
NULL	O
;	O
qCjobs	pointer
=	O
qjob	pointer
;	O
}	O
qjob	pointer
->	O
pascmds	pointer
=	O
(	O
(	O
struct	O
scmd	struct
*	O
)	O
xrealloc	function
(	O
(	O
pointer	pointer
)	O
qjob	pointer
->	O
pascmds	pointer
,	O
(	O
qjob	pointer
->	O
ccmds	int
+	O
1	int
)	O
*	O
sizeof	O
(	O
struct	O
scmd	struct
)	O
)	O
)	O
;	O
qjob	pointer
->	O
pascmds	pointer
[	O
qjob	pointer
->	O
ccmds	int
]	O
=	O
*	O
qcmd	pointer
;	O
qjob	pointer
->	O
pazlogs	pointer
=	O
(	O
(	O
const	O
char	O
*	O
*	O
)	O
xrealloc	function
(	O
(	O
pointer	pointer
)	O
qjob	pointer
->	O
pazlogs	pointer
,	O
(	O
qjob	pointer
->	O
ccmds	int
+	O
1	int
)	O
*	O
sizeof	O
(	O
const	O
char	O
*	O
)	O
)	O
)	O
;	O
qjob	pointer
->	O
pazlogs	pointer
[	O
qjob	pointer
->	O
ccmds	int
]	O
=	O
zlog	pointer
;	O
++	O
qjob	pointer
->	O
ccmds	int
;	O
}	O
static	O
void	O
ucspool_cmds	function
(	O
fjobid	int
)	O
boolean	int
fjobid	int
;	O
{	O
struct	O
sjob	struct
*	O
qjob	pointer
;	O
char	O
*	O
zjobid	pointer
;	O
for	O
(	O
qjob	pointer
=	O
qCjobs	pointer
;	O
qjob	pointer
!=	O
NULL	O
;	O
qjob	pointer
=	O
qjob	pointer
->	O
qnext	pointer
)	O
{	O
ulog_system	function
(	O
qjob	pointer
->	O
qsys	pointer
->	O
uuconf_zname	pointer
)	O
;	O
zjobid	pointer
=	O
zsysdep_spool_commands	function
(	O
qjob	pointer
->	O
qsys	pointer
,	O
bCgrade	char
,	O
qjob	pointer
->	O
ccmds	int
,	O
qjob	pointer
->	O
pascmds	pointer
,	O
(	O
boolean	int
*	O
)	O
NULL	O
)	O
;	O
if	O
(	O
zjobid	pointer
!=	O
NULL	O
)	O
{	O
int	O
i	int
;	O
struct	O
scmd	struct
*	O
qcmd	pointer
;	O
const	O
char	O
*	O
*	O
pz	pointer
;	O
for	O
(	O
i	int
=	O
0	int
,	O
qcmd	pointer
=	O
qjob	pointer
->	O
pascmds	pointer
,	O
pz	pointer
=	O
qjob	pointer
->	O
pazlogs	pointer
;	O
i	int
<	O
qjob	pointer
->	O
ccmds	int
;	O
i	int
++	O
,	O
qcmd	pointer
++	O
,	O
pz	pointer
++	O
)	O
{	O
if	O
(	O
*	O
pz	pointer
!=	O
NULL	O
)	O
{	O
if	O
(	O
*	O
*	O
pz	pointer
!=	O
'\0'	O
)	O
ulog	function
(	O
LOG_NORMAL	int
,	O
"%s"	pointer
,	O
*	O
pz	pointer
)	O
;	O
}	O
else	O
if	O
(	O
qcmd	pointer
->	O
bcmd	char
==	O
'S'	O
)	O
ulog	function
(	O
LOG_NORMAL	int
,	O
"Queuing send of %s to %s"	pointer
,	O
qcmd	pointer
->	O
zfrom	pointer
,	O
qcmd	pointer
->	O
zto	pointer
)	O
;	O
else	O
if	O
(	O
qcmd	pointer
->	O
bcmd	char
==	O
'R'	O
)	O
ulog	function
(	O
LOG_NORMAL	int
,	O
"Queuing request of %s to %s"	pointer
,	O
qcmd	pointer
->	O
zfrom	pointer
,	O
qcmd	pointer
->	O
zto	pointer
)	O
;	O
else	O
{	O
const	O
char	O
*	O
zto	pointer
;	O
zto	pointer
=	O
strrchr	function
(	O
qcmd	pointer
->	O
zto	pointer
,	O
'!'	O
)	O
;	O
if	O
(	O
zto	pointer
!=	O
NULL	O
)	O
++	O
zto	pointer
;	O
else	O
zto	pointer
=	O
qcmd	pointer
->	O
zto	pointer
;	O
ulog	function
(	O
LOG_NORMAL	int
,	O
"Queuing request of %s to %s"	pointer
,	O
qcmd	pointer
->	O
zfrom	pointer
,	O
zto	pointer
)	O
;	O
}	O
}	O
if	O
(	O
fjobid	int
)	O
printf	function
(	O
"%s\n"	pointer
,	O
zjobid	pointer
)	O
;	O
ubuffree	function
(	O
zjobid	pointer
)	O
;	O
}	O
}	O
}	O
static	O
const	O
char	O
*	O
zcone_system	function
(	O
pfany	pointer
)	O
boolean	int
*	O
pfany	pointer
;	O
{	O
if	O
(	O
qCjobs	pointer
==	O
NULL	O
)	O
{	O
*	O
pfany	pointer
=	O
FALSE	O
;	O
return	O
NULL	O
;	O
}	O
*	O
pfany	pointer
=	O
TRUE	O
;	O
if	O
(	O
qCjobs	pointer
->	O
qnext	pointer
==	O
NULL	O
)	O
return	O
qCjobs	pointer
->	O
qsys	pointer
->	O
uuconf_zname	pointer
;	O
else	O
return	O
NULL	O
;	O
}	O
static	O
int	O
cCfiles	int
;	O
static	O
const	O
char	O
*	O
*	O
pCaz	pointer
;	O
static	O
void	O
ucrecord_file	function
(	O
zfile	pointer
)	O
const	O
char	O
*	O
zfile	pointer
;	O
{	O
pCaz	pointer
=	O
(	O
const	O
char	O
*	O
*	O
)	O
xrealloc	function
(	O
(	O
pointer	pointer
)	O
pCaz	pointer
,	O
(	O
cCfiles	int
+	O
1	int
)	O
*	O
sizeof	O
(	O
const	O
char	O
*	O
)	O
)	O
;	O
pCaz	pointer
[	O
cCfiles	int
]	O
=	O
zfile	pointer
;	O
++	O
cCfiles	int
;	O
}	O
static	O
void	O
ucabort	function
(	O
)	O
{	O
int	O
i	int
;	O
for	O
(	O
i	int
=	O
0	int
;	O
i	int
<	O
cCfiles	int
;	O
i	int
++	O
)	O
(	O
void	O
)	O
remove	function
(	O
pCaz	pointer
[	O
i	int
]	O
)	O
;	O
ulog_close	function
(	O
)	O
;	O
usysdep_exit	function
(	O
FALSE	O
)	O
;	O
}	O
