extern	O
void	O
showPropertiesDialog	function
(	O
)	O
;	O
char	O
*	O
input_str	pointer
;	O
static	O
sig_atomic_t	int
end	int
=	O
0	int
;	O
void	O
exit_gracefully	function
(	O
)	O
{	O
restoreTerminal	function
(	O
)	O
;	O
write_config_file	function
(	O
)	O
;	O
fcloseall	function
(	O
)	O
;	O
showCursor	function
(	O
)	O
;	O
setScreenColors	function
(	O
WHITE	int
,	O
BGDEFAULT	int
)	O
;	O
clearScreen	function
(	O
)	O
;	O
fprintf	function
(	O
stdout	pointer
,	O
"\x1b[0m"	pointer
)	O
;	O
exit	function
(	O
0	int
)	O
;	O
}	O
void	O
sighandler	function
(	O
int	O
signo	int
)	O
{	O
if	O
(	O
signo	int
==	O
2	int
)	O
{	O
copyMarked	function
(	O
)	O
;	O
drawBox	function
(	O
1	int
,	O
1	int
,	O
SCREEN_H	int
,	O
SCREEN_W	int
,	O
" Prime File Manager "	pointer
,	O
NO	int
)	O
;	O
}	O
else	O
if	O
(	O
signo	int
==	O
SIGTSTP	int
)	O
{	O
int	O
i	int
=	O
msgBoxH	function
(	O
"Are you sure you want to exit?"	pointer
,	O
YES	int
|	O
NO	int
,	O
CONFIRM	int
)	O
;	O
if	O
(	O
i	int
==	O
YES	int
)	O
{	O
exit_gracefully	function
(	O
)	O
;	O
}	O
else	O
{	O
refreshWindows	function
(	O
)	O
;	O
}	O
}	O
else	O
{	O
end	int
=	O
1	int
;	O
}	O
}	O
struct	O
termios	struct
oldtio	struct
,	O
curtio	struct
;	O
struct	O
sigaction	struct
sa	struct
;	O
void	O
print_dir_highlight	function
(	O
int	O
selectedDir	int
)	O
{	O
int	O
pos	int
=	O
firstVisDir	int
+	O
selectedDir	int
;	O
int	O
j	int
;	O
fprintf	function
(	O
stdout	pointer
,	O
"\x1b[%d;%dH%s"	pointer
,	O
selectedDir	int
+	O
4	int
,	O
3	int
,	O
dirHighLight	pointer
)	O
;	O
if	O
(	O
dirs	array
[	O
pos	int
]	O
->	O
namelen	int
>=	O
MAX_DIR_NAME_LEN	int
)	O
{	O
fprintf	function
(	O
stdout	pointer
,	O
"\x1b[%d;%dH%c"	pointer
,	O
selectedDir	int
+	O
4	int
,	O
3	int
,	O
dirs	array
[	O
pos	int
]	O
->	O
star	char
)	O
;	O
for	O
(	O
j	int
=	O
0	int
;	O
j	int
<	O
MAX_DIR_NAME_LEN	int
-	O
3	int
;	O
j	int
++	O
)	O
fprintf	function
(	O
stdout	pointer
,	O
"%c"	pointer
,	O
dirs	array
[	O
pos	int
]	O
->	O
name	pointer
[	O
j	int
]	O
)	O
;	O
fprintf	function
(	O
stdout	pointer
,	O
".."	pointer
)	O
;	O
}	O
else	O
{	O
fprintf	function
(	O
stdout	pointer
,	O
"\x1b[%d;%dH%c%s"	pointer
,	O
selectedDir	int
+	O
4	int
,	O
3	int
,	O
dirs	array
[	O
pos	int
]	O
->	O
star	char
,	O
dirs	array
[	O
pos	int
]	O
->	O
name	pointer
)	O
;	O
}	O
}	O
void	O
print_file_highlight	function
(	O
int	O
selectedFile	int
)	O
{	O
int	O
pos	int
=	O
firstVisFile	int
+	O
selectedFile	int
;	O
int	O
j	int
;	O
fprintf	function
(	O
stdout	pointer
,	O
"\x1b[%d;%dH%s"	pointer
,	O
selectedFile	int
+	O
4	int
,	O
(	O
SCREEN_W	int
/	O
2	int
)	O
+	O
1	int
,	O
fileHighLight	pointer
)	O
;	O
if	O
(	O
files	array
[	O
pos	int
]	O
->	O
namelen	int
>=	O
MAX_DIR_NAME_LEN	int
)	O
{	O
fprintf	function
(	O
stdout	pointer
,	O
"\x1b[%d;%dH%c"	pointer
,	O
selectedFile	int
+	O
4	int
,	O
(	O
SCREEN_W	int
/	O
2	int
)	O
+	O
1	int
,	O
files	array
[	O
pos	int
]	O
->	O
star	char
)	O
;	O
for	O
(	O
j	int
=	O
0	int
;	O
j	int
<	O
MAX_DIR_NAME_LEN	int
-	O
3	int
;	O
j	int
++	O
)	O
fprintf	function
(	O
stdout	pointer
,	O
"%c"	pointer
,	O
files	array
[	O
pos	int
]	O
->	O
name	pointer
[	O
j	int
]	O
)	O
;	O
fprintf	function
(	O
stdout	pointer
,	O
".."	pointer
)	O
;	O
}	O
else	O
{	O
fprintf	function
(	O
stdout	pointer
,	O
"\x1b[%d;%dH%c%s"	pointer
,	O
selectedFile	int
+	O
4	int
,	O
(	O
SCREEN_W	int
/	O
2	int
)	O
+	O
1	int
,	O
files	array
[	O
pos	int
]	O
->	O
star	char
,	O
files	array
[	O
pos	int
]	O
->	O
name	pointer
)	O
;	O
}	O
}	O
void	O
showErrorMsgBox	function
(	O
char	O
*	O
msg	pointer
,	O
char	O
*	O
arg	pointer
)	O
{	O
int	O
len1	int
=	O
strlen	function
(	O
msg	pointer
)	O
;	O
int	O
len2	int
=	O
strlen	function
(	O
arg	pointer
)	O
;	O
char	O
tmp	array
[	O
len1	int
+	O
len2	int
+	O
1	int
]	O
;	O
strcpy	function
(	O
tmp	array
,	O
msg	pointer
)	O
;	O
strcat	function
(	O
tmp	array
,	O
arg	pointer
)	O
;	O
msgBoxH	function
(	O
tmp	array
,	O
OK	int
,	O
ERROR	int
)	O
;	O
}	O
void	O
shiftDirsUp	function
(	O
int	O
pos	int
)	O
{	O
if	O
(	O
dirs	array
[	O
pos	int
]	O
->	O
name	pointer
)	O
free	function
(	O
dirs	array
[	O
pos	int
]	O
->	O
name	pointer
)	O
;	O
free	function
(	O
dirs	array
[	O
pos	int
]	O
)	O
;	O
for	O
(	O
;	O
pos	int
<	O
totalDirs	int
-	O
1	int
;	O
pos	int
++	O
)	O
{	O
dirs	array
[	O
pos	int
]	O
=	O
dirs	array
[	O
pos	int
+	O
1	int
]	O
;	O
}	O
dirs	array
[	O
pos	int
]	O
=	O
NULL	O
;	O
totalDirs	int
--	O
;	O
}	O
void	O
shiftFilesUp	function
(	O
int	O
pos	int
)	O
{	O
if	O
(	O
files	array
[	O
pos	int
]	O
->	O
name	pointer
)	O
free	function
(	O
files	array
[	O
pos	int
]	O
->	O
name	pointer
)	O
;	O
free	function
(	O
files	array
[	O
pos	int
]	O
)	O
;	O
for	O
(	O
;	O
pos	int
<	O
totalFiles	int
-	O
1	int
;	O
pos	int
++	O
)	O
{	O
files	array
[	O
pos	int
]	O
=	O
files	array
[	O
pos	int
+	O
1	int
]	O
;	O
}	O
files	array
[	O
pos	int
]	O
=	O
NULL	O
;	O
totalFiles	int
--	O
;	O
}	O
int	O
main	function
(	O
int	O
argc	int
,	O
char	O
*	O
*	O
argv	pointer
)	O
{	O
parse_args	function
(	O
argc	int
,	O
argv	pointer
)	O
;	O
cwd	short
=	O
getcwd	function
(	O
NULL	O
,	O
0	int
)	O
;	O
if	O
(	O
!	O
cwd	short
)	O
{	O
fprintf	function
(	O
stderr	pointer
,	O
"Error: unable to detect current working directory\n"	pointer
)	O
;	O
exit	function
(	O
1	int
)	O
;	O
}	O
cwdlen	int
=	O
strlen	function
(	O
cwd	short
)	O
;	O
init	function
(	O
)	O
;	O
read_config_file	function
(	O
)	O
;	O
clearScreen	function
(	O
)	O
;	O
hideCursor	function
(	O
)	O
;	O
setScreenColorsI	function
(	O
COLOR_WINDOW	int
)	O
;	O
drawBox	function
(	O
1	int
,	O
1	int
,	O
SCREEN_H	int
,	O
SCREEN_W	int
,	O
" Prime File Manager "	pointer
,	O
YES	int
)	O
;	O
drawMenuBar	function
(	O
2	int
,	O
2	int
,	O
SCREEN_W	int
-	O
2	int
)	O
;	O
drawBox	function
(	O
3	int
,	O
(	O
int	O
)	O
(	O
SCREEN_W	int
/	O
2	int
)	O
,	O
SCREEN_H	int
-	O
5	int
,	O
SCREEN_W	int
-	O
1	int
,	O
" File view "	pointer
,	O
YES	int
)	O
;	O
drawBox	function
(	O
SCREEN_H	int
-	O
4	int
,	O
2	int
,	O
SCREEN_H	int
-	O
1	int
,	O
SCREEN_W	int
-	O
1	int
,	O
" Quick functions "	pointer
,	O
YES	int
)	O
;	O
drawBox	function
(	O
3	int
,	O
2	int
,	O
SCREEN_H	int
-	O
5	int
,	O
(	O
int	O
)	O
(	O
SCREEN_W	int
/	O
2	int
)	O
-	O
1	int
,	O
" Directory view "	pointer
,	O
YES	int
)	O
;	O
drawBox	function
(	O
1	int
,	O
1	int
,	O
SCREEN_H	int
,	O
SCREEN_W	int
,	O
" Prime File Manager "	pointer
,	O
NO	int
)	O
;	O
refreshBottomView	function
(	O
)	O
;	O
scanDir	function
(	O
"."	pointer
)	O
;	O
int	O
ch	pointer
,	O
i	int
;	O
while	O
(	O
!	O
end	int
)	O
{	O
ch	pointer
=	O
getKey	function
(	O
)	O
;	O
switch	O
(	O
ch	pointer
)	O
{	O
case	O
(	O
DEL_KEY	int
)	O
:	O
if	O
(	O
GNU_DOS_LEVEL	int
>	O
3	int
)	O
break	O
;	O
do_del	O
:	O
if	O
(	O
numStarred	int
==	O
0	int
)	O
{	O
if	O
(	O
activeWindow	int
==	O
DIR_WIN	int
)	O
{	O
int	O
j	int
=	O
firstVisDir	int
+	O
selectedDir	int
;	O
if	O
(	O
j	int
<	O
2	int
)	O
break	O
;	O
int	O
k	int
=	O
msgBoxH	function
(	O
"Are you sure you want to delete\n"	pointer
"this directory and all its subdirectories?"	pointer
,	O
YES	int
|	O
NO	int
,	O
CONFIRM	int
)	O
;	O
if	O
(	O
k	int
==	O
YES	int
)	O
{	O
char	O
*	O
logfilename	pointer
=	O
tmpnam	function
(	O
NULL	O
)	O
;	O
FILE	struct
*	O
logfile	pointer
=	O
fopen	function
(	O
logfilename	pointer
,	O
"wb"	pointer
)	O
;	O
deleteThisDir	function
(	O
dirs	array
[	O
j	int
]	O
->	O
name	pointer
,	O
0	int
,	O
logfile	pointer
)	O
;	O
purgeLogFile	function
(	O
logfile	pointer
,	O
logfilename	pointer
)	O
;	O
shiftDirsUp	function
(	O
j	int
)	O
;	O
if	O
(	O
j	int
==	O
totalDirs	int
)	O
{	O
if	O
(	O
totalDirs	int
<=	O
numVisDirs	int
)	O
selectedDir	int
--	O
;	O
else	O
firstVisDir	int
--	O
;	O
}	O
}	O
}	O
else	O
{	O
int	O
j	int
=	O
firstVisFile	int
+	O
selectedFile	int
;	O
if	O
(	O
files	array
[	O
j	int
]	O
->	O
type	char
==	O
'%'	O
)	O
break	O
;	O
int	O
k	int
=	O
msgBoxH	function
(	O
"Are you sure you want to delete this file?"	pointer
,	O
YES	int
|	O
NO	int
,	O
CONFIRM	int
)	O
;	O
if	O
(	O
k	int
==	O
YES	int
)	O
{	O
remove	function
(	O
files	array
[	O
j	int
]	O
->	O
name	pointer
)	O
;	O
shiftFilesUp	function
(	O
j	int
)	O
;	O
if	O
(	O
j	int
==	O
totalFiles	int
)	O
{	O
if	O
(	O
totalFiles	int
<=	O
numVisFiles	int
)	O
selectedFile	int
--	O
;	O
else	O
firstVisFile	int
--	O
;	O
}	O
}	O
}	O
refreshWindows	function
(	O
)	O
;	O
refreshBottomView	function
(	O
)	O
;	O
}	O
else	O
{	O
deleteMarked	function
(	O
)	O
;	O
scanDir	function
(	O
cwd	short
)	O
;	O
}	O
break	O
;	O
case	O
(	O
UP_KEY	int
)	O
:	O
if	O
(	O
GNU_DOS_LEVEL	int
>	O
1	int
)	O
break	O
;	O
do_up	O
:	O
if	O
(	O
activeWindow	int
==	O
DIR_WIN	int
)	O
{	O
selectedDir	int
--	O
;	O
if	O
(	O
selectedDir	int
<	O
0	int
)	O
{	O
selectedDir	int
=	O
0	int
;	O
if	O
(	O
firstVisDir	int
>	O
0	int
)	O
{	O
firstVisDir	int
--	O
;	O
refreshDirView	function
(	O
)	O
;	O
}	O
}	O
else	O
{	O
setScreenColors	function
(	O
FILE_DIR_COLOR	array
[	O
DIRCOLOR	O
(	O
firstVisDir	int
+	O
selectedDir	int
+	O
1	int
)	O
]	O
,	O
BG_COLOR	array
[	O
COLOR_WINDOW	int
]	O
)	O
;	O
print_dir_highlight	function
(	O
selectedDir	int
+	O
1	int
)	O
;	O
setScreenColorsI	function
(	O
COLOR_HIGHLIGHT_TEXT	int
)	O
;	O
print_dir_highlight	function
(	O
selectedDir	int
)	O
;	O
}	O
fflush	function
(	O
stdout	pointer
)	O
;	O
}	O
else	O
{	O
if	O
(	O
files	array
[	O
0	int
]	O
->	O
type	char
==	O
'%'	O
)	O
break	O
;	O
selectedFile	int
--	O
;	O
if	O
(	O
selectedFile	int
<	O
0	int
)	O
{	O
selectedFile	int
=	O
0	int
;	O
if	O
(	O
firstVisFile	int
>	O
0	int
)	O
{	O
firstVisFile	int
--	O
;	O
refreshFileView	function
(	O
)	O
;	O
}	O
}	O
else	O
{	O
setScreenColors	function
(	O
FILE_DIR_COLOR	array
[	O
FILECOLOR	O
(	O
firstVisFile	int
+	O
selectedFile	int
+	O
1	int
)	O
]	O
,	O
BG_COLOR	array
[	O
COLOR_WINDOW	int
]	O
)	O
;	O
print_file_highlight	function
(	O
selectedFile	int
+	O
1	int
)	O
;	O
setScreenColorsI	function
(	O
COLOR_HIGHLIGHT_TEXT	int
)	O
;	O
print_file_highlight	function
(	O
selectedFile	int
)	O
;	O
}	O
fflush	function
(	O
stdout	pointer
)	O
;	O
}	O
break	O
;	O
case	O
(	O
DOWN_KEY	int
)	O
:	O
if	O
(	O
GNU_DOS_LEVEL	int
>	O
1	int
)	O
break	O
;	O
do_down	O
:	O
if	O
(	O
activeWindow	int
==	O
DIR_WIN	int
)	O
{	O
selectedDir	int
++	O
;	O
if	O
(	O
selectedDir	int
>=	O
totalDirs	int
)	O
selectedDir	int
--	O
;	O
if	O
(	O
selectedDir	int
>=	O
numVisDirs	int
)	O
{	O
selectedDir	int
=	O
numVisDirs	int
-	O
1	int
;	O
if	O
(	O
(	O
firstVisDir	int
+	O
numVisDirs	int
)	O
<	O
totalDirs	int
)	O
{	O
firstVisDir	int
++	O
;	O
refreshDirView	function
(	O
)	O
;	O
}	O
}	O
else	O
{	O
setScreenColors	function
(	O
FILE_DIR_COLOR	array
[	O
DIRCOLOR	O
(	O
firstVisDir	int
+	O
selectedDir	int
-	O
1	int
)	O
]	O
,	O
BG_COLOR	array
[	O
COLOR_WINDOW	int
]	O
)	O
;	O
print_dir_highlight	function
(	O
selectedDir	int
-	O
1	int
)	O
;	O
setScreenColorsI	function
(	O
COLOR_HIGHLIGHT_TEXT	int
)	O
;	O
print_dir_highlight	function
(	O
selectedDir	int
)	O
;	O
}	O
fflush	function
(	O
stdout	pointer
)	O
;	O
}	O
else	O
{	O
if	O
(	O
files	array
[	O
0	int
]	O
->	O
type	char
==	O
'%'	O
)	O
break	O
;	O
selectedFile	int
++	O
;	O
if	O
(	O
selectedFile	int
>=	O
totalFiles	int
)	O
selectedFile	int
--	O
;	O
if	O
(	O
selectedFile	int
>=	O
numVisFiles	int
)	O
{	O
selectedFile	int
=	O
numVisFiles	int
-	O
1	int
;	O
if	O
(	O
(	O
firstVisFile	int
+	O
numVisFiles	int
)	O
<	O
totalFiles	int
)	O
{	O
firstVisFile	int
++	O
;	O
refreshFileView	function
(	O
)	O
;	O
}	O
}	O
else	O
{	O
setScreenColors	function
(	O
FILE_DIR_COLOR	array
[	O
FILECOLOR	O
(	O
firstVisFile	int
+	O
selectedFile	int
-	O
1	int
)	O
]	O
,	O
BG_COLOR	array
[	O
COLOR_WINDOW	int
]	O
)	O
;	O
print_file_highlight	function
(	O
selectedFile	int
-	O
1	int
)	O
;	O
setScreenColorsI	function
(	O
COLOR_HIGHLIGHT_TEXT	int
)	O
;	O
print_file_highlight	function
(	O
selectedFile	int
)	O
;	O
}	O
fflush	function
(	O
stdout	pointer
)	O
;	O
}	O
break	O
;	O
case	O
(	O
TAB_KEY	int
)	O
:	O
if	O
(	O
activeWindow	int
==	O
DIR_WIN	int
)	O
activeWindow	int
=	O
FILE_WIN	int
;	O
else	O
activeWindow	int
=	O
DIR_WIN	int
;	O
refreshFileView	function
(	O
)	O
;	O
refreshDirView	function
(	O
)	O
;	O
break	O
;	O
case	O
(	O
ENTER_KEY	int
)	O
:	O
if	O
(	O
ALT	int
)	O
{	O
if	O
(	O
activeWindow	int
==	O
FILE_WIN	int
&&	O
files	array
[	O
0	int
]	O
->	O
type	char
==	O
'%'	O
)	O
break	O
;	O
showPropertiesDialog	function
(	O
)	O
;	O
scanDir	function
(	O
cwd	short
)	O
;	O
}	O
else	O
{	O
if	O
(	O
activeWindow	int
==	O
DIR_WIN	int
)	O
{	O
scanDir	function
(	O
dirs	array
[	O
firstVisDir	int
+	O
selectedDir	int
]	O
->	O
name	pointer
)	O
;	O
}	O
else	O
{	O
if	O
(	O
files	array
[	O
0	int
]	O
->	O
type	char
!=	O
'%'	O
)	O
{	O
showPropertiesDialog	function
(	O
)	O
;	O
scanDir	function
(	O
cwd	short
)	O
;	O
}	O
}	O
}	O
break	O
;	O
case	O
(	O
SPACE_KEY	int
)	O
:	O
toggleSelected	function
(	O
)	O
;	O
break	O
;	O
case	O
(	O
's'	O
)	O
:	O
case	O
(	O
'S'	O
)	O
:	O
if	O
(	O
CTRL	int
)	O
{	O
if	O
(	O
GNU_DOS_LEVEL	int
<=	O
4	int
)	O
break	O
;	O
findFile	function
(	O
)	O
;	O
hideCursor	function
(	O
)	O
;	O
scanDir	function
(	O
cwd	short
)	O
;	O
}	O
else	O
goto	O
insert_char	O
;	O
break	O
;	O
case	O
(	O
'f'	O
)	O
:	O
case	O
(	O
'F'	O
)	O
:	O
if	O
(	O
ALT	int
)	O
{	O
showMenu	function
(	O
0	int
)	O
;	O
}	O
else	O
if	O
(	O
CTRL	int
)	O
{	O
if	O
(	O
GNU_DOS_LEVEL	int
>	O
4	int
)	O
break	O
;	O
findFile	function
(	O
)	O
;	O
cwd	short
=	O
getcwd	function
(	O
NULL	O
,	O
0	int
)	O
;	O
scanDir	function
(	O
cwd	short
)	O
;	O
}	O
else	O
goto	O
insert_char	O
;	O
break	O
;	O
case	O
(	O
'e'	O
)	O
:	O
case	O
(	O
'E'	O
)	O
:	O
if	O
(	O
CTRL	int
)	O
{	O
if	O
(	O
GNU_DOS_LEVEL	int
>	O
2	int
)	O
goto	O
do_end	O
;	O
exportTree	function
(	O
YES	int
)	O
;	O
hideCursor	function
(	O
)	O
;	O
scanDir	function
(	O
cwd	short
)	O
;	O
}	O
else	O
if	O
(	O
ALT	int
)	O
{	O
showMenu	function
(	O
1	int
)	O
;	O
}	O
else	O
goto	O
insert_char	O
;	O
break	O
;	O
case	O
(	O
'h'	O
)	O
:	O
case	O
(	O
'H'	O
)	O
:	O
if	O
(	O
ALT	int
)	O
{	O
showMenu	function
(	O
3	int
)	O
;	O
}	O
else	O
goto	O
insert_char	O
;	O
break	O
;	O
case	O
(	O
'x'	O
)	O
:	O
case	O
(	O
'X'	O
)	O
:	O
if	O
(	O
CTRL	int
)	O
{	O
if	O
(	O
GNU_DOS_LEVEL	int
>	O
4	int
)	O
{	O
int	O
k	int
=	O
(	O
int	O
)	O
SCREEN_H	int
/	O
2	int
;	O
int	O
l	int
=	O
(	O
int	O
)	O
SCREEN_W	int
/	O
2	int
;	O
drawBox	function
(	O
k	int
-	O
1	int
,	O
l	int
-	O
23	int
,	O
k	int
+	O
1	int
,	O
l	int
+	O
23	int
,	O
NULL	O
,	O
YES	int
)	O
;	O
setScreenColorsI	function
(	O
COLOR_HIGHLIGHT_TEXT	int
)	O
;	O
fprintf	function
(	O
stdout	pointer
,	O
"\e[%d;%dH"	pointer
,	O
k	int
,	O
l	int
-	O
22	int
)	O
;	O
fprintf	function
(	O
stdout	pointer
,	O
"[C-c] Quit  [C-f] Open location [C-g] Cancel"	pointer
)	O
;	O
int	O
loop	int
=	O
1	int
;	O
while	O
(	O
loop	int
)	O
{	O
ch	pointer
=	O
getKey	function
(	O
)	O
;	O
if	O
(	O
ch	pointer
==	O
'c'	O
&&	O
CTRL	int
)	O
goto	O
do_exit	O
;	O
else	O
if	O
(	O
ch	pointer
==	O
'f'	O
&&	O
CTRL	int
)	O
{	O
file_open_location	function
(	O
)	O
;	O
loop	int
=	O
0	int
;	O
break	O
;	O
}	O
else	O
if	O
(	O
ch	pointer
==	O
'g'	O
&&	O
CTRL	int
)	O
{	O
refreshWindows	function
(	O
)	O
;	O
loop	int
=	O
0	int
;	O
break	O
;	O
}	O
}	O
}	O
else	O
cutMarked	function
(	O
)	O
;	O
}	O
else	O
goto	O
insert_char	O
;	O
break	O
;	O
case	O
(	O
'v'	O
)	O
:	O
case	O
(	O
'V'	O
)	O
:	O
if	O
(	O
CTRL	int
)	O
{	O
if	O
(	O
GNU_DOS_LEVEL	int
>	O
3	int
)	O
break	O
;	O
pasteMarked	function
(	O
)	O
;	O
}	O
else	O
goto	O
insert_char	O
;	O
break	O
;	O
case	O
(	O
'p'	O
)	O
:	O
case	O
(	O
'P'	O
)	O
:	O
if	O
(	O
CTRL	int
)	O
{	O
if	O
(	O
GNU_DOS_LEVEL	int
>	O
1	int
)	O
goto	O
do_up	O
;	O
msgBoxH	function
(	O
"Oops! This function is currently not implemented."	pointer
,	O
OK	int
,	O
INFO	int
)	O
;	O
refreshWindows	function
(	O
)	O
;	O
}	O
else	O
goto	O
insert_char	O
;	O
break	O
;	O
case	O
(	O
'a'	O
)	O
:	O
case	O
(	O
'A'	O
)	O
:	O
if	O
(	O
CTRL	int
)	O
{	O
if	O
(	O
GNU_DOS_LEVEL	int
>	O
2	int
)	O
goto	O
do_home	O
;	O
markAll	function
(	O
)	O
;	O
refreshAll	function
(	O
)	O
;	O
}	O
else	O
goto	O
insert_char	O
;	O
break	O
;	O
case	O
(	O
'w'	O
)	O
:	O
case	O
(	O
'W'	O
)	O
:	O
if	O
(	O
CTRL	int
)	O
{	O
if	O
(	O
GNU_DOS_LEVEL	int
<	O
4	int
)	O
clearSelection	function
(	O
)	O
;	O
else	O
cutMarked	function
(	O
)	O
;	O
}	O
else	O
goto	O
insert_char	O
;	O
break	O
;	O
case	O
(	O
'o'	O
)	O
:	O
case	O
(	O
'O'	O
)	O
:	O
if	O
(	O
CTRL	int
)	O
{	O
if	O
(	O
GNU_DOS_LEVEL	int
>	O
4	int
)	O
break	O
;	O
file_open_location	function
(	O
)	O
;	O
refreshWindows	function
(	O
)	O
;	O
}	O
else	O
if	O
(	O
ALT	int
)	O
{	O
showMenu	function
(	O
2	int
)	O
;	O
}	O
else	O
goto	O
insert_char	O
;	O
break	O
;	O
case	O
(	O
HOME_KEY	int
)	O
:	O
if	O
(	O
GNU_DOS_LEVEL	int
>	O
1	int
)	O
break	O
;	O
do_home	O
:	O
if	O
(	O
activeWindow	int
==	O
DIR_WIN	int
)	O
{	O
firstVisDir	int
=	O
0	int
;	O
selectedDir	int
=	O
0	int
;	O
refreshDirView	function
(	O
)	O
;	O
}	O
else	O
if	O
(	O
activeWindow	int
==	O
FILE_WIN	int
)	O
{	O
firstVisFile	int
=	O
0	int
;	O
selectedFile	int
=	O
0	int
;	O
refreshFileView	function
(	O
)	O
;	O
}	O
fflush	function
(	O
stdout	pointer
)	O
;	O
break	O
;	O
case	O
(	O
END_KEY	int
)	O
:	O
if	O
(	O
GNU_DOS_LEVEL	int
>	O
1	int
)	O
break	O
;	O
do_end	O
:	O
if	O
(	O
activeWindow	int
==	O
DIR_WIN	int
)	O
{	O
if	O
(	O
totalDirs	int
<=	O
numVisDirs	int
)	O
{	O
selectedDir	int
=	O
totalDirs	int
-	O
1	int
;	O
}	O
else	O
{	O
firstVisDir	int
=	O
totalDirs	int
-	O
numVisDirs	int
;	O
selectedDir	int
=	O
numVisDirs	int
-	O
1	int
;	O
}	O
refreshDirView	function
(	O
)	O
;	O
}	O
else	O
{	O
if	O
(	O
totalFiles	int
<=	O
numVisFiles	int
)	O
{	O
selectedFile	int
=	O
totalFiles	int
-	O
1	int
;	O
}	O
else	O
{	O
firstVisFile	int
=	O
totalFiles	int
-	O
numVisFiles	int
;	O
selectedFile	int
=	O
numVisFiles	int
-	O
1	int
;	O
}	O
refreshFileView	function
(	O
)	O
;	O
fflush	function
(	O
stdout	pointer
)	O
;	O
}	O
break	O
;	O
case	O
(	O
'g'	O
)	O
:	O
case	O
(	O
'G'	O
)	O
:	O
if	O
(	O
CTRL	int
)	O
{	O
if	O
(	O
GNU_DOS_LEVEL	int
<	O
3	int
)	O
break	O
;	O
goto	O
do_exit	O
;	O
}	O
else	O
goto	O
insert_char	O
;	O
break	O
;	O
case	O
(	O
'd'	O
)	O
:	O
case	O
(	O
'D'	O
)	O
:	O
if	O
(	O
CTRL	int
)	O
{	O
if	O
(	O
GNU_DOS_LEVEL	int
>	O
3	int
)	O
goto	O
do_del	O
;	O
}	O
else	O
goto	O
insert_char	O
;	O
break	O
;	O
case	O
(	O
'q'	O
)	O
:	O
case	O
(	O
'Q'	O
)	O
:	O
if	O
(	O
CTRL	int
)	O
{	O
if	O
(	O
GNU_DOS_LEVEL	int
>	O
4	int
)	O
break	O
;	O
do_exit	O
:	O
i	int
=	O
msgBoxH	function
(	O
"Are you sure you want to exit?"	pointer
,	O
YES	int
|	O
NO	int
,	O
CONFIRM	int
)	O
;	O
if	O
(	O
i	int
==	O
YES	int
)	O
exit_gracefully	function
(	O
)	O
;	O
else	O
refreshWindows	function
(	O
)	O
;	O
}	O
else	O
goto	O
insert_char	O
;	O
break	O
;	O
case	O
(	O
'c'	O
)	O
:	O
case	O
(	O
'C'	O
)	O
:	O
if	O
(	O
CTRL	int
)	O
copyMarked	function
(	O
)	O
;	O
else	O
goto	O
insert_char	O
;	O
break	O
;	O
case	O
(	O
'/'	O
)	O
:	O
if	O
(	O
CTRL	int
&&	O
GNU_DOS_LEVEL	int
>	O
4	int
)	O
{	O
unMarkAll	function
(	O
activeWindow	int
)	O
;	O
}	O
break	O
;	O
case	O
(	O
'z'	O
)	O
:	O
case	O
(	O
'Z'	O
)	O
:	O
if	O
(	O
CTRL	int
)	O
{	O
if	O
(	O
GNU_DOS_LEVEL	int
>	O
4	int
)	O
break	O
;	O
unMarkAll	function
(	O
activeWindow	int
)	O
;	O
}	O
else	O
goto	O
insert_char	O
;	O
break	O
;	O
case	O
(	O
'n'	O
)	O
:	O
case	O
(	O
'N'	O
)	O
:	O
if	O
(	O
CTRL	int
)	O
{	O
if	O
(	O
GNU_DOS_LEVEL	int
>	O
1	int
)	O
goto	O
do_down	O
;	O
char	O
*	O
res	pointer
=	O
getUserInput	function
(	O
"Enter directory name to create:"	pointer
,	O
"New Directory"	pointer
)	O
;	O
hideCursor	function
(	O
)	O
;	O
if	O
(	O
!	O
res	pointer
)	O
break	O
;	O
struct	O
stat	struct
st	struct
;	O
if	O
(	O
stat	struct
(	O
res	pointer
,	O
&	O
st	struct
)	O
==	O
-	O
1	int
)	O
{	O
if	O
(	O
mkdir	function
(	O
res	pointer
,	O
0775	int
)	O
==	O
-	O
1	int
)	O
{	O
showErrorMsgBox	function
(	O
"Error creating directory:"	pointer
,	O
res	pointer
)	O
;	O
}	O
}	O
else	O
{	O
msgBoxH	function
(	O
"Directory already exists!"	pointer
,	O
OK	int
,	O
ERROR	int
)	O
;	O
}	O
free	function
(	O
res	pointer
)	O
;	O
scanDir	function
(	O
cwd	short
)	O
;	O
refreshFileView	function
(	O
)	O
;	O
refreshDirView	function
(	O
)	O
;	O
}	O
else	O
goto	O
insert_char	O
;	O
break	O
;	O
default	O
:	O
insert_char	O
:	O
if	O
(	O
ch	pointer
>=	O
33	int
&&	O
ch	pointer
<=	O
126	int
)	O
{	O
int	O
i	int
,	O
x	int
=	O
-	O
1	int
;	O
if	O
(	O
activeWindow	int
==	O
DIR_WIN	int
)	O
{	O
for	O
(	O
i	int
=	O
firstVisDir	int
+	O
selectedDir	int
+	O
1	int
;	O
i	int
<	O
totalDirs	int
;	O
i	int
++	O
)	O
{	O
if	O
(	O
dirs	array
[	O
i	int
]	O
->	O
name	pointer
[	O
0	int
]	O
==	O
ch	pointer
||	O
dirs	array
[	O
i	int
]	O
->	O
name	pointer
[	O
0	int
]	O
==	O
ch	pointer
-	O
32	int
)	O
{	O
x	int
=	O
i	int
;	O
break	O
;	O
}	O
}	O
if	O
(	O
i	int
>=	O
totalDirs	int
)	O
{	O
for	O
(	O
i	int
=	O
0	int
;	O
i	int
<=	O
firstVisDir	int
+	O
selectedDir	int
;	O
i	int
++	O
)	O
{	O
if	O
(	O
dirs	array
[	O
i	int
]	O
->	O
name	pointer
[	O
0	int
]	O
==	O
ch	pointer
||	O
dirs	array
[	O
i	int
]	O
->	O
name	pointer
[	O
0	int
]	O
==	O
ch	pointer
-	O
32	int
)	O
{	O
x	int
=	O
i	int
;	O
break	O
;	O
}	O
}	O
}	O
if	O
(	O
x	int
>=	O
0	int
)	O
{	O
selectedDir	int
=	O
x	int
-	O
firstVisDir	int
;	O
if	O
(	O
totalDirs	int
<=	O
numVisDirs	int
)	O
{	O
refreshDirView	function
(	O
)	O
;	O
continue	O
;	O
}	O
if	O
(	O
selectedDir	int
<	O
0	int
)	O
{	O
firstVisDir	int
+=	O
selectedDir	int
;	O
selectedDir	int
=	O
0	int
;	O
}	O
else	O
if	O
(	O
selectedDir	int
>=	O
numVisDirs	int
)	O
{	O
firstVisDir	int
+=	O
selectedDir	int
-	O
numVisDirs	int
+	O
1	int
;	O
selectedDir	int
=	O
numVisDirs	int
-	O
1	int
;	O
}	O
if	O
(	O
totalDirs	int
-	O
firstVisDir	int
<	O
numVisDirs	int
)	O
{	O
selectedDir	int
=	O
firstVisDir	int
;	O
firstVisDir	int
=	O
totalDirs	int
-	O
numVisDirs	int
;	O
selectedDir	int
-=	O
firstVisDir	int
;	O
}	O
refreshDirView	function
(	O
)	O
;	O
}	O
}	O
else	O
if	O
(	O
activeWindow	int
==	O
FILE_WIN	int
)	O
{	O
for	O
(	O
i	int
=	O
firstVisFile	int
+	O
selectedFile	int
+	O
1	int
;	O
i	int
<	O
totalFiles	int
;	O
i	int
++	O
)	O
{	O
if	O
(	O
files	array
[	O
i	int
]	O
->	O
name	pointer
[	O
0	int
]	O
==	O
ch	pointer
||	O
files	array
[	O
i	int
]	O
->	O
name	pointer
[	O
0	int
]	O
==	O
ch	pointer
-	O
32	int
)	O
{	O
x	int
=	O
i	int
;	O
break	O
;	O
}	O
}	O
if	O
(	O
i	int
>=	O
totalFiles	int
)	O
{	O
for	O
(	O
i	int
=	O
0	int
;	O
i	int
<=	O
firstVisFile	int
+	O
selectedFile	int
;	O
i	int
++	O
)	O
{	O
if	O
(	O
files	array
[	O
i	int
]	O
->	O
name	pointer
[	O
0	int
]	O
==	O
ch	pointer
||	O
files	array
[	O
i	int
]	O
->	O
name	pointer
[	O
0	int
]	O
==	O
ch	pointer
-	O
32	int
)	O
{	O
x	int
=	O
i	int
;	O
break	O
;	O
}	O
}	O
}	O
if	O
(	O
x	int
>=	O
0	int
)	O
{	O
selectedFile	int
=	O
x	int
-	O
firstVisFile	int
;	O
if	O
(	O
totalFiles	int
<=	O
numVisFiles	int
)	O
{	O
refreshFileView	function
(	O
)	O
;	O
continue	O
;	O
}	O
if	O
(	O
selectedFile	int
<	O
0	int
)	O
{	O
firstVisFile	int
+=	O
selectedFile	int
;	O
selectedFile	int
=	O
0	int
;	O
}	O
else	O
if	O
(	O
selectedFile	int
>=	O
numVisFiles	int
)	O
{	O
firstVisFile	int
+=	O
selectedFile	int
-	O
numVisFiles	int
+	O
1	int
;	O
selectedFile	int
=	O
numVisFiles	int
-	O
1	int
;	O
}	O
if	O
(	O
totalFiles	int
-	O
firstVisFile	int
<	O
numVisFiles	int
)	O
{	O
selectedFile	int
=	O
firstVisFile	int
;	O
firstVisFile	int
=	O
totalFiles	int
-	O
numVisFiles	int
;	O
selectedFile	int
-=	O
firstVisFile	int
;	O
}	O
refreshFileView	function
(	O
)	O
;	O
}	O
}	O
}	O
break	O
;	O
}	O
setScreenColorsI	function
(	O
COLOR_WINDOW	int
)	O
;	O
}	O
exit_gracefully	function
(	O
)	O
;	O
return	O
0	int
;	O
}	O
void	O
toggleSelected	function
(	O
)	O
{	O
setScreenColorsI	function
(	O
COLOR_HIGHLIGHT_TEXT	int
)	O
;	O
int	O
pos	int
;	O
switch	O
(	O
activeWindow	int
)	O
{	O
case	O
(	O
DIR_WIN	int
)	O
:	O
pos	int
=	O
firstVisDir	int
+	O
selectedDir	int
;	O
if	O
(	O
(	O
strcmp	function
(	O
dirs	array
[	O
pos	int
]	O
->	O
name	pointer
,	O
"."	pointer
)	O
==	O
0	int
)	O
||	O
(	O
strcmp	function
(	O
dirs	array
[	O
pos	int
]	O
->	O
name	pointer
,	O
".."	pointer
)	O
==	O
0	int
)	O
)	O
break	O
;	O
if	O
(	O
dirs	array
[	O
pos	int
]	O
->	O
star	char
==	O
'*'	O
)	O
{	O
dirs	array
[	O
pos	int
]	O
->	O
star	char
=	O
' '	O
;	O
numStarred	int
--	O
;	O
}	O
else	O
{	O
if	O
(	O
dirs	array
[	O
pos	int
]	O
->	O
star	char
==	O
'^'	O
)	O
{	O
numCut	int
--	O
;	O
removeCutDir	function
(	O
pos	int
)	O
;	O
}	O
else	O
if	O
(	O
dirs	array
[	O
pos	int
]	O
->	O
star	char
==	O
'#'	O
)	O
{	O
numCopy	int
--	O
;	O
removeCopyDir	function
(	O
pos	int
)	O
;	O
}	O
dirs	array
[	O
pos	int
]	O
->	O
star	char
=	O
'*'	O
;	O
numStarred	int
++	O
;	O
}	O
fprintf	function
(	O
stdout	pointer
,	O
"\e[%d;%dH"	pointer
,	O
selectedDir	int
+	O
4	int
,	O
3	int
)	O
;	O
fprintf	function
(	O
stdout	pointer
,	O
"%c"	pointer
,	O
dirs	array
[	O
pos	int
]	O
->	O
star	char
)	O
;	O
refreshBottomView	function
(	O
)	O
;	O
break	O
;	O
case	O
(	O
FILE_WIN	int
)	O
:	O
pos	int
=	O
firstVisFile	int
+	O
selectedFile	int
;	O
if	O
(	O
files	array
[	O
pos	int
]	O
->	O
type	char
==	O
'%'	O
)	O
break	O
;	O
if	O
(	O
files	array
[	O
pos	int
]	O
->	O
star	char
==	O
'*'	O
)	O
{	O
files	array
[	O
pos	int
]	O
->	O
star	char
=	O
' '	O
;	O
numStarred	int
--	O
;	O
}	O
else	O
{	O
if	O
(	O
files	array
[	O
pos	int
]	O
->	O
star	char
==	O
'^'	O
)	O
{	O
numCut	int
--	O
;	O
removeCutFile	function
(	O
pos	int
)	O
;	O
}	O
else	O
if	O
(	O
files	array
[	O
pos	int
]	O
->	O
star	char
==	O
'#'	O
)	O
{	O
numCopy	int
--	O
;	O
removeCopyFile	function
(	O
pos	int
)	O
;	O
}	O
files	array
[	O
pos	int
]	O
->	O
star	char
=	O
'*'	O
;	O
numStarred	int
++	O
;	O
}	O
fprintf	function
(	O
stdout	pointer
,	O
"\e[%d;%dH"	pointer
,	O
selectedFile	int
+	O
4	int
,	O
(	O
SCREEN_W	int
/	O
2	int
)	O
+	O
1	int
)	O
;	O
fprintf	function
(	O
stdout	pointer
,	O
"%c"	pointer
,	O
files	array
[	O
pos	int
]	O
->	O
star	char
)	O
;	O
refreshBottomView	function
(	O
)	O
;	O
break	O
;	O
}	O
}	O
int	O
addDirEntry	function
(	O
int	O
pos	int
,	O
char	O
*	O
name	pointer
)	O
{	O
int	O
len	int
=	O
strlen	function
(	O
name	pointer
)	O
;	O
if	O
(	O
!	O
dirs	array
[	O
pos	int
]	O
)	O
{	O
dirs	array
[	O
pos	int
]	O
=	O
allocDirStructB	function
(	O
len	int
+	O
1	int
)	O
;	O
if	O
(	O
!	O
dirs	array
[	O
pos	int
]	O
)	O
return	O
0	int
;	O
}	O
else	O
{	O
free	function
(	O
dirs	array
[	O
pos	int
]	O
->	O
name	pointer
)	O
;	O
dirs	array
[	O
pos	int
]	O
->	O
name	pointer
=	O
(	O
char	O
*	O
)	O
malloc	function
(	O
len	int
+	O
1	int
)	O
;	O
if	O
(	O
!	O
dirs	array
[	O
pos	int
]	O
->	O
name	pointer
)	O
return	O
0	int
;	O
}	O
strcpy	function
(	O
dirs	array
[	O
pos	int
]	O
->	O
name	pointer
,	O
name	pointer
)	O
;	O
dirs	array
[	O
pos	int
]	O
->	O
namelen	int
=	O
len	int
;	O
return	O
1	int
;	O
}	O
int	O
addFileEntry	function
(	O
int	O
pos	int
,	O
char	O
*	O
name	pointer
)	O
{	O
int	O
len	int
=	O
strlen	function
(	O
name	pointer
)	O
;	O
if	O
(	O
!	O
files	array
[	O
pos	int
]	O
)	O
{	O
files	array
[	O
pos	int
]	O
=	O
allocFileStructB	function
(	O
len	int
+	O
1	int
)	O
;	O
if	O
(	O
!	O
files	array
[	O
pos	int
]	O
)	O
return	O
0	int
;	O
}	O
else	O
{	O
if	O
(	O
files	array
[	O
pos	int
]	O
->	O
type	char
!=	O
'%'	O
)	O
free	function
(	O
files	array
[	O
pos	int
]	O
->	O
name	pointer
)	O
;	O
files	array
[	O
pos	int
]	O
->	O
name	pointer
=	O
(	O
char	O
*	O
)	O
malloc	function
(	O
len	int
+	O
1	int
)	O
;	O
if	O
(	O
!	O
files	array
[	O
pos	int
]	O
->	O
name	pointer
)	O
return	O
0	int
;	O
}	O
strcpy	function
(	O
files	array
[	O
pos	int
]	O
->	O
name	pointer
,	O
name	pointer
)	O
;	O
files	array
[	O
pos	int
]	O
->	O
namelen	int
=	O
len	int
;	O
return	O
1	int
;	O
}	O
void	O
scanDir	function
(	O
char	O
*	O
dir	pointer
)	O
{	O
int	O
dcount	int
=	O
0	int
,	O
fcount	int
=	O
0	int
;	O
int	O
n	int
,	O
j	int
;	O
struct	O
dirent	struct
*	O
*	O
eps	pointer
;	O
struct	O
stat	struct
statbuf	struct
;	O
n	int
=	O
scandir	function
(	O
dir	pointer
,	O
&	O
eps	pointer
,	O
one	function
,	O
alphasort	function
)	O
;	O
if	O
(	O
strcmp	function
(	O
dir	pointer
,	O
"."	pointer
)	O
&&	O
strcmp	function
(	O
dir	pointer
,	O
cwd	short
)	O
)	O
{	O
j	int
=	O
chdir	function
(	O
dir	pointer
)	O
;	O
if	O
(	O
j	int
==	O
-	O
1	int
)	O
{	O
showErrorMsgBox	function
(	O
"Error changing directory:"	pointer
,	O
dir	pointer
)	O
;	O
goto	O
finish	O
;	O
}	O
if	O
(	O
cwd	short
)	O
free	function
(	O
cwd	short
)	O
;	O
cwd	short
=	O
getcwd	function
(	O
NULL	O
,	O
0	int
)	O
;	O
cwdlen	int
=	O
strlen	function
(	O
cwd	short
)	O
;	O
}	O
if	O
(	O
n	int
>=	O
0	int
)	O
{	O
int	O
cnt	int
;	O
for	O
(	O
cnt	int
=	O
0	int
;	O
cnt	int
<	O
n	int
;	O
++	O
cnt	int
)	O
{	O
char	O
*	O
d	pointer
=	O
eps	pointer
[	O
cnt	int
]	O
->	O
d_name	array
;	O
j	int
=	O
lstat	function
(	O
d	pointer
,	O
&	O
statbuf	struct
)	O
;	O
if	O
(	O
j	int
==	O
-	O
1	int
)	O
{	O
char	O
tmp	array
[	O
strlen	function
(	O
d	pointer
)	O
+	O
2	int
]	O
;	O
strcpy	function
(	O
tmp	array
,	O
": "	pointer
)	O
;	O
strcat	function
(	O
tmp	array
,	O
d	pointer
)	O
;	O
showErrorMsgBox	function
(	O
strerror	function
(	O
errno	O
)	O
,	O
tmp	array
)	O
;	O
goto	O
finish	O
;	O
}	O
if	O
(	O
S_ISDIR	O
(	O
statbuf	struct
.	O
st_mode	int
)	O
)	O
{	O
if	O
(	O
dcount	int
>=	O
MAXENTRIES	int
)	O
break	O
;	O
if	O
(	O
!	O
addDirEntry	function
(	O
dcount	int
,	O
d	pointer
)	O
)	O
{	O
msgBoxH	function
(	O
"Insufficient memory."	pointer
,	O
OK	int
,	O
ERROR	int
)	O
;	O
goto	O
finish	O
;	O
}	O
if	O
(	O
strcmp	function
(	O
d	pointer
,	O
".."	pointer
)	O
==	O
0	int
||	O
strcmp	function
(	O
d	pointer
,	O
"."	pointer
)	O
==	O
0	int
)	O
j	int
=	O
0	int
;	O
else	O
j	int
=	O
checkCutOrCopyDir	function
(	O
dcount	int
)	O
;	O
switch	O
(	O
j	int
)	O
{	O
case	O
1	int
:	O
dirs	array
[	O
dcount	int
]	O
->	O
star	char
=	O
'^'	O
;	O
break	O
;	O
case	O
2	int
:	O
dirs	array
[	O
dcount	int
]	O
->	O
star	char
=	O
'#'	O
;	O
break	O
;	O
default	O
:	O
dirs	array
[	O
dcount	int
]	O
->	O
star	char
=	O
' '	O
;	O
break	O
;	O
}	O
if	O
(	O
dirs	array
[	O
dcount	int
]	O
->	O
name	pointer
[	O
0	int
]	O
==	O
'.'	O
)	O
dirs	array
[	O
dcount	int
]	O
->	O
type	char
=	O
'h'	O
;	O
else	O
dirs	array
[	O
dcount	int
]	O
->	O
type	char
=	O
'd'	O
;	O
dcount	int
++	O
;	O
}	O
else	O
{	O
if	O
(	O
fcount	int
>=	O
MAXENTRIES	int
)	O
break	O
;	O
if	O
(	O
!	O
addFileEntry	function
(	O
fcount	int
,	O
d	pointer
)	O
)	O
{	O
msgBoxH	function
(	O
"Insufficient memory."	pointer
,	O
OK	int
,	O
ERROR	int
)	O
;	O
goto	O
finish	O
;	O
}	O
j	int
=	O
checkCutOrCopyFile	function
(	O
fcount	int
)	O
;	O
switch	O
(	O
j	int
)	O
{	O
case	O
1	int
:	O
files	array
[	O
fcount	int
]	O
->	O
star	char
=	O
'^'	O
;	O
break	O
;	O
case	O
2	int
:	O
files	array
[	O
fcount	int
]	O
->	O
star	char
=	O
'#'	O
;	O
break	O
;	O
default	O
:	O
files	array
[	O
fcount	int
]	O
->	O
star	char
=	O
' '	O
;	O
break	O
;	O
}	O
if	O
(	O
d	pointer
[	O
0	int
]	O
==	O
'.'	O
)	O
files	array
[	O
fcount	int
]	O
->	O
type	char
=	O
'h'	O
;	O
else	O
if	O
(	O
S_ISLNK	O
(	O
statbuf	struct
.	O
st_mode	int
)	O
)	O
files	array
[	O
fcount	int
]	O
->	O
type	char
=	O
'l'	O
;	O
else	O
if	O
(	O
(	O
statbuf	struct
.	O
st_mode	int
&	O
S_IXUSR	O
)	O
||	O
(	O
statbuf	struct
.	O
st_mode	int
&	O
S_IXGRP	O
)	O
||	O
(	O
statbuf	struct
.	O
st_mode	int
&	O
S_IXOTH	O
)	O
)	O
files	array
[	O
fcount	int
]	O
->	O
type	char
=	O
'x'	O
;	O
else	O
{	O
char	O
*	O
ext	pointer
=	O
strrchr	function
(	O
d	pointer
,	O
'.'	O
)	O
;	O
if	O
(	O
!	O
ext	pointer
)	O
files	array
[	O
fcount	int
]	O
->	O
type	char
=	O
'r'	O
;	O
else	O
{	O
if	O
(	O
strcasecmp	function
(	O
ext	pointer
,	O
".tar"	pointer
)	O
==	O
0	int
||	O
strcasecmp	function
(	O
ext	pointer
,	O
".gz"	pointer
)	O
==	O
0	int
||	O
strcasecmp	function
(	O
ext	pointer
,	O
".xz"	pointer
)	O
==	O
0	int
||	O
strcasecmp	function
(	O
ext	pointer
,	O
".Z"	pointer
)	O
==	O
0	int
||	O
strcasecmp	function
(	O
ext	pointer
,	O
".rar"	pointer
)	O
==	O
0	int
||	O
strcasecmp	function
(	O
ext	pointer
,	O
".zip"	pointer
)	O
==	O
0	int
||	O
strcasecmp	function
(	O
ext	pointer
,	O
".bz2"	pointer
)	O
==	O
0	int
||	O
strcasecmp	function
(	O
ext	pointer
,	O
".7z"	pointer
)	O
==	O
0	int
||	O
strcasecmp	function
(	O
ext	pointer
,	O
".lzma"	pointer
)	O
==	O
0	int
||	O
strcasecmp	function
(	O
ext	pointer
,	O
".lha"	pointer
)	O
==	O
0	int
||	O
strcasecmp	function
(	O
ext	pointer
,	O
".jar"	pointer
)	O
==	O
0	int
)	O
files	array
[	O
fcount	int
]	O
->	O
type	char
=	O
'a'	O
;	O
else	O
if	O
(	O
strcasecmp	function
(	O
ext	pointer
,	O
".bmp"	pointer
)	O
==	O
0	int
||	O
strcasecmp	function
(	O
ext	pointer
,	O
".png"	pointer
)	O
==	O
0	int
||	O
strcasecmp	function
(	O
ext	pointer
,	O
".jpg"	pointer
)	O
==	O
0	int
||	O
strcasecmp	function
(	O
ext	pointer
,	O
".jpeg"	pointer
)	O
==	O
0	int
||	O
strcasecmp	function
(	O
ext	pointer
,	O
".pcx"	pointer
)	O
==	O
0	int
||	O
strcasecmp	function
(	O
ext	pointer
,	O
".ico"	pointer
)	O
==	O
0	int
||	O
strcasecmp	function
(	O
ext	pointer
,	O
".gif"	pointer
)	O
==	O
0	int
||	O
strcasecmp	function
(	O
ext	pointer
,	O
".tiff"	pointer
)	O
==	O
0	int
)	O
files	array
[	O
fcount	int
]	O
->	O
type	char
=	O
'p'	O
;	O
else	O
files	array
[	O
fcount	int
]	O
->	O
type	char
=	O
'r'	O
;	O
}	O
}	O
fcount	int
++	O
;	O
}	O
free	function
(	O
eps	pointer
[	O
cnt	int
]	O
)	O
;	O
}	O
free	function
(	O
eps	pointer
)	O
;	O
}	O
else	O
{	O
showErrorMsgBox	function
(	O
"Failed to open directory:"	pointer
,	O
strerror	function
(	O
errno	O
)	O
)	O
;	O
goto	O
finish	O
;	O
}	O
freeFileStructs	function
(	O
fcount	int
,	O
totalFiles	int
)	O
;	O
totalFiles	int
=	O
fcount	int
;	O
if	O
(	O
totalFiles	int
<	O
numVisFiles	int
)	O
files	array
[	O
totalFiles	int
]	O
=	O
NULL	O
;	O
firstVisFile	int
=	O
0	int
;	O
selectedFile	int
=	O
0	int
;	O
freeDirStructs	function
(	O
dcount	int
,	O
totalDirs	int
)	O
;	O
totalDirs	int
=	O
dcount	int
;	O
if	O
(	O
totalDirs	int
<	O
numVisDirs	int
)	O
dirs	array
[	O
totalDirs	int
]	O
=	O
NULL	O
;	O
firstVisDir	int
=	O
0	int
;	O
selectedDir	int
=	O
0	int
;	O
numStarred	int
=	O
0	int
;	O
finish	O
:	O
refreshAll	function
(	O
)	O
;	O
}	O
void	O
refreshAll	function
(	O
)	O
{	O
setScreenColorsI	function
(	O
COLOR_WINDOW	int
)	O
;	O
drawBox	function
(	O
1	int
,	O
1	int
,	O
SCREEN_H	int
,	O
SCREEN_W	int
,	O
" Prime File Manager "	pointer
,	O
NO	int
)	O
;	O
drawMenuBar	function
(	O
2	int
,	O
2	int
,	O
SCREEN_W	int
-	O
2	int
)	O
;	O
refreshFileView	function
(	O
)	O
;	O
refreshDirView	function
(	O
)	O
;	O
refreshBottomView	function
(	O
)	O
;	O
}	O
void	O
refreshWindows	function
(	O
)	O
{	O
setScreenColorsI	function
(	O
COLOR_WINDOW	int
)	O
;	O
refreshFileView	function
(	O
)	O
;	O
refreshDirView	function
(	O
)	O
;	O
}	O
void	O
refreshDirView	function
(	O
)	O
{	O
if	O
(	O
activeWindow	int
==	O
DIR_WIN	int
)	O
setScreenColors	function
(	O
GREEN	int
,	O
BG_COLOR	array
[	O
COLOR_WINDOW	int
]	O
)	O
;	O
drawBox	function
(	O
3	int
,	O
2	int
,	O
SCREEN_H	int
-	O
5	int
,	O
(	O
int	O
)	O
(	O
SCREEN_W	int
/	O
2	int
)	O
-	O
1	int
,	O
" Directory view "	pointer
,	O
YES	int
)	O
;	O
int	O
i	int
,	O
j	int
,	O
k	int
;	O
if	O
(	O
totalDirs	int
==	O
0	int
)	O
{	O
fprintf	function
(	O
stdout	pointer
,	O
"\x1b[%d;%dH%s"	pointer
,	O
4	int
,	O
3	int
,	O
dirHighLight	pointer
)	O
;	O
fprintf	function
(	O
stdout	pointer
,	O
"\x1b[%d;%dH No directory entries found!"	pointer
,	O
4	int
,	O
3	int
)	O
;	O
return	O
;	O
}	O
for	O
(	O
i	int
=	O
0	int
;	O
i	int
<	O
numVisDirs	int
;	O
i	int
++	O
)	O
{	O
k	int
=	O
firstVisDir	int
+	O
i	int
;	O
if	O
(	O
dirs	array
[	O
k	int
]	O
==	O
NULL	O
)	O
break	O
;	O
if	O
(	O
i	int
==	O
selectedDir	int
&&	O
activeWindow	int
==	O
DIR_WIN	int
)	O
setScreenColorsI	function
(	O
COLOR_HIGHLIGHT_TEXT	int
)	O
;	O
else	O
setScreenColors	function
(	O
FILE_DIR_COLOR	array
[	O
DIRCOLOR	O
(	O
k	int
)	O
]	O
,	O
BG_COLOR	array
[	O
COLOR_WINDOW	int
]	O
)	O
;	O
print_dir_highlight	function
(	O
i	int
)	O
;	O
}	O
setScreenColorsI	function
(	O
COLOR_WINDOW	int
)	O
;	O
drawBox	function
(	O
1	int
,	O
1	int
,	O
SCREEN_H	int
,	O
SCREEN_W	int
,	O
" Prime File Manager "	pointer
,	O
NO	int
)	O
;	O
}	O
void	O
refreshFileView	function
(	O
)	O
{	O
if	O
(	O
activeWindow	int
==	O
FILE_WIN	int
)	O
setScreenColors	function
(	O
GREEN	int
,	O
BG_COLOR	array
[	O
COLOR_WINDOW	int
]	O
)	O
;	O
drawBox	function
(	O
3	int
,	O
(	O
int	O
)	O
(	O
SCREEN_W	int
/	O
2	int
)	O
,	O
SCREEN_H	int
-	O
5	int
,	O
SCREEN_W	int
-	O
1	int
,	O
" File view "	pointer
,	O
YES	int
)	O
;	O
int	O
i	int
,	O
j	int
,	O
k	int
;	O
if	O
(	O
totalFiles	int
==	O
0	int
)	O
{	O
addFileEntry	function
(	O
0	int
,	O
"(Empty folder)"	pointer
)	O
;	O
files	array
[	O
0	int
]	O
->	O
type	char
=	O
'%'	O
;	O
files	array
[	O
1	int
]	O
=	O
NULL	O
;	O
totalFiles	int
=	O
1	int
;	O
}	O
for	O
(	O
i	int
=	O
0	int
;	O
i	int
<	O
numVisFiles	int
;	O
i	int
++	O
)	O
{	O
k	int
=	O
firstVisDir	int
+	O
i	int
;	O
if	O
(	O
files	array
[	O
k	int
]	O
==	O
NULL	O
)	O
break	O
;	O
if	O
(	O
i	int
==	O
selectedFile	int
&&	O
activeWindow	int
==	O
FILE_WIN	int
)	O
setScreenColorsI	function
(	O
COLOR_HIGHLIGHT_TEXT	int
)	O
;	O
else	O
setScreenColors	function
(	O
FILE_DIR_COLOR	array
[	O
FILECOLOR	O
(	O
k	int
)	O
]	O
,	O
BG_COLOR	array
[	O
COLOR_WINDOW	int
]	O
)	O
;	O
print_file_highlight	function
(	O
i	int
)	O
;	O
}	O
setScreenColorsI	function
(	O
COLOR_WINDOW	int
)	O
;	O
drawBox	function
(	O
1	int
,	O
1	int
,	O
SCREEN_H	int
,	O
SCREEN_W	int
,	O
" Prime File Manager "	pointer
,	O
NO	int
)	O
;	O
}	O
void	O
refreshBottomView	function
(	O
)	O
{	O
setScreenColorsI	function
(	O
COLOR_WINDOW	int
)	O
;	O
drawBox	function
(	O
SCREEN_H	int
-	O
4	int
,	O
2	int
,	O
SCREEN_H	int
-	O
1	int
,	O
SCREEN_W	int
-	O
1	int
,	O
" Quick reference "	pointer
,	O
YES	int
)	O
;	O
fprintf	function
(	O
stdout	pointer
,	O
"\e[%d;%dH"	pointer
,	O
SCREEN_H	int
-	O
2	int
,	O
4	int
)	O
;	O
if	O
(	O
cwd	short
!=	O
NULL	O
)	O
{	O
if	O
(	O
strlen	function
(	O
cwd	short
)	O
>	O
SCREEN_W	int
-	O
7	int
)	O
{	O
int	O
i	int
;	O
fprintf	function
(	O
stdout	pointer
,	O
"CWD: "	pointer
)	O
;	O
for	O
(	O
i	int
=	O
0	int
;	O
i	int
<	O
SCREEN_W	int
-	O
12	int
;	O
i	int
++	O
)	O
putchar	function
(	O
cwd	short
[	O
i	int
]	O
)	O
;	O
fprintf	function
(	O
stdout	pointer
,	O
".."	pointer
)	O
;	O
}	O
else	O
{	O
fprintf	function
(	O
stdout	pointer
,	O
"CWD: %s"	pointer
,	O
cwd	short
)	O
;	O
}	O
}	O
fprintf	function
(	O
stdout	pointer
,	O
"\e[%d;%dH"	pointer
,	O
SCREEN_H	int
-	O
3	int
,	O
4	int
)	O
;	O
if	O
(	O
numStarred	int
>	O
0	int
)	O
fprintf	function
(	O
stdout	pointer
,	O
"Marked (%d) "	pointer
,	O
numStarred	int
)	O
;	O
if	O
(	O
numCut	int
>	O
0	int
)	O
fprintf	function
(	O
stdout	pointer
,	O
"Cut (%d) "	pointer
,	O
numCut	int
)	O
;	O
if	O
(	O
numCopy	int
>	O
0	int
)	O
fprintf	function
(	O
stdout	pointer
,	O
"Copy (%d) "	pointer
,	O
numCopy	int
)	O
;	O
drawBox	function
(	O
1	int
,	O
1	int
,	O
SCREEN_H	int
,	O
SCREEN_W	int
,	O
" Prime File Manager "	pointer
,	O
NO	int
)	O
;	O
}	O
void	O
drawMenuBar	function
(	O
int	O
x	int
,	O
int	O
y	int
,	O
int	O
w	int
)	O
{	O
printf	function
(	O
"\x1b[0m"	pointer
)	O
;	O
setScreenColorsI	function
(	O
COLOR_MENU_BAR	int
)	O
;	O
fprintf	function
(	O
stdout	pointer
,	O
"\x1b[%d;%dH"	pointer
,	O
x	int
,	O
y	int
)	O
;	O
int	O
i	int
,	O
j	int
,	O
lastChar	int
=	O
y	int
;	O
for	O
(	O
i	int
=	O
0	int
;	O
i	int
<	O
w	int
;	O
i	int
++	O
)	O
fputc	function
(	O
' '	O
,	O
stdout	pointer
)	O
;	O
fprintf	function
(	O
stdout	pointer
,	O
"\x1b[%d;%dH"	pointer
,	O
x	int
,	O
y	int
)	O
;	O
for	O
(	O
i	int
=	O
0	int
;	O
i	int
<	O
totalMainMenus	int
;	O
i	int
++	O
)	O
{	O
j	int
=	O
0	int
;	O
lastChar	int
++	O
;	O
fprintf	function
(	O
stdout	pointer
,	O
" "	pointer
)	O
;	O
while	O
(	O
menu	array
[	O
i	int
]	O
[	O
j	int
]	O
!=	O
'\0'	O
)	O
{	O
if	O
(	O
menu	array
[	O
i	int
]	O
[	O
j	int
]	O
==	O
'&'	O
)	O
{	O
fprintf	function
(	O
stdout	pointer
,	O
"%c"	pointer
,	O
menu	array
[	O
i	int
]	O
[	O
j	int
+	O
1	int
]	O
)	O
;	O
}	O
else	O
{	O
fprintf	function
(	O
stdout	pointer
,	O
"%c"	pointer
,	O
menu	array
[	O
i	int
]	O
[	O
j	int
+	O
1	int
]	O
)	O
;	O
}	O
lastChar	int
++	O
;	O
j	int
++	O
;	O
}	O
fprintf	function
(	O
stdout	pointer
,	O
" "	pointer
)	O
;	O
}	O
setScreenColorsI	function
(	O
COLOR_WINDOW	int
)	O
;	O
}	O
