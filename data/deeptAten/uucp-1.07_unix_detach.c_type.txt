void	O
usysdep_detach	function
(	O
)	O
{	O
pid_t	int
igrp	int
;	O
ulog	function
(	O
LOG_NORMAL	int
,	O
(	O
const	O
char	O
*	O
)	O
NULL	O
)	O
;	O
igrp	int
=	O
getpgrp	function
(	O
)	O
;	O
if	O
(	O
igrp	int
==	O
getpid	function
(	O
)	O
)	O
{	O
boolean	int
fignored	int
;	O
pid_t	int
ipid	int
;	O
usset_signal	function
(	O
SIGHUP	int
,	O
SIG_IGN	O
,	O
FALSE	O
,	O
&	O
fignored	int
)	O
;	O
ipid	int
=	O
ixsfork	function
(	O
)	O
;	O
if	O
(	O
ipid	int
<	O
0	int
)	O
ulog	function
(	O
LOG_FATAL	int
,	O
"fork: %s"	pointer
,	O
strerror	function
(	O
errno	O
)	O
)	O
;	O
if	O
(	O
ipid	int
!=	O
0	int
)	O
_exit	function
(	O
EXIT_SUCCESS	int
)	O
;	O
while	O
(	O
getppid	function
(	O
)	O
!=	O
1	int
)	O
sleep	function
(	O
1	int
)	O
;	O
ipid	int
=	O
getpid	function
(	O
)	O
;	O
ulog_id	function
(	O
ipid	int
)	O
;	O
if	O
(	O
!	O
fignored	int
)	O
usset_signal	function
(	O
SIGHUP	int
,	O
ussignal	function
,	O
TRUE	O
,	O
(	O
boolean	int
*	O
)	O
NULL	O
)	O
;	O
DEBUG_MESSAGE2	O
(	O
DEBUG_PORT	O
,	O
"usysdep_detach: Forked; old PID %ld, new pid %ld"	pointer
,	O
(	O
long	O
)	O
igrp	int
,	O
(	O
long	O
)	O
ipid	int
)	O
;	O
}	O
(	O
void	O
)	O
close	function
(	O
0	int
)	O
;	O
(	O
void	O
)	O
close	function
(	O
1	int
)	O
;	O
(	O
void	O
)	O
close	function
(	O
2	int
)	O
;	O
if	O
(	O
open	function
(	O
(	O
char	O
*	O
)	O
"/dev/null"	pointer
,	O
O_RDONLY	int
)	O
!=	O
0	int
||	O
open	function
(	O
(	O
char	O
*	O
)	O
"/dev/null"	pointer
,	O
O_WRONLY	int
)	O
!=	O
1	int
||	O
open	function
(	O
(	O
char	O
*	O
)	O
"/dev/null"	pointer
,	O
O_WRONLY	int
)	O
!=	O
2	int
)	O
ulog	function
(	O
LOG_FATAL	int
,	O
"open (/dev/null): %s"	pointer
,	O
strerror	function
(	O
errno	O
)	O
)	O
;	O
if	O
(	O
setsid	function
(	O
)	O
<	O
0	int
)	O
ulog	function
(	O
LOG_ERROR	int
,	O
"setsid: %s"	pointer
,	O
strerror	function
(	O
errno	O
)	O
)	O
;	O
}	O
